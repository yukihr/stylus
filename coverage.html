<!DOCTYPE html><html><head><title>Coverage</title><script>

headings = [];

onload = function(){
  headings = document.querySelectorAll('h2');
};

onscroll = function(e){
  var heading = find(window.scrollY);
  if (!heading) return;
  var links = document.querySelectorAll('#menu a')
    , link;

  for (var i = 0, len = links.length; i < len; ++i) {
    link = links[i];
    link.className = link.getAttribute('href') == '#' + heading.id
      ? 'active'
      : '';
  }
};

function find(y) {
  var i = headings.length
    , heading;

  while (i--) {
    heading = headings[i];
    if (y > heading.offsetTop) {
      return heading;
    }
  }
}
</script><style>

body {
  font: 14px/1.6 "Helvetica Neue", Helvetica, Arial, sans-serif;
  margin: 0;
  color: #2C2C2C;
  border-top: 2px solid #ddd;
}

#coverage {
  padding: 60px;
}

h1 a {
  color: inherit;
  font-weight: inherit;
}

h1 a:hover {
  text-decoration: none;
}

.onload h1 {
  opacity: 1;
}

h2 {
  width: 80%;
  margin-top: 80px;
  margin-bottom: 0;
  font-weight: 100;
  letter-spacing: 1px;
  border-bottom: 1px solid #eee;
}

a {
  color: #8A6343;
  font-weight: bold;
  text-decoration: none;
}

a:hover {
  text-decoration: underline;
}

ul {
  margin-top: 20px;
  padding: 0 15px;
  width: 100%;
}

ul li {
  float: left;
  width: 40%;
  margin-top: 5px;
  margin-right: 60px;
  list-style: none;
  border-bottom: 1px solid #eee;
  padding: 5px 0;
  font-size: 12px;
}

ul::after {
  content: '.';
  height: 0;
  display: block;
  visibility: hidden;
  clear: both;
}

code {
  font: 12px monaco, monospace;
}

pre {
  margin: 30px;
  padding: 30px;
  border: 1px solid #eee;
  border-bottom-color: #ddd;
  -webkit-border-radius: 2px;
  -moz-border-radius: 2px;
  -webkit-box-shadow: inset 0 0 10px #eee;
  -moz-box-shadow: inset 0 0 10px #eee;
  overflow-x: auto;
}

img {
  margin: 30px;
  padding: 1px;
  -webkit-border-radius: 3px;
  -moz-border-radius: 3px;
  -webkit-box-shadow: 0 3px 10px #dedede, 0 1px 5px #888;
  -moz-box-shadow: 0 3px 10px #dedede, 0 1px 5px #888;
  max-width: 100%;
}

footer {
  background: #eee;
  width: 100%;
  padding: 50px 0;
  text-align: right;
  border-top: 1px solid #ddd;
}

footer span {
  display: block;
  margin-right: 30px;
  color: #888;
  font-size: 12px;
}

#menu {
  position: fixed;
  font-size: 12px;
  overflow-y: auto;
  top: 0;
  right: 0;
  margin: 0;
  height: 100%;
  padding: 15px 0;
  text-align: right;
  border-left: 1px solid #eee;
  -moz-box-shadow: 0 0 2px #888
     , inset 5px 0 20px rgba(0,0,0,.5)
     , inset 5px 0 3px rgba(0,0,0,.3);
  -webkit-box-shadow: 0 0 2px #888
     , inset 5px 0 20px rgba(0,0,0,.5)
     , inset 5px 0 3px rgba(0,0,0,.3);
  -webkit-font-smoothing: antialiased;
  background: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGYAAABmCAMAAAAOARRQAAABelBMVEUjJSU6OzshIyM5OjoqKy02NjgsLS01NTYjJCUzNTUgISMlJSc0NTUvMDA6PDwlJyg1NjYoKis2NjYrLS02ODkpKyw0NDYrLC04ODovLzA4Ojo0NDUtLy86OjwjIyU4OTosLS82ODgtLS8hIyQvMTEnKCooKSsrKy0qLCwkJSUnKCkrLCwpKiwwMjIxMzMqLC0tLS0pKissLC00NTYwMDIwMTQpKysoKSovMDEtLzA2OTkxMzUrKywvLy8qKyszNTY5OzsqKiw6OjswMDExNDUoKiozNDUvMDIyNDY1Njg2Njk5OTozMzU0NjY4ODkiIyUiIyQ4OTkuMDEmKCowMjQwMTErLS4qKywwMTMhIiMpKiopKy0tLjAkJScxNDQvLzExNDYyNDQmKCk5OTslJig5OjskJSYxMzQrLS8gISIwMTIoKCk1NTUlJSUnJygwMDA4ODgiIiMhISI8PDw6Ojo5OTkpKSojIyQ7OzsyMjIpKSssLCw6Ozw1NjlrfLakAAAg2UlEQVR42jR6i3ea6rYvPgANIAhVXh8WvkQlioUiFlFcBtAmoiRNdzxqu9p0J7vrdK29zuPeex77nnvO/35n1r1ndHRktI0jTOacv/l7lCBK5UqVpOha/YxmWK7BC4TQFKVXrbYsnimqxuuMVlOQ0XltWjUdCwRJ1M+tC1KudOs9q6+da2adUewG0SC0SwELfHtgDds93VEuydEbl3QMWeNoYkR7b/0x1ZRobGI3mLwzAhePqTAwhg6aogjNsGy7/jwQ4rkdqe7CWLxF8k9LfMVFyRS7VJqtkrW8Vt/bkR8FZJao16ipknbC3Yw2lM7laO6HBEOadEZ2tpf65c4v8e3u7FyU6qbiNNyCuzXZ6pawgnwgmrpTT/Q7w2EZmiIJ0dzWDI7mhQ80IfRnMu2kzA5r5r1pIFoia+/d93HRYp1GV8TbrkWoU/+jdI0Ff6yGwTjT1Hn8J+8m1rKpGiYPuNiHnMtNMIv+zpsk84MYTNW1/+DpwXLvckdOCMYowVNPREe0QlM8xRHXXFhcNDzupwsSmb5pH+0t0RP2Qk+QtI7F1Qm6JRC6ZPBtPq/dq/kH+jxtCljn9TIpW6rQIgmSVyj6lPICIw4N/taka41PFUInth0je9+jO6Kt1G4/a7V2LEgG02B0pHVuCZrgltSKMuIl5SyufUv9mYuQi+mFgzbBEtFo2g+Dh4sSTrLNu8JPh00sQydpb00tqXBvqRN7Q7kqzcnIxCGnvZt/WmJacoOEO6Dcn8Qre03pOCSQxbMOXUuDNx9SxuLz4W1I18gvjViQ67zV0rxdWL8Te/TQkuo8STS41DR48W7L6YP2uWIqiUV8rd6Gbf/rnegKZeG8TpAM6afhGze9JAOxbLjsnUXEbrZ9vLYd7MT32cPF5mKKxmjy7huaoD9n62GOxni3iIJwv0IzZAZjdZkUtolCNLVfYZNaquFjGszVVf+J0vrz4CawoKdHnOzb0NMH7CDBOybfYNJ4rfeMyFNjkFYVTzMFs87rnPGXLUOeNKRVc0LnU7/UIgelzsy3CMuth0YfvnY0wsD3vODUL3eJcKqHQpm8yM3XZQWJxO6Un9iYloyyLpOwN2obHy6W6gbpcb44XmyC+mg+itAcaprGcrwZCqMj/GmtKn0zPvpTz/Cv1dw21XwP3cRupg3H3MF/S71eTKj1YrdwKdc2Mw0fRmb2sFf8lW3aU6JbIZSEPqvXvjM7G/aApyXlXeqKfMq0g/Su3rUGJPSPrtGElgknrZM3xUXqsAP6zMCNVn5u8aJnSNpJv2uru7t2jfRziW2+GuhqfldUNbPk71olwo+46ePUo1U3WKk/e5YK07F/wGRgcpODmQnIlVeHCWBE4puBi2jq28UKpqiN1/4UOrGz59TNYrrQHtd+11sG40BGD+pXdelNqGOg4NXe8W4eacJV/NS9/2Umtym6WQqveqR9xdCMElpxnbkalM4Vf9uaEcWZaKdyibEIjWKxJZPN95niCL3GiaXyssIrHxoLkqkzLCXULN46/f2h3tQJgyip+Tk9EAjJ9aJshq7t8X45aowSKspMSvPf7r9R8yxNptIaHS5ozuEm6luPDApugyNP8OaqiQ4BjaequXA54SLC83eHIY2r+CZp4409Xqw8Aa2oI7XkCrQi+in0w5AqF/kLNrcUz+qkl/lAobY1jSnx5OJNhyXIz3qfNFlXc0TKaglNwdWkWYt9QQ1Kr6W8zue21iNrdJk+N5oCr2O9nEtWKC7IS5J/zdDEYrmnAYfg6agCy+qcgz7ZofeDc4PbUWSvkshWuAc7OjiUyLkj+RAtdlwXJcjxdpkTTHDhK8lBCi8+JtvDVL1W6elmOM++YS0LuSlaP1oUvAeiW3cFnvTr8EbTz1tsSMYdGeZe40sRWu5uAfj7q+ZoKv2FNQ0p5XY1lmlcigHZqTPpabufEVrNuNPi165w3uCVQJHyJqmSJ7ZHnguqwtCmwViIJijj04ba2JNYtB+yORf5gg1/9t9iw4vUpeqiunSAbf+IBdj/b+iG2qrHvuNP0Vd/+ThVZT/lrvHYjjgDbbyxaqgHNM2uhxa1GW3UedZYhMMwM4mQhltouK+IV4NdbIQNM+8Yv311RZk9kT4tiYR4LkyFcuPpdcjuhUuFqBAWRZa11lcZ3gEBlXywsNhrt+plISZP5DlsV9l4EgY6J3yZPTUcMrgaWAT3oI79eSbGEbcJpr6BD8kyDiVt+G0/hXosQN4NFXKlfWIfsIs0BHODVok1/IGnKFHJYIquh8Xo+2+bkQNTGgWmN/fZ0Y33LSj6lr1GyV7mWIKg7ZTRZPGuhF/zjRNcQ1UPtSYgnWQxSs0yrVhwNDcdGMNSNe2JT3WuzbAM3HykyAajS3Uphf6STKEqxLas9EnmnhA/lyj9Uj+JoY7SVgVmGLl46Rm2u98sbkap2lzAdKBG4r6LgulQOSSjQv1GWdQ0jtDUK/mAaqM1Uqjpu4k3Rvfvxv7YTxLSK+wN3E5jVIzmF23uZ7hiH/sVP49D7tvoKp4S8b1LuvRlivVB/algbhcFITYVXvDpLzpDfplR2uD5V4XJFxpjmIpLc9Y5sB2TpBRix7Bme6GZIq+06v3XzNeTcA4obQIKxrnT4C2JpOqD92dbmSX8MGazly5EsZVMvSU1f4RZwyu8iQXbVdeLlZrjuTT1jrY1uk5c7iZ7RsvhhluqAkq4JpVQAg7RJFtSu+xgJ8Pv6O1j5DkLxT8mkbfyRW5DrQmG7hiDIjCgBsADbjuof6YHLGeV6a5Q1Smx9joUXPpdaaDx97A/Wq00oJkdR7ZYuQRfS533JtxO1erduqWOYIt3wh0wpbLuCNIYkwxbswbikCUu2CDCS+Q+7rgVtfRcm+SOcdKPRlZ/rE7wNVUEE39KTS5uvUKN1PUnkloPkyzhyGQ8qkouEjJ3H/VXdqG6asSRiw3ecMlBvDDt8dDhBHXMwZ2Cajzjr7/76T+IavqPYvz6r7//E/3X3+N//h/0QozbjPgPiir69P/8X3/9F/yv8b/827/++98WItPu5/Hvwd8YPf5bp/2/lX/T/+Of/0MJ/lYTa+L/Ef+d9vN/3/2T6P/+jyTzu/evf6U7vxN7B6pJkRtAF6jUr8I+P8RsP/ptGhfqFk+pQ/DgAy6NJtRYJdXmp4gK7WLqLKJ+MaKhGjOojvL+SnIWrkpy0SLHDe4QuyNzaEA15mLMCcmE8Em+4HdOihW4/ZWuppJEmzeAwcDtv7MuLc9y2V5atvxXNe3S4DUMt5/Qy2LM9kSYKiVWBuKlfp4nxTntpuW03JbIlkiRvBXmT23g1I2OYe6IizUHPIq6zm6mbfsbteKmi/sg9J+ocQBMctGFO7iljo8TPN+z3jxw4do+ZwfqoR9dkNTKHyM305GpTkfhcHexVkPVGEbUOjuo9f0UMPHBFlGEx0SLvJvVRKTwW7PSew5oPme+E42+frJa9cGt2njS3dK5kIif2eYbhuSEQXEqMVfUjhGIuin0G0/W5ezJyJQy3SpMLai4M0JUWb5u1k9tny5bd1pPwYBpQuDCXZl62xg4CdVEAtflXHs6JKmP/pH6mOl796Lgopj0o8d5kKh00hxG3OSdEE/QBo9Hgr8JJqAeLDwJohG5j/DGh61Rc/+tf22/8kEnxHNCEjo0ElvvGfESZkqmz2BDcKV1H1buSkhkdg7p1IMGs2s17nYjpblrWuE2K9WEO/hcRp5e9oOF/QBmOaDtgil+oaU6szPrdwW65fOB0KUTsVUn7LFU7J8e6cxJIl9+FHw5MQMzuQJ+4oxMH3iW/5GK+hWuG0T+gTLs+fAjdtUd58TmIUq04EeyRCYCjkldow234aIgR5bqwrtZosZ+6YEqAmDqatJ9lWasz4IquKALPtd92hGI3Z2BdzzZue+REl1Om4DIWD+RrtUTOJLI+S0jHowXXdAxsGLSd40zYNuEUlOGhrwL6c7tcOtUOvpJCP7QBQS19H+GvZn05ewjlVLz+IGKoC9TyfQjLMBNmXCuqqtTdOSukZW48B0HqgSTCBrBnlFvF4CG2Su7yFzqmJFURK3UmTT3ru050r0ptUpMilYnBJWfl2Bv6kPlUuE1kxxpdzui9AubsR2N2boVSu81OulAwBqoSr1LZ0LLYOomyZHmjqnXlP72s8LnDouEJjtodBvdHaG1jMySYO7crWd90MpCRyCG14vb5IE7Arupw/y/RcCm/Tm3zK6zYj8PYNaGldiUfkB/LHWcmf2lVM+mwyU27a0qq2tscrQ/vzBjN26DnntIrOyGizzXK35yKQdYnUABkyN4saz3WD/viF+eCcsXnIajdWYJWaYHRstIis9CS+tqnFGmz2j5uzfr3Z4prqgK4XOT/PyftvjZqIm8lhkfxJ7Ol3CJF1piYBGAG8wtAk56Drw1YwmOpcz+NdfkSpSLplRXLXHL0Rquj6YW/gabqgK7Dgr6NwtH0B/AN7XrN+MVJ6AmXmUuqmQulrNNYPmH0RoDogydOKLo/QbfYNARSQQKISRCzRXU+q9WWJFL3LZW6u34CkeG97xC0NNGaJ0bvK6SnZS3zPskr5EtuCgjMWR5o2x5BqhKmDWJPRe7JMEOyRb5uUKlHaGVtq5ivSOaSliSXp9SQm2qk8MRJh10MAp9QQ2H5t59J8rjiwSZtoIfMGjlLPVNdYl/LBR0AO6WLGDmkLkIPRE45Y9MftdAK/yNu1Hn6tzOQTesgQ+8fSzB19wO91vCnO23vOWQdwJ63SJrYjdfKFW6W281PKs2k8iT9ai1cgJ4sa3xqdvmtxR8/+D1B8AKc2u+6JftryRhMWSQtoSBgIyyQGyxcnELuAasXN12oSriU4RMz1DD6RL0TSV+om7i1Yt+jEE/jnawM8cX/UhN4nkiv/w9eALrzNhXuQfOzFL0Fi6SjF7/4Qn8rLYBoa85cvgAnkCEBP+HPbEnquVXCZsMS/yzYw2Vru60P/+nJPYKkzZFjmbykzUoEqV836T5q3fP/L383dF82tx18/AZgZczMAgyeWYKmSZIqtHL+e+O4ZRcq9VI3g/qPeCoiK4pcgEqdbS0S/Be54sbVQOuJVPNBblIghzeasNu7h/g+Sz1IdhI5lCwq1nUb3Ji4OCIcqQZqtqJ5w7rXrg/DA9IgVmEGhDgGecEwnCTHffXcXs0V3OCEVzYDKS1vp/oX+ng+6XVU86UjA6FMO2RXOOOrqY1GgPvrAk9HV/BXtCu5RuwF8qgdGDLsBcui4E33ymdBip1X8uKyhIWT8qNRDsXz+gvO9UiEC0d8RG4Tf2x8H4slljgHtCBcxHLTWOYJm5H/fCPCzOgf9qgOUxTRZ0Pc6ha5yLuLVT9ntvIa6gacE99mCovdUumTQdRP4RPsS9129eEe2uSvvGh0bV4Y3QPPhPZMqhZWSMa5R0Hc1SGO4IVOQc0FrirlibTVfKRrYkD8kz3b+X65/QkUNaZdrdl3mCap0Hf3YcCw/LiouJYNbqz88UqeDYv93yO7vvXtgl4XCyAO4ODkY6W+83+LZU//p3/zXNGGrUKClCiOnL27iJZbNWDF02XXAOeFlB7IaADoMH1Yqr+UP9biyZDEa/iJt4MDeIz6GKTdLVBfWGVtRN4fdT2rgReX8UXwF2zOrradm4J0nyTgdPnai3RvzpZvCKDUqjOwD/QA6EDaMCLewX6QWYVnHY1sx1bd8ovYnPm1ZvPH+rE20lWjOCnZ66/xDt0QAl15FjfBcZp+i9OU0RNPQ0t3x2pSNWo8eiYudwsnuP1Hq6iH1LJCJynkYsfgJ0p3pF6SoQk2l+jqE8CPk+ziGJRSKjs+W5AO185umPdkYzlK4wl7TC9NxyyDP7ZoyYVoXiuS6SjnInlLWrwz1i8bGTKXX0AVQWkSfIlglW3zRJRJ8bg5VgE6ZEnqNu9B++0GNQvDQJvFize4ESNKBJP+8vA3LM4AX5SIBq08Mob+7QMTCZx4nwP/64+4BnlZC+8WtlP/CXw6t1PwMwkJ3jhP1FiXLhDF/3I6FGUzO2DSi9ABxKyyL9paZxSEz40ZCPQToDAJu1959k7QdbVxgB4icsu2s4zsTPJhcEDo+N1GX4zSk/wriRh8AqwL62972i9HJHd1ydaLXVzvKvOfGGw5RVcUVMiKXFH4APdkQU/dc5BX0YfKTNZYXCW9mb8bc8mufoQP6BbdQmT99ZjoYfr/go4TgQX9IDgztim7wyFeGMfbNaeqj8Dzs38pgcqwSv2hbqB3oSGKWKy+sesY7p57wAHldqE6NDudk/W7s/zjrK4rZFlFvaGxnSZdHbc1y47qDN6xkoK8O3bfr2j41dlJZ71rB4dlDqapPFa8N6xBrprUdtenUCHwxKNhw1uuTBh+9uU45k4REpQABN2bAO9DSLqoIL26gNroWgup5pUMxHUNSq4Gyz47vBPvilpo5f9OYI2ddAqTqmnxXERxQJ3UK8fHbVE9HagHi3+tqNRoNsArdmAxHA5LwtQo9ZAaNKUTljnokljo2x8scqVpEEIPc01fPCdHOCg0DeWBz8D5TVAAfx8aRH5X2ZYNI3ebKDZdeJ+oBDAxmRqJ30Eh2/DaeAy5diVNMpEDmXiPDsGTzBLXy8eVDdJoIafgx/gxMyQi454QrW56nCyeELgSuNNEmYkflF+t3CZQOVRWjKhIuCclmQSlAXT3+4JGG75B4t/5hQ+ldMP4LsAW6z3XmU6IJJwpnGVnsgUZhoY1fZlwTR8wSU7xRejf2uCx9Z5trVTRRJP9KnEb134dEieil6eCOGWgboI7xsqsqM99jfJLTePjygKlH2CVxxsse9QRzTBFjD/Kjqitr/CCTBt/SJ6nLxz7cKP9pFqBpp0lN5y+adKNsZjrPuroemZauH9aTTFD3EKHW8S55XBLFQAt1jgxTQCTwxmx/JyfsZDN1RroN3VaxpSenpIX7K+ZbL8VdlQDcI4Cbzg3QJLa9yVqNxUelu+EtxLVqeekaAvSJkO6sSVqbUajxqhKshNpvZqoeApF0k/0P0ikkwUcbdwc4A1ejN7Oo0O15kG7hTMoK3hZRBCX7YYeLW0wvcXx/18n/u37yLgzBYVBUvORGli+sfRcX/74uD6P4hq+7xu54TlWJLFzT63uwUDwuEDdOjJQqx7JV+ZjaEAPi7t0MMrR4Q8Rkf18uxD6RK0RKh0hL8YU+DeL97i4pa5ZSyAfXKwZRS/8gXcxdZXm62RBDj8U3sN8x95b5PpPs/mCBKYvpaA50pN5Ct/499AFTtwQ5vgeSh+NHrKIi4NVpwM/XzRaNfJD856lPE6M21zWPguFsH7jbLVyEDfRmt4VwrhCJ5VTYmcSPfGgO5clfN+vbaDZ7sakU5+2vZ2WCDY031NxJarVytfDDVtiafcTGO2rJ/taoL3zChN2qmjxofczTOYQPPVQPh0JVtYgdUQINcSiNEEy58UdYXX1MpWUCEBx7LbcGtAm8XWRQTVOaoV3ySri4RShhs/B/0m4jX6OAwXOvcA09bNSG4czEGv/Wey6V/jbTCNTW6awXdNTcA1GsPe1E9fZdGl7R0vyoVpIdJtfC6d32NNErrvq/R+d65VG+YOwRXppXxOCYyGNSf1K3x6VxAW/vtz4EC1SgCOSPdN62sLsoIzuDfg8GwZAbquVO8HIuFP/ToVoeUB7nnwMF35a1wK1tI6fkrqFKhQdeJpwyls0pIy8AZde3/6LUUbFaYJthyUJSU/kqDXTLQElnn0Jr4B2RVghNrmNmoEn7pXIeshPguXVsvwoTdmClq49JJU3LWhHyWTrJL9bRP6VKv3tZoA/th77p5Jw++OEENvyvWy/pNeExiDUVQaXIRGh8xySZTI36yueFaSXo1uJY0RnXYgEOoWWOJHeaVuX/bGNhHsh2yinznl/++NJcE9j6fBPRcBdq9hb8awNw8U7Bl6GM7x69EDOIIbX/npZ++amlHR9L/35mE/2Ss4gb0xCcY4VyTFLRE796vHysLAamqcyO+aFQyJIDBNslbH2/MrAvZiSEIedc/cqjmv4fbda2pXbv+F5a2szSsdkm9noiNURXt8edUhGUF6fSZWd1IJaXKFwD+49R6eCXD4Bkef7j9tRtNMVgW8BhRz/Qpy1TmeYk0doyjZoJSbePOReVHgkFsCFuQJ+Lgc4BxeAsK/cOiNDRmdNw0ctYhn/nQ498dYI5znzGLoJi1rav7Cn88rL3wLePVtDK5gl77Tki3gHEsIAQ2+IKgarj7Y8W1IQzV5V9N+0TjLqbg68WfKcOmBCOj3JkwJhVIkwDhc+JorXuZEPMEh0vvH3x7iqf+VAwXgd4diZiaJD1zHL9Snx6Wfg4IugreyhabQkcir+y5XgDtdx3Avs7lkeeCBwDvZoTUCXx5QrZkcEqWfYEiEYRs/EphmRALSNGR1Iclgdr5VFoELpzF4++f35w3/j0t5ucW3n2ch4PQCLuUXupsPRR7UA5FjSKrMtPcKAZJfagO4lGE7FH3YKMjorpK0ZxAv+i2JkJhtAMWWWFej4RhPR/cJ3DxwocCvXDi4SGZU4cu+K32XndiFWgopAl+0GApcwf1XvymJcFs39jExIBO4yUjU9MExBLQYc9H+W7+IgdESPRpciT+rKZPebVtaVq+1GYO/5xTAL3HASjNTGIgMvdjWbgc7JvdE1zIFpuC0U9ESiZyzBixzxWxj4Kwh8My34q+FK3KNLtmsA1qyrmKSNQOXCPUZd+ONelBTvFoUI/CYsqa/RhtKiyMf2CgSFqEPk59Y3uqnlZ8gFpswfSYyko23yVZYxzKGxGm49Zqxg1l8oz5Ra9XaRwHkuxepmgyhm0SoNy2KlbcEqK+9QqS9PNx9Ihm9U7gsR55SSJ1FBDNnkuWKxIZ0SDpXuOGwZdoUbOMDPHP4vBAgz2VlSEJAHZGJVbYIg7l/FO5KfIVvxC8pPPxMGcNMoevFDeStt2iqztE10n2TA4dgJH76YS9HDhKHD3iCx6ieFX84BAI3QQnngh76f5ruPQVbr5qZmck/5UjDc26lfrOvUBWy0Ogl8bCoOkMOns81TnC3cuUS9KW8+9A+fe3XYZOFUPG1u5epSSmDLw0s5s2F0W30ANeo+zJkJQz9SPZgzwYpEoktofhGVfmLOAB20boCbW1QWq/NpET/hnMecw/uSyAH4NJc3ECOU4nnkK1fj3S/i5dwb3R7k00AqQQUwt7Ie1qV0aY/VQX0J8hLPy7eBNXMHYZYDNxHZ2Qh6AuXJxq+AeRec/Q+JLhZV6hpXwQEzw7bf5v9uUf2vpq3qlhmy0IIGTkwYdCfSAFmqbdo+3XvDTDjFJde0mbeQLcn2n31xaAqJ0ixO/CLsT4I4G4DoncVTgRGNBtsCcjISWT+oeXZ4Iedw/8OsJI1aPnNKLX/60VvcZb94uasRxCkqlPQ11u1Sa2hHvB80WQENxVyzjns0/PiEByyil21Te6oisk3mNCEMrhouCFO3yEZTHHOCMy9eb/4Tmi8cVf3Lf7P53SY2hX3PSN033As3ETIMLHWumWEO9JXHA2y2SIBlIPpLGG2qvNsCIlIr+B1SWAqRKm2w6Blf7U+zCSBwJrfHG5i8J5Gax/cVonMlon7aHJX/gSvucIncRP93XCqkv7D8IFKFsLiBgHqUpXhE3pYjEcV1dk/JD9zFVCfEaQIVX8Jmfz7IIofcBKQ4OaG+C3xC2veX9CD+iAFXDNaGg9eTVxvkbJRJlW4Nk9Wk13kn696jWppRDe/8pDrYMO9ZyxZ98ReKSz9kWKLLyk2zCZgAniCkLJVX3n1M9DYbomyahWiv/KixRIV9hj/oFz87I+HLznbPTjpa+D+bZQnMuRsljTpv90vQUt/pK7jCFnA30B/jtroSF2/m/gpWn1aQs5WeA6ghzF8SdqWI20fghdSeDOCSCmLgTkfaGgGDmw7nHFkRzGtag57IHS2na06I+gzEphXo1w/Zx2BM/jKL2nZoFjHggtFQjYi8nSVRSXIE58RPbBObXk7uuIL9+rs/5Zo7suJInEUxgsiZZAWS25iBtpEiZeBgDtghEoAE0sjcayNq85M4tbu/LF5h51335PsGzQ09O875+vUS89lkWMyNOFoip2PuyWyMP/iU2XIZdfCCJNDjebDoBLQdpy7QQZC7s9c0wjHJervQNDu2jWzBW5MSAJMr7bP+Iv92BkS/GGgzjEn7MF1IRKFwwzbjbS4/slGOmhx9cZrFu7HSEefojNv3r0UaKfKOWzXsq1zEugbzlMDFsacRJJI/iJlK3vtkZ+PLZIVMFlKA32wbq2Kd5T0uCLZ1CPkAfCdzkz2EYscjDcZq2AWfziN2covN4kXE1lQXPPLTNM1xx3tbiepcO/t3SWm4w87qfh99SL0ZnY+LKFPLPeXVM2mIIoVWt+9Nk0I7nY4O79iGYqxZ8RVz289an6NVdJWnSKZvJQCAuHNiVaDxPAFoH392t9wot5t0/qmU95eEWNbU2udUW5sN9JVqcYlvAIfLeYC33oUzzxZgSktsv21mA7Uly1FA5VnoJFh6N244Wmv3YJGFv/TCPryaw+ZORlpZjQdq/2DYXr3EZskfed0G61P09ipTKmlTQ1067Rg5+PAk5FlQ9e0SWbGf2B/08kqymOTMVOznsALHHNFH4LFRKl2F/NOiYFl9khNHnSu9Ak5sq26Ynl/i2fdTle29Y1ugqmR5Yj4YT9pvslFyYCbw0mNFr5rVQm1LvkG27QMq9ph3t8fmn6r6SQ4oSbr5tz+J1kIawGzDxb6VYOvvWhobDTXfBeNv3b4aNm5XUinsCGqG2q/45m3+LoCOsddFceYhRx1Tsss9PLdPfJdErFMjYd3gddjiP0+XQjcRadZP6bwNLySvunFf20Czy6JqdEW2a96KxdYdOryBv1BjbuUq2yCHeh+6sk7fGmmPi50pe/1l5TyPe5oHW9oPnhPswLyf2TFDdCyYlhwBCstv5C1HwlW7xWoGT9XZt4qVj5WryLPLLD6h/5cMLEjWzgCeAIKNsLak92aBqBsHl4AJwl2N4jfvbSkBExGimv0nFvv09uDScQbjx+w4kPQjgjlW+g9ws9VEJvI2k8N6XxVu0uIwovgTFdunG24gBtaDi+y1YLQwZ8mwbip5fVlO3k0n0AEr/ETbtu8Vjkm+nNSiEb7X/3fMjBL5A8PdgG+/FnbexbFFExmEfetXAnisEKy5z44WVPpQZjSy/jzeGn4yDRsFGqhh87QPaDBWhlo37IFbe/C0xynS91d2tP/AJoJS0sVF6iwAAAAAElFTkSuQmCC");
}

#logo {
  position: fixed;
  bottom: 10px;
  right: 10px;
  background: rgba(255,255,255,.1);
  font-size: 11px;
  display: block;
  width: 20px;
  height: 20px;
  line-height: 20px;
  text-align: center;
  -webkit-border-radius: 20px;
  -moz-border-radius: 20px;
  -webkit-box-shadow: 0 0 3px rgba(0,0,0,.2);
  -moz-box-shadow: 0 0 3px rgba(0,0,0,.2);
  color: inherit;
}

#menu li a {
  display: block;
  color: white;
  padding: 0 35px 0 25px;
  -webkit-transition: background 300ms;
  -moz-transition: background 300ms;
}

#menu li {
  position: relative;
  list-style: none;
}

#menu a:hover,
#menu a.active {
  text-decoration: none;
  background: rgba(255,255,255,.1);
}

#menu li:hover .cov {
  opacity: 1;
}

#menu li .dirname {
  opacity: .60;
  padding-right: 2px;
}

#menu li .basename {
  opacity: 1;
}

#menu .cov {
  background: rgba(0,0,0,.4);
  position: absolute;
  top: 0;
  right: 8px;
  font-size: 9px;
  opacity: .6;
  text-align: left;
  width: 17px;
  -webkit-border-radius: 10px;
  -moz-border-radius: 10px;
  padding: 2px 3px;
  text-align: center;
}

#stats:nth-child(2n) {
  display: inline-block;
  margin-top: 15px;
  border: 1px solid #eee;
  padding: 10px;
  -webkit-box-shadow: inset 0 0 2px #eee;
  -moz-box-shadow: inset 0 0 2px #eee;
  -webkit-border-radius: 5px;
  -moz-border-radius: 5px;
}

#stats div {
  float: left;
  padding: 0 5px;
}

#stats::after {
  display: block;
  content: '';
  clear: both;
}

#stats .sloc::after {
  content: ' SLOC';
  color: #b6b6b6;
}

#stats .percentage::after {
  content: ' coverage';
  color: #b6b6b6;
}

#stats .hits,
#stats .misses {
  display: none;
}

.high {
  color: #00d4b4;
}
.medium {
  color: #e87d0d;
}
.low {
  color: #d4081a;
}
.terrible {
  color: #d4081a;
  font-weight: bold;
}

table {
  width: 80%;
  margin-top: 10px;
  border-collapse: collapse;
  border: 1px solid #cbcbcb;
  color: #363636;
  -webkit-border-radius: 3px;
  -moz-border-radius: 3px;
}

table thead {
  display: none;
}

table td.line,
table td.hits {
  width: 20px;
  background: #eaeaea;
  text-align: center;
  font-size: 11px;
  padding: 0 10px;
  color: #949494;
}

table td.hits {
  width: 10px;
  padding: 2px 5px;
  color: rgba(0,0,0,.2);
  background: #f0f0f0;
}

tr.miss td.line,
tr.miss td.hits {
  background: #e6c3c7;
}

tr.miss td {
  background: #f8d5d8;
}

td.source {
  padding-left: 15px;
  line-height: 15px;
  white-space: pre;
  font: 12px monaco, monospace;
}

code .comment { color: #ddd }
code .init { color: #2F6FAD }
code .string { color: #5890AD }
code .keyword { color: #8A6343 }
code .number { color: #2F6FAD }
</style></head><body><div id="coverage"><h1 id="overview">Coverage</h1><div id="menu"><li><a href="#overview">overview</a></li><li><span class="cov high">88</span><a href="#stylus.js"><span class="basename">stylus.js</span></a></li><li><span class="cov high">76</span><a href="#renderer.js"><span class="basename">renderer.js</span></a></li><li><span class="cov high">98</span><a href="#parser.js"><span class="basename">parser.js</span></a></li><li><span class="cov high">97</span><a href="#lexer.js"><span class="basename">lexer.js</span></a></li><li><span class="cov high">77</span><a href="#token.js"><span class="basename">token.js</span></a></li><li><span class="cov high">100</span><a href="#nodes/index.js"><span class="dirname">nodes/</span><span class="basename">index.js</span></a></li><li><span class="cov high">89</span><a href="#nodes/node.js"><span class="dirname">nodes/</span><span class="basename">node.js</span></a></li><li><span class="cov high">96</span><a href="#visitor/evaluator.js"><span class="dirname">visitor/</span><span class="basename">evaluator.js</span></a></li><li><span class="cov high">100</span><a href="#visitor/index.js"><span class="dirname">visitor/</span><span class="basename">index.js</span></a></li><li><span class="cov high">100</span><a href="#units.js"><span class="basename">units.js</span></a></li><li><span class="cov high">94</span><a href="#stack/index.js"><span class="dirname">stack/</span><span class="basename">index.js</span></a></li><li><span class="cov high">90</span><a href="#stack/frame.js"><span class="dirname">stack/</span><span class="basename">frame.js</span></a></li><li><span class="cov high">77</span><a href="#stack/scope.js"><span class="dirname">stack/</span><span class="basename">scope.js</span></a></li><li><span class="cov medium">71</span><a href="#utils.js"><span class="basename">utils.js</span></a></li><li><span class="cov high">83</span><a href="#functions/index.js"><span class="dirname">functions/</span><span class="basename">index.js</span></a></li><li><span class="cov high">93</span><a href="#visitor/compiler.js"><span class="dirname">visitor/</span><span class="basename">compiler.js</span></a></li><li><span class="cov high">91</span><a href="#functions/image.js"><span class="dirname">functions/</span><span class="basename">image.js</span></a></li><li><span class="cov high">100</span><a href="#colors.js"><span class="basename">colors.js</span></a></li><li><span class="cov high">87</span><a href="#nodes/root.js"><span class="dirname">nodes/</span><span class="basename">root.js</span></a></li><li><span class="cov high">100</span><a href="#nodes/null.js"><span class="dirname">nodes/</span><span class="basename">null.js</span></a></li><li><span class="cov high">100</span><a href="#nodes/each.js"><span class="dirname">nodes/</span><span class="basename">each.js</span></a></li><li><span class="cov high">100</span><a href="#nodes/if.js"><span class="dirname">nodes/</span><span class="basename">if.js</span></a></li><li><span class="cov high">92</span><a href="#nodes/call.js"><span class="dirname">nodes/</span><span class="basename">call.js</span></a></li><li><span class="cov high">87</span><a href="#nodes/page.js"><span class="dirname">nodes/</span><span class="basename">page.js</span></a></li><li><span class="cov medium">58</span><a href="#nodes/fontface.js"><span class="dirname">nodes/</span><span class="basename">fontface.js</span></a></li><li><span class="cov high">100</span><a href="#nodes/unaryop.js"><span class="dirname">nodes/</span><span class="basename">unaryop.js</span></a></li><li><span class="cov high">100</span><a href="#nodes/binop.js"><span class="dirname">nodes/</span><span class="basename">binop.js</span></a></li><li><span class="cov high">100</span><a href="#nodes/ternary.js"><span class="dirname">nodes/</span><span class="basename">ternary.js</span></a></li><li><span class="cov high">96</span><a href="#nodes/block.js"><span class="dirname">nodes/</span><span class="basename">block.js</span></a></li><li><span class="cov high">78</span><a href="#nodes/unit.js"><span class="dirname">nodes/</span><span class="basename">unit.js</span></a></li><li><span class="cov high">100</span><a href="#nodes/string.js"><span class="dirname">nodes/</span><span class="basename">string.js</span></a></li><li><span class="cov high">94</span><a href="#nodes/hsla.js"><span class="dirname">nodes/</span><span class="basename">hsla.js</span></a></li><li><span class="cov high">82</span><a href="#nodes/rgba.js"><span class="dirname">nodes/</span><span class="basename">rgba.js</span></a></li><li><span class="cov high">79</span><a href="#nodes/ident.js"><span class="dirname">nodes/</span><span class="basename">ident.js</span></a></li><li><span class="cov high">100</span><a href="#nodes/group.js"><span class="dirname">nodes/</span><span class="basename">group.js</span></a></li><li><span class="cov high">78</span><a href="#nodes/literal.js"><span class="dirname">nodes/</span><span class="basename">literal.js</span></a></li><li><span class="cov medium">50</span><a href="#nodes/jsliteral.js"><span class="dirname">nodes/</span><span class="basename">jsliteral.js</span></a></li><li><span class="cov high">94</span><a href="#nodes/boolean.js"><span class="dirname">nodes/</span><span class="basename">boolean.js</span></a></li><li><span class="cov high">100</span><a href="#nodes/return.js"><span class="dirname">nodes/</span><span class="basename">return.js</span></a></li><li><span class="cov high">85</span><a href="#nodes/media.js"><span class="dirname">nodes/</span><span class="basename">media.js</span></a></li><li><span class="cov high">93</span><a href="#nodes/params.js"><span class="dirname">nodes/</span><span class="basename">params.js</span></a></li><li><span class="cov high">100</span><a href="#nodes/comment.js"><span class="dirname">nodes/</span><span class="basename">comment.js</span></a></li><li><span class="cov high">94</span><a href="#nodes/keyframes.js"><span class="dirname">nodes/</span><span class="basename">keyframes.js</span></a></li><li><span class="cov high">85</span><a href="#nodes/charset.js"><span class="dirname">nodes/</span><span class="basename">charset.js</span></a></li><li><span class="cov high">100</span><a href="#nodes/import.js"><span class="dirname">nodes/</span><span class="basename">import.js</span></a></li><li><span class="cov high">77</span><a href="#nodes/extend.js"><span class="dirname">nodes/</span><span class="basename">extend.js</span></a></li><li><span class="cov medium">73</span><a href="#nodes/function.js"><span class="dirname">nodes/</span><span class="basename">function.js</span></a></li><li><span class="cov high">88</span><a href="#nodes/property.js"><span class="dirname">nodes/</span><span class="basename">property.js</span></a></li><li><span class="cov high">92</span><a href="#nodes/selector.js"><span class="dirname">nodes/</span><span class="basename">selector.js</span></a></li><li><span class="cov high">94</span><a href="#nodes/expression.js"><span class="dirname">nodes/</span><span class="basename">expression.js</span></a></li><li><span class="cov high">100</span><a href="#nodes/arguments.js"><span class="dirname">nodes/</span><span class="basename">arguments.js</span></a></li><li><span class="cov medium">53</span><a href="#errors.js"><span class="basename">errors.js</span></a></li><li><span class="cov high">100</span><a href="#visitor/normalizer.js"><span class="dirname">visitor/</span><span class="basename">normalizer.js</span></a></li><li><span class="cov terrible">7</span><a href="#middleware.js"><span class="basename">middleware.js</span></a></li><li><span class="cov terrible">20</span><a href="#convert/css.js"><span class="dirname">convert/</span><span class="basename">css.js</span></a></li><li><span class="cov high">85</span><a href="#functions/url.js"><span class="dirname">functions/</span><span class="basename">url.js</span></a></li><a id="logo" href="http://visionmedia.github.com/mocha/">m</a></div><div id="stats" class="high"><div class="percentage">89%</div><div class="sloc">2834</div><div class="hits">2533</div><div class="misses">301</div></div><div id="files"><div class="file"><h2 id="stylus.js">stylus.js</h2><div id="stats" class="high"><div class="percentage">88%</div><div class="sloc">18</div><div class="hits">16</div><div class="misses">2</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr><td class="line">1</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source">/*!</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source"> * Stylus</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source"> * Copyright(c) 2010 LearnBoost &lt;dev@learnboost.com&gt;</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> * MIT Licensed</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source"> * Module dependencies.</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">12</td><td class="hits">1</td><td class="source">var Renderer = require('./renderer')</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source">  , Parser = require('./parser')</td></tr><tr><td class="line">14</td><td class="hits"></td><td class="source">  , nodes = require('./nodes')</td></tr><tr><td class="line">15</td><td class="hits"></td><td class="source">  , utils = require('./utils');</td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">17</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source"> * Export render as the module.</td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">21</td><td class="hits">1</td><td class="source">exports = module.exports = render;</td></tr><tr><td class="line">22</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">23</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">24</td><td class="hits"></td><td class="source"> * Library version.</td></tr><tr><td class="line">25</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">26</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">27</td><td class="hits">1</td><td class="source">exports.version = '0.24.0';</td></tr><tr><td class="line">28</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">29</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">30</td><td class="hits"></td><td class="source"> * Expose nodes.</td></tr><tr><td class="line">31</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">32</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">33</td><td class="hits">1</td><td class="source">exports.nodes = nodes;</td></tr><tr><td class="line">34</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">35</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">36</td><td class="hits"></td><td class="source"> * Expose BIFs.</td></tr><tr><td class="line">37</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">38</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">39</td><td class="hits">1</td><td class="source">exports.functions = require('./functions');</td></tr><tr><td class="line">40</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">41</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">42</td><td class="hits"></td><td class="source"> * Expose utils.</td></tr><tr><td class="line">43</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">44</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">45</td><td class="hits">1</td><td class="source">exports.utils = require('./utils');</td></tr><tr><td class="line">46</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">47</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">48</td><td class="hits"></td><td class="source"> * Expose middleware.</td></tr><tr><td class="line">49</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">50</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">51</td><td class="hits">1</td><td class="source">exports.middleware = require('./middleware');</td></tr><tr><td class="line">52</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">53</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">54</td><td class="hits"></td><td class="source"> * Expose constructors.</td></tr><tr><td class="line">55</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">56</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">57</td><td class="hits">1</td><td class="source">exports.Visitor = require('./visitor');</td></tr><tr class="hit"><td class="line">58</td><td class="hits">1</td><td class="source">exports.Parser = require('./parser');</td></tr><tr class="hit"><td class="line">59</td><td class="hits">1</td><td class="source">exports.Evaluator = require('./visitor/evaluator');</td></tr><tr class="hit"><td class="line">60</td><td class="hits">1</td><td class="source">exports.Compiler = require('./visitor/compiler');</td></tr><tr><td class="line">61</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">62</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">63</td><td class="hits"></td><td class="source"> * Convert the given `css` to `stylus` source.</td></tr><tr><td class="line">64</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">65</td><td class="hits"></td><td class="source"> * @param {String} css</td></tr><tr><td class="line">66</td><td class="hits"></td><td class="source"> * @return {String}</td></tr><tr><td class="line">67</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">68</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">69</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">70</td><td class="hits">1</td><td class="source">exports.convertCSS = require('./convert/css');</td></tr><tr><td class="line">71</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">72</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">73</td><td class="hits"></td><td class="source"> * Render the given `str` with `options` and callback `fn(err, css)`.</td></tr><tr><td class="line">74</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">75</td><td class="hits"></td><td class="source"> * @param {String} str</td></tr><tr><td class="line">76</td><td class="hits"></td><td class="source"> * @param {Object|Function} options</td></tr><tr><td class="line">77</td><td class="hits"></td><td class="source"> * @param {Function} fn</td></tr><tr><td class="line">78</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">79</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">80</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">81</td><td class="hits">1</td><td class="source">exports.render = function(str, options, fn){</td></tr><tr class="miss"><td class="line">82</td><td class="hits">0</td><td class="source">  if ('function' == typeof options) fn = options, options = {};</td></tr><tr class="miss"><td class="line">83</td><td class="hits">0</td><td class="source">  new Renderer(str, options).render(fn);</td></tr><tr><td class="line">84</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">85</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">86</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">87</td><td class="hits"></td><td class="source"> * Return a new `Renderer` for the given `str` and `options`.</td></tr><tr><td class="line">88</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">89</td><td class="hits"></td><td class="source"> * @param {String} str</td></tr><tr><td class="line">90</td><td class="hits"></td><td class="source"> * @param {Object} options</td></tr><tr><td class="line">91</td><td class="hits"></td><td class="source"> * @return {Renderer}</td></tr><tr><td class="line">92</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">93</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">94</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">95</td><td class="hits">1</td><td class="source">function render(str, options) {</td></tr><tr class="hit"><td class="line">96</td><td class="hits">208</td><td class="source">  return new Renderer(str, options);</td></tr><tr><td class="line">97</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">98</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">99</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">100</td><td class="hits"></td><td class="source"> * Expose optional functions.</td></tr><tr><td class="line">101</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">102</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">103</td><td class="hits">1</td><td class="source">exports.url = require('./functions/url');</td></tr></tbody></table></div><div class="file"><h2 id="renderer.js">renderer.js</h2><div id="stats" class="high"><div class="percentage">76%</div><div class="sloc">52</div><div class="hits">40</div><div class="misses">12</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr><td class="line">1</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source">/*!</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source"> * Stylus - Renderer</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source"> * Copyright(c) 2010 LearnBoost &lt;dev@learnboost.com&gt;</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> * MIT Licensed</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source"> * Module dependencies.</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">12</td><td class="hits">1</td><td class="source">var Parser = require('./parser')</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source">  , EventEmitter = require('events').EventEmitter</td></tr><tr><td class="line">14</td><td class="hits"></td><td class="source">  , Compiler = require('./visitor/compiler')</td></tr><tr><td class="line">15</td><td class="hits"></td><td class="source">  , Evaluator = require('./visitor/evaluator')</td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source">  , Normalizer = require('./visitor/normalizer')</td></tr><tr><td class="line">17</td><td class="hits"></td><td class="source">  , utils = require('./utils')</td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source">  , nodes = require('./nodes')</td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source">  , path = require('path')</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source">  , join = path.join;</td></tr><tr><td class="line">21</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">22</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">23</td><td class="hits"></td><td class="source"> * Expose `Renderer`.</td></tr><tr><td class="line">24</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">25</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">26</td><td class="hits">1</td><td class="source">module.exports = Renderer;</td></tr><tr><td class="line">27</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">28</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">29</td><td class="hits"></td><td class="source"> * Initialize a new `Renderer` with the given `str` and `options`.</td></tr><tr><td class="line">30</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">31</td><td class="hits"></td><td class="source"> * @param {String} str</td></tr><tr><td class="line">32</td><td class="hits"></td><td class="source"> * @param {Object} options</td></tr><tr><td class="line">33</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">34</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">35</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">36</td><td class="hits">1</td><td class="source">function Renderer(str, options) {</td></tr><tr class="hit"><td class="line">37</td><td class="hits">208</td><td class="source">  options = options || {};</td></tr><tr class="hit"><td class="line">38</td><td class="hits">208</td><td class="source">  options.globals = {};</td></tr><tr class="hit"><td class="line">39</td><td class="hits">208</td><td class="source">  options.functions = {};</td></tr><tr class="hit"><td class="line">40</td><td class="hits">208</td><td class="source">  options.imports = [join(__dirname, 'functions')];</td></tr><tr class="hit"><td class="line">41</td><td class="hits">208</td><td class="source">  options.paths = options.paths || [];</td></tr><tr class="hit"><td class="line">42</td><td class="hits">208</td><td class="source">  options.filename = options.filename || 'stylus';</td></tr><tr class="hit"><td class="line">43</td><td class="hits">208</td><td class="source">  this.options = options;</td></tr><tr class="hit"><td class="line">44</td><td class="hits">208</td><td class="source">  this.str = str;</td></tr><tr class="hit"><td class="line">45</td><td class="hits">1</td><td class="source">};</td></tr><tr><td class="line">46</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">47</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">48</td><td class="hits"></td><td class="source"> * Inherit from `EventEmitter.prototype`.</td></tr><tr><td class="line">49</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">50</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">51</td><td class="hits">1</td><td class="source">Renderer.prototype.__proto__ = EventEmitter.prototype;</td></tr><tr><td class="line">52</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">53</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">54</td><td class="hits"></td><td class="source"> * Parse and evaluate AST, then callback `fn(err, css, js)`.</td></tr><tr><td class="line">55</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">56</td><td class="hits"></td><td class="source"> * @param {Function} fn</td></tr><tr><td class="line">57</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">58</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">59</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">60</td><td class="hits">1</td><td class="source">Renderer.prototype.render = function(fn){</td></tr><tr class="hit"><td class="line">61</td><td class="hits">208</td><td class="source">  var parser = this.parser = new Parser(this.str, this.options);</td></tr><tr class="hit"><td class="line">62</td><td class="hits">208</td><td class="source">  try {</td></tr><tr class="hit"><td class="line">63</td><td class="hits">208</td><td class="source">    nodes.filename = this.options.filename;</td></tr><tr><td class="line">64</td><td class="hits"></td><td class="source">    // parse</td></tr><tr class="hit"><td class="line">65</td><td class="hits">208</td><td class="source">    var ast = parser.parse();</td></tr><tr><td class="line">66</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">67</td><td class="hits"></td><td class="source">    // evaluate</td></tr><tr class="hit"><td class="line">68</td><td class="hits">208</td><td class="source">    this.evaluator = new Evaluator(ast, this.options);</td></tr><tr class="hit"><td class="line">69</td><td class="hits">208</td><td class="source">    ast = this.evaluator.evaluate();</td></tr><tr><td class="line">70</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">71</td><td class="hits"></td><td class="source">    // normalize</td></tr><tr class="hit"><td class="line">72</td><td class="hits">208</td><td class="source">    var normalizer = new Normalizer(ast, this.options);</td></tr><tr class="hit"><td class="line">73</td><td class="hits">208</td><td class="source">    ast = normalizer.normalize();</td></tr><tr><td class="line">74</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">75</td><td class="hits"></td><td class="source">    // compile</td></tr><tr class="hit"><td class="line">76</td><td class="hits">208</td><td class="source">    var compiler = new Compiler(ast, this.options)</td></tr><tr><td class="line">77</td><td class="hits"></td><td class="source">      , css = compiler.compile();</td></tr><tr><td class="line">78</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">79</td><td class="hits">208</td><td class="source">    this.emit('end', css);</td></tr><tr class="hit"><td class="line">80</td><td class="hits">208</td><td class="source">    fn(null, css);</td></tr><tr><td class="line">81</td><td class="hits"></td><td class="source">  } catch (err) {</td></tr><tr class="miss"><td class="line">82</td><td class="hits">0</td><td class="source">    var options = {};</td></tr><tr class="miss"><td class="line">83</td><td class="hits">0</td><td class="source">    options.input = err.input || this.str;</td></tr><tr class="miss"><td class="line">84</td><td class="hits">0</td><td class="source">    options.filename = err.filename || this.options.filename;</td></tr><tr class="miss"><td class="line">85</td><td class="hits">0</td><td class="source">    options.lineno = err.lineno || parser.lexer.lineno;</td></tr><tr class="miss"><td class="line">86</td><td class="hits">0</td><td class="source">    fn(utils.formatException(err, options));</td></tr><tr><td class="line">87</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">88</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">89</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">90</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">91</td><td class="hits"></td><td class="source"> * Set option `key` to `val`.</td></tr><tr><td class="line">92</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">93</td><td class="hits"></td><td class="source"> * @param {String} key</td></tr><tr><td class="line">94</td><td class="hits"></td><td class="source"> * @param {Mixed} val</td></tr><tr><td class="line">95</td><td class="hits"></td><td class="source"> * @return {Renderer} for chaining</td></tr><tr><td class="line">96</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">97</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">98</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">99</td><td class="hits">1</td><td class="source">Renderer.prototype.set = function(key, val){</td></tr><tr class="hit"><td class="line">100</td><td class="hits">211</td><td class="source">  this.options[key] = val;</td></tr><tr class="hit"><td class="line">101</td><td class="hits">211</td><td class="source">  return this;</td></tr><tr><td class="line">102</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">103</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">104</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">105</td><td class="hits"></td><td class="source"> * Get option `key`.</td></tr><tr><td class="line">106</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">107</td><td class="hits"></td><td class="source"> * @param {String} key</td></tr><tr><td class="line">108</td><td class="hits"></td><td class="source"> * @return {Mixed} val</td></tr><tr><td class="line">109</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">110</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">111</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">112</td><td class="hits">1</td><td class="source">Renderer.prototype.get = function(key){</td></tr><tr class="miss"><td class="line">113</td><td class="hits">0</td><td class="source">  return this.options[key];</td></tr><tr><td class="line">114</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">115</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">116</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">117</td><td class="hits"></td><td class="source"> * Include the given `path` to the lookup paths array.</td></tr><tr><td class="line">118</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">119</td><td class="hits"></td><td class="source"> * @param {String} path</td></tr><tr><td class="line">120</td><td class="hits"></td><td class="source"> * @return {Renderer} for chaining</td></tr><tr><td class="line">121</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">122</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">123</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">124</td><td class="hits">1</td><td class="source">Renderer.prototype.include = function(path){</td></tr><tr class="hit"><td class="line">125</td><td class="hits">416</td><td class="source">  this.options.paths.push(path);</td></tr><tr class="hit"><td class="line">126</td><td class="hits">416</td><td class="source">  return this;</td></tr><tr><td class="line">127</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">128</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">129</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">130</td><td class="hits"></td><td class="source"> * Use the given `fn`.</td></tr><tr><td class="line">131</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">132</td><td class="hits"></td><td class="source"> * This allows for plugins to alter the renderer in</td></tr><tr><td class="line">133</td><td class="hits"></td><td class="source"> * any way they wish, exposing paths etc.</td></tr><tr><td class="line">134</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">135</td><td class="hits"></td><td class="source"> * @param {Function}</td></tr><tr><td class="line">136</td><td class="hits"></td><td class="source"> * @return {Renderer} for chaining</td></tr><tr><td class="line">137</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">138</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">139</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">140</td><td class="hits">1</td><td class="source">Renderer.prototype.use = function(fn){</td></tr><tr class="miss"><td class="line">141</td><td class="hits">0</td><td class="source">  fn.call(this, this);</td></tr><tr class="miss"><td class="line">142</td><td class="hits">0</td><td class="source">  return this;</td></tr><tr><td class="line">143</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">144</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">145</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">146</td><td class="hits"></td><td class="source"> * Define function or global var with the given `name`. Optionally</td></tr><tr><td class="line">147</td><td class="hits"></td><td class="source"> * the function may accept full expressions, by setting `raw`</td></tr><tr><td class="line">148</td><td class="hits"></td><td class="source"> * to `true`.</td></tr><tr><td class="line">149</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">150</td><td class="hits"></td><td class="source"> * @param {String} name</td></tr><tr><td class="line">151</td><td class="hits"></td><td class="source"> * @param {Function|Node} fn</td></tr><tr><td class="line">152</td><td class="hits"></td><td class="source"> * @return {Renderer} for chaining</td></tr><tr><td class="line">153</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">154</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">155</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">156</td><td class="hits">1</td><td class="source">Renderer.prototype.define = function(name, fn, raw){</td></tr><tr class="hit"><td class="line">157</td><td class="hits">208</td><td class="source">  fn = utils.coerce(fn);</td></tr><tr><td class="line">158</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">159</td><td class="hits">208</td><td class="source">  if (fn.nodeName) {</td></tr><tr class="miss"><td class="line">160</td><td class="hits">0</td><td class="source">    this.options.globals[name] = fn;</td></tr><tr class="miss"><td class="line">161</td><td class="hits">0</td><td class="source">    return this;</td></tr><tr><td class="line">162</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">163</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">164</td><td class="hits"></td><td class="source">  // function</td></tr><tr class="hit"><td class="line">165</td><td class="hits">208</td><td class="source">  this.options.functions[name] = fn;</td></tr><tr class="hit"><td class="line">166</td><td class="hits">208</td><td class="source">  if (undefined != raw) fn.raw = raw;</td></tr><tr class="hit"><td class="line">167</td><td class="hits">208</td><td class="source">  return this;</td></tr><tr><td class="line">168</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">169</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">170</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">171</td><td class="hits"></td><td class="source"> * Import the given `file`.</td></tr><tr><td class="line">172</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">173</td><td class="hits"></td><td class="source"> * @param {String} file</td></tr><tr><td class="line">174</td><td class="hits"></td><td class="source"> * @return {Renderer} for chaining</td></tr><tr><td class="line">175</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">176</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">177</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">178</td><td class="hits">1</td><td class="source">Renderer.prototype.import = function(file){</td></tr><tr class="miss"><td class="line">179</td><td class="hits">0</td><td class="source">  this.options.imports.push(file);</td></tr><tr class="miss"><td class="line">180</td><td class="hits">0</td><td class="source">  return this;</td></tr><tr><td class="line">181</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">182</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">183</td><td class="hits"></td><td class="source"> </td></tr></tbody></table></div><div class="file"><h2 id="parser.js">parser.js</h2><div id="stats" class="high"><div class="percentage">98%</div><div class="sloc">532</div><div class="hits">522</div><div class="misses">10</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr><td class="line">1</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source">/*!</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source"> * Stylus - Parser</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source"> * Copyright(c) 2010 LearnBoost &lt;dev@learnboost.com&gt;</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> * MIT Licensed</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source"> * Module dependencies.</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">12</td><td class="hits">1</td><td class="source">var Lexer = require('./lexer')</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source">  , nodes = require('./nodes')</td></tr><tr><td class="line">14</td><td class="hits"></td><td class="source">  , Token = require('./token')</td></tr><tr><td class="line">15</td><td class="hits"></td><td class="source">  , inspect = require('util').inspect</td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source">  , errors = require('./errors');</td></tr><tr><td class="line">17</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source">// debuggers</td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">20</td><td class="hits">1</td><td class="source">var debug = {</td></tr><tr><td class="line">21</td><td class="hits"></td><td class="source">    lexer: require('debug')('stylus:lexer')</td></tr><tr><td class="line">22</td><td class="hits"></td><td class="source">  , selector: require('debug')('stylus:parser:selector')</td></tr><tr><td class="line">23</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">24</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">25</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">26</td><td class="hits"></td><td class="source"> * Selector composite tokens.</td></tr><tr><td class="line">27</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">28</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">29</td><td class="hits">1</td><td class="source">var selectorTokens = [</td></tr><tr><td class="line">30</td><td class="hits"></td><td class="source">    'ident'</td></tr><tr><td class="line">31</td><td class="hits"></td><td class="source">  , 'string'</td></tr><tr><td class="line">32</td><td class="hits"></td><td class="source">  , 'selector'</td></tr><tr><td class="line">33</td><td class="hits"></td><td class="source">  , 'function'</td></tr><tr><td class="line">34</td><td class="hits"></td><td class="source">  , 'comment'</td></tr><tr><td class="line">35</td><td class="hits"></td><td class="source">  , 'boolean'</td></tr><tr><td class="line">36</td><td class="hits"></td><td class="source">  , 'space'</td></tr><tr><td class="line">37</td><td class="hits"></td><td class="source">  , 'color'</td></tr><tr><td class="line">38</td><td class="hits"></td><td class="source">  , 'unit'</td></tr><tr><td class="line">39</td><td class="hits"></td><td class="source">  , 'for'</td></tr><tr><td class="line">40</td><td class="hits"></td><td class="source">  , 'in'</td></tr><tr><td class="line">41</td><td class="hits"></td><td class="source">  , '['</td></tr><tr><td class="line">42</td><td class="hits"></td><td class="source">  , ']'</td></tr><tr><td class="line">43</td><td class="hits"></td><td class="source">  , '('</td></tr><tr><td class="line">44</td><td class="hits"></td><td class="source">  , ')'</td></tr><tr><td class="line">45</td><td class="hits"></td><td class="source">  , '+'</td></tr><tr><td class="line">46</td><td class="hits"></td><td class="source">  , '-'</td></tr><tr><td class="line">47</td><td class="hits"></td><td class="source">  , '*'</td></tr><tr><td class="line">48</td><td class="hits"></td><td class="source">  , '*='</td></tr><tr><td class="line">49</td><td class="hits"></td><td class="source">  , '&lt;'</td></tr><tr><td class="line">50</td><td class="hits"></td><td class="source">  , '&gt;'</td></tr><tr><td class="line">51</td><td class="hits"></td><td class="source">  , '='</td></tr><tr><td class="line">52</td><td class="hits"></td><td class="source">  , ':'</td></tr><tr><td class="line">53</td><td class="hits"></td><td class="source">  , '&amp;'</td></tr><tr><td class="line">54</td><td class="hits"></td><td class="source">  , '~'</td></tr><tr><td class="line">55</td><td class="hits"></td><td class="source">  , '{'</td></tr><tr><td class="line">56</td><td class="hits"></td><td class="source">  , '}'</td></tr><tr><td class="line">57</td><td class="hits"></td><td class="source">];</td></tr><tr><td class="line">58</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">59</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">60</td><td class="hits"></td><td class="source"> * CSS3 pseudo-selectors.</td></tr><tr><td class="line">61</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">62</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">63</td><td class="hits">1</td><td class="source">var pseudoSelectors = [</td></tr><tr><td class="line">64</td><td class="hits"></td><td class="source">    'root'</td></tr><tr><td class="line">65</td><td class="hits"></td><td class="source">  , 'nth-child'</td></tr><tr><td class="line">66</td><td class="hits"></td><td class="source">  , 'nth-last-child'</td></tr><tr><td class="line">67</td><td class="hits"></td><td class="source">  , 'nth-of-type'</td></tr><tr><td class="line">68</td><td class="hits"></td><td class="source">  , 'nth-last-of-type'</td></tr><tr><td class="line">69</td><td class="hits"></td><td class="source">  , 'first-child'</td></tr><tr><td class="line">70</td><td class="hits"></td><td class="source">  , 'last-child'</td></tr><tr><td class="line">71</td><td class="hits"></td><td class="source">  , 'first-of-type'</td></tr><tr><td class="line">72</td><td class="hits"></td><td class="source">  , 'last-of-type'</td></tr><tr><td class="line">73</td><td class="hits"></td><td class="source">  , 'only-child'</td></tr><tr><td class="line">74</td><td class="hits"></td><td class="source">  , 'only-of-type'</td></tr><tr><td class="line">75</td><td class="hits"></td><td class="source">  , 'empty'</td></tr><tr><td class="line">76</td><td class="hits"></td><td class="source">  , 'link'</td></tr><tr><td class="line">77</td><td class="hits"></td><td class="source">  , 'visited'</td></tr><tr><td class="line">78</td><td class="hits"></td><td class="source">  , 'active'</td></tr><tr><td class="line">79</td><td class="hits"></td><td class="source">  , 'hover'</td></tr><tr><td class="line">80</td><td class="hits"></td><td class="source">  , 'focus'</td></tr><tr><td class="line">81</td><td class="hits"></td><td class="source">  , 'target'</td></tr><tr><td class="line">82</td><td class="hits"></td><td class="source">  , 'lang'</td></tr><tr><td class="line">83</td><td class="hits"></td><td class="source">  , 'enabled'</td></tr><tr><td class="line">84</td><td class="hits"></td><td class="source">  , 'disabled'</td></tr><tr><td class="line">85</td><td class="hits"></td><td class="source">  , 'checked'</td></tr><tr><td class="line">86</td><td class="hits"></td><td class="source">  , 'not'</td></tr><tr><td class="line">87</td><td class="hits"></td><td class="source">];</td></tr><tr><td class="line">88</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">89</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">90</td><td class="hits"></td><td class="source"> * Initialize a new `Parser` with the given `str` and `options`.</td></tr><tr><td class="line">91</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">92</td><td class="hits"></td><td class="source"> * @param {String} str</td></tr><tr><td class="line">93</td><td class="hits"></td><td class="source"> * @param {Object} options</td></tr><tr><td class="line">94</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">95</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">96</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">97</td><td class="hits">1</td><td class="source">var Parser = module.exports = function Parser(str, options) {</td></tr><tr class="hit"><td class="line">98</td><td class="hits">430</td><td class="source">  var self = this;</td></tr><tr class="hit"><td class="line">99</td><td class="hits">430</td><td class="source">  options = options || {};</td></tr><tr class="hit"><td class="line">100</td><td class="hits">430</td><td class="source">  this.lexer = new Lexer(str, options);</td></tr><tr class="hit"><td class="line">101</td><td class="hits">430</td><td class="source">  this.root = options.root || new nodes.Root;</td></tr><tr class="hit"><td class="line">102</td><td class="hits">430</td><td class="source">  this.state = ['root'];</td></tr><tr class="hit"><td class="line">103</td><td class="hits">430</td><td class="source">  this.stash = [];</td></tr><tr class="hit"><td class="line">104</td><td class="hits">430</td><td class="source">  this.parens = 0;</td></tr><tr class="hit"><td class="line">105</td><td class="hits">430</td><td class="source">  this.css = 0;</td></tr><tr class="hit"><td class="line">106</td><td class="hits">430</td><td class="source">  this.state.pop = function(){</td></tr><tr class="hit"><td class="line">107</td><td class="hits">96765</td><td class="source">    self.prevState = [].pop.call(this);</td></tr><tr><td class="line">108</td><td class="hits"></td><td class="source">  };</td></tr><tr><td class="line">109</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">110</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">111</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">112</td><td class="hits"></td><td class="source"> * Parser prototype.</td></tr><tr><td class="line">113</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">114</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">115</td><td class="hits">1</td><td class="source">Parser.prototype = {</td></tr><tr><td class="line">116</td><td class="hits"></td><td class="source">  </td></tr><tr><td class="line">117</td><td class="hits"></td><td class="source">  /**</td></tr><tr><td class="line">118</td><td class="hits"></td><td class="source">   * Constructor.</td></tr><tr><td class="line">119</td><td class="hits"></td><td class="source">   */</td></tr><tr><td class="line">120</td><td class="hits"></td><td class="source">  </td></tr><tr><td class="line">121</td><td class="hits"></td><td class="source">  constructor: Parser,</td></tr><tr><td class="line">122</td><td class="hits"></td><td class="source">  </td></tr><tr><td class="line">123</td><td class="hits"></td><td class="source">  /**</td></tr><tr><td class="line">124</td><td class="hits"></td><td class="source">   * Return current state.</td></tr><tr><td class="line">125</td><td class="hits"></td><td class="source">   *</td></tr><tr><td class="line">126</td><td class="hits"></td><td class="source">   * @return {String}</td></tr><tr><td class="line">127</td><td class="hits"></td><td class="source">   * @api private</td></tr><tr><td class="line">128</td><td class="hits"></td><td class="source">   */</td></tr><tr><td class="line">129</td><td class="hits"></td><td class="source">  </td></tr><tr><td class="line">130</td><td class="hits"></td><td class="source">  currentState: function() {</td></tr><tr class="hit"><td class="line">131</td><td class="hits">49398</td><td class="source">    return this.state[this.state.length - 1];</td></tr><tr><td class="line">132</td><td class="hits"></td><td class="source">  },</td></tr><tr><td class="line">133</td><td class="hits"></td><td class="source">  </td></tr><tr><td class="line">134</td><td class="hits"></td><td class="source">  /**</td></tr><tr><td class="line">135</td><td class="hits"></td><td class="source">   * Parse the input, then return the root node.</td></tr><tr><td class="line">136</td><td class="hits"></td><td class="source">   *</td></tr><tr><td class="line">137</td><td class="hits"></td><td class="source">   * @return {Node}</td></tr><tr><td class="line">138</td><td class="hits"></td><td class="source">   * @api private</td></tr><tr><td class="line">139</td><td class="hits"></td><td class="source">   */</td></tr><tr><td class="line">140</td><td class="hits"></td><td class="source">  </td></tr><tr><td class="line">141</td><td class="hits"></td><td class="source">  parse: function(){</td></tr><tr class="hit"><td class="line">142</td><td class="hits">430</td><td class="source">    var block = this.parent = this.root;</td></tr><tr class="hit"><td class="line">143</td><td class="hits">430</td><td class="source">    while ('eos' != this.peek().type) {</td></tr><tr class="hit"><td class="line">144</td><td class="hits">27973</td><td class="source">      if (this.accept('newline')) continue;</td></tr><tr class="hit"><td class="line">145</td><td class="hits">9451</td><td class="source">      var stmt = this.statement();</td></tr><tr class="hit"><td class="line">146</td><td class="hits">9451</td><td class="source">      this.accept(';');</td></tr><tr class="hit"><td class="line">147</td><td class="hits">9451</td><td class="source">      if (!stmt) this.error('unexpected token {peek}, not allowed at the root level');</td></tr><tr class="hit"><td class="line">148</td><td class="hits">9451</td><td class="source">      block.push(stmt);</td></tr><tr><td class="line">149</td><td class="hits"></td><td class="source">    }</td></tr><tr class="hit"><td class="line">150</td><td class="hits">430</td><td class="source">    return block;</td></tr><tr><td class="line">151</td><td class="hits"></td><td class="source">  },</td></tr><tr><td class="line">152</td><td class="hits"></td><td class="source">  </td></tr><tr><td class="line">153</td><td class="hits"></td><td class="source">  /**</td></tr><tr><td class="line">154</td><td class="hits"></td><td class="source">   * Throw an `Error` with the given `msg`.</td></tr><tr><td class="line">155</td><td class="hits"></td><td class="source">   *</td></tr><tr><td class="line">156</td><td class="hits"></td><td class="source">   * @param {String} msg</td></tr><tr><td class="line">157</td><td class="hits"></td><td class="source">   * @api private</td></tr><tr><td class="line">158</td><td class="hits"></td><td class="source">   */</td></tr><tr><td class="line">159</td><td class="hits"></td><td class="source">  </td></tr><tr><td class="line">160</td><td class="hits"></td><td class="source">  error: function(msg){</td></tr><tr class="miss"><td class="line">161</td><td class="hits">0</td><td class="source">    var type = this.peek().type</td></tr><tr><td class="line">162</td><td class="hits"></td><td class="source">      , val = undefined == this.peek().val</td></tr><tr><td class="line">163</td><td class="hits"></td><td class="source">        ? ''</td></tr><tr><td class="line">164</td><td class="hits"></td><td class="source">        : ' ' + this.peek().toString();</td></tr><tr class="miss"><td class="line">165</td><td class="hits">0</td><td class="source">    if (val.trim() == type.trim()) val = '';</td></tr><tr class="miss"><td class="line">166</td><td class="hits">0</td><td class="source">    throw new errors.ParseError(msg.replace('{peek}', '&quot;' + type + val + '&quot;'));</td></tr><tr><td class="line">167</td><td class="hits"></td><td class="source">  },</td></tr><tr><td class="line">168</td><td class="hits"></td><td class="source">  </td></tr><tr><td class="line">169</td><td class="hits"></td><td class="source">  /**</td></tr><tr><td class="line">170</td><td class="hits"></td><td class="source">   * Accept the given token `type`, and return it,</td></tr><tr><td class="line">171</td><td class="hits"></td><td class="source">   * otherwise return `undefined`.</td></tr><tr><td class="line">172</td><td class="hits"></td><td class="source">   *</td></tr><tr><td class="line">173</td><td class="hits"></td><td class="source">   * @param {String} type</td></tr><tr><td class="line">174</td><td class="hits"></td><td class="source">   * @return {Token}</td></tr><tr><td class="line">175</td><td class="hits"></td><td class="source">   * @api private</td></tr><tr><td class="line">176</td><td class="hits"></td><td class="source">   */</td></tr><tr><td class="line">177</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">178</td><td class="hits"></td><td class="source">  accept: function(type){</td></tr><tr class="hit"><td class="line">179</td><td class="hits">3489044</td><td class="source">    if (type == this.peek().type) {</td></tr><tr class="hit"><td class="line">180</td><td class="hits">87379</td><td class="source">      return this.next();</td></tr><tr><td class="line">181</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">182</td><td class="hits"></td><td class="source">  },</td></tr><tr><td class="line">183</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">184</td><td class="hits"></td><td class="source">  /**</td></tr><tr><td class="line">185</td><td class="hits"></td><td class="source">   * Expect token `type` and return it, throw otherwise.</td></tr><tr><td class="line">186</td><td class="hits"></td><td class="source">   *</td></tr><tr><td class="line">187</td><td class="hits"></td><td class="source">   * @param {String} type</td></tr><tr><td class="line">188</td><td class="hits"></td><td class="source">   * @return {Token}</td></tr><tr><td class="line">189</td><td class="hits"></td><td class="source">   * @api private</td></tr><tr><td class="line">190</td><td class="hits"></td><td class="source">   */</td></tr><tr><td class="line">191</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">192</td><td class="hits"></td><td class="source">  expect: function(type){</td></tr><tr class="hit"><td class="line">193</td><td class="hits">110718</td><td class="source">    if (type != this.peek().type) {</td></tr><tr class="miss"><td class="line">194</td><td class="hits">0</td><td class="source">      this.error('expected &quot;' + type + '&quot;, got {peek}');</td></tr><tr><td class="line">195</td><td class="hits"></td><td class="source">    }</td></tr><tr class="hit"><td class="line">196</td><td class="hits">110718</td><td class="source">    return this.next();</td></tr><tr><td class="line">197</td><td class="hits"></td><td class="source">  },</td></tr><tr><td class="line">198</td><td class="hits"></td><td class="source">  </td></tr><tr><td class="line">199</td><td class="hits"></td><td class="source">  /**</td></tr><tr><td class="line">200</td><td class="hits"></td><td class="source">   * Get the next token.</td></tr><tr><td class="line">201</td><td class="hits"></td><td class="source">   *</td></tr><tr><td class="line">202</td><td class="hits"></td><td class="source">   * @return {Token}</td></tr><tr><td class="line">203</td><td class="hits"></td><td class="source">   * @api private</td></tr><tr><td class="line">204</td><td class="hits"></td><td class="source">   */</td></tr><tr><td class="line">205</td><td class="hits"></td><td class="source">  </td></tr><tr><td class="line">206</td><td class="hits"></td><td class="source">  next: function() {</td></tr><tr class="hit"><td class="line">207</td><td class="hits">220721</td><td class="source">    var tok = this.stash.length</td></tr><tr><td class="line">208</td><td class="hits"></td><td class="source">      ? this.stash.pop()</td></tr><tr><td class="line">209</td><td class="hits"></td><td class="source">      : this.lexer.next();</td></tr><tr class="hit"><td class="line">210</td><td class="hits">220721</td><td class="source">    nodes.lineno = tok.lineno;</td></tr><tr class="hit"><td class="line">211</td><td class="hits">220721</td><td class="source">    debug.lexer('%s %s', tok.type, tok.val || '');</td></tr><tr class="hit"><td class="line">212</td><td class="hits">220721</td><td class="source">    return tok;</td></tr><tr><td class="line">213</td><td class="hits"></td><td class="source">  },</td></tr><tr><td class="line">214</td><td class="hits"></td><td class="source">  </td></tr><tr><td class="line">215</td><td class="hits"></td><td class="source">  /**</td></tr><tr><td class="line">216</td><td class="hits"></td><td class="source">   * Peek with lookahead(1).</td></tr><tr><td class="line">217</td><td class="hits"></td><td class="source">   *</td></tr><tr><td class="line">218</td><td class="hits"></td><td class="source">   * @return {Token}</td></tr><tr><td class="line">219</td><td class="hits"></td><td class="source">   * @api private</td></tr><tr><td class="line">220</td><td class="hits"></td><td class="source">   */</td></tr><tr><td class="line">221</td><td class="hits"></td><td class="source">  </td></tr><tr><td class="line">222</td><td class="hits"></td><td class="source">  peek: function() {</td></tr><tr class="hit"><td class="line">223</td><td class="hits">3923543</td><td class="source">    return this.lexer.peek();</td></tr><tr><td class="line">224</td><td class="hits"></td><td class="source">  },</td></tr><tr><td class="line">225</td><td class="hits"></td><td class="source">  </td></tr><tr><td class="line">226</td><td class="hits"></td><td class="source">  /**</td></tr><tr><td class="line">227</td><td class="hits"></td><td class="source">   * Lookahead `n` tokens.</td></tr><tr><td class="line">228</td><td class="hits"></td><td class="source">   *</td></tr><tr><td class="line">229</td><td class="hits"></td><td class="source">   * @param {Number} n</td></tr><tr><td class="line">230</td><td class="hits"></td><td class="source">   * @return {Token}</td></tr><tr><td class="line">231</td><td class="hits"></td><td class="source">   * @api private</td></tr><tr><td class="line">232</td><td class="hits"></td><td class="source">   */</td></tr><tr><td class="line">233</td><td class="hits"></td><td class="source">  </td></tr><tr><td class="line">234</td><td class="hits"></td><td class="source">  lookahead: function(n){</td></tr><tr class="hit"><td class="line">235</td><td class="hits">537372</td><td class="source">    return this.lexer.lookahead(n);</td></tr><tr><td class="line">236</td><td class="hits"></td><td class="source">  },</td></tr><tr><td class="line">237</td><td class="hits"></td><td class="source">  </td></tr><tr><td class="line">238</td><td class="hits"></td><td class="source">  /**</td></tr><tr><td class="line">239</td><td class="hits"></td><td class="source">   * Check if the token at `n` is a valid selector token. </td></tr><tr><td class="line">240</td><td class="hits"></td><td class="source">   *</td></tr><tr><td class="line">241</td><td class="hits"></td><td class="source">   * @param {Number} n</td></tr><tr><td class="line">242</td><td class="hits"></td><td class="source">   * @return {Boolean}</td></tr><tr><td class="line">243</td><td class="hits"></td><td class="source">   * @api private</td></tr><tr><td class="line">244</td><td class="hits"></td><td class="source">   */</td></tr><tr><td class="line">245</td><td class="hits"></td><td class="source">  </td></tr><tr><td class="line">246</td><td class="hits"></td><td class="source">  isSelectorToken: function(n) {</td></tr><tr class="hit"><td class="line">247</td><td class="hits">50874</td><td class="source">    var la = this.lookahead(n).type;</td></tr><tr class="hit"><td class="line">248</td><td class="hits">50874</td><td class="source">    switch (la) {</td></tr><tr><td class="line">249</td><td class="hits"></td><td class="source">      case 'for':</td></tr><tr class="hit"><td class="line">250</td><td class="hits">10</td><td class="source">        return this.bracketed;</td></tr><tr><td class="line">251</td><td class="hits"></td><td class="source">      case '[':</td></tr><tr class="hit"><td class="line">252</td><td class="hits">3963</td><td class="source">        this.bracketed = true;</td></tr><tr class="hit"><td class="line">253</td><td class="hits">3963</td><td class="source">        return true;</td></tr><tr><td class="line">254</td><td class="hits"></td><td class="source">      case ']':</td></tr><tr class="hit"><td class="line">255</td><td class="hits">3947</td><td class="source">        this.bracketed = false;</td></tr><tr class="hit"><td class="line">256</td><td class="hits">3947</td><td class="source">        return true;</td></tr><tr><td class="line">257</td><td class="hits"></td><td class="source">      default:</td></tr><tr class="hit"><td class="line">258</td><td class="hits">42954</td><td class="source">        return ~selectorTokens.indexOf(la);</td></tr><tr><td class="line">259</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">260</td><td class="hits"></td><td class="source">  },</td></tr><tr><td class="line">261</td><td class="hits"></td><td class="source">  </td></tr><tr><td class="line">262</td><td class="hits"></td><td class="source">  /**</td></tr><tr><td class="line">263</td><td class="hits"></td><td class="source">   * Check if the token at `n` is a pseudo selector.</td></tr><tr><td class="line">264</td><td class="hits"></td><td class="source">   *</td></tr><tr><td class="line">265</td><td class="hits"></td><td class="source">   * @param {Number} n</td></tr><tr><td class="line">266</td><td class="hits"></td><td class="source">   * @return {Boolean}</td></tr><tr><td class="line">267</td><td class="hits"></td><td class="source">   * @api private</td></tr><tr><td class="line">268</td><td class="hits"></td><td class="source">   */</td></tr><tr><td class="line">269</td><td class="hits"></td><td class="source">  </td></tr><tr><td class="line">270</td><td class="hits"></td><td class="source">  isPseudoSelector: function(n){</td></tr><tr class="hit"><td class="line">271</td><td class="hits">1195</td><td class="source">    return ~pseudoSelectors.indexOf(this.lookahead(n).val.name);</td></tr><tr><td class="line">272</td><td class="hits"></td><td class="source">  },</td></tr><tr><td class="line">273</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">274</td><td class="hits"></td><td class="source">  /**</td></tr><tr><td class="line">275</td><td class="hits"></td><td class="source">   * Check if the current line contains `type`.</td></tr><tr><td class="line">276</td><td class="hits"></td><td class="source">   *</td></tr><tr><td class="line">277</td><td class="hits"></td><td class="source">   * @param {String} type</td></tr><tr><td class="line">278</td><td class="hits"></td><td class="source">   * @return {Boolean}</td></tr><tr><td class="line">279</td><td class="hits"></td><td class="source">   * @api private</td></tr><tr><td class="line">280</td><td class="hits"></td><td class="source">   */</td></tr><tr><td class="line">281</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">282</td><td class="hits"></td><td class="source">  lineContains: function(type){</td></tr><tr class="hit"><td class="line">283</td><td class="hits">510</td><td class="source">    var i = 1</td></tr><tr><td class="line">284</td><td class="hits"></td><td class="source">      , la;</td></tr><tr><td class="line">285</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">286</td><td class="hits">510</td><td class="source">    while (la = this.lookahead(i++)) {</td></tr><tr class="hit"><td class="line">287</td><td class="hits">3542</td><td class="source">      if (~['indent', 'outdent', 'newline'].indexOf(la.type)) return;</td></tr><tr class="hit"><td class="line">288</td><td class="hits">3683</td><td class="source">      if (type == la.type) return true;</td></tr><tr><td class="line">289</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">290</td><td class="hits"></td><td class="source">  },</td></tr><tr><td class="line">291</td><td class="hits"></td><td class="source">  </td></tr><tr><td class="line">292</td><td class="hits"></td><td class="source">  /**</td></tr><tr><td class="line">293</td><td class="hits"></td><td class="source">   * Valid selector tokens.</td></tr><tr><td class="line">294</td><td class="hits"></td><td class="source">   */</td></tr><tr><td class="line">295</td><td class="hits"></td><td class="source">  </td></tr><tr><td class="line">296</td><td class="hits"></td><td class="source">  selectorToken: function() {</td></tr><tr class="hit"><td class="line">297</td><td class="hits">4459</td><td class="source">    if (this.isSelectorToken(1)) {</td></tr><tr class="hit"><td class="line">298</td><td class="hits">3259</td><td class="source">      if ('{' == this.peek().type) {</td></tr><tr><td class="line">299</td><td class="hits"></td><td class="source">        // unclosed, must be a block</td></tr><tr class="hit"><td class="line">300</td><td class="hits">633</td><td class="source">        if (!this.lineContains('}')) return;</td></tr><tr><td class="line">301</td><td class="hits"></td><td class="source">        // check if ':' is within the braces.</td></tr><tr><td class="line">302</td><td class="hits"></td><td class="source">        // though not required by stylus, chances</td></tr><tr><td class="line">303</td><td class="hits"></td><td class="source">        // are if someone is using {} they will</td></tr><tr><td class="line">304</td><td class="hits"></td><td class="source">        // use css-style props, helping us with</td></tr><tr><td class="line">305</td><td class="hits"></td><td class="source">        // the ambiguity in this case</td></tr><tr class="hit"><td class="line">306</td><td class="hits">387</td><td class="source">        var i = 0</td></tr><tr><td class="line">307</td><td class="hits"></td><td class="source">          , la;</td></tr><tr class="hit"><td class="line">308</td><td class="hits">387</td><td class="source">        while (la = this.lookahead(++i)) {</td></tr><tr class="hit"><td class="line">309</td><td class="hits">1291</td><td class="source">          if ('}' == la.type) break;</td></tr><tr class="hit"><td class="line">310</td><td class="hits">1561</td><td class="source">          if (':' == la.type) return;</td></tr><tr><td class="line">311</td><td class="hits"></td><td class="source">        }</td></tr><tr><td class="line">312</td><td class="hits"></td><td class="source">      }</td></tr><tr class="hit"><td class="line">313</td><td class="hits">2788</td><td class="source">      return this.next();</td></tr><tr><td class="line">314</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">315</td><td class="hits"></td><td class="source">  },</td></tr><tr><td class="line">316</td><td class="hits"></td><td class="source">  </td></tr><tr><td class="line">317</td><td class="hits"></td><td class="source">  /**</td></tr><tr><td class="line">318</td><td class="hits"></td><td class="source">   * Consume whitespace.</td></tr><tr><td class="line">319</td><td class="hits"></td><td class="source">   */</td></tr><tr><td class="line">320</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">321</td><td class="hits"></td><td class="source">  skipWhitespace: function() {</td></tr><tr class="hit"><td class="line">322</td><td class="hits">47400</td><td class="source">    while (~['space', 'indent', 'outdent', 'newline'].indexOf(this.peek().type))</td></tr><tr class="hit"><td class="line">323</td><td class="hits">3152</td><td class="source">      this.next();</td></tr><tr><td class="line">324</td><td class="hits"></td><td class="source">  },</td></tr><tr><td class="line">325</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">326</td><td class="hits"></td><td class="source">  /**</td></tr><tr><td class="line">327</td><td class="hits"></td><td class="source">   * Consume newlines.</td></tr><tr><td class="line">328</td><td class="hits"></td><td class="source">   */</td></tr><tr><td class="line">329</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">330</td><td class="hits"></td><td class="source">  skipNewlines: function() {</td></tr><tr class="hit"><td class="line">331</td><td class="hits">48</td><td class="source">    while ('newline' == this.peek().type)</td></tr><tr class="hit"><td class="line">332</td><td class="hits">5</td><td class="source">      this.next();</td></tr><tr><td class="line">333</td><td class="hits"></td><td class="source">  },</td></tr><tr><td class="line">334</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">335</td><td class="hits"></td><td class="source">  /**</td></tr><tr><td class="line">336</td><td class="hits"></td><td class="source">   * Consume spaces.</td></tr><tr><td class="line">337</td><td class="hits"></td><td class="source">   */</td></tr><tr><td class="line">338</td><td class="hits"></td><td class="source">  </td></tr><tr><td class="line">339</td><td class="hits"></td><td class="source">  skipSpaces: function() {</td></tr><tr class="hit"><td class="line">340</td><td class="hits">3171</td><td class="source">    while ('space' == this.peek().type)</td></tr><tr class="hit"><td class="line">341</td><td class="hits">21</td><td class="source">      this.next();</td></tr><tr><td class="line">342</td><td class="hits"></td><td class="source">  },</td></tr><tr><td class="line">343</td><td class="hits"></td><td class="source">  </td></tr><tr><td class="line">344</td><td class="hits"></td><td class="source">  /**</td></tr><tr><td class="line">345</td><td class="hits"></td><td class="source">   * Check if the following sequence of tokens</td></tr><tr><td class="line">346</td><td class="hits"></td><td class="source">   * forms a function definition, ie trailing</td></tr><tr><td class="line">347</td><td class="hits"></td><td class="source">   * `{` or indentation.</td></tr><tr><td class="line">348</td><td class="hits"></td><td class="source">   */</td></tr><tr><td class="line">349</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">350</td><td class="hits"></td><td class="source">  looksLikeFunctionDefinition: function(i) {</td></tr><tr class="hit"><td class="line">351</td><td class="hits">15588</td><td class="source">    return 'indent' == this.lookahead(i).type</td></tr><tr><td class="line">352</td><td class="hits"></td><td class="source">      || '{' == this.lookahead(i).type;</td></tr><tr><td class="line">353</td><td class="hits"></td><td class="source">  },</td></tr><tr><td class="line">354</td><td class="hits"></td><td class="source">  </td></tr><tr><td class="line">355</td><td class="hits"></td><td class="source">  /**</td></tr><tr><td class="line">356</td><td class="hits"></td><td class="source">   * Check if the following sequence of tokens</td></tr><tr><td class="line">357</td><td class="hits"></td><td class="source">   * forms a selector.</td></tr><tr><td class="line">358</td><td class="hits"></td><td class="source">   */</td></tr><tr><td class="line">359</td><td class="hits"></td><td class="source">  </td></tr><tr><td class="line">360</td><td class="hits"></td><td class="source">  looksLikeSelector: function() {</td></tr><tr class="hit"><td class="line">361</td><td class="hits">6614</td><td class="source">    var i = 1</td></tr><tr><td class="line">362</td><td class="hits"></td><td class="source">      , brace;</td></tr><tr><td class="line">363</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">364</td><td class="hits"></td><td class="source">    // Assume selector when an ident is</td></tr><tr><td class="line">365</td><td class="hits"></td><td class="source">    // followed by a selector</td></tr><tr class="hit"><td class="line">366</td><td class="hits">6614</td><td class="source">    while ('ident' == this.lookahead(i).type</td></tr><tr class="hit"><td class="line">367</td><td class="hits">14</td><td class="source">      &amp;&amp; 'newline' == this.lookahead(i + 1).type) i += 2;</td></tr><tr><td class="line">368</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">369</td><td class="hits">6614</td><td class="source">    while (this.isSelectorToken(i)</td></tr><tr><td class="line">370</td><td class="hits"></td><td class="source">      || ',' == this.lookahead(i).type) {</td></tr><tr><td class="line">371</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">372</td><td class="hits">39863</td><td class="source">      if ('selector' == this.lookahead(i).type)</td></tr><tr class="hit"><td class="line">373</td><td class="hits">13</td><td class="source">        return true;</td></tr><tr><td class="line">374</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">375</td><td class="hits"></td><td class="source">      // the ':' token within braces signifies</td></tr><tr><td class="line">376</td><td class="hits"></td><td class="source">      // a selector. ex: &quot;foo{bar:'baz'}&quot;</td></tr><tr class="hit"><td class="line">377</td><td class="hits">39923</td><td class="source">      if ('{' == this.lookahead(i).type) brace = true;</td></tr><tr class="hit"><td class="line">378</td><td class="hits">39854</td><td class="source">      else if ('}' == this.lookahead(i).type) brace = false;</td></tr><tr class="hit"><td class="line">379</td><td class="hits">39856</td><td class="source">      if (brace &amp;&amp; ':' == this.lookahead(i).type) return true;</td></tr><tr><td class="line">380</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">381</td><td class="hits"></td><td class="source">      // '}' preceded by a space is considered a selector.</td></tr><tr><td class="line">382</td><td class="hits"></td><td class="source">      // for example &quot;foo{bar}{baz}&quot; may be a property,</td></tr><tr><td class="line">383</td><td class="hits"></td><td class="source">      // however &quot;foo{bar} {baz}&quot; is a selector</td></tr><tr class="hit"><td class="line">384</td><td class="hits">39844</td><td class="source">      if ('space' == this.lookahead(i).type</td></tr><tr><td class="line">385</td><td class="hits"></td><td class="source">        &amp;&amp; '{' == this.lookahead(i + 1).type)</td></tr><tr class="hit"><td class="line">386</td><td class="hits">33</td><td class="source">        return true;</td></tr><tr><td class="line">387</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">388</td><td class="hits"></td><td class="source">      // Assume pseudo selectors are NOT properties</td></tr><tr><td class="line">389</td><td class="hits"></td><td class="source">      // as 'td:th-child(1)' may look like a property</td></tr><tr><td class="line">390</td><td class="hits"></td><td class="source">      // and function call to the parser otherwise</td></tr><tr class="hit"><td class="line">391</td><td class="hits">39811</td><td class="source">      if (':' == this.lookahead(i++).type</td></tr><tr><td class="line">392</td><td class="hits"></td><td class="source">        &amp;&amp; this.isPseudoSelector(i))</td></tr><tr class="hit"><td class="line">393</td><td class="hits">10</td><td class="source">        return true;</td></tr><tr><td class="line">394</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">395</td><td class="hits">39801</td><td class="source">      if (',' == this.lookahead(i).type</td></tr><tr><td class="line">396</td><td class="hits"></td><td class="source">        &amp;&amp; 'newline' == this.lookahead(i + 1).type)</td></tr><tr class="miss"><td class="line">397</td><td class="hits">0</td><td class="source">        return true;</td></tr><tr><td class="line">398</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">399</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">400</td><td class="hits"></td><td class="source">    // Trailing comma</td></tr><tr class="hit"><td class="line">401</td><td class="hits">6552</td><td class="source">    if (',' == this.lookahead(i).type</td></tr><tr><td class="line">402</td><td class="hits"></td><td class="source">      &amp;&amp; 'newline' == this.lookahead(i + 1).type)</td></tr><tr class="miss"><td class="line">403</td><td class="hits">0</td><td class="source">      return true;</td></tr><tr><td class="line">404</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">405</td><td class="hits"></td><td class="source">    // Trailing brace</td></tr><tr class="hit"><td class="line">406</td><td class="hits">6552</td><td class="source">    if ('{' == this.lookahead(i).type</td></tr><tr><td class="line">407</td><td class="hits"></td><td class="source">      &amp;&amp; 'newline' == this.lookahead(i + 1).type)</td></tr><tr class="miss"><td class="line">408</td><td class="hits">0</td><td class="source">      return true;</td></tr><tr><td class="line">409</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">410</td><td class="hits"></td><td class="source">    // css-style mode, false on ; }</td></tr><tr class="hit"><td class="line">411</td><td class="hits">6552</td><td class="source">    if (this.css) {</td></tr><tr class="hit"><td class="line">412</td><td class="hits">1244</td><td class="source">      if (';' == this.lookahead(i) ||</td></tr><tr><td class="line">413</td><td class="hits"></td><td class="source">          '}' == this.lookahead(i))</td></tr><tr class="hit"><td class="line">414</td><td class="hits">785</td><td class="source">        return false;</td></tr><tr><td class="line">415</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">416</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">417</td><td class="hits"></td><td class="source">    // Trailing separators</td></tr><tr class="hit"><td class="line">418</td><td class="hits">5767</td><td class="source">    while (!~[</td></tr><tr><td class="line">419</td><td class="hits"></td><td class="source">        'indent'</td></tr><tr><td class="line">420</td><td class="hits"></td><td class="source">      , 'outdent'</td></tr><tr><td class="line">421</td><td class="hits"></td><td class="source">      , 'newline'</td></tr><tr><td class="line">422</td><td class="hits"></td><td class="source">      , 'for'</td></tr><tr><td class="line">423</td><td class="hits"></td><td class="source">      , 'if'</td></tr><tr><td class="line">424</td><td class="hits"></td><td class="source">      , ';'</td></tr><tr><td class="line">425</td><td class="hits"></td><td class="source">      , '}'].indexOf(this.lookahead(i).type))</td></tr><tr class="hit"><td class="line">426</td><td class="hits">3505</td><td class="source">      ++i;</td></tr><tr><td class="line">427</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">428</td><td class="hits">5767</td><td class="source">    if ('indent' == this.lookahead(i).type)</td></tr><tr class="hit"><td class="line">429</td><td class="hits">77</td><td class="source">      return true;</td></tr><tr><td class="line">430</td><td class="hits"></td><td class="source">  },</td></tr><tr><td class="line">431</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">432</td><td class="hits"></td><td class="source">  /**</td></tr><tr><td class="line">433</td><td class="hits"></td><td class="source">   * Check if the current state supports selectors.</td></tr><tr><td class="line">434</td><td class="hits"></td><td class="source">   */</td></tr><tr><td class="line">435</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">436</td><td class="hits"></td><td class="source">  stateAllowsSelector: function() {</td></tr><tr class="hit"><td class="line">437</td><td class="hits">525</td><td class="source">    switch (this.currentState()) {</td></tr><tr><td class="line">438</td><td class="hits"></td><td class="source">      case 'root':</td></tr><tr><td class="line">439</td><td class="hits"></td><td class="source">      case 'selector':</td></tr><tr><td class="line">440</td><td class="hits"></td><td class="source">      case 'conditional':</td></tr><tr><td class="line">441</td><td class="hits"></td><td class="source">      case 'keyframe':</td></tr><tr><td class="line">442</td><td class="hits"></td><td class="source">      case 'function':</td></tr><tr><td class="line">443</td><td class="hits"></td><td class="source">      case 'font-face':</td></tr><tr><td class="line">444</td><td class="hits"></td><td class="source">      case 'media':</td></tr><tr><td class="line">445</td><td class="hits"></td><td class="source">      case 'for':</td></tr><tr class="hit"><td class="line">446</td><td class="hits">523</td><td class="source">        return true;</td></tr><tr><td class="line">447</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">448</td><td class="hits"></td><td class="source">  },</td></tr><tr><td class="line">449</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">450</td><td class="hits"></td><td class="source">  /**</td></tr><tr><td class="line">451</td><td class="hits"></td><td class="source">   *   statement</td></tr><tr><td class="line">452</td><td class="hits"></td><td class="source">   * | statement 'if' expression</td></tr><tr><td class="line">453</td><td class="hits"></td><td class="source">   * | statement 'unless' expression</td></tr><tr><td class="line">454</td><td class="hits"></td><td class="source">   */</td></tr><tr><td class="line">455</td><td class="hits"></td><td class="source">  </td></tr><tr><td class="line">456</td><td class="hits"></td><td class="source">  statement: function() {</td></tr><tr class="hit"><td class="line">457</td><td class="hits">28594</td><td class="source">    var stmt = this.stmt()</td></tr><tr><td class="line">458</td><td class="hits"></td><td class="source">      , state = this.prevState</td></tr><tr><td class="line">459</td><td class="hits"></td><td class="source">      , block</td></tr><tr><td class="line">460</td><td class="hits"></td><td class="source">      , op;</td></tr><tr><td class="line">461</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">462</td><td class="hits"></td><td class="source">    // special-case statements since it</td></tr><tr><td class="line">463</td><td class="hits"></td><td class="source">    // is not an expression. We could</td></tr><tr><td class="line">464</td><td class="hits"></td><td class="source">    // implement postfix conditionals at</td></tr><tr><td class="line">465</td><td class="hits"></td><td class="source">    // the expression level, however they</td></tr><tr><td class="line">466</td><td class="hits"></td><td class="source">    // would then fail to enclose properties</td></tr><tr class="hit"><td class="line">467</td><td class="hits">28594</td><td class="source">    if (this.allowPostfix) {</td></tr><tr class="hit"><td class="line">468</td><td class="hits">2464</td><td class="source">      delete this.allowPostfix;</td></tr><tr class="hit"><td class="line">469</td><td class="hits">2464</td><td class="source">      state = 'expression';</td></tr><tr><td class="line">470</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">471</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">472</td><td class="hits">28594</td><td class="source">    switch (state) {</td></tr><tr><td class="line">473</td><td class="hits"></td><td class="source">      case 'assignment':</td></tr><tr><td class="line">474</td><td class="hits"></td><td class="source">      case 'expression':</td></tr><tr><td class="line">475</td><td class="hits"></td><td class="source">      case 'function arguments':</td></tr><tr class="hit"><td class="line">476</td><td class="hits">17514</td><td class="source">        while (op =</td></tr><tr><td class="line">477</td><td class="hits"></td><td class="source">             this.accept('if')</td></tr><tr><td class="line">478</td><td class="hits"></td><td class="source">          || this.accept('unless')</td></tr><tr><td class="line">479</td><td class="hits"></td><td class="source">          || this.accept('for')) {</td></tr><tr class="hit"><td class="line">480</td><td class="hits">468</td><td class="source">          switch (op.type) {</td></tr><tr><td class="line">481</td><td class="hits"></td><td class="source">            case 'if':</td></tr><tr><td class="line">482</td><td class="hits"></td><td class="source">            case 'unless':</td></tr><tr class="hit"><td class="line">483</td><td class="hits">253</td><td class="source">              stmt = new nodes.If(this.expression(), stmt);</td></tr><tr class="hit"><td class="line">484</td><td class="hits">253</td><td class="source">              stmt.postfix = true;</td></tr><tr class="hit"><td class="line">485</td><td class="hits">253</td><td class="source">              stmt.negate = 'unless' == op.type;</td></tr><tr class="hit"><td class="line">486</td><td class="hits">253</td><td class="source">              this.accept(';');</td></tr><tr class="hit"><td class="line">487</td><td class="hits">253</td><td class="source">              break;</td></tr><tr><td class="line">488</td><td class="hits"></td><td class="source">            case 'for':</td></tr><tr class="hit"><td class="line">489</td><td class="hits">215</td><td class="source">              var key</td></tr><tr><td class="line">490</td><td class="hits"></td><td class="source">                , val = this.id().name;</td></tr><tr class="hit"><td class="line">491</td><td class="hits">217</td><td class="source">              if (this.accept(',')) key = this.id().name;</td></tr><tr class="hit"><td class="line">492</td><td class="hits">215</td><td class="source">              this.expect('in');</td></tr><tr class="hit"><td class="line">493</td><td class="hits">215</td><td class="source">              var each = new nodes.Each(val, key, this.expression());</td></tr><tr class="hit"><td class="line">494</td><td class="hits">215</td><td class="source">              block = new nodes.Block;</td></tr><tr class="hit"><td class="line">495</td><td class="hits">215</td><td class="source">              block.push(stmt);</td></tr><tr class="hit"><td class="line">496</td><td class="hits">215</td><td class="source">              each.block = block;</td></tr><tr class="hit"><td class="line">497</td><td class="hits">215</td><td class="source">              stmt = each;</td></tr><tr><td class="line">498</td><td class="hits"></td><td class="source">          }</td></tr><tr><td class="line">499</td><td class="hits"></td><td class="source">        }</td></tr><tr><td class="line">500</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">501</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">502</td><td class="hits">28594</td><td class="source">    return stmt;</td></tr><tr><td class="line">503</td><td class="hits"></td><td class="source">  },</td></tr><tr><td class="line">504</td><td class="hits"></td><td class="source">  </td></tr><tr><td class="line">505</td><td class="hits"></td><td class="source">  /**</td></tr><tr><td class="line">506</td><td class="hits"></td><td class="source">   *    ident</td></tr><tr><td class="line">507</td><td class="hits"></td><td class="source">   *  | selector</td></tr><tr><td class="line">508</td><td class="hits"></td><td class="source">   *  | literal</td></tr><tr><td class="line">509</td><td class="hits"></td><td class="source">   *  | charset</td></tr><tr><td class="line">510</td><td class="hits"></td><td class="source">   *  | import</td></tr><tr><td class="line">511</td><td class="hits"></td><td class="source">   *  | media</td></tr><tr><td class="line">512</td><td class="hits"></td><td class="source">   *  | scope</td></tr><tr><td class="line">513</td><td class="hits"></td><td class="source">   *  | keyframes</td></tr><tr><td class="line">514</td><td class="hits"></td><td class="source">   *  | page</td></tr><tr><td class="line">515</td><td class="hits"></td><td class="source">   *  | for</td></tr><tr><td class="line">516</td><td class="hits"></td><td class="source">   *  | if</td></tr><tr><td class="line">517</td><td class="hits"></td><td class="source">   *  | unless</td></tr><tr><td class="line">518</td><td class="hits"></td><td class="source">   *  | comment</td></tr><tr><td class="line">519</td><td class="hits"></td><td class="source">   *  | expression</td></tr><tr><td class="line">520</td><td class="hits"></td><td class="source">   *  | 'return' expression</td></tr><tr><td class="line">521</td><td class="hits"></td><td class="source">   */</td></tr><tr><td class="line">522</td><td class="hits"></td><td class="source">  </td></tr><tr><td class="line">523</td><td class="hits"></td><td class="source">  stmt: function() {</td></tr><tr class="hit"><td class="line">524</td><td class="hits">28594</td><td class="source">    var type = this.peek().type;</td></tr><tr class="hit"><td class="line">525</td><td class="hits">28594</td><td class="source">    switch (type) {</td></tr><tr><td class="line">526</td><td class="hits"></td><td class="source">      case '-webkit-keyframes':</td></tr><tr><td class="line">527</td><td class="hits"></td><td class="source">      case 'keyframes':</td></tr><tr class="hit"><td class="line">528</td><td class="hits">14</td><td class="source">        return this.keyframes();</td></tr><tr><td class="line">529</td><td class="hits"></td><td class="source">      case 'font-face':</td></tr><tr class="hit"><td class="line">530</td><td class="hits">2</td><td class="source">        return this.fontface();</td></tr><tr><td class="line">531</td><td class="hits"></td><td class="source">      case 'comment':</td></tr><tr><td class="line">532</td><td class="hits"></td><td class="source">      case 'selector':</td></tr><tr><td class="line">533</td><td class="hits"></td><td class="source">      case 'literal':</td></tr><tr><td class="line">534</td><td class="hits"></td><td class="source">      case 'charset':</td></tr><tr><td class="line">535</td><td class="hits"></td><td class="source">      case 'import':</td></tr><tr><td class="line">536</td><td class="hits"></td><td class="source">      case 'extend':</td></tr><tr><td class="line">537</td><td class="hits"></td><td class="source">      case 'media':</td></tr><tr><td class="line">538</td><td class="hits"></td><td class="source">      case 'page':</td></tr><tr><td class="line">539</td><td class="hits"></td><td class="source">      case 'ident':</td></tr><tr><td class="line">540</td><td class="hits"></td><td class="source">      case 'scope':</td></tr><tr><td class="line">541</td><td class="hits"></td><td class="source">      case 'unless':</td></tr><tr><td class="line">542</td><td class="hits"></td><td class="source">      case 'function':</td></tr><tr><td class="line">543</td><td class="hits"></td><td class="source">      case 'for':</td></tr><tr><td class="line">544</td><td class="hits"></td><td class="source">      case 'if':</td></tr><tr class="hit"><td class="line">545</td><td class="hits">28001</td><td class="source">        return this[type]();</td></tr><tr><td class="line">546</td><td class="hits"></td><td class="source">      case 'return':</td></tr><tr class="hit"><td class="line">547</td><td class="hits">26</td><td class="source">        return this.return();</td></tr><tr><td class="line">548</td><td class="hits"></td><td class="source">      case '{':</td></tr><tr class="hit"><td class="line">549</td><td class="hits">45</td><td class="source">        return this.property();</td></tr><tr><td class="line">550</td><td class="hits"></td><td class="source">      default:</td></tr><tr><td class="line">551</td><td class="hits"></td><td class="source">        // Contextual selectors</td></tr><tr class="hit"><td class="line">552</td><td class="hits">506</td><td class="source">        if (this.stateAllowsSelector()) {</td></tr><tr class="hit"><td class="line">553</td><td class="hits">506</td><td class="source">          switch (type) {</td></tr><tr><td class="line">554</td><td class="hits"></td><td class="source">            case 'color':</td></tr><tr><td class="line">555</td><td class="hits"></td><td class="source">            case '~':</td></tr><tr><td class="line">556</td><td class="hits"></td><td class="source">            case '+':</td></tr><tr><td class="line">557</td><td class="hits"></td><td class="source">            case '&gt;':</td></tr><tr><td class="line">558</td><td class="hits"></td><td class="source">            case '&lt;':</td></tr><tr><td class="line">559</td><td class="hits"></td><td class="source">            case ':':</td></tr><tr><td class="line">560</td><td class="hits"></td><td class="source">            case '&amp;':</td></tr><tr><td class="line">561</td><td class="hits"></td><td class="source">            case '[':</td></tr><tr class="hit"><td class="line">562</td><td class="hits">49</td><td class="source">              return this.selector();</td></tr><tr><td class="line">563</td><td class="hits"></td><td class="source">            case '*':</td></tr><tr class="hit"><td class="line">564</td><td class="hits">18</td><td class="source">              return this.property();</td></tr><tr><td class="line">565</td><td class="hits"></td><td class="source">            case '-':</td></tr><tr class="hit"><td class="line">566</td><td class="hits">3</td><td class="source">              if ('{' == this.lookahead(2).type)</td></tr><tr class="hit"><td class="line">567</td><td class="hits">3</td><td class="source">                return this.property();</td></tr><tr><td class="line">568</td><td class="hits"></td><td class="source">          }</td></tr><tr><td class="line">569</td><td class="hits"></td><td class="source">        }</td></tr><tr><td class="line">570</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">571</td><td class="hits"></td><td class="source">        // Expression fallback</td></tr><tr class="hit"><td class="line">572</td><td class="hits">436</td><td class="source">        var expr = this.expression();</td></tr><tr class="hit"><td class="line">573</td><td class="hits">436</td><td class="source">        if (expr.isEmpty) this.error('unexpected {peek}');</td></tr><tr class="hit"><td class="line">574</td><td class="hits">436</td><td class="source">        return expr;</td></tr><tr><td class="line">575</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">576</td><td class="hits"></td><td class="source">  },</td></tr><tr><td class="line">577</td><td class="hits"></td><td class="source">  </td></tr><tr><td class="line">578</td><td class="hits"></td><td class="source">  /**</td></tr><tr><td class="line">579</td><td class="hits"></td><td class="source">   * indent (!outdent)+ outdent</td></tr><tr><td class="line">580</td><td class="hits"></td><td class="source">   */</td></tr><tr><td class="line">581</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">582</td><td class="hits"></td><td class="source">  block: function(node, scope) {</td></tr><tr class="hit"><td class="line">583</td><td class="hits">11266</td><td class="source">    var delim</td></tr><tr><td class="line">584</td><td class="hits"></td><td class="source">      , stmt</td></tr><tr><td class="line">585</td><td class="hits"></td><td class="source">      , block = this.parent = new nodes.Block(this.parent, node);</td></tr><tr><td class="line">586</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">587</td><td class="hits">13491</td><td class="source">    if (false === scope) block.scope = false;</td></tr><tr><td class="line">588</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">589</td><td class="hits"></td><td class="source">    // css-style</td></tr><tr class="hit"><td class="line">590</td><td class="hits">11266</td><td class="source">    if (this.accept('{')) {</td></tr><tr class="hit"><td class="line">591</td><td class="hits">3023</td><td class="source">      this.css++;</td></tr><tr class="hit"><td class="line">592</td><td class="hits">3023</td><td class="source">      delim = '}';</td></tr><tr class="hit"><td class="line">593</td><td class="hits">3023</td><td class="source">      this.skipWhitespace();</td></tr><tr><td class="line">594</td><td class="hits"></td><td class="source">    } else {</td></tr><tr class="hit"><td class="line">595</td><td class="hits">8243</td><td class="source">      delim = 'outdent';</td></tr><tr class="hit"><td class="line">596</td><td class="hits">8243</td><td class="source">      this.expect('indent');</td></tr><tr><td class="line">597</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">598</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">599</td><td class="hits">11266</td><td class="source">    while (delim != this.peek().type) {</td></tr><tr><td class="line">600</td><td class="hits"></td><td class="source">      // css-style</td></tr><tr class="hit"><td class="line">601</td><td class="hits">25626</td><td class="source">      if (this.css) {</td></tr><tr class="hit"><td class="line">602</td><td class="hits">3408</td><td class="source">        if (this.accept('newline')) continue;</td></tr><tr class="hit"><td class="line">603</td><td class="hits">3408</td><td class="source">        stmt = this.statement();</td></tr><tr class="hit"><td class="line">604</td><td class="hits">3408</td><td class="source">        this.accept(';');</td></tr><tr class="hit"><td class="line">605</td><td class="hits">3408</td><td class="source">        this.skipWhitespace();</td></tr><tr><td class="line">606</td><td class="hits"></td><td class="source">      } else {</td></tr><tr class="hit"><td class="line">607</td><td class="hits">28701</td><td class="source">        if (this.accept('newline')) continue;</td></tr><tr class="hit"><td class="line">608</td><td class="hits">15735</td><td class="source">        stmt = this.statement();</td></tr><tr class="hit"><td class="line">609</td><td class="hits">15735</td><td class="source">        this.accept(';');</td></tr><tr><td class="line">610</td><td class="hits"></td><td class="source">      }</td></tr><tr class="hit"><td class="line">611</td><td class="hits">19143</td><td class="source">      if (!stmt) this.error('unexpected token {peek} in block');</td></tr><tr class="hit"><td class="line">612</td><td class="hits">19143</td><td class="source">      block.push(stmt);</td></tr><tr><td class="line">613</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">614</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">615</td><td class="hits"></td><td class="source">    // css-style</td></tr><tr class="hit"><td class="line">616</td><td class="hits">11266</td><td class="source">    if (this.css) {</td></tr><tr class="hit"><td class="line">617</td><td class="hits">3023</td><td class="source">      this.skipWhitespace();</td></tr><tr class="hit"><td class="line">618</td><td class="hits">3023</td><td class="source">      this.expect('}');</td></tr><tr class="hit"><td class="line">619</td><td class="hits">3023</td><td class="source">      this.skipSpaces();</td></tr><tr class="hit"><td class="line">620</td><td class="hits">3023</td><td class="source">      this.css--;</td></tr><tr><td class="line">621</td><td class="hits"></td><td class="source">    } else {</td></tr><tr class="hit"><td class="line">622</td><td class="hits">8243</td><td class="source">      this.expect('outdent');</td></tr><tr><td class="line">623</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">624</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">625</td><td class="hits">11266</td><td class="source">    this.parent = block.parent;</td></tr><tr class="hit"><td class="line">626</td><td class="hits">11266</td><td class="source">    return block;</td></tr><tr><td class="line">627</td><td class="hits"></td><td class="source">  },</td></tr><tr><td class="line">628</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">629</td><td class="hits"></td><td class="source">  /**</td></tr><tr><td class="line">630</td><td class="hits"></td><td class="source">   * comment space*</td></tr><tr><td class="line">631</td><td class="hits"></td><td class="source">   */</td></tr><tr><td class="line">632</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">633</td><td class="hits"></td><td class="source">  comment: function(){</td></tr><tr class="hit"><td class="line">634</td><td class="hits">62</td><td class="source">    var node = this.next().val;</td></tr><tr class="hit"><td class="line">635</td><td class="hits">62</td><td class="source">    this.skipSpaces();</td></tr><tr class="hit"><td class="line">636</td><td class="hits">62</td><td class="source">    return node;</td></tr><tr><td class="line">637</td><td class="hits"></td><td class="source">  },</td></tr><tr><td class="line">638</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">639</td><td class="hits"></td><td class="source">  /**</td></tr><tr><td class="line">640</td><td class="hits"></td><td class="source">   * for val (',' key) in expr</td></tr><tr><td class="line">641</td><td class="hits"></td><td class="source">   */</td></tr><tr><td class="line">642</td><td class="hits"></td><td class="source">  </td></tr><tr><td class="line">643</td><td class="hits"></td><td class="source">  for: function() {</td></tr><tr class="hit"><td class="line">644</td><td class="hits">870</td><td class="source">    this.expect('for');</td></tr><tr class="hit"><td class="line">645</td><td class="hits">870</td><td class="source">    var key</td></tr><tr><td class="line">646</td><td class="hits"></td><td class="source">      , val = this.id().name;</td></tr><tr class="hit"><td class="line">647</td><td class="hits">1086</td><td class="source">    if (this.accept(',')) key = this.id().name;</td></tr><tr class="hit"><td class="line">648</td><td class="hits">870</td><td class="source">    this.expect('in');</td></tr><tr class="hit"><td class="line">649</td><td class="hits">870</td><td class="source">    var each = new nodes.Each(val, key, this.expression());</td></tr><tr class="hit"><td class="line">650</td><td class="hits">870</td><td class="source">    this.state.push('for');</td></tr><tr class="hit"><td class="line">651</td><td class="hits">870</td><td class="source">    each.block = this.block(each, false);</td></tr><tr class="hit"><td class="line">652</td><td class="hits">870</td><td class="source">    this.state.pop();</td></tr><tr class="hit"><td class="line">653</td><td class="hits">870</td><td class="source">    return each;</td></tr><tr><td class="line">654</td><td class="hits"></td><td class="source">  },</td></tr><tr><td class="line">655</td><td class="hits"></td><td class="source">  </td></tr><tr><td class="line">656</td><td class="hits"></td><td class="source">  /**</td></tr><tr><td class="line">657</td><td class="hits"></td><td class="source">   * return expression</td></tr><tr><td class="line">658</td><td class="hits"></td><td class="source">   */</td></tr><tr><td class="line">659</td><td class="hits"></td><td class="source">  </td></tr><tr><td class="line">660</td><td class="hits"></td><td class="source">  return: function() {</td></tr><tr class="hit"><td class="line">661</td><td class="hits">26</td><td class="source">    this.expect('return');</td></tr><tr class="hit"><td class="line">662</td><td class="hits">26</td><td class="source">    var expr = this.expression();</td></tr><tr class="hit"><td class="line">663</td><td class="hits">26</td><td class="source">    return expr.isEmpty</td></tr><tr><td class="line">664</td><td class="hits"></td><td class="source">      ? new nodes.Return</td></tr><tr><td class="line">665</td><td class="hits"></td><td class="source">      : new nodes.Return(expr);</td></tr><tr><td class="line">666</td><td class="hits"></td><td class="source">  },</td></tr><tr><td class="line">667</td><td class="hits"></td><td class="source">  </td></tr><tr><td class="line">668</td><td class="hits"></td><td class="source">  /**</td></tr><tr><td class="line">669</td><td class="hits"></td><td class="source">   * unless expression block</td></tr><tr><td class="line">670</td><td class="hits"></td><td class="source">   */</td></tr><tr><td class="line">671</td><td class="hits"></td><td class="source">  </td></tr><tr><td class="line">672</td><td class="hits"></td><td class="source">  unless: function() {</td></tr><tr class="hit"><td class="line">673</td><td class="hits">837</td><td class="source">    this.expect('unless');</td></tr><tr class="hit"><td class="line">674</td><td class="hits">837</td><td class="source">    var node = new nodes.If(this.expression(), true);</td></tr><tr class="hit"><td class="line">675</td><td class="hits">837</td><td class="source">    this.state.push('conditional');</td></tr><tr class="hit"><td class="line">676</td><td class="hits">837</td><td class="source">    node.block = this.block(node, false);</td></tr><tr class="hit"><td class="line">677</td><td class="hits">837</td><td class="source">    this.state.pop();</td></tr><tr class="hit"><td class="line">678</td><td class="hits">837</td><td class="source">    return node;</td></tr><tr><td class="line">679</td><td class="hits"></td><td class="source">  },</td></tr><tr><td class="line">680</td><td class="hits"></td><td class="source">  </td></tr><tr><td class="line">681</td><td class="hits"></td><td class="source">  /**</td></tr><tr><td class="line">682</td><td class="hits"></td><td class="source">   * if expression block (else block)?</td></tr><tr><td class="line">683</td><td class="hits"></td><td class="source">   */</td></tr><tr><td class="line">684</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">685</td><td class="hits"></td><td class="source">  if: function() {</td></tr><tr class="hit"><td class="line">686</td><td class="hits">276</td><td class="source">    this.expect('if');</td></tr><tr class="hit"><td class="line">687</td><td class="hits">276</td><td class="source">    var node = new nodes.If(this.expression());</td></tr><tr class="hit"><td class="line">688</td><td class="hits">276</td><td class="source">    this.state.push('conditional');</td></tr><tr class="hit"><td class="line">689</td><td class="hits">276</td><td class="source">    node.block = this.block(node, false);</td></tr><tr class="hit"><td class="line">690</td><td class="hits">276</td><td class="source">    while (this.accept('else')) {</td></tr><tr class="hit"><td class="line">691</td><td class="hits">242</td><td class="source">      if (this.accept('if')) {</td></tr><tr class="hit"><td class="line">692</td><td class="hits">216</td><td class="source">        var cond = this.expression()</td></tr><tr><td class="line">693</td><td class="hits"></td><td class="source">          , block = this.block(node, false);</td></tr><tr class="hit"><td class="line">694</td><td class="hits">216</td><td class="source">        node.elses.push(new nodes.If(cond, block));</td></tr><tr><td class="line">695</td><td class="hits"></td><td class="source">      } else {</td></tr><tr class="hit"><td class="line">696</td><td class="hits">26</td><td class="source">        node.elses.push(this.block(node, false));</td></tr><tr class="hit"><td class="line">697</td><td class="hits">26</td><td class="source">        break;</td></tr><tr><td class="line">698</td><td class="hits"></td><td class="source">      }</td></tr><tr><td class="line">699</td><td class="hits"></td><td class="source">    }</td></tr><tr class="hit"><td class="line">700</td><td class="hits">276</td><td class="source">    this.state.pop();</td></tr><tr class="hit"><td class="line">701</td><td class="hits">276</td><td class="source">    return node;</td></tr><tr><td class="line">702</td><td class="hits"></td><td class="source">  },</td></tr><tr><td class="line">703</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">704</td><td class="hits"></td><td class="source">  /**</td></tr><tr><td class="line">705</td><td class="hits"></td><td class="source">   * scope</td></tr><tr><td class="line">706</td><td class="hits"></td><td class="source">   */</td></tr><tr><td class="line">707</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">708</td><td class="hits"></td><td class="source">  scope: function(){</td></tr><tr class="hit"><td class="line">709</td><td class="hits">2</td><td class="source">    var val = this.expect('scope').val;</td></tr><tr class="hit"><td class="line">710</td><td class="hits">2</td><td class="source">    this.selectorScope = val;</td></tr><tr class="hit"><td class="line">711</td><td class="hits">2</td><td class="source">    return nodes.null;</td></tr><tr><td class="line">712</td><td class="hits"></td><td class="source">  },</td></tr><tr><td class="line">713</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">714</td><td class="hits"></td><td class="source">  /**</td></tr><tr><td class="line">715</td><td class="hits"></td><td class="source">   * extend</td></tr><tr><td class="line">716</td><td class="hits"></td><td class="source">   */</td></tr><tr><td class="line">717</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">718</td><td class="hits"></td><td class="source">  extend: function(){</td></tr><tr class="hit"><td class="line">719</td><td class="hits">13</td><td class="source">    var val = this.expect('extend').val;</td></tr><tr class="hit"><td class="line">720</td><td class="hits">13</td><td class="source">    return new nodes.Extend(val);</td></tr><tr><td class="line">721</td><td class="hits"></td><td class="source">  },</td></tr><tr><td class="line">722</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">723</td><td class="hits"></td><td class="source">  /**</td></tr><tr><td class="line">724</td><td class="hits"></td><td class="source">   * media</td></tr><tr><td class="line">725</td><td class="hits"></td><td class="source">   */</td></tr><tr><td class="line">726</td><td class="hits"></td><td class="source">  </td></tr><tr><td class="line">727</td><td class="hits"></td><td class="source">  media: function() {</td></tr><tr class="hit"><td class="line">728</td><td class="hits">20</td><td class="source">    var val = this.expect('media').val</td></tr><tr><td class="line">729</td><td class="hits"></td><td class="source">      , media = new nodes.Media(val);</td></tr><tr class="hit"><td class="line">730</td><td class="hits">20</td><td class="source">    this.state.push('media');</td></tr><tr class="hit"><td class="line">731</td><td class="hits">20</td><td class="source">    media.block = this.block(media);</td></tr><tr class="hit"><td class="line">732</td><td class="hits">20</td><td class="source">    this.state.pop();</td></tr><tr class="hit"><td class="line">733</td><td class="hits">20</td><td class="source">    return media;</td></tr><tr><td class="line">734</td><td class="hits"></td><td class="source">  },</td></tr><tr><td class="line">735</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">736</td><td class="hits"></td><td class="source">  /**</td></tr><tr><td class="line">737</td><td class="hits"></td><td class="source">   * fontface</td></tr><tr><td class="line">738</td><td class="hits"></td><td class="source">   */</td></tr><tr><td class="line">739</td><td class="hits"></td><td class="source">  </td></tr><tr><td class="line">740</td><td class="hits"></td><td class="source">  fontface: function() {</td></tr><tr class="hit"><td class="line">741</td><td class="hits">2</td><td class="source">    this.expect('font-face');</td></tr><tr class="hit"><td class="line">742</td><td class="hits">2</td><td class="source">    var node = new nodes.FontFace;</td></tr><tr class="hit"><td class="line">743</td><td class="hits">2</td><td class="source">    this.state.push('font-face');</td></tr><tr class="hit"><td class="line">744</td><td class="hits">2</td><td class="source">    node.block = this.block(node);</td></tr><tr class="hit"><td class="line">745</td><td class="hits">2</td><td class="source">    this.state.pop();</td></tr><tr class="hit"><td class="line">746</td><td class="hits">2</td><td class="source">    return node;</td></tr><tr><td class="line">747</td><td class="hits"></td><td class="source">  },</td></tr><tr><td class="line">748</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">749</td><td class="hits"></td><td class="source">  /**</td></tr><tr><td class="line">750</td><td class="hits"></td><td class="source">   * import expression</td></tr><tr><td class="line">751</td><td class="hits"></td><td class="source">   */</td></tr><tr><td class="line">752</td><td class="hits"></td><td class="source">   </td></tr><tr><td class="line">753</td><td class="hits"></td><td class="source">  import: function() {</td></tr><tr class="hit"><td class="line">754</td><td class="hits">22</td><td class="source">    this.expect('import');</td></tr><tr class="hit"><td class="line">755</td><td class="hits">22</td><td class="source">    this.allowPostfix = true;</td></tr><tr class="hit"><td class="line">756</td><td class="hits">22</td><td class="source">    return new nodes.Import(this.expression());</td></tr><tr><td class="line">757</td><td class="hits"></td><td class="source">  },</td></tr><tr><td class="line">758</td><td class="hits"></td><td class="source">  </td></tr><tr><td class="line">759</td><td class="hits"></td><td class="source">  /**</td></tr><tr><td class="line">760</td><td class="hits"></td><td class="source">   * charset string</td></tr><tr><td class="line">761</td><td class="hits"></td><td class="source">   */</td></tr><tr><td class="line">762</td><td class="hits"></td><td class="source">  </td></tr><tr><td class="line">763</td><td class="hits"></td><td class="source">  charset: function() {</td></tr><tr class="hit"><td class="line">764</td><td class="hits">2</td><td class="source">    this.expect('charset');</td></tr><tr class="hit"><td class="line">765</td><td class="hits">2</td><td class="source">    var str = this.expect('string').val;</td></tr><tr class="hit"><td class="line">766</td><td class="hits">2</td><td class="source">    this.allowPostfix = true;</td></tr><tr class="hit"><td class="line">767</td><td class="hits">2</td><td class="source">    return new nodes.Charset(str);</td></tr><tr><td class="line">768</td><td class="hits"></td><td class="source">  },</td></tr><tr><td class="line">769</td><td class="hits"></td><td class="source">  </td></tr><tr><td class="line">770</td><td class="hits"></td><td class="source">  /**</td></tr><tr><td class="line">771</td><td class="hits"></td><td class="source">   * page selector? block</td></tr><tr><td class="line">772</td><td class="hits"></td><td class="source">   */</td></tr><tr><td class="line">773</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">774</td><td class="hits"></td><td class="source">  page: function() {</td></tr><tr class="hit"><td class="line">775</td><td class="hits">8</td><td class="source">    var selector;</td></tr><tr class="hit"><td class="line">776</td><td class="hits">8</td><td class="source">    this.expect('page');</td></tr><tr class="hit"><td class="line">777</td><td class="hits">8</td><td class="source">    if (this.accept(':')) {</td></tr><tr class="hit"><td class="line">778</td><td class="hits">6</td><td class="source">      var str = this.expect('ident').val.name;</td></tr><tr class="hit"><td class="line">779</td><td class="hits">6</td><td class="source">      selector = new nodes.Literal(':' + str);</td></tr><tr><td class="line">780</td><td class="hits"></td><td class="source">    }</td></tr><tr class="hit"><td class="line">781</td><td class="hits">8</td><td class="source">    var page = new nodes.Page(selector);</td></tr><tr class="hit"><td class="line">782</td><td class="hits">8</td><td class="source">    this.skipSpaces();</td></tr><tr class="hit"><td class="line">783</td><td class="hits">8</td><td class="source">    this.state.push('page');</td></tr><tr class="hit"><td class="line">784</td><td class="hits">8</td><td class="source">    page.block = this.block(page);</td></tr><tr class="hit"><td class="line">785</td><td class="hits">8</td><td class="source">    this.state.pop();</td></tr><tr class="hit"><td class="line">786</td><td class="hits">8</td><td class="source">    return page;</td></tr><tr><td class="line">787</td><td class="hits"></td><td class="source">  },</td></tr><tr><td class="line">788</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">789</td><td class="hits"></td><td class="source">  /**</td></tr><tr><td class="line">790</td><td class="hits"></td><td class="source">   * keyframes name (</td></tr><tr><td class="line">791</td><td class="hits"></td><td class="source">   *  (unit | from | to)</td></tr><tr><td class="line">792</td><td class="hits"></td><td class="source">   *  (',' (unit | from | to)*)</td></tr><tr><td class="line">793</td><td class="hits"></td><td class="source">   *  block)+</td></tr><tr><td class="line">794</td><td class="hits"></td><td class="source">   */</td></tr><tr><td class="line">795</td><td class="hits"></td><td class="source">   </td></tr><tr><td class="line">796</td><td class="hits"></td><td class="source">  keyframes: function() {</td></tr><tr class="hit"><td class="line">797</td><td class="hits">14</td><td class="source">    var pos</td></tr><tr><td class="line">798</td><td class="hits"></td><td class="source">      , tok = this.expect('keyframes')</td></tr><tr><td class="line">799</td><td class="hits"></td><td class="source">      , keyframes = new nodes.Keyframes(this.id(), tok.val)</td></tr><tr><td class="line">800</td><td class="hits"></td><td class="source">      , vals = [];</td></tr><tr><td class="line">801</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">802</td><td class="hits"></td><td class="source">    // css-style</td></tr><tr class="hit"><td class="line">803</td><td class="hits">14</td><td class="source">    if (this.accept('{')) {</td></tr><tr class="hit"><td class="line">804</td><td class="hits">7</td><td class="source">      this.css++;</td></tr><tr class="hit"><td class="line">805</td><td class="hits">7</td><td class="source">      this.skipWhitespace();</td></tr><tr><td class="line">806</td><td class="hits"></td><td class="source">    } else {</td></tr><tr class="hit"><td class="line">807</td><td class="hits">7</td><td class="source">      this.expect('indent');</td></tr><tr><td class="line">808</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">809</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">810</td><td class="hits">14</td><td class="source">    this.skipNewlines();</td></tr><tr><td class="line">811</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">812</td><td class="hits">14</td><td class="source">    while (pos = this.accept('unit') || this.accept('ident')) {</td></tr><tr><td class="line">813</td><td class="hits"></td><td class="source">      // from | to</td></tr><tr class="hit"><td class="line">814</td><td class="hits">40</td><td class="source">      if ('ident' == pos.type) {</td></tr><tr class="hit"><td class="line">815</td><td class="hits">25</td><td class="source">        this.accept('space');</td></tr><tr class="hit"><td class="line">816</td><td class="hits">25</td><td class="source">        switch (pos.val.name) {</td></tr><tr><td class="line">817</td><td class="hits"></td><td class="source">          case 'from':</td></tr><tr class="hit"><td class="line">818</td><td class="hits">13</td><td class="source">            pos = new nodes.Unit(0, '%');</td></tr><tr class="hit"><td class="line">819</td><td class="hits">13</td><td class="source">            break;</td></tr><tr><td class="line">820</td><td class="hits"></td><td class="source">          case 'to':</td></tr><tr class="hit"><td class="line">821</td><td class="hits">12</td><td class="source">            pos = new nodes.Unit(100, '%');</td></tr><tr class="hit"><td class="line">822</td><td class="hits">12</td><td class="source">            break;</td></tr><tr><td class="line">823</td><td class="hits"></td><td class="source">          default:</td></tr><tr class="miss"><td class="line">824</td><td class="hits">0</td><td class="source">            this.error('&quot;' + pos.val.name + '&quot; is invalid, use &quot;from&quot; or &quot;to&quot;');</td></tr><tr><td class="line">825</td><td class="hits"></td><td class="source">        }</td></tr><tr><td class="line">826</td><td class="hits"></td><td class="source">      } else {</td></tr><tr class="hit"><td class="line">827</td><td class="hits">15</td><td class="source">        pos = pos.val;</td></tr><tr><td class="line">828</td><td class="hits"></td><td class="source">      }</td></tr><tr><td class="line">829</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">830</td><td class="hits">40</td><td class="source">      vals.push(pos);</td></tr><tr><td class="line">831</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">832</td><td class="hits"></td><td class="source">      // ','</td></tr><tr class="hit"><td class="line">833</td><td class="hits">46</td><td class="source">      if (this.accept(',') || this.accept('newline')) continue;</td></tr><tr><td class="line">834</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">835</td><td class="hits"></td><td class="source">      // block</td></tr><tr class="hit"><td class="line">836</td><td class="hits">34</td><td class="source">      this.state.push('keyframe');</td></tr><tr class="hit"><td class="line">837</td><td class="hits">34</td><td class="source">      var block = this.block(keyframes);</td></tr><tr class="hit"><td class="line">838</td><td class="hits">34</td><td class="source">      keyframes.push(vals, block);</td></tr><tr class="hit"><td class="line">839</td><td class="hits">34</td><td class="source">      vals = [];</td></tr><tr class="hit"><td class="line">840</td><td class="hits">34</td><td class="source">      this.state.pop();</td></tr><tr class="hit"><td class="line">841</td><td class="hits">50</td><td class="source">      if (this.css) this.skipWhitespace();</td></tr><tr class="hit"><td class="line">842</td><td class="hits">34</td><td class="source">      this.skipNewlines();</td></tr><tr><td class="line">843</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">844</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">845</td><td class="hits"></td><td class="source">    // css-style</td></tr><tr class="hit"><td class="line">846</td><td class="hits">14</td><td class="source">    if (this.css) {</td></tr><tr class="hit"><td class="line">847</td><td class="hits">7</td><td class="source">      this.skipWhitespace();</td></tr><tr class="hit"><td class="line">848</td><td class="hits">7</td><td class="source">      this.expect('}');</td></tr><tr class="hit"><td class="line">849</td><td class="hits">7</td><td class="source">      this.css--;</td></tr><tr><td class="line">850</td><td class="hits"></td><td class="source">    } else {</td></tr><tr class="hit"><td class="line">851</td><td class="hits">7</td><td class="source">      this.expect('outdent');</td></tr><tr><td class="line">852</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">853</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">854</td><td class="hits">14</td><td class="source">    return keyframes;</td></tr><tr><td class="line">855</td><td class="hits"></td><td class="source">  },</td></tr><tr><td class="line">856</td><td class="hits"></td><td class="source">  </td></tr><tr><td class="line">857</td><td class="hits"></td><td class="source">  /**</td></tr><tr><td class="line">858</td><td class="hits"></td><td class="source">   * literal</td></tr><tr><td class="line">859</td><td class="hits"></td><td class="source">   */</td></tr><tr><td class="line">860</td><td class="hits"></td><td class="source">  </td></tr><tr><td class="line">861</td><td class="hits"></td><td class="source">  literal: function() {</td></tr><tr class="hit"><td class="line">862</td><td class="hits">1</td><td class="source">    return this.expect('literal').val;</td></tr><tr><td class="line">863</td><td class="hits"></td><td class="source">  },</td></tr><tr><td class="line">864</td><td class="hits"></td><td class="source">  </td></tr><tr><td class="line">865</td><td class="hits"></td><td class="source">  /**</td></tr><tr><td class="line">866</td><td class="hits"></td><td class="source">   * ident space?</td></tr><tr><td class="line">867</td><td class="hits"></td><td class="source">   */</td></tr><tr><td class="line">868</td><td class="hits"></td><td class="source">  </td></tr><tr><td class="line">869</td><td class="hits"></td><td class="source">  id: function() {</td></tr><tr class="hit"><td class="line">870</td><td class="hits">36115</td><td class="source">    var tok = this.expect('ident');</td></tr><tr class="hit"><td class="line">871</td><td class="hits">36115</td><td class="source">    this.accept('space');</td></tr><tr class="hit"><td class="line">872</td><td class="hits">36115</td><td class="source">    return tok.val;</td></tr><tr><td class="line">873</td><td class="hits"></td><td class="source">  },</td></tr><tr><td class="line">874</td><td class="hits"></td><td class="source">  </td></tr><tr><td class="line">875</td><td class="hits"></td><td class="source">  /**</td></tr><tr><td class="line">876</td><td class="hits"></td><td class="source">   *   ident</td></tr><tr><td class="line">877</td><td class="hits"></td><td class="source">   * | assignment</td></tr><tr><td class="line">878</td><td class="hits"></td><td class="source">   * | property</td></tr><tr><td class="line">879</td><td class="hits"></td><td class="source">   * | selector</td></tr><tr><td class="line">880</td><td class="hits"></td><td class="source">   */</td></tr><tr><td class="line">881</td><td class="hits"></td><td class="source">  </td></tr><tr><td class="line">882</td><td class="hits"></td><td class="source">  ident: function() {</td></tr><tr class="hit"><td class="line">883</td><td class="hits">43984</td><td class="source">    var i = 2</td></tr><tr><td class="line">884</td><td class="hits"></td><td class="source">      , la = this.lookahead(i).type;</td></tr><tr><td class="line">885</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">886</td><td class="hits">62050</td><td class="source">    while ('space' == la) la = this.lookahead(++i).type;</td></tr><tr><td class="line">887</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">888</td><td class="hits">43984</td><td class="source">    switch (la) {</td></tr><tr><td class="line">889</td><td class="hits"></td><td class="source">      // Assignment</td></tr><tr><td class="line">890</td><td class="hits"></td><td class="source">      case '=':</td></tr><tr><td class="line">891</td><td class="hits"></td><td class="source">      case '?=':</td></tr><tr><td class="line">892</td><td class="hits"></td><td class="source">      case '-=':</td></tr><tr><td class="line">893</td><td class="hits"></td><td class="source">      case '+=':</td></tr><tr><td class="line">894</td><td class="hits"></td><td class="source">      case '*=':</td></tr><tr><td class="line">895</td><td class="hits"></td><td class="source">      case '/=':</td></tr><tr><td class="line">896</td><td class="hits"></td><td class="source">      case '%=':</td></tr><tr class="hit"><td class="line">897</td><td class="hits">5649</td><td class="source">        return this.assignment();</td></tr><tr><td class="line">898</td><td class="hits"></td><td class="source">      // Assignment []=</td></tr><tr><td class="line">899</td><td class="hits"></td><td class="source">      case '[':</td></tr><tr class="hit"><td class="line">900</td><td class="hits">7526</td><td class="source">        if (this._ident == this.peek()) return this.id();</td></tr><tr class="hit"><td class="line">901</td><td class="hits">2798</td><td class="source">        while (']' != this.lookahead(i++).type</td></tr><tr class="hit"><td class="line">902</td><td class="hits">6485</td><td class="source">          &amp;&amp; 'selector' != this.lookahead(i).type) ;</td></tr><tr class="hit"><td class="line">903</td><td class="hits">2798</td><td class="source">        if ('=' == this.lookahead(i).type) {</td></tr><tr class="hit"><td class="line">904</td><td class="hits">12</td><td class="source">          this._ident = this.peek();</td></tr><tr class="hit"><td class="line">905</td><td class="hits">12</td><td class="source">          return this.expression();</td></tr><tr class="hit"><td class="line">906</td><td class="hits">2786</td><td class="source">        } else if (this.looksLikeSelector() &amp;&amp; this.stateAllowsSelector()) {</td></tr><tr class="hit"><td class="line">907</td><td class="hits">17</td><td class="source">          return this.selector();</td></tr><tr><td class="line">908</td><td class="hits"></td><td class="source">        }</td></tr><tr><td class="line">909</td><td class="hits"></td><td class="source">      // Operation</td></tr><tr><td class="line">910</td><td class="hits"></td><td class="source">      case '-':</td></tr><tr><td class="line">911</td><td class="hits"></td><td class="source">      case '+':</td></tr><tr><td class="line">912</td><td class="hits"></td><td class="source">      case '/':</td></tr><tr><td class="line">913</td><td class="hits"></td><td class="source">      case '*':</td></tr><tr><td class="line">914</td><td class="hits"></td><td class="source">      case '%':</td></tr><tr><td class="line">915</td><td class="hits"></td><td class="source">      case '**':</td></tr><tr><td class="line">916</td><td class="hits"></td><td class="source">      case 'and':</td></tr><tr><td class="line">917</td><td class="hits"></td><td class="source">      case 'or':</td></tr><tr><td class="line">918</td><td class="hits"></td><td class="source">      case '&amp;&amp;':</td></tr><tr><td class="line">919</td><td class="hits"></td><td class="source">      case '||':</td></tr><tr><td class="line">920</td><td class="hits"></td><td class="source">      case '&gt;':</td></tr><tr><td class="line">921</td><td class="hits"></td><td class="source">      case '&lt;':</td></tr><tr><td class="line">922</td><td class="hits"></td><td class="source">      case '&gt;=':</td></tr><tr><td class="line">923</td><td class="hits"></td><td class="source">      case '&lt;=':</td></tr><tr><td class="line">924</td><td class="hits"></td><td class="source">      case '!=':</td></tr><tr><td class="line">925</td><td class="hits"></td><td class="source">      case '==':</td></tr><tr><td class="line">926</td><td class="hits"></td><td class="source">      case '?':</td></tr><tr><td class="line">927</td><td class="hits"></td><td class="source">      case 'in':</td></tr><tr><td class="line">928</td><td class="hits"></td><td class="source">      case 'is a':</td></tr><tr><td class="line">929</td><td class="hits"></td><td class="source">      case 'is defined':</td></tr><tr><td class="line">930</td><td class="hits"></td><td class="source">        // Prevent cyclic .ident, return literal</td></tr><tr class="hit"><td class="line">931</td><td class="hits">11674</td><td class="source">        if (this._ident == this.peek()) {</td></tr><tr class="hit"><td class="line">932</td><td class="hits">3708</td><td class="source">          return this.id();</td></tr><tr><td class="line">933</td><td class="hits"></td><td class="source">        } else {</td></tr><tr class="hit"><td class="line">934</td><td class="hits">7966</td><td class="source">          this._ident = this.peek();</td></tr><tr class="hit"><td class="line">935</td><td class="hits">7966</td><td class="source">          switch (this.currentState()) {</td></tr><tr><td class="line">936</td><td class="hits"></td><td class="source">            // unary op or selector in property / for</td></tr><tr><td class="line">937</td><td class="hits"></td><td class="source">            case 'for':</td></tr><tr><td class="line">938</td><td class="hits"></td><td class="source">            case 'selector':</td></tr><tr class="hit"><td class="line">939</td><td class="hits">6</td><td class="source">              return this.property();</td></tr><tr><td class="line">940</td><td class="hits"></td><td class="source">            // Part of a selector</td></tr><tr><td class="line">941</td><td class="hits"></td><td class="source">            case 'root':</td></tr><tr><td class="line">942</td><td class="hits"></td><td class="source">            case 'media':</td></tr><tr><td class="line">943</td><td class="hits"></td><td class="source">            case 'font-face':</td></tr><tr class="hit"><td class="line">944</td><td class="hits">10</td><td class="source">              return this.selector();</td></tr><tr><td class="line">945</td><td class="hits"></td><td class="source">            case 'function':</td></tr><tr class="hit"><td class="line">946</td><td class="hits">1270</td><td class="source">              return this.looksLikeSelector()</td></tr><tr><td class="line">947</td><td class="hits"></td><td class="source">                ? this.selector()</td></tr><tr><td class="line">948</td><td class="hits"></td><td class="source">                : this.expression();</td></tr><tr><td class="line">949</td><td class="hits"></td><td class="source">            // Do not disrupt the ident when an operand</td></tr><tr><td class="line">950</td><td class="hits"></td><td class="source">            default:</td></tr><tr class="hit"><td class="line">951</td><td class="hits">6680</td><td class="source">              return this.operand</td></tr><tr><td class="line">952</td><td class="hits"></td><td class="source">                ? this.id()</td></tr><tr><td class="line">953</td><td class="hits"></td><td class="source">                : this.expression();</td></tr><tr><td class="line">954</td><td class="hits"></td><td class="source">          }</td></tr><tr><td class="line">955</td><td class="hits"></td><td class="source">        }</td></tr><tr><td class="line">956</td><td class="hits"></td><td class="source">      // Selector or property</td></tr><tr><td class="line">957</td><td class="hits"></td><td class="source">      default:</td></tr><tr class="hit"><td class="line">958</td><td class="hits">24268</td><td class="source">        switch (this.currentState()) {</td></tr><tr><td class="line">959</td><td class="hits"></td><td class="source">          case 'root':</td></tr><tr class="hit"><td class="line">960</td><td class="hits">593</td><td class="source">            return this.selector();</td></tr><tr><td class="line">961</td><td class="hits"></td><td class="source">          case 'for':</td></tr><tr><td class="line">962</td><td class="hits"></td><td class="source">          case 'page':</td></tr><tr><td class="line">963</td><td class="hits"></td><td class="source">          case 'media':</td></tr><tr><td class="line">964</td><td class="hits"></td><td class="source">          case 'font-face':</td></tr><tr><td class="line">965</td><td class="hits"></td><td class="source">          case 'selector':</td></tr><tr><td class="line">966</td><td class="hits"></td><td class="source">          case 'function':</td></tr><tr><td class="line">967</td><td class="hits"></td><td class="source">          case 'keyframe':</td></tr><tr><td class="line">968</td><td class="hits"></td><td class="source">          case 'conditional':</td></tr><tr class="hit"><td class="line">969</td><td class="hits">2486</td><td class="source">            return this.property();</td></tr><tr><td class="line">970</td><td class="hits"></td><td class="source">          default:</td></tr><tr class="hit"><td class="line">971</td><td class="hits">21189</td><td class="source">            return this.id();</td></tr><tr><td class="line">972</td><td class="hits"></td><td class="source">        }</td></tr><tr><td class="line">973</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">974</td><td class="hits"></td><td class="source">  },</td></tr><tr><td class="line">975</td><td class="hits"></td><td class="source">  </td></tr><tr><td class="line">976</td><td class="hits"></td><td class="source">  /**</td></tr><tr><td class="line">977</td><td class="hits"></td><td class="source">   * '*'? (ident | '{' expression '}')+</td></tr><tr><td class="line">978</td><td class="hits"></td><td class="source">   */</td></tr><tr><td class="line">979</td><td class="hits"></td><td class="source">  </td></tr><tr><td class="line">980</td><td class="hits"></td><td class="source">  interpolate: function() {</td></tr><tr class="hit"><td class="line">981</td><td class="hits">2440</td><td class="source">    var node</td></tr><tr><td class="line">982</td><td class="hits"></td><td class="source">      , segs = []</td></tr><tr><td class="line">983</td><td class="hits"></td><td class="source">      , star;</td></tr><tr><td class="line">984</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">985</td><td class="hits">2440</td><td class="source">    star = this.accept('*');</td></tr><tr class="hit"><td class="line">986</td><td class="hits">2447</td><td class="source">    if (star) segs.push(new nodes.Literal('*'));</td></tr><tr><td class="line">987</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">988</td><td class="hits">2440</td><td class="source">    while (true) {</td></tr><tr class="hit"><td class="line">989</td><td class="hits">4904</td><td class="source">      if (this.accept('{')) {</td></tr><tr class="hit"><td class="line">990</td><td class="hits">45</td><td class="source">        this.state.push('interpolation');</td></tr><tr class="hit"><td class="line">991</td><td class="hits">45</td><td class="source">        segs.push(this.expression());</td></tr><tr class="hit"><td class="line">992</td><td class="hits">45</td><td class="source">        this.expect('}');</td></tr><tr class="hit"><td class="line">993</td><td class="hits">45</td><td class="source">        this.state.pop();</td></tr><tr class="hit"><td class="line">994</td><td class="hits">4859</td><td class="source">      } else if (node = this.accept('-')){</td></tr><tr class="hit"><td class="line">995</td><td class="hits">6</td><td class="source">        segs.push(new nodes.Literal('-'));</td></tr><tr class="hit"><td class="line">996</td><td class="hits">4853</td><td class="source">      } else if (node = this.accept('ident')){</td></tr><tr class="hit"><td class="line">997</td><td class="hits">2413</td><td class="source">        segs.push(node.val);</td></tr><tr><td class="line">998</td><td class="hits"></td><td class="source">      } else {</td></tr><tr class="hit"><td class="line">999</td><td class="hits">2440</td><td class="source">        break;</td></tr><tr><td class="line">1000</td><td class="hits"></td><td class="source">      }</td></tr><tr><td class="line">1001</td><td class="hits"></td><td class="source">    }</td></tr><tr class="hit"><td class="line">1002</td><td class="hits">2440</td><td class="source">    if (!segs.length) this.expect('ident');</td></tr><tr class="hit"><td class="line">1003</td><td class="hits">2440</td><td class="source">    return segs;</td></tr><tr><td class="line">1004</td><td class="hits"></td><td class="source">  },</td></tr><tr><td class="line">1005</td><td class="hits"></td><td class="source">  </td></tr><tr><td class="line">1006</td><td class="hits"></td><td class="source">  /**</td></tr><tr><td class="line">1007</td><td class="hits"></td><td class="source">   *   property ':'? expression</td></tr><tr><td class="line">1008</td><td class="hits"></td><td class="source">   * | ident</td></tr><tr><td class="line">1009</td><td class="hits"></td><td class="source">   */</td></tr><tr><td class="line">1010</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">1011</td><td class="hits"></td><td class="source">  property: function() {</td></tr><tr class="hit"><td class="line">1012</td><td class="hits">2676</td><td class="source">    if (this.looksLikeSelector()) return this.selector();</td></tr><tr><td class="line">1013</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">1014</td><td class="hits"></td><td class="source">    // property</td></tr><tr class="hit"><td class="line">1015</td><td class="hits">2440</td><td class="source">    var ident = this.interpolate()</td></tr><tr><td class="line">1016</td><td class="hits"></td><td class="source">      , prop = new nodes.Property(ident)</td></tr><tr><td class="line">1017</td><td class="hits"></td><td class="source">      , ret = prop;</td></tr><tr><td class="line">1018</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">1019</td><td class="hits"></td><td class="source">    // optional ':'</td></tr><tr class="hit"><td class="line">1020</td><td class="hits">2440</td><td class="source">    this.accept('space');</td></tr><tr class="hit"><td class="line">1021</td><td class="hits">3590</td><td class="source">    if (this.accept(':')) this.accept('space');</td></tr><tr><td class="line">1022</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">1023</td><td class="hits">2440</td><td class="source">    this.state.push('property');</td></tr><tr class="hit"><td class="line">1024</td><td class="hits">2440</td><td class="source">    this.inProperty = true;</td></tr><tr class="hit"><td class="line">1025</td><td class="hits">2440</td><td class="source">    prop.expr = this.list();</td></tr><tr class="hit"><td class="line">1026</td><td class="hits">2900</td><td class="source">    if (prop.expr.isEmpty) ret = ident[0];</td></tr><tr class="hit"><td class="line">1027</td><td class="hits">2440</td><td class="source">    this.inProperty = false;</td></tr><tr class="hit"><td class="line">1028</td><td class="hits">2440</td><td class="source">    this.allowPostfix = true;</td></tr><tr class="hit"><td class="line">1029</td><td class="hits">2440</td><td class="source">    this.state.pop();</td></tr><tr><td class="line">1030</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">1031</td><td class="hits"></td><td class="source">    // optional ';'</td></tr><tr class="hit"><td class="line">1032</td><td class="hits">2440</td><td class="source">    this.accept(';');</td></tr><tr><td class="line">1033</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">1034</td><td class="hits">2440</td><td class="source">    return ret;</td></tr><tr><td class="line">1035</td><td class="hits"></td><td class="source">  },</td></tr><tr><td class="line">1036</td><td class="hits"></td><td class="source">  </td></tr><tr><td class="line">1037</td><td class="hits"></td><td class="source">  /**</td></tr><tr><td class="line">1038</td><td class="hits"></td><td class="source">   *   selector ',' selector</td></tr><tr><td class="line">1039</td><td class="hits"></td><td class="source">   * | selector newline selector</td></tr><tr><td class="line">1040</td><td class="hits"></td><td class="source">   * | selector block</td></tr><tr><td class="line">1041</td><td class="hits"></td><td class="source">   */</td></tr><tr><td class="line">1042</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">1043</td><td class="hits"></td><td class="source">  selector: function() {</td></tr><tr class="hit"><td class="line">1044</td><td class="hits">1051</td><td class="source">    var tok</td></tr><tr><td class="line">1045</td><td class="hits"></td><td class="source">      , arr</td></tr><tr><td class="line">1046</td><td class="hits"></td><td class="source">      , group = new nodes.Group</td></tr><tr><td class="line">1047</td><td class="hits"></td><td class="source">      , scope = this.selectorScope</td></tr><tr><td class="line">1048</td><td class="hits"></td><td class="source">      , isRoot = 'root' == this.currentState();</td></tr><tr><td class="line">1049</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">1050</td><td class="hits">1051</td><td class="source">    do {</td></tr><tr class="hit"><td class="line">1051</td><td class="hits">1671</td><td class="source">      arr = [];</td></tr><tr><td class="line">1052</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">1053</td><td class="hits"></td><td class="source">      // Clobber newline after ,</td></tr><tr class="hit"><td class="line">1054</td><td class="hits">1671</td><td class="source">      this.accept('newline');</td></tr><tr><td class="line">1055</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">1056</td><td class="hits"></td><td class="source">      // Selector candidates,</td></tr><tr><td class="line">1057</td><td class="hits"></td><td class="source">      // stitched together to</td></tr><tr><td class="line">1058</td><td class="hits"></td><td class="source">      // form a selector.</td></tr><tr class="hit"><td class="line">1059</td><td class="hits">1671</td><td class="source">      while (tok = this.selectorToken()) {</td></tr><tr class="hit"><td class="line">1060</td><td class="hits">2788</td><td class="source">        debug.selector('%s', tok);</td></tr><tr><td class="line">1061</td><td class="hits"></td><td class="source">        // Selector component</td></tr><tr class="hit"><td class="line">1062</td><td class="hits">2788</td><td class="source">        switch (tok.type) {</td></tr><tr><td class="line">1063</td><td class="hits"></td><td class="source">          case '{':</td></tr><tr class="hit"><td class="line">1064</td><td class="hits">39</td><td class="source">            this.skipSpaces();</td></tr><tr class="hit"><td class="line">1065</td><td class="hits">39</td><td class="source">            var expr = this.expression();</td></tr><tr class="hit"><td class="line">1066</td><td class="hits">39</td><td class="source">            this.skipSpaces();</td></tr><tr class="hit"><td class="line">1067</td><td class="hits">39</td><td class="source">            this.expect('}');</td></tr><tr class="hit"><td class="line">1068</td><td class="hits">39</td><td class="source">            arr.push(expr);</td></tr><tr class="hit"><td class="line">1069</td><td class="hits">39</td><td class="source">            break;</td></tr><tr><td class="line">1070</td><td class="hits"></td><td class="source">          case 'comment':</td></tr><tr class="hit"><td class="line">1071</td><td class="hits">1</td><td class="source">            arr.push(new nodes.Literal(tok.val.str));</td></tr><tr class="hit"><td class="line">1072</td><td class="hits">1</td><td class="source">            break;</td></tr><tr><td class="line">1073</td><td class="hits"></td><td class="source">          case 'color':</td></tr><tr class="hit"><td class="line">1074</td><td class="hits">20</td><td class="source">            arr.push(new nodes.Literal(tok.val.raw));</td></tr><tr class="hit"><td class="line">1075</td><td class="hits">20</td><td class="source">            break;</td></tr><tr><td class="line">1076</td><td class="hits"></td><td class="source">          case 'space':</td></tr><tr class="hit"><td class="line">1077</td><td class="hits">325</td><td class="source">            arr.push(new nodes.Literal(' '));</td></tr><tr class="hit"><td class="line">1078</td><td class="hits">325</td><td class="source">            break;</td></tr><tr><td class="line">1079</td><td class="hits"></td><td class="source">          case 'function':</td></tr><tr class="hit"><td class="line">1080</td><td class="hits">22</td><td class="source">            arr.push(new nodes.Literal(tok.val.name + '('));</td></tr><tr class="hit"><td class="line">1081</td><td class="hits">22</td><td class="source">            break;</td></tr><tr><td class="line">1082</td><td class="hits"></td><td class="source">          case 'ident':</td></tr><tr class="hit"><td class="line">1083</td><td class="hits">1467</td><td class="source">            arr.push(new nodes.Literal(tok.val.name));</td></tr><tr class="hit"><td class="line">1084</td><td class="hits">1467</td><td class="source">            break;</td></tr><tr><td class="line">1085</td><td class="hits"></td><td class="source">          default:</td></tr><tr class="hit"><td class="line">1086</td><td class="hits">914</td><td class="source">            arr.push(new nodes.Literal(tok.val));</td></tr><tr class="hit"><td class="line">1087</td><td class="hits">981</td><td class="source">            if (tok.space) arr.push(new nodes.Literal(' '));</td></tr><tr><td class="line">1088</td><td class="hits"></td><td class="source">        }</td></tr><tr><td class="line">1089</td><td class="hits"></td><td class="source">      }</td></tr><tr><td class="line">1090</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">1091</td><td class="hits"></td><td class="source">      // Push the selector</td></tr><tr class="hit"><td class="line">1092</td><td class="hits">1675</td><td class="source">      if (isRoot &amp;&amp; scope) arr.unshift(new nodes.Literal(scope + ' '));</td></tr><tr class="hit"><td class="line">1093</td><td class="hits">1671</td><td class="source">      group.push(new nodes.Selector(arr));</td></tr><tr><td class="line">1094</td><td class="hits"></td><td class="source">    } while (this.accept(',') || this.accept('newline'));</td></tr><tr><td class="line">1095</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">1096</td><td class="hits">1051</td><td class="source">    this.lexer.allowComments = false;</td></tr><tr class="hit"><td class="line">1097</td><td class="hits">1051</td><td class="source">    this.state.push('selector');</td></tr><tr class="hit"><td class="line">1098</td><td class="hits">1051</td><td class="source">    group.block = this.block(group);</td></tr><tr class="hit"><td class="line">1099</td><td class="hits">1051</td><td class="source">    this.state.pop();</td></tr><tr><td class="line">1100</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">1101</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">1102</td><td class="hits">1051</td><td class="source">    return group;</td></tr><tr><td class="line">1103</td><td class="hits"></td><td class="source">  },</td></tr><tr><td class="line">1104</td><td class="hits"></td><td class="source">  </td></tr><tr><td class="line">1105</td><td class="hits"></td><td class="source">  /**</td></tr><tr><td class="line">1106</td><td class="hits"></td><td class="source">   * ident ('=' | '?=') expression</td></tr><tr><td class="line">1107</td><td class="hits"></td><td class="source">   */</td></tr><tr><td class="line">1108</td><td class="hits"></td><td class="source">  </td></tr><tr><td class="line">1109</td><td class="hits"></td><td class="source">  assignment: function() {</td></tr><tr class="hit"><td class="line">1110</td><td class="hits">5649</td><td class="source">    var op</td></tr><tr><td class="line">1111</td><td class="hits"></td><td class="source">      , node</td></tr><tr><td class="line">1112</td><td class="hits"></td><td class="source">      , name = this.id().name;</td></tr><tr><td class="line">1113</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">1114</td><td class="hits">5649</td><td class="source">    if (op =</td></tr><tr><td class="line">1115</td><td class="hits"></td><td class="source">         this.accept('=')</td></tr><tr><td class="line">1116</td><td class="hits"></td><td class="source">      || this.accept('?=')</td></tr><tr><td class="line">1117</td><td class="hits"></td><td class="source">      || this.accept('+=')</td></tr><tr><td class="line">1118</td><td class="hits"></td><td class="source">      || this.accept('-=')</td></tr><tr><td class="line">1119</td><td class="hits"></td><td class="source">      || this.accept('*=')</td></tr><tr><td class="line">1120</td><td class="hits"></td><td class="source">      || this.accept('/=')</td></tr><tr><td class="line">1121</td><td class="hits"></td><td class="source">      || this.accept('%=')) {</td></tr><tr class="hit"><td class="line">1122</td><td class="hits">5649</td><td class="source">      this.state.push('assignment');</td></tr><tr class="hit"><td class="line">1123</td><td class="hits">5649</td><td class="source">      var expr = this.list();</td></tr><tr class="hit"><td class="line">1124</td><td class="hits">5649</td><td class="source">      if (expr.isEmpty) this.error('invalid right-hand side operand in assignment, got {peek}')</td></tr><tr class="hit"><td class="line">1125</td><td class="hits">5649</td><td class="source">      node = new nodes.Ident(name, expr);</td></tr><tr class="hit"><td class="line">1126</td><td class="hits">5649</td><td class="source">      this.state.pop();</td></tr><tr><td class="line">1127</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">1128</td><td class="hits">5649</td><td class="source">      switch (op.type) {</td></tr><tr><td class="line">1129</td><td class="hits"></td><td class="source">        case '?=':</td></tr><tr class="hit"><td class="line">1130</td><td class="hits">8</td><td class="source">          var defined = new nodes.BinOp('is defined', node)</td></tr><tr><td class="line">1131</td><td class="hits"></td><td class="source">            , lookup = new nodes.Ident(name);</td></tr><tr class="hit"><td class="line">1132</td><td class="hits">8</td><td class="source">          node = new nodes.Ternary(defined, lookup, node);</td></tr><tr class="hit"><td class="line">1133</td><td class="hits">8</td><td class="source">          break;</td></tr><tr><td class="line">1134</td><td class="hits"></td><td class="source">        case '+=':</td></tr><tr><td class="line">1135</td><td class="hits"></td><td class="source">        case '-=':</td></tr><tr><td class="line">1136</td><td class="hits"></td><td class="source">        case '*=':</td></tr><tr><td class="line">1137</td><td class="hits"></td><td class="source">        case '/=':</td></tr><tr><td class="line">1138</td><td class="hits"></td><td class="source">        case '%=':</td></tr><tr class="hit"><td class="line">1139</td><td class="hits">452</td><td class="source">          node.val = new nodes.BinOp(op.type[0], new nodes.Ident(name), expr);</td></tr><tr class="hit"><td class="line">1140</td><td class="hits">452</td><td class="source">          break;</td></tr><tr><td class="line">1141</td><td class="hits"></td><td class="source">      }</td></tr><tr><td class="line">1142</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">1143</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">1144</td><td class="hits">5649</td><td class="source">    return node;</td></tr><tr><td class="line">1145</td><td class="hits"></td><td class="source">  },</td></tr><tr><td class="line">1146</td><td class="hits"></td><td class="source">  </td></tr><tr><td class="line">1147</td><td class="hits"></td><td class="source">  /**</td></tr><tr><td class="line">1148</td><td class="hits"></td><td class="source">   *   definition</td></tr><tr><td class="line">1149</td><td class="hits"></td><td class="source">   * | call</td></tr><tr><td class="line">1150</td><td class="hits"></td><td class="source">   */</td></tr><tr><td class="line">1151</td><td class="hits"></td><td class="source">  </td></tr><tr><td class="line">1152</td><td class="hits"></td><td class="source">  function: function() {</td></tr><tr class="hit"><td class="line">1153</td><td class="hits">15588</td><td class="source">    var parens = 1</td></tr><tr><td class="line">1154</td><td class="hits"></td><td class="source">      , i = 2</td></tr><tr><td class="line">1155</td><td class="hits"></td><td class="source">      , tok;</td></tr><tr><td class="line">1156</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">1157</td><td class="hits"></td><td class="source">    // Lookahead and determine if we are dealing</td></tr><tr><td class="line">1158</td><td class="hits"></td><td class="source">    // with a function call or definition. Here</td></tr><tr><td class="line">1159</td><td class="hits"></td><td class="source">    // we pair parens to prevent false negatives</td></tr><tr class="hit"><td class="line">1160</td><td class="hits">15588</td><td class="source">    out:</td></tr><tr><td class="line">1161</td><td class="hits"></td><td class="source">    while (tok = this.lookahead(i++)) {</td></tr><tr class="hit"><td class="line">1162</td><td class="hits">62275</td><td class="source">      switch (tok.type) {</td></tr><tr><td class="line">1163</td><td class="hits"></td><td class="source">        case 'function':</td></tr><tr><td class="line">1164</td><td class="hits"></td><td class="source">        case '(':</td></tr><tr class="hit"><td class="line">1165</td><td class="hits">1883</td><td class="source">          ++parens;</td></tr><tr class="hit"><td class="line">1166</td><td class="hits">1883</td><td class="source">          break;</td></tr><tr><td class="line">1167</td><td class="hits"></td><td class="source">        case ')':</td></tr><tr class="hit"><td class="line">1168</td><td class="hits">33059</td><td class="source">          if (!--parens) break out;</td></tr><tr class="hit"><td class="line">1169</td><td class="hits">1883</td><td class="source">          break;</td></tr><tr><td class="line">1170</td><td class="hits"></td><td class="source">        case 'eos':</td></tr><tr class="miss"><td class="line">1171</td><td class="hits">0</td><td class="source">          this.error('failed to find closing paren &quot;)&quot;');</td></tr><tr><td class="line">1172</td><td class="hits"></td><td class="source">      }</td></tr><tr><td class="line">1173</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">1174</td><td class="hits"></td><td class="source">    </td></tr><tr><td class="line">1175</td><td class="hits"></td><td class="source">    // Definition or call</td></tr><tr class="hit"><td class="line">1176</td><td class="hits">15588</td><td class="source">    switch (this.currentState()) {</td></tr><tr><td class="line">1177</td><td class="hits"></td><td class="source">      case 'expression':</td></tr><tr class="miss"><td class="line">1178</td><td class="hits">0</td><td class="source">        return this.functionCall();</td></tr><tr><td class="line">1179</td><td class="hits"></td><td class="source">      default:</td></tr><tr class="hit"><td class="line">1180</td><td class="hits">15588</td><td class="source">        return this.looksLikeFunctionDefinition(i)</td></tr><tr><td class="line">1181</td><td class="hits"></td><td class="source">          ? this.functionDefinition()</td></tr><tr><td class="line">1182</td><td class="hits"></td><td class="source">          : this.expression();</td></tr><tr><td class="line">1183</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">1184</td><td class="hits"></td><td class="source">  },</td></tr><tr><td class="line">1185</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">1186</td><td class="hits"></td><td class="source">  /**</td></tr><tr><td class="line">1187</td><td class="hits"></td><td class="source">   * url '(' (expression | urlchars)+ ')'</td></tr><tr><td class="line">1188</td><td class="hits"></td><td class="source">   */</td></tr><tr><td class="line">1189</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">1190</td><td class="hits"></td><td class="source">  url: function() {</td></tr><tr class="hit"><td class="line">1191</td><td class="hits">16</td><td class="source">    this.expect('function');</td></tr><tr class="hit"><td class="line">1192</td><td class="hits">16</td><td class="source">    this.state.push('function arguments');</td></tr><tr class="hit"><td class="line">1193</td><td class="hits">16</td><td class="source">    var args = this.args();</td></tr><tr class="hit"><td class="line">1194</td><td class="hits">16</td><td class="source">    this.expect(')');</td></tr><tr class="hit"><td class="line">1195</td><td class="hits">16</td><td class="source">    this.state.pop();</td></tr><tr class="hit"><td class="line">1196</td><td class="hits">16</td><td class="source">    return new nodes.Call('url', args);</td></tr><tr><td class="line">1197</td><td class="hits"></td><td class="source">  },</td></tr><tr><td class="line">1198</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">1199</td><td class="hits"></td><td class="source">  /**</td></tr><tr><td class="line">1200</td><td class="hits"></td><td class="source">   * ident '(' expression ')'</td></tr><tr><td class="line">1201</td><td class="hits"></td><td class="source">   */</td></tr><tr><td class="line">1202</td><td class="hits"></td><td class="source">  </td></tr><tr><td class="line">1203</td><td class="hits"></td><td class="source">  functionCall: function() {</td></tr><tr class="hit"><td class="line">1204</td><td class="hits">14796</td><td class="source">    if ('url' == this.peek().val.name) return this.url();</td></tr><tr class="hit"><td class="line">1205</td><td class="hits">14764</td><td class="source">    var name = this.expect('function').val.name;</td></tr><tr class="hit"><td class="line">1206</td><td class="hits">14764</td><td class="source">    this.state.push('function arguments');</td></tr><tr class="hit"><td class="line">1207</td><td class="hits">14764</td><td class="source">    this.parens++;</td></tr><tr class="hit"><td class="line">1208</td><td class="hits">14764</td><td class="source">    var args = this.args();</td></tr><tr class="hit"><td class="line">1209</td><td class="hits">14764</td><td class="source">    this.expect(')');</td></tr><tr class="hit"><td class="line">1210</td><td class="hits">14764</td><td class="source">    this.parens--;</td></tr><tr class="hit"><td class="line">1211</td><td class="hits">14764</td><td class="source">    this.state.pop();</td></tr><tr class="hit"><td class="line">1212</td><td class="hits">14764</td><td class="source">    return new nodes.Call(name, args);</td></tr><tr><td class="line">1213</td><td class="hits"></td><td class="source">  },</td></tr><tr><td class="line">1214</td><td class="hits"></td><td class="source">  </td></tr><tr><td class="line">1215</td><td class="hits"></td><td class="source">  /**</td></tr><tr><td class="line">1216</td><td class="hits"></td><td class="source">   * ident '(' params ')' block</td></tr><tr><td class="line">1217</td><td class="hits"></td><td class="source">   */</td></tr><tr><td class="line">1218</td><td class="hits"></td><td class="source">  </td></tr><tr><td class="line">1219</td><td class="hits"></td><td class="source">  functionDefinition: function() {</td></tr><tr class="hit"><td class="line">1220</td><td class="hits">7926</td><td class="source">    var name = this.expect('function').val.name;</td></tr><tr><td class="line">1221</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">1222</td><td class="hits"></td><td class="source">    // params</td></tr><tr class="hit"><td class="line">1223</td><td class="hits">7926</td><td class="source">    this.state.push('function params');</td></tr><tr class="hit"><td class="line">1224</td><td class="hits">7926</td><td class="source">    this.skipWhitespace();</td></tr><tr class="hit"><td class="line">1225</td><td class="hits">7926</td><td class="source">    var params = this.params();</td></tr><tr class="hit"><td class="line">1226</td><td class="hits">7926</td><td class="source">    this.skipWhitespace();</td></tr><tr class="hit"><td class="line">1227</td><td class="hits">7926</td><td class="source">    this.expect(')');</td></tr><tr class="hit"><td class="line">1228</td><td class="hits">7926</td><td class="source">    this.state.pop();</td></tr><tr><td class="line">1229</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">1230</td><td class="hits"></td><td class="source">    // Body</td></tr><tr class="hit"><td class="line">1231</td><td class="hits">7926</td><td class="source">    this.state.push('function');</td></tr><tr class="hit"><td class="line">1232</td><td class="hits">7926</td><td class="source">    var fn = new nodes.Function(name, params);</td></tr><tr class="hit"><td class="line">1233</td><td class="hits">7926</td><td class="source">    fn.block = this.block(fn);</td></tr><tr class="hit"><td class="line">1234</td><td class="hits">7926</td><td class="source">    this.state.pop();</td></tr><tr class="hit"><td class="line">1235</td><td class="hits">7926</td><td class="source">    return new nodes.Ident(name, fn);</td></tr><tr><td class="line">1236</td><td class="hits"></td><td class="source">  },</td></tr><tr><td class="line">1237</td><td class="hits"></td><td class="source">  </td></tr><tr><td class="line">1238</td><td class="hits"></td><td class="source">  /**</td></tr><tr><td class="line">1239</td><td class="hits"></td><td class="source">   *   ident</td></tr><tr><td class="line">1240</td><td class="hits"></td><td class="source">   * | ident '...'</td></tr><tr><td class="line">1241</td><td class="hits"></td><td class="source">   * | ident '=' expression</td></tr><tr><td class="line">1242</td><td class="hits"></td><td class="source">   * | ident ',' ident</td></tr><tr><td class="line">1243</td><td class="hits"></td><td class="source">   */</td></tr><tr><td class="line">1244</td><td class="hits"></td><td class="source">  </td></tr><tr><td class="line">1245</td><td class="hits"></td><td class="source">  params: function() {</td></tr><tr class="hit"><td class="line">1246</td><td class="hits">7926</td><td class="source">    var tok</td></tr><tr><td class="line">1247</td><td class="hits"></td><td class="source">      , node</td></tr><tr><td class="line">1248</td><td class="hits"></td><td class="source">      , params = new nodes.Params;</td></tr><tr class="hit"><td class="line">1249</td><td class="hits">7926</td><td class="source">    while (tok = this.accept('ident')) {</td></tr><tr class="hit"><td class="line">1250</td><td class="hits">11032</td><td class="source">      this.accept('space');</td></tr><tr class="hit"><td class="line">1251</td><td class="hits">11032</td><td class="source">      params.push(node = tok.val);</td></tr><tr class="hit"><td class="line">1252</td><td class="hits">11032</td><td class="source">      if (this.accept('...')) {</td></tr><tr class="hit"><td class="line">1253</td><td class="hits">227</td><td class="source">        node.rest = true;</td></tr><tr class="hit"><td class="line">1254</td><td class="hits">10805</td><td class="source">      } else if (this.accept('=')) {</td></tr><tr class="hit"><td class="line">1255</td><td class="hits">246</td><td class="source">        node.val = this.expression();</td></tr><tr><td class="line">1256</td><td class="hits"></td><td class="source">      }</td></tr><tr class="hit"><td class="line">1257</td><td class="hits">11032</td><td class="source">      this.skipWhitespace();</td></tr><tr class="hit"><td class="line">1258</td><td class="hits">11032</td><td class="source">      this.accept(',');</td></tr><tr class="hit"><td class="line">1259</td><td class="hits">11032</td><td class="source">      this.skipWhitespace();</td></tr><tr><td class="line">1260</td><td class="hits"></td><td class="source">    }</td></tr><tr class="hit"><td class="line">1261</td><td class="hits">7926</td><td class="source">    return params;</td></tr><tr><td class="line">1262</td><td class="hits"></td><td class="source">  },</td></tr><tr><td class="line">1263</td><td class="hits"></td><td class="source">  </td></tr><tr><td class="line">1264</td><td class="hits"></td><td class="source">  /**</td></tr><tr><td class="line">1265</td><td class="hits"></td><td class="source">   * (ident ':')? expression (',' (ident ':')? expression)*</td></tr><tr><td class="line">1266</td><td class="hits"></td><td class="source">   */</td></tr><tr><td class="line">1267</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">1268</td><td class="hits"></td><td class="source">  args: function() {</td></tr><tr class="hit"><td class="line">1269</td><td class="hits">14780</td><td class="source">    var args = new nodes.Arguments</td></tr><tr><td class="line">1270</td><td class="hits"></td><td class="source">      , keyword;</td></tr><tr><td class="line">1271</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">1272</td><td class="hits">14780</td><td class="source">    do {</td></tr><tr><td class="line">1273</td><td class="hits"></td><td class="source">      // keyword</td></tr><tr class="hit"><td class="line">1274</td><td class="hits">22323</td><td class="source">      if ('ident' == this.peek().type &amp;&amp; ':' == this.lookahead(2).type) {</td></tr><tr class="hit"><td class="line">1275</td><td class="hits">43</td><td class="source">        keyword = this.next().val.string;</td></tr><tr class="hit"><td class="line">1276</td><td class="hits">43</td><td class="source">        this.expect(':');</td></tr><tr class="hit"><td class="line">1277</td><td class="hits">43</td><td class="source">        args.map[keyword] = this.expression();</td></tr><tr><td class="line">1278</td><td class="hits"></td><td class="source">      // arg</td></tr><tr><td class="line">1279</td><td class="hits"></td><td class="source">      } else {</td></tr><tr class="hit"><td class="line">1280</td><td class="hits">22280</td><td class="source">        args.push(this.expression());</td></tr><tr><td class="line">1281</td><td class="hits"></td><td class="source">      }</td></tr><tr><td class="line">1282</td><td class="hits"></td><td class="source">    } while (this.accept(','));</td></tr><tr><td class="line">1283</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">1284</td><td class="hits">14780</td><td class="source">    return args;</td></tr><tr><td class="line">1285</td><td class="hits"></td><td class="source">  },</td></tr><tr><td class="line">1286</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">1287</td><td class="hits"></td><td class="source">  /**</td></tr><tr><td class="line">1288</td><td class="hits"></td><td class="source">   * expression (',' expression)*</td></tr><tr><td class="line">1289</td><td class="hits"></td><td class="source">   */</td></tr><tr><td class="line">1290</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">1291</td><td class="hits"></td><td class="source">  list: function() {</td></tr><tr class="hit"><td class="line">1292</td><td class="hits">8089</td><td class="source">    var node = this.expression();</td></tr><tr class="hit"><td class="line">1293</td><td class="hits">8089</td><td class="source">    while (this.accept(',')) {</td></tr><tr class="hit"><td class="line">1294</td><td class="hits">56</td><td class="source">      if (node.isList) {</td></tr><tr class="hit"><td class="line">1295</td><td class="hits">39</td><td class="source">        list.push(this.expression());</td></tr><tr><td class="line">1296</td><td class="hits"></td><td class="source">      } else {</td></tr><tr class="hit"><td class="line">1297</td><td class="hits">17</td><td class="source">        var list = new nodes.Expression(true);</td></tr><tr class="hit"><td class="line">1298</td><td class="hits">17</td><td class="source">        list.push(node);</td></tr><tr class="hit"><td class="line">1299</td><td class="hits">17</td><td class="source">        list.push(this.expression());</td></tr><tr class="hit"><td class="line">1300</td><td class="hits">17</td><td class="source">        node = list;</td></tr><tr><td class="line">1301</td><td class="hits"></td><td class="source">      }</td></tr><tr><td class="line">1302</td><td class="hits"></td><td class="source">    }</td></tr><tr class="hit"><td class="line">1303</td><td class="hits">8089</td><td class="source">    return node;</td></tr><tr><td class="line">1304</td><td class="hits"></td><td class="source">  },</td></tr><tr><td class="line">1305</td><td class="hits"></td><td class="source">  </td></tr><tr><td class="line">1306</td><td class="hits"></td><td class="source">  /**</td></tr><tr><td class="line">1307</td><td class="hits"></td><td class="source">   * negation+</td></tr><tr><td class="line">1308</td><td class="hits"></td><td class="source">   */</td></tr><tr><td class="line">1309</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">1310</td><td class="hits"></td><td class="source">  expression: function() {</td></tr><tr class="hit"><td class="line">1311</td><td class="hits">54901</td><td class="source">    var node</td></tr><tr><td class="line">1312</td><td class="hits"></td><td class="source">      , expr = new nodes.Expression;</td></tr><tr class="hit"><td class="line">1313</td><td class="hits">54901</td><td class="source">    this.state.push('expression');</td></tr><tr class="hit"><td class="line">1314</td><td class="hits">54901</td><td class="source">    while (node = this.negation()) {</td></tr><tr class="hit"><td class="line">1315</td><td class="hits">56490</td><td class="source">      if (!node) this.error('unexpected token {peek} in expression');</td></tr><tr class="hit"><td class="line">1316</td><td class="hits">56490</td><td class="source">      expr.push(node);</td></tr><tr><td class="line">1317</td><td class="hits"></td><td class="source">    }</td></tr><tr class="hit"><td class="line">1318</td><td class="hits">54901</td><td class="source">    this.state.pop();</td></tr><tr class="hit"><td class="line">1319</td><td class="hits">54901</td><td class="source">    return expr;</td></tr><tr><td class="line">1320</td><td class="hits"></td><td class="source">  },</td></tr><tr><td class="line">1321</td><td class="hits"></td><td class="source">  </td></tr><tr><td class="line">1322</td><td class="hits"></td><td class="source">  /**</td></tr><tr><td class="line">1323</td><td class="hits"></td><td class="source">   *   'not' ternary</td></tr><tr><td class="line">1324</td><td class="hits"></td><td class="source">   * | ternary</td></tr><tr><td class="line">1325</td><td class="hits"></td><td class="source">   */</td></tr><tr><td class="line">1326</td><td class="hits"></td><td class="source">  </td></tr><tr><td class="line">1327</td><td class="hits"></td><td class="source">  negation: function() {</td></tr><tr class="hit"><td class="line">1328</td><td class="hits">111400</td><td class="source">    if (this.accept('not')) {</td></tr><tr class="hit"><td class="line">1329</td><td class="hits">9</td><td class="source">      return new nodes.UnaryOp('!', this.negation());</td></tr><tr><td class="line">1330</td><td class="hits"></td><td class="source">    }</td></tr><tr class="hit"><td class="line">1331</td><td class="hits">111391</td><td class="source">    return this.ternary();</td></tr><tr><td class="line">1332</td><td class="hits"></td><td class="source">  },</td></tr><tr><td class="line">1333</td><td class="hits"></td><td class="source">  </td></tr><tr><td class="line">1334</td><td class="hits"></td><td class="source">  /**</td></tr><tr><td class="line">1335</td><td class="hits"></td><td class="source">   * logical ('?' expression ':' expression)?</td></tr><tr><td class="line">1336</td><td class="hits"></td><td class="source">   */</td></tr><tr><td class="line">1337</td><td class="hits"></td><td class="source">  </td></tr><tr><td class="line">1338</td><td class="hits"></td><td class="source">  ternary: function() {</td></tr><tr class="hit"><td class="line">1339</td><td class="hits">111391</td><td class="source">    var node = this.logical();</td></tr><tr class="hit"><td class="line">1340</td><td class="hits">111391</td><td class="source">    if (this.accept('?')) {</td></tr><tr class="hit"><td class="line">1341</td><td class="hits">858</td><td class="source">      var trueExpr = this.expression();</td></tr><tr class="hit"><td class="line">1342</td><td class="hits">858</td><td class="source">      this.expect(':');</td></tr><tr class="hit"><td class="line">1343</td><td class="hits">858</td><td class="source">      var falseExpr = this.expression();</td></tr><tr class="hit"><td class="line">1344</td><td class="hits">858</td><td class="source">      node = new nodes.Ternary(node, trueExpr, falseExpr);</td></tr><tr><td class="line">1345</td><td class="hits"></td><td class="source">    }</td></tr><tr class="hit"><td class="line">1346</td><td class="hits">111391</td><td class="source">    return node;</td></tr><tr><td class="line">1347</td><td class="hits"></td><td class="source">  },</td></tr><tr><td class="line">1348</td><td class="hits"></td><td class="source">  </td></tr><tr><td class="line">1349</td><td class="hits"></td><td class="source">  /**</td></tr><tr><td class="line">1350</td><td class="hits"></td><td class="source">   * typecheck (('&amp;&amp;' | '||') typecheck)*</td></tr><tr><td class="line">1351</td><td class="hits"></td><td class="source">   */</td></tr><tr><td class="line">1352</td><td class="hits"></td><td class="source">  </td></tr><tr><td class="line">1353</td><td class="hits"></td><td class="source">  logical: function() {</td></tr><tr class="hit"><td class="line">1354</td><td class="hits">111391</td><td class="source">    var op</td></tr><tr><td class="line">1355</td><td class="hits"></td><td class="source">      , node = this.typecheck();</td></tr><tr class="hit"><td class="line">1356</td><td class="hits">111391</td><td class="source">    while (op = this.accept('&amp;&amp;') || this.accept('||')) {</td></tr><tr class="hit"><td class="line">1357</td><td class="hits">272</td><td class="source">      node = new nodes.BinOp(op.type, node, this.typecheck());</td></tr><tr><td class="line">1358</td><td class="hits"></td><td class="source">    }</td></tr><tr class="hit"><td class="line">1359</td><td class="hits">111391</td><td class="source">    return node;</td></tr><tr><td class="line">1360</td><td class="hits"></td><td class="source">  },</td></tr><tr><td class="line">1361</td><td class="hits"></td><td class="source">  </td></tr><tr><td class="line">1362</td><td class="hits"></td><td class="source">  /**</td></tr><tr><td class="line">1363</td><td class="hits"></td><td class="source">   * equality ('is a' equality)*</td></tr><tr><td class="line">1364</td><td class="hits"></td><td class="source">   */</td></tr><tr><td class="line">1365</td><td class="hits"></td><td class="source">  </td></tr><tr><td class="line">1366</td><td class="hits"></td><td class="source">  typecheck: function() {</td></tr><tr class="hit"><td class="line">1367</td><td class="hits">111663</td><td class="source">    var op</td></tr><tr><td class="line">1368</td><td class="hits"></td><td class="source">      , node = this.equality();</td></tr><tr class="hit"><td class="line">1369</td><td class="hits">111663</td><td class="source">    while (op = this.accept('is a')) {</td></tr><tr class="hit"><td class="line">1370</td><td class="hits">859</td><td class="source">      this.operand = true;</td></tr><tr class="hit"><td class="line">1371</td><td class="hits">859</td><td class="source">      if (!node) this.error('illegal unary &quot;' + op + '&quot;, missing left-hand operand');</td></tr><tr class="hit"><td class="line">1372</td><td class="hits">859</td><td class="source">      node = new nodes.BinOp(op.type, node, this.equality());</td></tr><tr class="hit"><td class="line">1373</td><td class="hits">859</td><td class="source">      this.operand = false;</td></tr><tr><td class="line">1374</td><td class="hits"></td><td class="source">    }</td></tr><tr class="hit"><td class="line">1375</td><td class="hits">111663</td><td class="source">    return node;</td></tr><tr><td class="line">1376</td><td class="hits"></td><td class="source">  },</td></tr><tr><td class="line">1377</td><td class="hits"></td><td class="source">  </td></tr><tr><td class="line">1378</td><td class="hits"></td><td class="source">  /**</td></tr><tr><td class="line">1379</td><td class="hits"></td><td class="source">   * in (('==' | '!=') in)*</td></tr><tr><td class="line">1380</td><td class="hits"></td><td class="source">   */</td></tr><tr><td class="line">1381</td><td class="hits"></td><td class="source">  </td></tr><tr><td class="line">1382</td><td class="hits"></td><td class="source">  equality: function() {</td></tr><tr class="hit"><td class="line">1383</td><td class="hits">112522</td><td class="source">    var op</td></tr><tr><td class="line">1384</td><td class="hits"></td><td class="source">      , node = this.in();</td></tr><tr class="hit"><td class="line">1385</td><td class="hits">112522</td><td class="source">    while (op = this.accept('==') || this.accept('!=')) {</td></tr><tr class="hit"><td class="line">1386</td><td class="hits">1378</td><td class="source">      this.operand = true;</td></tr><tr class="hit"><td class="line">1387</td><td class="hits">1378</td><td class="source">      if (!node) this.error('illegal unary &quot;' + op + '&quot;, missing left-hand operand');</td></tr><tr class="hit"><td class="line">1388</td><td class="hits">1378</td><td class="source">      node = new nodes.BinOp(op.type, node, this.in());</td></tr><tr class="hit"><td class="line">1389</td><td class="hits">1378</td><td class="source">      this.operand = false;</td></tr><tr><td class="line">1390</td><td class="hits"></td><td class="source">    }</td></tr><tr class="hit"><td class="line">1391</td><td class="hits">112522</td><td class="source">    return node;</td></tr><tr><td class="line">1392</td><td class="hits"></td><td class="source">  },</td></tr><tr><td class="line">1393</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">1394</td><td class="hits"></td><td class="source">  /**</td></tr><tr><td class="line">1395</td><td class="hits"></td><td class="source">   * relational ('in' relational)*</td></tr><tr><td class="line">1396</td><td class="hits"></td><td class="source">   */</td></tr><tr><td class="line">1397</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">1398</td><td class="hits"></td><td class="source">  in: function() {</td></tr><tr class="hit"><td class="line">1399</td><td class="hits">113900</td><td class="source">    var node = this.relational();</td></tr><tr class="hit"><td class="line">1400</td><td class="hits">113900</td><td class="source">    while (this.accept('in')) {</td></tr><tr class="hit"><td class="line">1401</td><td class="hits">228</td><td class="source">      this.operand = true;</td></tr><tr class="hit"><td class="line">1402</td><td class="hits">228</td><td class="source">      if (!node) this.error('illegal unary &quot;in&quot;, missing left-hand operand');</td></tr><tr class="hit"><td class="line">1403</td><td class="hits">228</td><td class="source">      node = new nodes.BinOp('in', node, this.relational());</td></tr><tr class="hit"><td class="line">1404</td><td class="hits">228</td><td class="source">      this.operand = false;</td></tr><tr><td class="line">1405</td><td class="hits"></td><td class="source">    }</td></tr><tr class="hit"><td class="line">1406</td><td class="hits">113900</td><td class="source">    return node;</td></tr><tr><td class="line">1407</td><td class="hits"></td><td class="source">  },</td></tr><tr><td class="line">1408</td><td class="hits"></td><td class="source">  </td></tr><tr><td class="line">1409</td><td class="hits"></td><td class="source">  /**</td></tr><tr><td class="line">1410</td><td class="hits"></td><td class="source">   * range (('&gt;=' | '&lt;=' | '&gt;' | '&lt;') range)*</td></tr><tr><td class="line">1411</td><td class="hits"></td><td class="source">   */</td></tr><tr><td class="line">1412</td><td class="hits"></td><td class="source">  </td></tr><tr><td class="line">1413</td><td class="hits"></td><td class="source">  relational: function() {</td></tr><tr class="hit"><td class="line">1414</td><td class="hits">114128</td><td class="source">    var op</td></tr><tr><td class="line">1415</td><td class="hits"></td><td class="source">      , node = this.range();</td></tr><tr class="hit"><td class="line">1416</td><td class="hits">114128</td><td class="source">    while (op = </td></tr><tr><td class="line">1417</td><td class="hits"></td><td class="source">         this.accept('&gt;=')</td></tr><tr><td class="line">1418</td><td class="hits"></td><td class="source">      || this.accept('&lt;=')</td></tr><tr><td class="line">1419</td><td class="hits"></td><td class="source">      || this.accept('&lt;')</td></tr><tr><td class="line">1420</td><td class="hits"></td><td class="source">      || this.accept('&gt;')</td></tr><tr><td class="line">1421</td><td class="hits"></td><td class="source">      ) {</td></tr><tr class="hit"><td class="line">1422</td><td class="hits">861</td><td class="source">      this.operand = true;</td></tr><tr class="hit"><td class="line">1423</td><td class="hits">861</td><td class="source">      if (!node) this.error('illegal unary &quot;' + op + '&quot;, missing left-hand operand');</td></tr><tr class="hit"><td class="line">1424</td><td class="hits">861</td><td class="source">      node = new nodes.BinOp(op.type, node, this.range());</td></tr><tr class="hit"><td class="line">1425</td><td class="hits">861</td><td class="source">      this.operand = false;</td></tr><tr><td class="line">1426</td><td class="hits"></td><td class="source">    }</td></tr><tr class="hit"><td class="line">1427</td><td class="hits">114128</td><td class="source">    return node;</td></tr><tr><td class="line">1428</td><td class="hits"></td><td class="source">  },</td></tr><tr><td class="line">1429</td><td class="hits"></td><td class="source">  </td></tr><tr><td class="line">1430</td><td class="hits"></td><td class="source">  /**</td></tr><tr><td class="line">1431</td><td class="hits"></td><td class="source">   * additive (('..' | '...') additive)*</td></tr><tr><td class="line">1432</td><td class="hits"></td><td class="source">   */</td></tr><tr><td class="line">1433</td><td class="hits"></td><td class="source">  </td></tr><tr><td class="line">1434</td><td class="hits"></td><td class="source">  range: function() {</td></tr><tr class="hit"><td class="line">1435</td><td class="hits">114989</td><td class="source">    var op</td></tr><tr><td class="line">1436</td><td class="hits"></td><td class="source">      , node = this.additive();</td></tr><tr class="hit"><td class="line">1437</td><td class="hits">114989</td><td class="source">    if (op = this.accept('...') || this.accept('..')) {</td></tr><tr class="hit"><td class="line">1438</td><td class="hits">223</td><td class="source">      this.operand = true;</td></tr><tr class="hit"><td class="line">1439</td><td class="hits">223</td><td class="source">      if (!node) this.error('illegal unary &quot;' + op + '&quot;, missing left-hand operand');</td></tr><tr class="hit"><td class="line">1440</td><td class="hits">223</td><td class="source">      node = new nodes.BinOp(op.val, node, this.additive());</td></tr><tr class="hit"><td class="line">1441</td><td class="hits">223</td><td class="source">      this.operand = false;</td></tr><tr><td class="line">1442</td><td class="hits"></td><td class="source">    }</td></tr><tr class="hit"><td class="line">1443</td><td class="hits">114989</td><td class="source">    return node;</td></tr><tr><td class="line">1444</td><td class="hits"></td><td class="source">  },</td></tr><tr><td class="line">1445</td><td class="hits"></td><td class="source">  </td></tr><tr><td class="line">1446</td><td class="hits"></td><td class="source">  /**</td></tr><tr><td class="line">1447</td><td class="hits"></td><td class="source">   * multiplicative (('+' | '-') multiplicative)*</td></tr><tr><td class="line">1448</td><td class="hits"></td><td class="source">   */</td></tr><tr><td class="line">1449</td><td class="hits"></td><td class="source">  </td></tr><tr><td class="line">1450</td><td class="hits"></td><td class="source">  additive: function() {</td></tr><tr class="hit"><td class="line">1451</td><td class="hits">115212</td><td class="source">    var op</td></tr><tr><td class="line">1452</td><td class="hits"></td><td class="source">      , node = this.multiplicative();</td></tr><tr class="hit"><td class="line">1453</td><td class="hits">115212</td><td class="source">    while (op = this.accept('+') || this.accept('-')) {</td></tr><tr class="hit"><td class="line">1454</td><td class="hits">4873</td><td class="source">      this.operand = true;</td></tr><tr class="hit"><td class="line">1455</td><td class="hits">4873</td><td class="source">      node = new nodes.BinOp(op.type, node, this.multiplicative());</td></tr><tr class="hit"><td class="line">1456</td><td class="hits">4873</td><td class="source">      this.operand = false;</td></tr><tr><td class="line">1457</td><td class="hits"></td><td class="source">    }</td></tr><tr class="hit"><td class="line">1458</td><td class="hits">115212</td><td class="source">    return node;</td></tr><tr><td class="line">1459</td><td class="hits"></td><td class="source">  },</td></tr><tr><td class="line">1460</td><td class="hits"></td><td class="source">  </td></tr><tr><td class="line">1461</td><td class="hits"></td><td class="source">  /**</td></tr><tr><td class="line">1462</td><td class="hits"></td><td class="source">   * defined (('**' | '*' | '/' | '%') defined)*</td></tr><tr><td class="line">1463</td><td class="hits"></td><td class="source">   */</td></tr><tr><td class="line">1464</td><td class="hits"></td><td class="source">  </td></tr><tr><td class="line">1465</td><td class="hits"></td><td class="source">  multiplicative: function() {</td></tr><tr class="hit"><td class="line">1466</td><td class="hits">120085</td><td class="source">    var op</td></tr><tr><td class="line">1467</td><td class="hits"></td><td class="source">      , node = this.defined();</td></tr><tr class="hit"><td class="line">1468</td><td class="hits">120085</td><td class="source">    while (op =</td></tr><tr><td class="line">1469</td><td class="hits"></td><td class="source">         this.accept('**')</td></tr><tr><td class="line">1470</td><td class="hits"></td><td class="source">      || this.accept('*')</td></tr><tr><td class="line">1471</td><td class="hits"></td><td class="source">      || this.accept('/')</td></tr><tr><td class="line">1472</td><td class="hits"></td><td class="source">      || this.accept('%')) {</td></tr><tr class="hit"><td class="line">1473</td><td class="hits">2773</td><td class="source">      this.operand = true;</td></tr><tr class="hit"><td class="line">1474</td><td class="hits">2773</td><td class="source">      if ('/' == op &amp;&amp; this.inProperty &amp;&amp; !this.parens) {</td></tr><tr class="hit"><td class="line">1475</td><td class="hits">10</td><td class="source">        this.stash.push(new Token('literal', new nodes.Literal('/')));</td></tr><tr class="hit"><td class="line">1476</td><td class="hits">10</td><td class="source">        this.operand = false;</td></tr><tr class="hit"><td class="line">1477</td><td class="hits">10</td><td class="source">        return node;</td></tr><tr><td class="line">1478</td><td class="hits"></td><td class="source">      } else {</td></tr><tr class="hit"><td class="line">1479</td><td class="hits">2763</td><td class="source">        if (!node) this.error('illegal unary &quot;' + op + '&quot;, missing left-hand operand');</td></tr><tr class="hit"><td class="line">1480</td><td class="hits">2763</td><td class="source">        node = new nodes.BinOp(op.type, node, this.defined());</td></tr><tr class="hit"><td class="line">1481</td><td class="hits">2763</td><td class="source">        this.operand = false;</td></tr><tr><td class="line">1482</td><td class="hits"></td><td class="source">      }</td></tr><tr><td class="line">1483</td><td class="hits"></td><td class="source">    }</td></tr><tr class="hit"><td class="line">1484</td><td class="hits">120075</td><td class="source">    return node;</td></tr><tr><td class="line">1485</td><td class="hits"></td><td class="source">  },</td></tr><tr><td class="line">1486</td><td class="hits"></td><td class="source">  </td></tr><tr><td class="line">1487</td><td class="hits"></td><td class="source">  /**</td></tr><tr><td class="line">1488</td><td class="hits"></td><td class="source">   *    unary 'is defined'</td></tr><tr><td class="line">1489</td><td class="hits"></td><td class="source">   *  | unary</td></tr><tr><td class="line">1490</td><td class="hits"></td><td class="source">   */</td></tr><tr><td class="line">1491</td><td class="hits"></td><td class="source">  </td></tr><tr><td class="line">1492</td><td class="hits"></td><td class="source">  defined: function() {</td></tr><tr class="hit"><td class="line">1493</td><td class="hits">122848</td><td class="source">    var node = this.unary();</td></tr><tr class="hit"><td class="line">1494</td><td class="hits">122848</td><td class="source">    if (this.accept('is defined')) {</td></tr><tr class="hit"><td class="line">1495</td><td class="hits">15</td><td class="source">      if (!node) this.error('illegal unary &quot;is defined&quot;, missing left-hand operand');</td></tr><tr class="hit"><td class="line">1496</td><td class="hits">15</td><td class="source">      node = new nodes.BinOp('is defined', node);</td></tr><tr><td class="line">1497</td><td class="hits"></td><td class="source">    }</td></tr><tr class="hit"><td class="line">1498</td><td class="hits">122848</td><td class="source">    return node;</td></tr><tr><td class="line">1499</td><td class="hits"></td><td class="source">  },</td></tr><tr><td class="line">1500</td><td class="hits"></td><td class="source">  </td></tr><tr><td class="line">1501</td><td class="hits"></td><td class="source">  /**</td></tr><tr><td class="line">1502</td><td class="hits"></td><td class="source">   *   ('!' | '~' | '+' | '-') unary</td></tr><tr><td class="line">1503</td><td class="hits"></td><td class="source">   * | subscript</td></tr><tr><td class="line">1504</td><td class="hits"></td><td class="source">   */</td></tr><tr><td class="line">1505</td><td class="hits"></td><td class="source">  </td></tr><tr><td class="line">1506</td><td class="hits"></td><td class="source">  unary: function() {</td></tr><tr class="hit"><td class="line">1507</td><td class="hits">123383</td><td class="source">    var op</td></tr><tr><td class="line">1508</td><td class="hits"></td><td class="source">      , node;</td></tr><tr class="hit"><td class="line">1509</td><td class="hits">123383</td><td class="source">    if (op =</td></tr><tr><td class="line">1510</td><td class="hits"></td><td class="source">         this.accept('!')</td></tr><tr><td class="line">1511</td><td class="hits"></td><td class="source">      || this.accept('~')</td></tr><tr><td class="line">1512</td><td class="hits"></td><td class="source">      || this.accept('+')</td></tr><tr><td class="line">1513</td><td class="hits"></td><td class="source">      || this.accept('-')) {</td></tr><tr class="hit"><td class="line">1514</td><td class="hits">535</td><td class="source">      this.operand = true;</td></tr><tr class="hit"><td class="line">1515</td><td class="hits">535</td><td class="source">      node = new nodes.UnaryOp(op.type, this.unary());</td></tr><tr class="hit"><td class="line">1516</td><td class="hits">535</td><td class="source">      this.operand = false;</td></tr><tr class="hit"><td class="line">1517</td><td class="hits">535</td><td class="source">      return node;</td></tr><tr><td class="line">1518</td><td class="hits"></td><td class="source">    }</td></tr><tr class="hit"><td class="line">1519</td><td class="hits">122848</td><td class="source">    return this.subscript();</td></tr><tr><td class="line">1520</td><td class="hits"></td><td class="source">  },</td></tr><tr><td class="line">1521</td><td class="hits"></td><td class="source">  </td></tr><tr><td class="line">1522</td><td class="hits"></td><td class="source">  /**</td></tr><tr><td class="line">1523</td><td class="hits"></td><td class="source">   *   primary ('[' expression ']' '='?)+</td></tr><tr><td class="line">1524</td><td class="hits"></td><td class="source">   * | primary</td></tr><tr><td class="line">1525</td><td class="hits"></td><td class="source">   */</td></tr><tr><td class="line">1526</td><td class="hits"></td><td class="source">  </td></tr><tr><td class="line">1527</td><td class="hits"></td><td class="source">  subscript: function() {</td></tr><tr class="hit"><td class="line">1528</td><td class="hits">122848</td><td class="source">    var node = this.primary();</td></tr><tr class="hit"><td class="line">1529</td><td class="hits">122848</td><td class="source">    while (this.accept('[')) {</td></tr><tr class="hit"><td class="line">1530</td><td class="hits">2822</td><td class="source">      node = new nodes.BinOp('[]', node, this.expression());</td></tr><tr class="hit"><td class="line">1531</td><td class="hits">2822</td><td class="source">      this.expect(']');</td></tr><tr><td class="line">1532</td><td class="hits"></td><td class="source">      // TODO: TernaryOp :)</td></tr><tr class="hit"><td class="line">1533</td><td class="hits">2822</td><td class="source">      if (this.accept('=')) {</td></tr><tr class="hit"><td class="line">1534</td><td class="hits">12</td><td class="source">        node.op += '=';</td></tr><tr class="hit"><td class="line">1535</td><td class="hits">12</td><td class="source">        node.val = this.expression();</td></tr><tr><td class="line">1536</td><td class="hits"></td><td class="source">      }</td></tr><tr><td class="line">1537</td><td class="hits"></td><td class="source">    }</td></tr><tr class="hit"><td class="line">1538</td><td class="hits">122848</td><td class="source">    return node;</td></tr><tr><td class="line">1539</td><td class="hits"></td><td class="source">  },</td></tr><tr><td class="line">1540</td><td class="hits"></td><td class="source">  </td></tr><tr><td class="line">1541</td><td class="hits"></td><td class="source">  /**</td></tr><tr><td class="line">1542</td><td class="hits"></td><td class="source">   *   unit</td></tr><tr><td class="line">1543</td><td class="hits"></td><td class="source">   * | null</td></tr><tr><td class="line">1544</td><td class="hits"></td><td class="source">   * | color</td></tr><tr><td class="line">1545</td><td class="hits"></td><td class="source">   * | string</td></tr><tr><td class="line">1546</td><td class="hits"></td><td class="source">   * | ident</td></tr><tr><td class="line">1547</td><td class="hits"></td><td class="source">   * | boolean</td></tr><tr><td class="line">1548</td><td class="hits"></td><td class="source">   * | literal</td></tr><tr><td class="line">1549</td><td class="hits"></td><td class="source">   * | '(' expression ')' '%'?</td></tr><tr><td class="line">1550</td><td class="hits"></td><td class="source">   */</td></tr><tr><td class="line">1551</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">1552</td><td class="hits"></td><td class="source">  primary: function() {</td></tr><tr class="hit"><td class="line">1553</td><td class="hits">122848</td><td class="source">    var op</td></tr><tr><td class="line">1554</td><td class="hits"></td><td class="source">      , node;</td></tr><tr><td class="line">1555</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">1556</td><td class="hits"></td><td class="source">    // Parenthesis</td></tr><tr class="hit"><td class="line">1557</td><td class="hits">122848</td><td class="source">    if (this.accept('(')) {</td></tr><tr class="hit"><td class="line">1558</td><td class="hits">2668</td><td class="source">      ++this.parens;</td></tr><tr class="hit"><td class="line">1559</td><td class="hits">2668</td><td class="source">      var expr = this.expression();</td></tr><tr class="hit"><td class="line">1560</td><td class="hits">2668</td><td class="source">      this.expect(')');</td></tr><tr class="hit"><td class="line">1561</td><td class="hits">2668</td><td class="source">      --this.parens;</td></tr><tr class="hit"><td class="line">1562</td><td class="hits">2671</td><td class="source">      if (this.accept('%')) expr.push(new nodes.Ident('%'));</td></tr><tr class="hit"><td class="line">1563</td><td class="hits">2668</td><td class="source">      return expr;</td></tr><tr><td class="line">1564</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">1565</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">1566</td><td class="hits"></td><td class="source">    // Primitive</td></tr><tr class="hit"><td class="line">1567</td><td class="hits">120180</td><td class="source">    switch (this.peek().type) {</td></tr><tr><td class="line">1568</td><td class="hits"></td><td class="source">      case 'null':</td></tr><tr><td class="line">1569</td><td class="hits"></td><td class="source">      case 'unit':</td></tr><tr><td class="line">1570</td><td class="hits"></td><td class="source">      case 'color':</td></tr><tr><td class="line">1571</td><td class="hits"></td><td class="source">      case 'string':</td></tr><tr><td class="line">1572</td><td class="hits"></td><td class="source">      case 'literal':</td></tr><tr><td class="line">1573</td><td class="hits"></td><td class="source">      case 'boolean':</td></tr><tr class="hit"><td class="line">1574</td><td class="hits">16553</td><td class="source">        return this.next().val;</td></tr><tr><td class="line">1575</td><td class="hits"></td><td class="source">      case 'ident':</td></tr><tr class="hit"><td class="line">1576</td><td class="hits">33946</td><td class="source">        return this.ident();</td></tr><tr><td class="line">1577</td><td class="hits"></td><td class="source">      case 'function':</td></tr><tr class="hit"><td class="line">1578</td><td class="hits">14780</td><td class="source">        return this.functionCall();</td></tr><tr><td class="line">1579</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">1580</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">1581</td><td class="hits"></td><td class="source">};</td></tr></tbody></table></div><div class="file"><h2 id="lexer.js">lexer.js</h2><div id="stats" class="high"><div class="percentage">97%</div><div class="sloc">253</div><div class="hits">246</div><div class="misses">7</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr><td class="line">1</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source">/*!</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source"> * Stylus - Lexer</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source"> * Copyright(c) 2010 LearnBoost &lt;dev@learnboost.com&gt;</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> * MIT Licensed</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source"> * Module dependencies.</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">12</td><td class="hits">1</td><td class="source">var Token = require('./token')</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source">  , nodes = require('./nodes')</td></tr><tr><td class="line">14</td><td class="hits"></td><td class="source">  , errors = require('./errors')</td></tr><tr><td class="line">15</td><td class="hits"></td><td class="source">  , units = require('./units');</td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">17</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source"> * Expose `Lexer`.</td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">21</td><td class="hits">1</td><td class="source">exports = module.exports = Lexer;</td></tr><tr><td class="line">22</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">23</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">24</td><td class="hits"></td><td class="source"> * Operator aliases.</td></tr><tr><td class="line">25</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">26</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">27</td><td class="hits">1</td><td class="source">var alias = {</td></tr><tr><td class="line">28</td><td class="hits"></td><td class="source">    'and': '&amp;&amp;'</td></tr><tr><td class="line">29</td><td class="hits"></td><td class="source">  , 'or': '||'</td></tr><tr><td class="line">30</td><td class="hits"></td><td class="source">  , 'is': '=='</td></tr><tr><td class="line">31</td><td class="hits"></td><td class="source">  , 'isnt': '!='</td></tr><tr><td class="line">32</td><td class="hits"></td><td class="source">  , 'is not': '!='</td></tr><tr><td class="line">33</td><td class="hits"></td><td class="source">  , ':=': '?='</td></tr><tr><td class="line">34</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">35</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">36</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">37</td><td class="hits"></td><td class="source"> * Units.</td></tr><tr><td class="line">38</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">39</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">40</td><td class="hits">1</td><td class="source">units = units.join('|');</td></tr><tr><td class="line">41</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">42</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">43</td><td class="hits"></td><td class="source"> * Unit RegExp.</td></tr><tr><td class="line">44</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">45</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">46</td><td class="hits">1</td><td class="source">var unit = new RegExp('^(-)?(\\d+\\.\\d+|\\d+|\\.\\d+)(' + units + ')?[ \\t]*');</td></tr><tr><td class="line">47</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">48</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">49</td><td class="hits"></td><td class="source"> * Initialize a new `Lexer` with the given `str` and `options`.</td></tr><tr><td class="line">50</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">51</td><td class="hits"></td><td class="source"> * @param {String} str</td></tr><tr><td class="line">52</td><td class="hits"></td><td class="source"> * @param {Object} options</td></tr><tr><td class="line">53</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">54</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">55</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">56</td><td class="hits">1</td><td class="source">function Lexer(str, options) {</td></tr><tr class="hit"><td class="line">57</td><td class="hits">430</td><td class="source">  options = options || {};</td></tr><tr class="hit"><td class="line">58</td><td class="hits">430</td><td class="source">  this.stash = [];</td></tr><tr class="hit"><td class="line">59</td><td class="hits">430</td><td class="source">  this.indentStack = [];</td></tr><tr class="hit"><td class="line">60</td><td class="hits">430</td><td class="source">  this.indentRe = null;</td></tr><tr class="hit"><td class="line">61</td><td class="hits">430</td><td class="source">  this.lineno = 1;</td></tr><tr><td class="line">62</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">63</td><td class="hits">430</td><td class="source">  function comment(str, val, offset, s) {</td></tr><tr class="hit"><td class="line">64</td><td class="hits">91</td><td class="source">    return s.lastIndexOf('/*', offset) &gt; s.lastIndexOf('*/', offset)</td></tr><tr><td class="line">65</td><td class="hits"></td><td class="source">      ? str</td></tr><tr><td class="line">66</td><td class="hits"></td><td class="source">      : val;</td></tr><tr class="hit"><td class="line">67</td><td class="hits">430</td><td class="source">  };</td></tr><tr><td class="line">68</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">69</td><td class="hits">430</td><td class="source">  this.str = str</td></tr><tr><td class="line">70</td><td class="hits"></td><td class="source">    .replace(/\r\n?/g, '\n')</td></tr><tr><td class="line">71</td><td class="hits"></td><td class="source">    .replace(/\\ *\n/g, ' ')</td></tr><tr><td class="line">72</td><td class="hits"></td><td class="source">    .replace(/([,:(]) *\n\s*/g, comment)</td></tr><tr><td class="line">73</td><td class="hits"></td><td class="source">    .replace(/\s*\n *([,)])/g, comment);</td></tr><tr class="hit"><td class="line">74</td><td class="hits">1</td><td class="source">};</td></tr><tr><td class="line">75</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">76</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">77</td><td class="hits"></td><td class="source"> * Lexer prototype.</td></tr><tr><td class="line">78</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">79</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">80</td><td class="hits">1</td><td class="source">Lexer.prototype = {</td></tr><tr><td class="line">81</td><td class="hits"></td><td class="source">  </td></tr><tr><td class="line">82</td><td class="hits"></td><td class="source">  /**</td></tr><tr><td class="line">83</td><td class="hits"></td><td class="source">   * Custom inspect.</td></tr><tr><td class="line">84</td><td class="hits"></td><td class="source">   */</td></tr><tr><td class="line">85</td><td class="hits"></td><td class="source">  </td></tr><tr><td class="line">86</td><td class="hits"></td><td class="source">  inspect: function(){</td></tr><tr class="miss"><td class="line">87</td><td class="hits">0</td><td class="source">    var tok</td></tr><tr><td class="line">88</td><td class="hits"></td><td class="source">      , tmp = this.str</td></tr><tr><td class="line">89</td><td class="hits"></td><td class="source">      , buf = [];</td></tr><tr class="miss"><td class="line">90</td><td class="hits">0</td><td class="source">    while ('eos' != (tok = this.next()).type) {</td></tr><tr class="miss"><td class="line">91</td><td class="hits">0</td><td class="source">      buf.push(tok.inspect());</td></tr><tr><td class="line">92</td><td class="hits"></td><td class="source">    }</td></tr><tr class="miss"><td class="line">93</td><td class="hits">0</td><td class="source">    this.str = tmp;</td></tr><tr class="miss"><td class="line">94</td><td class="hits">0</td><td class="source">    this.prevIndents = 0;</td></tr><tr class="miss"><td class="line">95</td><td class="hits">0</td><td class="source">    return buf.concat(tok.inspect()).join('\n');</td></tr><tr><td class="line">96</td><td class="hits"></td><td class="source">  },</td></tr><tr><td class="line">97</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">98</td><td class="hits"></td><td class="source">  /**</td></tr><tr><td class="line">99</td><td class="hits"></td><td class="source">   * Lookahead `n` tokens.</td></tr><tr><td class="line">100</td><td class="hits"></td><td class="source">   *</td></tr><tr><td class="line">101</td><td class="hits"></td><td class="source">   * @param {Number} n</td></tr><tr><td class="line">102</td><td class="hits"></td><td class="source">   * @return {Object}</td></tr><tr><td class="line">103</td><td class="hits"></td><td class="source">   * @api private</td></tr><tr><td class="line">104</td><td class="hits"></td><td class="source">   */</td></tr><tr><td class="line">105</td><td class="hits"></td><td class="source">  </td></tr><tr><td class="line">106</td><td class="hits"></td><td class="source">  lookahead: function(n){</td></tr><tr class="hit"><td class="line">107</td><td class="hits">4460915</td><td class="source">    var fetch = n - this.stash.length;</td></tr><tr class="hit"><td class="line">108</td><td class="hits">4681060</td><td class="source">    while (fetch-- &gt; 0) this.stash.push(this.advance());</td></tr><tr class="hit"><td class="line">109</td><td class="hits">4460915</td><td class="source">    return this.stash[--n];</td></tr><tr><td class="line">110</td><td class="hits"></td><td class="source">  },</td></tr><tr><td class="line">111</td><td class="hits"></td><td class="source">  </td></tr><tr><td class="line">112</td><td class="hits"></td><td class="source">  /**</td></tr><tr><td class="line">113</td><td class="hits"></td><td class="source">   * Consume the given `len`.</td></tr><tr><td class="line">114</td><td class="hits"></td><td class="source">   *</td></tr><tr><td class="line">115</td><td class="hits"></td><td class="source">   * @param {Number|Array} len</td></tr><tr><td class="line">116</td><td class="hits"></td><td class="source">   * @api private</td></tr><tr><td class="line">117</td><td class="hits"></td><td class="source">   */</td></tr><tr><td class="line">118</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">119</td><td class="hits"></td><td class="source">  skip: function(len){</td></tr><tr class="hit"><td class="line">120</td><td class="hits">239432</td><td class="source">    this.str = this.str.substr(Array.isArray(len)</td></tr><tr><td class="line">121</td><td class="hits"></td><td class="source">      ? len[0].length</td></tr><tr><td class="line">122</td><td class="hits"></td><td class="source">      : len);</td></tr><tr><td class="line">123</td><td class="hits"></td><td class="source">  },</td></tr><tr><td class="line">124</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">125</td><td class="hits"></td><td class="source">  /**</td></tr><tr><td class="line">126</td><td class="hits"></td><td class="source">   * Fetch next token including those stashed by peek.</td></tr><tr><td class="line">127</td><td class="hits"></td><td class="source">   *</td></tr><tr><td class="line">128</td><td class="hits"></td><td class="source">   * @return {Token}</td></tr><tr><td class="line">129</td><td class="hits"></td><td class="source">   * @api private</td></tr><tr><td class="line">130</td><td class="hits"></td><td class="source">   */</td></tr><tr><td class="line">131</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">132</td><td class="hits"></td><td class="source">  next: function() {</td></tr><tr class="hit"><td class="line">133</td><td class="hits">220711</td><td class="source">    var tok = this.stashed() || this.advance();</td></tr><tr class="hit"><td class="line">134</td><td class="hits">220711</td><td class="source">    switch (tok.type) {</td></tr><tr><td class="line">135</td><td class="hits"></td><td class="source">      case 'newline':</td></tr><tr><td class="line">136</td><td class="hits"></td><td class="source">      case 'indent':</td></tr><tr class="hit"><td class="line">137</td><td class="hits">24441</td><td class="source">        ++this.lineno;</td></tr><tr class="hit"><td class="line">138</td><td class="hits">24441</td><td class="source">        break;</td></tr><tr><td class="line">139</td><td class="hits"></td><td class="source">      case 'outdent':</td></tr><tr class="hit"><td class="line">140</td><td class="hits">15822</td><td class="source">        if ('outdent' != this.prev.type) ++this.lineno;</td></tr><tr><td class="line">141</td><td class="hits"></td><td class="source">    }</td></tr><tr class="hit"><td class="line">142</td><td class="hits">220711</td><td class="source">    this.prev = tok;</td></tr><tr class="hit"><td class="line">143</td><td class="hits">220711</td><td class="source">    tok.lineno = this.lineno;</td></tr><tr class="hit"><td class="line">144</td><td class="hits">220711</td><td class="source">    return tok;</td></tr><tr><td class="line">145</td><td class="hits"></td><td class="source">  },</td></tr><tr><td class="line">146</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">147</td><td class="hits"></td><td class="source">  /**</td></tr><tr><td class="line">148</td><td class="hits"></td><td class="source">   * Fetch next token.</td></tr><tr><td class="line">149</td><td class="hits"></td><td class="source">   *</td></tr><tr><td class="line">150</td><td class="hits"></td><td class="source">   * @return {Token}</td></tr><tr><td class="line">151</td><td class="hits"></td><td class="source">   * @api private</td></tr><tr><td class="line">152</td><td class="hits"></td><td class="source">   */</td></tr><tr><td class="line">153</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">154</td><td class="hits"></td><td class="source">  advance: function() {</td></tr><tr class="hit"><td class="line">155</td><td class="hits">240015</td><td class="source">    return this.eos()</td></tr><tr><td class="line">156</td><td class="hits"></td><td class="source">      || this.null()</td></tr><tr><td class="line">157</td><td class="hits"></td><td class="source">      || this.sep()</td></tr><tr><td class="line">158</td><td class="hits"></td><td class="source">      || this.keyword()</td></tr><tr><td class="line">159</td><td class="hits"></td><td class="source">      || this.urlchars()</td></tr><tr><td class="line">160</td><td class="hits"></td><td class="source">      || this.atrule()</td></tr><tr><td class="line">161</td><td class="hits"></td><td class="source">      || this.scope()</td></tr><tr><td class="line">162</td><td class="hits"></td><td class="source">      || this.extends()</td></tr><tr><td class="line">163</td><td class="hits"></td><td class="source">      || this.media()</td></tr><tr><td class="line">164</td><td class="hits"></td><td class="source">      || this.comment()</td></tr><tr><td class="line">165</td><td class="hits"></td><td class="source">      || this.newline()</td></tr><tr><td class="line">166</td><td class="hits"></td><td class="source">      || this.escaped()</td></tr><tr><td class="line">167</td><td class="hits"></td><td class="source">      || this.important()</td></tr><tr><td class="line">168</td><td class="hits"></td><td class="source">      || this.literal()</td></tr><tr><td class="line">169</td><td class="hits"></td><td class="source">      || this.function()</td></tr><tr><td class="line">170</td><td class="hits"></td><td class="source">      || this.brace()</td></tr><tr><td class="line">171</td><td class="hits"></td><td class="source">      || this.paren()</td></tr><tr><td class="line">172</td><td class="hits"></td><td class="source">      || this.color()</td></tr><tr><td class="line">173</td><td class="hits"></td><td class="source">      || this.string()</td></tr><tr><td class="line">174</td><td class="hits"></td><td class="source">      || this.unit()</td></tr><tr><td class="line">175</td><td class="hits"></td><td class="source">      || this.namedop()</td></tr><tr><td class="line">176</td><td class="hits"></td><td class="source">      || this.boolean()</td></tr><tr><td class="line">177</td><td class="hits"></td><td class="source">      || this.ident()</td></tr><tr><td class="line">178</td><td class="hits"></td><td class="source">      || this.op()</td></tr><tr><td class="line">179</td><td class="hits"></td><td class="source">      || this.space()</td></tr><tr><td class="line">180</td><td class="hits"></td><td class="source">      || this.selector();</td></tr><tr><td class="line">181</td><td class="hits"></td><td class="source">  },</td></tr><tr><td class="line">182</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">183</td><td class="hits"></td><td class="source">  /**</td></tr><tr><td class="line">184</td><td class="hits"></td><td class="source">   * Lookahead a single token.</td></tr><tr><td class="line">185</td><td class="hits"></td><td class="source">   *</td></tr><tr><td class="line">186</td><td class="hits"></td><td class="source">   * @return {Token}</td></tr><tr><td class="line">187</td><td class="hits"></td><td class="source">   * @api private</td></tr><tr><td class="line">188</td><td class="hits"></td><td class="source">   */</td></tr><tr><td class="line">189</td><td class="hits"></td><td class="source">  </td></tr><tr><td class="line">190</td><td class="hits"></td><td class="source">  peek: function() {</td></tr><tr class="hit"><td class="line">191</td><td class="hits">3923543</td><td class="source">    return this.lookahead(1);</td></tr><tr><td class="line">192</td><td class="hits"></td><td class="source">  },</td></tr><tr><td class="line">193</td><td class="hits"></td><td class="source">  </td></tr><tr><td class="line">194</td><td class="hits"></td><td class="source">  /**</td></tr><tr><td class="line">195</td><td class="hits"></td><td class="source">   * Return the next possibly stashed token.</td></tr><tr><td class="line">196</td><td class="hits"></td><td class="source">   *</td></tr><tr><td class="line">197</td><td class="hits"></td><td class="source">   * @return {Token}</td></tr><tr><td class="line">198</td><td class="hits"></td><td class="source">   * @api private</td></tr><tr><td class="line">199</td><td class="hits"></td><td class="source">   */</td></tr><tr><td class="line">200</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">201</td><td class="hits"></td><td class="source">  stashed: function() {</td></tr><tr class="hit"><td class="line">202</td><td class="hits">220711</td><td class="source">    return this.stash.shift();</td></tr><tr><td class="line">203</td><td class="hits"></td><td class="source">  },</td></tr><tr><td class="line">204</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">205</td><td class="hits"></td><td class="source">  /**</td></tr><tr><td class="line">206</td><td class="hits"></td><td class="source">   * EOS | trailing outdents.</td></tr><tr><td class="line">207</td><td class="hits"></td><td class="source">   */</td></tr><tr><td class="line">208</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">209</td><td class="hits"></td><td class="source">  eos: function() {</td></tr><tr class="hit"><td class="line">210</td><td class="hits">479447</td><td class="source">    if (this.str.length) return;</td></tr><tr class="hit"><td class="line">211</td><td class="hits">583</td><td class="source">    if (this.indentStack.length) {</td></tr><tr class="hit"><td class="line">212</td><td class="hits">153</td><td class="source">      this.indentStack.shift();</td></tr><tr class="hit"><td class="line">213</td><td class="hits">153</td><td class="source">      return new Token('outdent');</td></tr><tr><td class="line">214</td><td class="hits"></td><td class="source">    } else {</td></tr><tr class="hit"><td class="line">215</td><td class="hits">430</td><td class="source">      return new Token('eos');</td></tr><tr><td class="line">216</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">217</td><td class="hits"></td><td class="source">  },</td></tr><tr><td class="line">218</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">219</td><td class="hits"></td><td class="source">  /**</td></tr><tr><td class="line">220</td><td class="hits"></td><td class="source">   * url char</td></tr><tr><td class="line">221</td><td class="hits"></td><td class="source">   */</td></tr><tr><td class="line">222</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">223</td><td class="hits"></td><td class="source">  urlchars: function() {</td></tr><tr class="hit"><td class="line">224</td><td class="hits">233893</td><td class="source">    var captures;</td></tr><tr class="hit"><td class="line">225</td><td class="hits">467701</td><td class="source">    if (!this.isURL) return;</td></tr><tr class="hit"><td class="line">226</td><td class="hits">85</td><td class="source">    if (captures = /^[\/:@.;?&amp;=*!,&lt;&gt;#%0-9]+/.exec(this.str)) {</td></tr><tr class="hit"><td class="line">227</td><td class="hits">22</td><td class="source">      this.skip(captures);</td></tr><tr class="hit"><td class="line">228</td><td class="hits">22</td><td class="source">      return new Token('literal', new nodes.Literal(captures[0]));</td></tr><tr><td class="line">229</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">230</td><td class="hits"></td><td class="source">  },</td></tr><tr><td class="line">231</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">232</td><td class="hits"></td><td class="source">  /**</td></tr><tr><td class="line">233</td><td class="hits"></td><td class="source">   * ';' [ \t]*</td></tr><tr><td class="line">234</td><td class="hits"></td><td class="source">   */</td></tr><tr><td class="line">235</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">236</td><td class="hits"></td><td class="source">  sep: function() {</td></tr><tr class="hit"><td class="line">237</td><td class="hits">239410</td><td class="source">    var captures;</td></tr><tr class="hit"><td class="line">238</td><td class="hits">239410</td><td class="source">    if (captures = /^;[ \t]*/.exec(this.str)) {</td></tr><tr class="hit"><td class="line">239</td><td class="hits">1265</td><td class="source">      this.skip(captures);</td></tr><tr class="hit"><td class="line">240</td><td class="hits">1265</td><td class="source">      return new Token(';');</td></tr><tr><td class="line">241</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">242</td><td class="hits"></td><td class="source">  },</td></tr><tr><td class="line">243</td><td class="hits"></td><td class="source">  </td></tr><tr><td class="line">244</td><td class="hits"></td><td class="source">  /**</td></tr><tr><td class="line">245</td><td class="hits"></td><td class="source">   * ' '+</td></tr><tr><td class="line">246</td><td class="hits"></td><td class="source">   */</td></tr><tr><td class="line">247</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">248</td><td class="hits"></td><td class="source">  space: function() {</td></tr><tr class="hit"><td class="line">249</td><td class="hits">19059</td><td class="source">    var captures;</td></tr><tr class="hit"><td class="line">250</td><td class="hits">19059</td><td class="source">    if (captures = /^([ \t]+)/.exec(this.str)) {</td></tr><tr class="hit"><td class="line">251</td><td class="hits">18512</td><td class="source">      this.skip(captures);</td></tr><tr class="hit"><td class="line">252</td><td class="hits">18512</td><td class="source">      return new Token('space');</td></tr><tr><td class="line">253</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">254</td><td class="hits"></td><td class="source">  },</td></tr><tr><td class="line">255</td><td class="hits"></td><td class="source">  </td></tr><tr><td class="line">256</td><td class="hits"></td><td class="source">  /**</td></tr><tr><td class="line">257</td><td class="hits"></td><td class="source">   * '\\' . ' '*</td></tr><tr><td class="line">258</td><td class="hits"></td><td class="source">   */</td></tr><tr><td class="line">259</td><td class="hits"></td><td class="source">   </td></tr><tr><td class="line">260</td><td class="hits"></td><td class="source">  escaped: function() {</td></tr><tr class="hit"><td class="line">261</td><td class="hits">182141</td><td class="source">    var captures;</td></tr><tr class="hit"><td class="line">262</td><td class="hits">182141</td><td class="source">    if (captures = /^\\(.)[ \t]*/.exec(this.str)) {</td></tr><tr class="hit"><td class="line">263</td><td class="hits">2</td><td class="source">      var c = captures[1];</td></tr><tr class="hit"><td class="line">264</td><td class="hits">2</td><td class="source">      this.skip(captures);</td></tr><tr class="hit"><td class="line">265</td><td class="hits">2</td><td class="source">      return new Token('ident', new nodes.Literal(c));</td></tr><tr><td class="line">266</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">267</td><td class="hits"></td><td class="source">  },</td></tr><tr><td class="line">268</td><td class="hits"></td><td class="source">  </td></tr><tr><td class="line">269</td><td class="hits"></td><td class="source">  /**</td></tr><tr><td class="line">270</td><td class="hits"></td><td class="source">   * '@css' ' '* '{' .* '}' ' '*</td></tr><tr><td class="line">271</td><td class="hits"></td><td class="source">   */</td></tr><tr><td class="line">272</td><td class="hits"></td><td class="source">  </td></tr><tr><td class="line">273</td><td class="hits"></td><td class="source">  literal: function() {</td></tr><tr><td class="line">274</td><td class="hits"></td><td class="source">    // HACK attack !!!</td></tr><tr class="hit"><td class="line">275</td><td class="hits">182127</td><td class="source">    var captures;</td></tr><tr class="hit"><td class="line">276</td><td class="hits">182127</td><td class="source">    if (captures = /^@css[ \t]*\{/.exec(this.str)) {</td></tr><tr class="hit"><td class="line">277</td><td class="hits">1</td><td class="source">      this.skip(captures);</td></tr><tr class="hit"><td class="line">278</td><td class="hits">1</td><td class="source">      var c</td></tr><tr><td class="line">279</td><td class="hits"></td><td class="source">        , braces = 1</td></tr><tr><td class="line">280</td><td class="hits"></td><td class="source">        , css = '';</td></tr><tr class="hit"><td class="line">281</td><td class="hits">1</td><td class="source">      while (c = this.str[0]) {</td></tr><tr class="hit"><td class="line">282</td><td class="hits">65</td><td class="source">        this.str = this.str.substr(1);</td></tr><tr class="hit"><td class="line">283</td><td class="hits">65</td><td class="source">        switch (c) {</td></tr><tr class="hit"><td class="line">284</td><td class="hits">4</td><td class="source">          case '{': ++braces; break;</td></tr><tr class="hit"><td class="line">285</td><td class="hits">6</td><td class="source">          case '}': --braces; break;</td></tr><tr><td class="line">286</td><td class="hits"></td><td class="source">        }</td></tr><tr class="hit"><td class="line">287</td><td class="hits">65</td><td class="source">        css += c;</td></tr><tr class="hit"><td class="line">288</td><td class="hits">66</td><td class="source">        if (!braces) break;</td></tr><tr><td class="line">289</td><td class="hits"></td><td class="source">      }</td></tr><tr class="hit"><td class="line">290</td><td class="hits">1</td><td class="source">      css = css.replace(/\s*}$/, '');</td></tr><tr class="hit"><td class="line">291</td><td class="hits">1</td><td class="source">      return new Token('literal', new nodes.Literal(css));</td></tr><tr><td class="line">292</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">293</td><td class="hits"></td><td class="source">  },</td></tr><tr><td class="line">294</td><td class="hits"></td><td class="source">  </td></tr><tr><td class="line">295</td><td class="hits"></td><td class="source">  /**</td></tr><tr><td class="line">296</td><td class="hits"></td><td class="source">   * '!important' ' '*</td></tr><tr><td class="line">297</td><td class="hits"></td><td class="source">   */</td></tr><tr><td class="line">298</td><td class="hits"></td><td class="source">  </td></tr><tr><td class="line">299</td><td class="hits"></td><td class="source">  important: function() {</td></tr><tr class="hit"><td class="line">300</td><td class="hits">182139</td><td class="source">    var captures;</td></tr><tr class="hit"><td class="line">301</td><td class="hits">182139</td><td class="source">    if (captures = /^!important[ \t]*/.exec(this.str)) {</td></tr><tr class="hit"><td class="line">302</td><td class="hits">12</td><td class="source">      this.skip(captures);</td></tr><tr class="hit"><td class="line">303</td><td class="hits">12</td><td class="source">      return new Token('ident', new nodes.Literal('!important'));</td></tr><tr><td class="line">304</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">305</td><td class="hits"></td><td class="source">  },</td></tr><tr><td class="line">306</td><td class="hits"></td><td class="source">  </td></tr><tr><td class="line">307</td><td class="hits"></td><td class="source">  /**</td></tr><tr><td class="line">308</td><td class="hits"></td><td class="source">   * '{' | '}'</td></tr><tr><td class="line">309</td><td class="hits"></td><td class="source">   */</td></tr><tr><td class="line">310</td><td class="hits"></td><td class="source">  </td></tr><tr><td class="line">311</td><td class="hits"></td><td class="source">  brace: function() {</td></tr><tr class="hit"><td class="line">312</td><td class="hits">159398</td><td class="source">    var captures;</td></tr><tr class="hit"><td class="line">313</td><td class="hits">159398</td><td class="source">    if (captures = /^([{}])/.exec(this.str)) {</td></tr><tr class="hit"><td class="line">314</td><td class="hits">6228</td><td class="source">      this.skip(1);</td></tr><tr class="hit"><td class="line">315</td><td class="hits">6228</td><td class="source">      var brace = captures[1];</td></tr><tr class="hit"><td class="line">316</td><td class="hits">6228</td><td class="source">      return new Token(brace, brace);</td></tr><tr><td class="line">317</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">318</td><td class="hits"></td><td class="source">  },</td></tr><tr><td class="line">319</td><td class="hits"></td><td class="source">  </td></tr><tr><td class="line">320</td><td class="hits"></td><td class="source">  /**</td></tr><tr><td class="line">321</td><td class="hits"></td><td class="source">   * '(' | ')' ' '*</td></tr><tr><td class="line">322</td><td class="hits"></td><td class="source">   */</td></tr><tr><td class="line">323</td><td class="hits"></td><td class="source">  </td></tr><tr><td class="line">324</td><td class="hits"></td><td class="source">  paren: function() {</td></tr><tr class="hit"><td class="line">325</td><td class="hits">153170</td><td class="source">    var captures;</td></tr><tr class="hit"><td class="line">326</td><td class="hits">153170</td><td class="source">    if (captures = /^([()])([ \t]*)/.exec(this.str)) {</td></tr><tr class="hit"><td class="line">327</td><td class="hits">28064</td><td class="source">      var paren = captures[1];</td></tr><tr class="hit"><td class="line">328</td><td class="hits">28064</td><td class="source">      this.skip(captures);</td></tr><tr class="hit"><td class="line">329</td><td class="hits">53460</td><td class="source">      if (')' == paren) this.isURL = false;</td></tr><tr class="hit"><td class="line">330</td><td class="hits">28064</td><td class="source">      var tok = new Token(paren, paren);</td></tr><tr class="hit"><td class="line">331</td><td class="hits">28064</td><td class="source">      tok.space = captures[2];</td></tr><tr class="hit"><td class="line">332</td><td class="hits">28064</td><td class="source">      return tok;</td></tr><tr><td class="line">333</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">334</td><td class="hits"></td><td class="source">  },</td></tr><tr><td class="line">335</td><td class="hits"></td><td class="source">  </td></tr><tr><td class="line">336</td><td class="hits"></td><td class="source">  /**</td></tr><tr><td class="line">337</td><td class="hits"></td><td class="source">   * 'null'</td></tr><tr><td class="line">338</td><td class="hits"></td><td class="source">   */</td></tr><tr><td class="line">339</td><td class="hits"></td><td class="source">  </td></tr><tr><td class="line">340</td><td class="hits"></td><td class="source">  null: function() {</td></tr><tr class="hit"><td class="line">341</td><td class="hits">239432</td><td class="source">    var captures;</td></tr><tr class="hit"><td class="line">342</td><td class="hits">239432</td><td class="source">    if (captures = /^(null)\b[ \t]*/.exec(this.str)) {</td></tr><tr class="hit"><td class="line">343</td><td class="hits">22</td><td class="source">      this.skip(captures);</td></tr><tr class="hit"><td class="line">344</td><td class="hits">22</td><td class="source">      return new Token('null', nodes.null);</td></tr><tr><td class="line">345</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">346</td><td class="hits"></td><td class="source">  },</td></tr><tr><td class="line">347</td><td class="hits"></td><td class="source">  </td></tr><tr><td class="line">348</td><td class="hits"></td><td class="source">  /**</td></tr><tr><td class="line">349</td><td class="hits"></td><td class="source">   *   'if'</td></tr><tr><td class="line">350</td><td class="hits"></td><td class="source">   * | 'else'</td></tr><tr><td class="line">351</td><td class="hits"></td><td class="source">   * | 'unless'</td></tr><tr><td class="line">352</td><td class="hits"></td><td class="source">   * | 'return'</td></tr><tr><td class="line">353</td><td class="hits"></td><td class="source">   * | 'for'</td></tr><tr><td class="line">354</td><td class="hits"></td><td class="source">   * | 'in'</td></tr><tr><td class="line">355</td><td class="hits"></td><td class="source">   */</td></tr><tr><td class="line">356</td><td class="hits"></td><td class="source">  </td></tr><tr><td class="line">357</td><td class="hits"></td><td class="source">  keyword: function() {</td></tr><tr class="hit"><td class="line">358</td><td class="hits">238145</td><td class="source">    var captures;</td></tr><tr class="hit"><td class="line">359</td><td class="hits">238145</td><td class="source">    if (captures = /^(return|if|else|unless|for|in)\b[ \t]*/.exec(this.str)) {</td></tr><tr class="hit"><td class="line">360</td><td class="hits">4252</td><td class="source">      var keyword = captures[1];</td></tr><tr class="hit"><td class="line">361</td><td class="hits">4252</td><td class="source">      this.skip(captures);</td></tr><tr class="hit"><td class="line">362</td><td class="hits">4252</td><td class="source">      return new Token(keyword, keyword);</td></tr><tr><td class="line">363</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">364</td><td class="hits"></td><td class="source">  },</td></tr><tr><td class="line">365</td><td class="hits"></td><td class="source">  </td></tr><tr><td class="line">366</td><td class="hits"></td><td class="source">  /**</td></tr><tr><td class="line">367</td><td class="hits"></td><td class="source">   *   'not'</td></tr><tr><td class="line">368</td><td class="hits"></td><td class="source">   * | 'and'</td></tr><tr><td class="line">369</td><td class="hits"></td><td class="source">   * | 'or'</td></tr><tr><td class="line">370</td><td class="hits"></td><td class="source">   * | 'is'</td></tr><tr><td class="line">371</td><td class="hits"></td><td class="source">   * | 'is not'</td></tr><tr><td class="line">372</td><td class="hits"></td><td class="source">   * | 'isnt'</td></tr><tr><td class="line">373</td><td class="hits"></td><td class="source">   * | 'is a'</td></tr><tr><td class="line">374</td><td class="hits"></td><td class="source">   * | 'is defined'</td></tr><tr><td class="line">375</td><td class="hits"></td><td class="source">   */</td></tr><tr><td class="line">376</td><td class="hits"></td><td class="source">  </td></tr><tr><td class="line">377</td><td class="hits"></td><td class="source">  namedop: function() {</td></tr><tr class="hit"><td class="line">378</td><td class="hits">108667</td><td class="source">    var captures;</td></tr><tr class="hit"><td class="line">379</td><td class="hits">108667</td><td class="source">    if (captures = /^(not|and|or|is a|is defined|isnt|is not|is)(?!-)\b([ \t]*)/.exec(this.str)) {</td></tr><tr class="hit"><td class="line">380</td><td class="hits">1141</td><td class="source">      var op = captures[1];</td></tr><tr class="hit"><td class="line">381</td><td class="hits">1141</td><td class="source">      this.skip(captures);</td></tr><tr class="hit"><td class="line">382</td><td class="hits">1141</td><td class="source">      op = alias[op] || op;</td></tr><tr class="hit"><td class="line">383</td><td class="hits">1141</td><td class="source">      var tok = new Token(op, op);</td></tr><tr class="hit"><td class="line">384</td><td class="hits">1141</td><td class="source">      tok.space = captures[2];</td></tr><tr class="hit"><td class="line">385</td><td class="hits">1141</td><td class="source">      return tok;</td></tr><tr><td class="line">386</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">387</td><td class="hits"></td><td class="source">  },</td></tr><tr><td class="line">388</td><td class="hits"></td><td class="source">  </td></tr><tr><td class="line">389</td><td class="hits"></td><td class="source">  /**</td></tr><tr><td class="line">390</td><td class="hits"></td><td class="source">   *   ','</td></tr><tr><td class="line">391</td><td class="hits"></td><td class="source">   * | '+'</td></tr><tr><td class="line">392</td><td class="hits"></td><td class="source">   * | '+='</td></tr><tr><td class="line">393</td><td class="hits"></td><td class="source">   * | '-'</td></tr><tr><td class="line">394</td><td class="hits"></td><td class="source">   * | '-='</td></tr><tr><td class="line">395</td><td class="hits"></td><td class="source">   * | '*'</td></tr><tr><td class="line">396</td><td class="hits"></td><td class="source">   * | '*='</td></tr><tr><td class="line">397</td><td class="hits"></td><td class="source">   * | '/'</td></tr><tr><td class="line">398</td><td class="hits"></td><td class="source">   * | '/='</td></tr><tr><td class="line">399</td><td class="hits"></td><td class="source">   * | '%'</td></tr><tr><td class="line">400</td><td class="hits"></td><td class="source">   * | '%='</td></tr><tr><td class="line">401</td><td class="hits"></td><td class="source">   * | '**'</td></tr><tr><td class="line">402</td><td class="hits"></td><td class="source">   * | '!'</td></tr><tr><td class="line">403</td><td class="hits"></td><td class="source">   * | '&amp;'</td></tr><tr><td class="line">404</td><td class="hits"></td><td class="source">   * | '&amp;&amp;'</td></tr><tr><td class="line">405</td><td class="hits"></td><td class="source">   * | '||'</td></tr><tr><td class="line">406</td><td class="hits"></td><td class="source">   * | '&gt;'</td></tr><tr><td class="line">407</td><td class="hits"></td><td class="source">   * | '&gt;='</td></tr><tr><td class="line">408</td><td class="hits"></td><td class="source">   * | '&lt;'</td></tr><tr><td class="line">409</td><td class="hits"></td><td class="source">   * | '&lt;='</td></tr><tr><td class="line">410</td><td class="hits"></td><td class="source">   * | '='</td></tr><tr><td class="line">411</td><td class="hits"></td><td class="source">   * | '=='</td></tr><tr><td class="line">412</td><td class="hits"></td><td class="source">   * | '!='</td></tr><tr><td class="line">413</td><td class="hits"></td><td class="source">   * | '!'</td></tr><tr><td class="line">414</td><td class="hits"></td><td class="source">   * | '~'</td></tr><tr><td class="line">415</td><td class="hits"></td><td class="source">   * | '?='</td></tr><tr><td class="line">416</td><td class="hits"></td><td class="source">   * | ':='</td></tr><tr><td class="line">417</td><td class="hits"></td><td class="source">   * | '?'</td></tr><tr><td class="line">418</td><td class="hits"></td><td class="source">   * | ':'</td></tr><tr><td class="line">419</td><td class="hits"></td><td class="source">   * | '['</td></tr><tr><td class="line">420</td><td class="hits"></td><td class="source">   * | ']'</td></tr><tr><td class="line">421</td><td class="hits"></td><td class="source">   * | '..'</td></tr><tr><td class="line">422</td><td class="hits"></td><td class="source">   * | '...'</td></tr><tr><td class="line">423</td><td class="hits"></td><td class="source">   */</td></tr><tr><td class="line">424</td><td class="hits"></td><td class="source">  </td></tr><tr><td class="line">425</td><td class="hits"></td><td class="source">  op: function() {</td></tr><tr class="hit"><td class="line">426</td><td class="hits">56317</td><td class="source">    var captures;</td></tr><tr class="hit"><td class="line">427</td><td class="hits">56317</td><td class="source">    if (captures = /^([.]{2,3}|&amp;&amp;|\|\||[!&lt;&gt;=?:]=|\*\*|[-+*\/%]=?|[,=?:!~&lt;&gt;&amp;\[\]])([ \t]*)/.exec(this.str)) {</td></tr><tr class="hit"><td class="line">428</td><td class="hits">37258</td><td class="source">      var op = captures[1];</td></tr><tr class="hit"><td class="line">429</td><td class="hits">37258</td><td class="source">      this.skip(captures);</td></tr><tr class="hit"><td class="line">430</td><td class="hits">37258</td><td class="source">      op = alias[op] || op;</td></tr><tr class="hit"><td class="line">431</td><td class="hits">37258</td><td class="source">      var tok = new Token(op, op);</td></tr><tr class="hit"><td class="line">432</td><td class="hits">37258</td><td class="source">      tok.space = captures[2];</td></tr><tr class="hit"><td class="line">433</td><td class="hits">37258</td><td class="source">      return tok;</td></tr><tr><td class="line">434</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">435</td><td class="hits"></td><td class="source">  },</td></tr><tr><td class="line">436</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">437</td><td class="hits"></td><td class="source">  /**</td></tr><tr><td class="line">438</td><td class="hits"></td><td class="source">   * '@extends' ([^{\n]+)</td></tr><tr><td class="line">439</td><td class="hits"></td><td class="source">   */</td></tr><tr><td class="line">440</td><td class="hits"></td><td class="source">  </td></tr><tr><td class="line">441</td><td class="hits"></td><td class="source">  extends: function() {</td></tr><tr class="hit"><td class="line">442</td><td class="hits">233821</td><td class="source">    var captures;</td></tr><tr class="hit"><td class="line">443</td><td class="hits">233821</td><td class="source">    if (captures = /^@extends?[ \t]*([^\/{\n;]+)/.exec(this.str)) {</td></tr><tr class="hit"><td class="line">444</td><td class="hits">13</td><td class="source">      this.skip(captures);</td></tr><tr class="hit"><td class="line">445</td><td class="hits">13</td><td class="source">      return new Token('extend', captures[1].trim());</td></tr><tr><td class="line">446</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">447</td><td class="hits"></td><td class="source">  },</td></tr><tr><td class="line">448</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">449</td><td class="hits"></td><td class="source">  /**</td></tr><tr><td class="line">450</td><td class="hits"></td><td class="source">   * '@media' ([^{\n]+)</td></tr><tr><td class="line">451</td><td class="hits"></td><td class="source">   */</td></tr><tr><td class="line">452</td><td class="hits"></td><td class="source">  </td></tr><tr><td class="line">453</td><td class="hits"></td><td class="source">  media: function() {</td></tr><tr class="hit"><td class="line">454</td><td class="hits">233808</td><td class="source">    var captures;</td></tr><tr class="hit"><td class="line">455</td><td class="hits">233808</td><td class="source">    if (captures = /^@media[ \t]*([^\/{\n]+)/.exec(this.str)) {</td></tr><tr class="hit"><td class="line">456</td><td class="hits">20</td><td class="source">      this.skip(captures);</td></tr><tr class="hit"><td class="line">457</td><td class="hits">20</td><td class="source">      return new Token('media', captures[1].trim());</td></tr><tr><td class="line">458</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">459</td><td class="hits"></td><td class="source">  },</td></tr><tr><td class="line">460</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">461</td><td class="hits"></td><td class="source">  /**</td></tr><tr><td class="line">462</td><td class="hits"></td><td class="source">   * '@scope' ([^{\n]+)</td></tr><tr><td class="line">463</td><td class="hits"></td><td class="source">   */</td></tr><tr><td class="line">464</td><td class="hits"></td><td class="source">  </td></tr><tr><td class="line">465</td><td class="hits"></td><td class="source">  scope: function() {</td></tr><tr class="hit"><td class="line">466</td><td class="hits">233823</td><td class="source">    var captures;</td></tr><tr class="hit"><td class="line">467</td><td class="hits">233823</td><td class="source">    if (captures = /^@scope[ \t]*([^\/{\n]+)/.exec(this.str)) {</td></tr><tr class="hit"><td class="line">468</td><td class="hits">2</td><td class="source">      this.skip(captures);</td></tr><tr class="hit"><td class="line">469</td><td class="hits">2</td><td class="source">      return new Token('scope', captures[1].trim());</td></tr><tr><td class="line">470</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">471</td><td class="hits"></td><td class="source">  },</td></tr><tr><td class="line">472</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">473</td><td class="hits"></td><td class="source">  /**</td></tr><tr><td class="line">474</td><td class="hits"></td><td class="source">   * '@' ('import' | 'keyframes' | 'charset' | 'page' | 'font-face')</td></tr><tr><td class="line">475</td><td class="hits"></td><td class="source">   */</td></tr><tr><td class="line">476</td><td class="hits"></td><td class="source">  </td></tr><tr><td class="line">477</td><td class="hits"></td><td class="source">  atrule: function() {</td></tr><tr class="hit"><td class="line">478</td><td class="hits">233871</td><td class="source">    var captures;</td></tr><tr class="hit"><td class="line">479</td><td class="hits">233871</td><td class="source">    if (captures = /^@(import|(?:-(\w+)-)?keyframes|charset|font-face|page)[ \t]*/.exec(this.str)) {</td></tr><tr class="hit"><td class="line">480</td><td class="hits">48</td><td class="source">      this.skip(captures);</td></tr><tr class="hit"><td class="line">481</td><td class="hits">48</td><td class="source">      var vendor = captures[2]</td></tr><tr><td class="line">482</td><td class="hits"></td><td class="source">        , type = captures[1];</td></tr><tr class="hit"><td class="line">483</td><td class="hits">50</td><td class="source">      if (vendor) type = 'keyframes';</td></tr><tr class="hit"><td class="line">484</td><td class="hits">48</td><td class="source">      return new Token(type, vendor);</td></tr><tr><td class="line">485</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">486</td><td class="hits"></td><td class="source">  },</td></tr><tr><td class="line">487</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">488</td><td class="hits"></td><td class="source">  /**</td></tr><tr><td class="line">489</td><td class="hits"></td><td class="source">   * '//' *</td></tr><tr><td class="line">490</td><td class="hits"></td><td class="source">   */</td></tr><tr><td class="line">491</td><td class="hits"></td><td class="source">  </td></tr><tr><td class="line">492</td><td class="hits"></td><td class="source">  comment: function() {</td></tr><tr><td class="line">493</td><td class="hits"></td><td class="source">    // Single line</td></tr><tr class="hit"><td class="line">494</td><td class="hits">233788</td><td class="source">    if ('/' == this.str[0] &amp;&amp; '/' == this.str[1]) {</td></tr><tr class="hit"><td class="line">495</td><td class="hits">5712</td><td class="source">      var end = this.str.indexOf('\n');</td></tr><tr class="hit"><td class="line">496</td><td class="hits">5714</td><td class="source">      if (-1 == end) end = this.str.length;</td></tr><tr class="hit"><td class="line">497</td><td class="hits">5712</td><td class="source">      this.skip(end);</td></tr><tr class="hit"><td class="line">498</td><td class="hits">5712</td><td class="source">      return this.advance();</td></tr><tr><td class="line">499</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">500</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">501</td><td class="hits"></td><td class="source">    // Multi-line</td></tr><tr class="hit"><td class="line">502</td><td class="hits">228076</td><td class="source">    if ('/' == this.str[0] &amp;&amp; '*' == this.str[1]) {</td></tr><tr class="hit"><td class="line">503</td><td class="hits">63</td><td class="source">      var end = this.str.indexOf('*/');</td></tr><tr class="hit"><td class="line">504</td><td class="hits">63</td><td class="source">      if (-1 == end) end = this.str.length;</td></tr><tr class="hit"><td class="line">505</td><td class="hits">63</td><td class="source">      var str = this.str.substr(0, end + 2)</td></tr><tr><td class="line">506</td><td class="hits"></td><td class="source">        , lines = str.split('\n').length - 1</td></tr><tr><td class="line">507</td><td class="hits"></td><td class="source">        , suppress = true;</td></tr><tr class="hit"><td class="line">508</td><td class="hits">63</td><td class="source">      this.lineno += lines;</td></tr><tr class="hit"><td class="line">509</td><td class="hits">63</td><td class="source">      this.skip(end + 2);</td></tr><tr><td class="line">510</td><td class="hits"></td><td class="source">      // output</td></tr><tr class="hit"><td class="line">511</td><td class="hits">63</td><td class="source">      if ('!' == str[2]) {</td></tr><tr class="hit"><td class="line">512</td><td class="hits">1</td><td class="source">        str = str.replace('*!', '*');</td></tr><tr class="hit"><td class="line">513</td><td class="hits">1</td><td class="source">        suppress = false;</td></tr><tr><td class="line">514</td><td class="hits"></td><td class="source">      }</td></tr><tr class="hit"><td class="line">515</td><td class="hits">63</td><td class="source">      return new Token('comment', new nodes.Comment(str, suppress));</td></tr><tr><td class="line">516</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">517</td><td class="hits"></td><td class="source">  },</td></tr><tr><td class="line">518</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">519</td><td class="hits"></td><td class="source">  /**</td></tr><tr><td class="line">520</td><td class="hits"></td><td class="source">   * 'true' | 'false'</td></tr><tr><td class="line">521</td><td class="hits"></td><td class="source">   */</td></tr><tr><td class="line">522</td><td class="hits"></td><td class="source">  </td></tr><tr><td class="line">523</td><td class="hits"></td><td class="source">  boolean: function() {</td></tr><tr class="hit"><td class="line">524</td><td class="hits">107526</td><td class="source">    var captures;</td></tr><tr class="hit"><td class="line">525</td><td class="hits">107526</td><td class="source">    if (captures = /^(true|false)\b([ \t]*)/.exec(this.str)) {</td></tr><tr class="hit"><td class="line">526</td><td class="hits">122</td><td class="source">      var val = nodes.Boolean('true' == captures[1]);</td></tr><tr class="hit"><td class="line">527</td><td class="hits">122</td><td class="source">      this.skip(captures);</td></tr><tr class="hit"><td class="line">528</td><td class="hits">122</td><td class="source">      var tok = new Token('boolean', val);</td></tr><tr class="hit"><td class="line">529</td><td class="hits">122</td><td class="source">      tok.space = captures[2];</td></tr><tr class="hit"><td class="line">530</td><td class="hits">122</td><td class="source">      return tok;</td></tr><tr><td class="line">531</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">532</td><td class="hits"></td><td class="source">  },</td></tr><tr><td class="line">533</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">534</td><td class="hits"></td><td class="source">  /**</td></tr><tr><td class="line">535</td><td class="hits"></td><td class="source">   * -*[_a-zA-Z$] [-\w\d$]* '('</td></tr><tr><td class="line">536</td><td class="hits"></td><td class="source">   */</td></tr><tr><td class="line">537</td><td class="hits"></td><td class="source">  </td></tr><tr><td class="line">538</td><td class="hits"></td><td class="source">  function: function() {</td></tr><tr class="hit"><td class="line">539</td><td class="hits">182126</td><td class="source">    var captures;</td></tr><tr class="hit"><td class="line">540</td><td class="hits">182126</td><td class="source">    if (captures = /^(-*[_a-zA-Z$][-\w\d$]*)\(([ \t]*)/.exec(this.str)) {</td></tr><tr class="hit"><td class="line">541</td><td class="hits">22728</td><td class="source">      var name = captures[1];</td></tr><tr class="hit"><td class="line">542</td><td class="hits">22728</td><td class="source">      this.skip(captures);</td></tr><tr class="hit"><td class="line">543</td><td class="hits">22728</td><td class="source">      this.isURL = 'url' == name;</td></tr><tr class="hit"><td class="line">544</td><td class="hits">22728</td><td class="source">      var tok = new Token('function', new nodes.Ident(name));</td></tr><tr class="hit"><td class="line">545</td><td class="hits">22728</td><td class="source">      tok.space = captures[2];</td></tr><tr class="hit"><td class="line">546</td><td class="hits">22728</td><td class="source">      return tok;</td></tr><tr><td class="line">547</td><td class="hits"></td><td class="source">    } </td></tr><tr><td class="line">548</td><td class="hits"></td><td class="source">  },</td></tr><tr><td class="line">549</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">550</td><td class="hits"></td><td class="source">  /**</td></tr><tr><td class="line">551</td><td class="hits"></td><td class="source">   * -*[_a-zA-Z$] [-\w\d$]*</td></tr><tr><td class="line">552</td><td class="hits"></td><td class="source">   */</td></tr><tr><td class="line">553</td><td class="hits"></td><td class="source">  </td></tr><tr><td class="line">554</td><td class="hits"></td><td class="source">  ident: function() {</td></tr><tr class="hit"><td class="line">555</td><td class="hits">107404</td><td class="source">    var captures;</td></tr><tr class="hit"><td class="line">556</td><td class="hits">107404</td><td class="source">    if (captures = /^(@)?(-*[_a-zA-Z$][-\w\d$]*)/.exec(this.str)) {</td></tr><tr class="hit"><td class="line">557</td><td class="hits">51087</td><td class="source">      var at = captures[1]</td></tr><tr><td class="line">558</td><td class="hits"></td><td class="source">        , name = captures[2]</td></tr><tr><td class="line">559</td><td class="hits"></td><td class="source">        , id = new nodes.Ident(name);</td></tr><tr class="hit"><td class="line">560</td><td class="hits">51087</td><td class="source">      this.skip(captures);</td></tr><tr class="hit"><td class="line">561</td><td class="hits">51087</td><td class="source">      id.property = !! at;</td></tr><tr class="hit"><td class="line">562</td><td class="hits">51087</td><td class="source">      return new Token('ident', id);</td></tr><tr><td class="line">563</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">564</td><td class="hits"></td><td class="source">  },</td></tr><tr><td class="line">565</td><td class="hits"></td><td class="source">  </td></tr><tr><td class="line">566</td><td class="hits"></td><td class="source">  /**</td></tr><tr><td class="line">567</td><td class="hits"></td><td class="source">   * '\n' ' '+</td></tr><tr><td class="line">568</td><td class="hits"></td><td class="source">   */</td></tr><tr><td class="line">569</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">570</td><td class="hits"></td><td class="source">  newline: function() {</td></tr><tr class="hit"><td class="line">571</td><td class="hits">228013</td><td class="source">    var captures, re;</td></tr><tr><td class="line">572</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">573</td><td class="hits"></td><td class="source">    // we have established the indentation regexp</td></tr><tr class="hit"><td class="line">574</td><td class="hits">228013</td><td class="source">    if (this.indentRe){</td></tr><tr class="hit"><td class="line">575</td><td class="hits">218785</td><td class="source">      captures = this.indentRe.exec(this.str);</td></tr><tr><td class="line">576</td><td class="hits"></td><td class="source">    // figure out if we are using tabs or spaces</td></tr><tr><td class="line">577</td><td class="hits"></td><td class="source">    } else {</td></tr><tr><td class="line">578</td><td class="hits"></td><td class="source">      // try tabs</td></tr><tr class="hit"><td class="line">579</td><td class="hits">9228</td><td class="source">      re = /^\n([\t]*)[ \t]*/;</td></tr><tr class="hit"><td class="line">580</td><td class="hits">9228</td><td class="source">      captures = re.exec(this.str);</td></tr><tr><td class="line">581</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">582</td><td class="hits"></td><td class="source">      // nope, try spaces</td></tr><tr class="hit"><td class="line">583</td><td class="hits">9228</td><td class="source">      if (captures &amp;&amp; !captures[1].length) {</td></tr><tr class="hit"><td class="line">584</td><td class="hits">1795</td><td class="source">        re = /^\n([ \t]*)/;</td></tr><tr class="hit"><td class="line">585</td><td class="hits">1795</td><td class="source">        captures = re.exec(this.str);</td></tr><tr><td class="line">586</td><td class="hits"></td><td class="source">      }</td></tr><tr><td class="line">587</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">588</td><td class="hits"></td><td class="source">      // established</td></tr><tr class="hit"><td class="line">589</td><td class="hits">9647</td><td class="source">      if (captures &amp;&amp; captures[1].length) this.indentRe = re;</td></tr><tr><td class="line">590</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">591</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">592</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">593</td><td class="hits">228013</td><td class="source">    if (captures) {</td></tr><tr class="hit"><td class="line">594</td><td class="hits">45872</td><td class="source">      var tok</td></tr><tr><td class="line">595</td><td class="hits"></td><td class="source">        , indents = captures[1].length;</td></tr><tr><td class="line">596</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">597</td><td class="hits">45872</td><td class="source">      this.skip(captures);</td></tr><tr class="hit"><td class="line">598</td><td class="hits">45872</td><td class="source">      if (this.str[0] === ' ' || this.str[0] === '\t') {</td></tr><tr class="miss"><td class="line">599</td><td class="hits">0</td><td class="source">        throw new errors.SyntaxError('Invalid indentation. You can use tabs or spaces to indent, but not both.');</td></tr><tr><td class="line">600</td><td class="hits"></td><td class="source">      }</td></tr><tr><td class="line">601</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">602</td><td class="hits"></td><td class="source">      // Reset state</td></tr><tr class="hit"><td class="line">603</td><td class="hits">45872</td><td class="source">      this.isVariable = false;</td></tr><tr><td class="line">604</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">605</td><td class="hits"></td><td class="source">      // Blank line</td></tr><tr class="hit"><td class="line">606</td><td class="hits">45872</td><td class="source">      if ('\n' == this.str[0]) {</td></tr><tr class="hit"><td class="line">607</td><td class="hits">14158</td><td class="source">        ++this.lineno;</td></tr><tr class="hit"><td class="line">608</td><td class="hits">14158</td><td class="source">        return this.advance();</td></tr><tr><td class="line">609</td><td class="hits"></td><td class="source">      }</td></tr><tr><td class="line">610</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">611</td><td class="hits"></td><td class="source">      // Outdent</td></tr><tr class="hit"><td class="line">612</td><td class="hits">31714</td><td class="source">      if (this.indentStack.length &amp;&amp; indents &lt; this.indentStack[0]) {</td></tr><tr class="hit"><td class="line">613</td><td class="hits">7273</td><td class="source">        while (this.indentStack.length &amp;&amp; this.indentStack[0] &gt; indents) {</td></tr><tr class="hit"><td class="line">614</td><td class="hits">8269</td><td class="source">          this.stash.push(new Token('outdent'));</td></tr><tr class="hit"><td class="line">615</td><td class="hits">8269</td><td class="source">          this.indentStack.shift();</td></tr><tr><td class="line">616</td><td class="hits"></td><td class="source">        }</td></tr><tr class="hit"><td class="line">617</td><td class="hits">7273</td><td class="source">        tok = this.stash.pop();</td></tr><tr><td class="line">618</td><td class="hits"></td><td class="source">      // Indent</td></tr><tr class="hit"><td class="line">619</td><td class="hits">24441</td><td class="source">      } else if (indents &amp;&amp; indents != this.indentStack[0]) {</td></tr><tr class="hit"><td class="line">620</td><td class="hits">8422</td><td class="source">        this.indentStack.unshift(indents);</td></tr><tr class="hit"><td class="line">621</td><td class="hits">8422</td><td class="source">        tok = new Token('indent');</td></tr><tr><td class="line">622</td><td class="hits"></td><td class="source">      // Newline</td></tr><tr><td class="line">623</td><td class="hits"></td><td class="source">      } else {</td></tr><tr class="hit"><td class="line">624</td><td class="hits">16019</td><td class="source">        tok = new Token('newline');</td></tr><tr><td class="line">625</td><td class="hits"></td><td class="source">      }</td></tr><tr><td class="line">626</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">627</td><td class="hits">31714</td><td class="source">      return tok;</td></tr><tr><td class="line">628</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">629</td><td class="hits"></td><td class="source">  },</td></tr><tr><td class="line">630</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">631</td><td class="hits"></td><td class="source">  /**</td></tr><tr><td class="line">632</td><td class="hits"></td><td class="source">   * '-'? (digit+ | digit* '.' digit+) unit</td></tr><tr><td class="line">633</td><td class="hits"></td><td class="source">   */</td></tr><tr><td class="line">634</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">635</td><td class="hits"></td><td class="source">  unit: function() {</td></tr><tr class="hit"><td class="line">636</td><td class="hits">119146</td><td class="source">    var captures;</td></tr><tr class="hit"><td class="line">637</td><td class="hits">119146</td><td class="source">    if (captures = unit.exec(this.str)) {</td></tr><tr class="hit"><td class="line">638</td><td class="hits">10479</td><td class="source">      this.skip(captures);</td></tr><tr class="hit"><td class="line">639</td><td class="hits">10479</td><td class="source">      var n = parseFloat(captures[2]);</td></tr><tr class="hit"><td class="line">640</td><td class="hits">10812</td><td class="source">      if ('-' == captures[1]) n = -n;</td></tr><tr class="hit"><td class="line">641</td><td class="hits">10479</td><td class="source">      var node = new nodes.Unit(n, captures[3]);</td></tr><tr class="hit"><td class="line">642</td><td class="hits">10479</td><td class="source">      return new Token('unit', node);</td></tr><tr><td class="line">643</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">644</td><td class="hits"></td><td class="source">  },</td></tr><tr><td class="line">645</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">646</td><td class="hits"></td><td class="source">  /**</td></tr><tr><td class="line">647</td><td class="hits"></td><td class="source">   * '&quot;' [^&quot;]+ '&quot;' | &quot;'&quot;&quot; [^']+ &quot;'&quot;</td></tr><tr><td class="line">648</td><td class="hits"></td><td class="source">   */</td></tr><tr><td class="line">649</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">650</td><td class="hits"></td><td class="source">  string: function() {</td></tr><tr class="hit"><td class="line">651</td><td class="hits">124885</td><td class="source">    var captures;</td></tr><tr class="hit"><td class="line">652</td><td class="hits">124885</td><td class="source">    if (captures = /^(&quot;[^&quot;]*&quot;|'[^']*')[ \t]*/.exec(this.str)) {</td></tr><tr class="hit"><td class="line">653</td><td class="hits">5739</td><td class="source">      var str = captures[1]</td></tr><tr><td class="line">654</td><td class="hits"></td><td class="source">        , quote = captures[0][0];</td></tr><tr class="hit"><td class="line">655</td><td class="hits">5739</td><td class="source">      this.skip(captures);</td></tr><tr class="hit"><td class="line">656</td><td class="hits">5739</td><td class="source">      str = str.slice(1,-1).replace(/\\n/g, '\n');</td></tr><tr class="hit"><td class="line">657</td><td class="hits">5739</td><td class="source">      return new Token('string', new nodes.String(str, quote));</td></tr><tr><td class="line">658</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">659</td><td class="hits"></td><td class="source">  },</td></tr><tr><td class="line">660</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">661</td><td class="hits"></td><td class="source">  /**</td></tr><tr><td class="line">662</td><td class="hits"></td><td class="source">   * #rrggbbaa | #rrggbb | #rgba | #rgb | #nn | #n</td></tr><tr><td class="line">663</td><td class="hits"></td><td class="source">   */</td></tr><tr><td class="line">664</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">665</td><td class="hits"></td><td class="source">  color: function() {</td></tr><tr class="hit"><td class="line">666</td><td class="hits">125106</td><td class="source">    return this.rrggbbaa()</td></tr><tr><td class="line">667</td><td class="hits"></td><td class="source">      || this.rrggbb()</td></tr><tr><td class="line">668</td><td class="hits"></td><td class="source">      || this.rgba()</td></tr><tr><td class="line">669</td><td class="hits"></td><td class="source">      || this.rgb()</td></tr><tr><td class="line">670</td><td class="hits"></td><td class="source">      || this.nn()</td></tr><tr><td class="line">671</td><td class="hits"></td><td class="source">      || this.n()</td></tr><tr><td class="line">672</td><td class="hits"></td><td class="source">  },</td></tr><tr><td class="line">673</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">674</td><td class="hits"></td><td class="source">  /**</td></tr><tr><td class="line">675</td><td class="hits"></td><td class="source">   * #n</td></tr><tr><td class="line">676</td><td class="hits"></td><td class="source">   */</td></tr><tr><td class="line">677</td><td class="hits"></td><td class="source">  </td></tr><tr><td class="line">678</td><td class="hits"></td><td class="source">  n: function() {</td></tr><tr class="hit"><td class="line">679</td><td class="hits">124900</td><td class="source">    var captures;</td></tr><tr class="hit"><td class="line">680</td><td class="hits">124900</td><td class="source">    if (captures = /^#([a-fA-F0-9]{1})[ \t]*/.exec(this.str)) {</td></tr><tr class="hit"><td class="line">681</td><td class="hits">15</td><td class="source">      this.skip(captures);</td></tr><tr class="hit"><td class="line">682</td><td class="hits">15</td><td class="source">      var n = parseInt(captures[1] + captures[1], 16)</td></tr><tr><td class="line">683</td><td class="hits"></td><td class="source">        , color = new nodes.RGBA(n, n, n, 1);</td></tr><tr class="hit"><td class="line">684</td><td class="hits">15</td><td class="source">      color.raw = captures[0];</td></tr><tr class="hit"><td class="line">685</td><td class="hits">15</td><td class="source">      return new Token('color', color); </td></tr><tr><td class="line">686</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">687</td><td class="hits"></td><td class="source">  },</td></tr><tr><td class="line">688</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">689</td><td class="hits"></td><td class="source">  /**</td></tr><tr><td class="line">690</td><td class="hits"></td><td class="source">   * #nn</td></tr><tr><td class="line">691</td><td class="hits"></td><td class="source">   */</td></tr><tr><td class="line">692</td><td class="hits"></td><td class="source">  </td></tr><tr><td class="line">693</td><td class="hits"></td><td class="source">  nn: function() {</td></tr><tr class="hit"><td class="line">694</td><td class="hits">124905</td><td class="source">    var captures;</td></tr><tr class="hit"><td class="line">695</td><td class="hits">124905</td><td class="source">    if (captures = /^#([a-fA-F0-9]{2})[ \t]*/.exec(this.str)) {</td></tr><tr class="hit"><td class="line">696</td><td class="hits">5</td><td class="source">      this.skip(captures);</td></tr><tr class="hit"><td class="line">697</td><td class="hits">5</td><td class="source">      var n = parseInt(captures[1], 16)</td></tr><tr><td class="line">698</td><td class="hits"></td><td class="source">        , color = new nodes.RGBA(n, n, n, 1);</td></tr><tr class="hit"><td class="line">699</td><td class="hits">5</td><td class="source">      color.raw = captures[0];</td></tr><tr class="hit"><td class="line">700</td><td class="hits">5</td><td class="source">      return new Token('color', color); </td></tr><tr><td class="line">701</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">702</td><td class="hits"></td><td class="source">  },</td></tr><tr><td class="line">703</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">704</td><td class="hits"></td><td class="source">  /**</td></tr><tr><td class="line">705</td><td class="hits"></td><td class="source">   * #rgb</td></tr><tr><td class="line">706</td><td class="hits"></td><td class="source">   */</td></tr><tr><td class="line">707</td><td class="hits"></td><td class="source">  </td></tr><tr><td class="line">708</td><td class="hits"></td><td class="source">  rgb: function() {</td></tr><tr class="hit"><td class="line">709</td><td class="hits">125045</td><td class="source">    var captures;</td></tr><tr class="hit"><td class="line">710</td><td class="hits">125045</td><td class="source">    if (captures = /^#([a-fA-F0-9]{3})[ \t]*/.exec(this.str)) {</td></tr><tr class="hit"><td class="line">711</td><td class="hits">140</td><td class="source">      this.skip(captures);</td></tr><tr class="hit"><td class="line">712</td><td class="hits">140</td><td class="source">      var rgb = captures[1]</td></tr><tr><td class="line">713</td><td class="hits"></td><td class="source">        , r = parseInt(rgb[0] + rgb[0], 16)</td></tr><tr><td class="line">714</td><td class="hits"></td><td class="source">        , g = parseInt(rgb[1] + rgb[1], 16)</td></tr><tr><td class="line">715</td><td class="hits"></td><td class="source">        , b = parseInt(rgb[2] + rgb[2], 16)</td></tr><tr><td class="line">716</td><td class="hits"></td><td class="source">        , color = new nodes.RGBA(r, g, b, 1);</td></tr><tr class="hit"><td class="line">717</td><td class="hits">140</td><td class="source">      color.raw = captures[0];</td></tr><tr class="hit"><td class="line">718</td><td class="hits">140</td><td class="source">      return new Token('color', color); </td></tr><tr><td class="line">719</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">720</td><td class="hits"></td><td class="source">  },</td></tr><tr><td class="line">721</td><td class="hits"></td><td class="source">  </td></tr><tr><td class="line">722</td><td class="hits"></td><td class="source">  /**</td></tr><tr><td class="line">723</td><td class="hits"></td><td class="source">   * #rgba</td></tr><tr><td class="line">724</td><td class="hits"></td><td class="source">   */</td></tr><tr><td class="line">725</td><td class="hits"></td><td class="source">  </td></tr><tr><td class="line">726</td><td class="hits"></td><td class="source">  rgba: function() {</td></tr><tr class="hit"><td class="line">727</td><td class="hits">125046</td><td class="source">    var captures;</td></tr><tr class="hit"><td class="line">728</td><td class="hits">125046</td><td class="source">    if (captures = /^#([a-fA-F0-9]{4})[ \t]*/.exec(this.str)) {</td></tr><tr class="hit"><td class="line">729</td><td class="hits">1</td><td class="source">      this.skip(captures);</td></tr><tr class="hit"><td class="line">730</td><td class="hits">1</td><td class="source">      var rgb = captures[1]</td></tr><tr><td class="line">731</td><td class="hits"></td><td class="source">        , r = parseInt(rgb[0] + rgb[0], 16)</td></tr><tr><td class="line">732</td><td class="hits"></td><td class="source">        , g = parseInt(rgb[1] + rgb[1], 16)</td></tr><tr><td class="line">733</td><td class="hits"></td><td class="source">        , b = parseInt(rgb[2] + rgb[2], 16)</td></tr><tr><td class="line">734</td><td class="hits"></td><td class="source">        , a = parseInt(rgb[3] + rgb[3], 16)</td></tr><tr><td class="line">735</td><td class="hits"></td><td class="source">        , color = new nodes.RGBA(r, g, b, a/255);</td></tr><tr class="hit"><td class="line">736</td><td class="hits">1</td><td class="source">      color.raw = captures[0];</td></tr><tr class="hit"><td class="line">737</td><td class="hits">1</td><td class="source">      return new Token('color', color); </td></tr><tr><td class="line">738</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">739</td><td class="hits"></td><td class="source">  },</td></tr><tr><td class="line">740</td><td class="hits"></td><td class="source">  </td></tr><tr><td class="line">741</td><td class="hits"></td><td class="source">  /**</td></tr><tr><td class="line">742</td><td class="hits"></td><td class="source">   * #rrggbb</td></tr><tr><td class="line">743</td><td class="hits"></td><td class="source">   */</td></tr><tr><td class="line">744</td><td class="hits"></td><td class="source">  </td></tr><tr><td class="line">745</td><td class="hits"></td><td class="source">  rrggbb: function() {</td></tr><tr class="hit"><td class="line">746</td><td class="hits">125105</td><td class="source">    var captures;</td></tr><tr class="hit"><td class="line">747</td><td class="hits">125105</td><td class="source">    if (captures = /^#([a-fA-F0-9]{6})[ \t]*/.exec(this.str)) {</td></tr><tr class="hit"><td class="line">748</td><td class="hits">59</td><td class="source">      this.skip(captures);</td></tr><tr class="hit"><td class="line">749</td><td class="hits">59</td><td class="source">      var rgb = captures[1]</td></tr><tr><td class="line">750</td><td class="hits"></td><td class="source">        , r = parseInt(rgb.substr(0, 2), 16)</td></tr><tr><td class="line">751</td><td class="hits"></td><td class="source">        , g = parseInt(rgb.substr(2, 2), 16)</td></tr><tr><td class="line">752</td><td class="hits"></td><td class="source">        , b = parseInt(rgb.substr(4, 2), 16)</td></tr><tr><td class="line">753</td><td class="hits"></td><td class="source">        , color = new nodes.RGBA(r, g, b, 1);</td></tr><tr class="hit"><td class="line">754</td><td class="hits">59</td><td class="source">      color.raw = captures[0];</td></tr><tr class="hit"><td class="line">755</td><td class="hits">59</td><td class="source">      return new Token('color', color); </td></tr><tr><td class="line">756</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">757</td><td class="hits"></td><td class="source">  },</td></tr><tr><td class="line">758</td><td class="hits"></td><td class="source">  </td></tr><tr><td class="line">759</td><td class="hits"></td><td class="source">  /**</td></tr><tr><td class="line">760</td><td class="hits"></td><td class="source">   * #rrggbbaa</td></tr><tr><td class="line">761</td><td class="hits"></td><td class="source">   */</td></tr><tr><td class="line">762</td><td class="hits"></td><td class="source">  </td></tr><tr><td class="line">763</td><td class="hits"></td><td class="source">  rrggbbaa: function() {</td></tr><tr class="hit"><td class="line">764</td><td class="hits">125106</td><td class="source">    var captures;</td></tr><tr class="hit"><td class="line">765</td><td class="hits">125106</td><td class="source">    if (captures = /^#([a-fA-F0-9]{8})[ \t]*/.exec(this.str)) {</td></tr><tr class="hit"><td class="line">766</td><td class="hits">1</td><td class="source">      this.skip(captures);</td></tr><tr class="hit"><td class="line">767</td><td class="hits">1</td><td class="source">      var rgb = captures[1]</td></tr><tr><td class="line">768</td><td class="hits"></td><td class="source">        , r = parseInt(rgb.substr(0, 2), 16)</td></tr><tr><td class="line">769</td><td class="hits"></td><td class="source">        , g = parseInt(rgb.substr(2, 2), 16)</td></tr><tr><td class="line">770</td><td class="hits"></td><td class="source">        , b = parseInt(rgb.substr(4, 2), 16)</td></tr><tr><td class="line">771</td><td class="hits"></td><td class="source">        , a = parseInt(rgb.substr(6, 2), 16)</td></tr><tr><td class="line">772</td><td class="hits"></td><td class="source">        , color = new nodes.RGBA(r, g, b, a/255);</td></tr><tr class="hit"><td class="line">773</td><td class="hits">1</td><td class="source">      color.raw = captures[0];</td></tr><tr class="hit"><td class="line">774</td><td class="hits">1</td><td class="source">      return new Token('color', color); </td></tr><tr><td class="line">775</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">776</td><td class="hits"></td><td class="source">  },</td></tr><tr><td class="line">777</td><td class="hits"></td><td class="source">  </td></tr><tr><td class="line">778</td><td class="hits"></td><td class="source">  /**</td></tr><tr><td class="line">779</td><td class="hits"></td><td class="source">   * [^\n,;]+</td></tr><tr><td class="line">780</td><td class="hits"></td><td class="source">   */</td></tr><tr><td class="line">781</td><td class="hits"></td><td class="source">  </td></tr><tr><td class="line">782</td><td class="hits"></td><td class="source">  selector: function() {</td></tr><tr class="hit"><td class="line">783</td><td class="hits">547</td><td class="source">    var captures;</td></tr><tr class="hit"><td class="line">784</td><td class="hits">547</td><td class="source">    if (captures = /^[^{\n,]+/.exec(this.str)) {</td></tr><tr class="hit"><td class="line">785</td><td class="hits">547</td><td class="source">      var selector = captures[0];</td></tr><tr class="hit"><td class="line">786</td><td class="hits">547</td><td class="source">      this.skip(captures);</td></tr><tr class="hit"><td class="line">787</td><td class="hits">547</td><td class="source">      return new Token('selector', selector);</td></tr><tr><td class="line">788</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">789</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">790</td><td class="hits"></td><td class="source">};</td></tr></tbody></table></div><div class="file"><h2 id="token.js">token.js</h2><div id="stats" class="high"><div class="percentage">77%</div><div class="sloc">9</div><div class="hits">7</div><div class="misses">2</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr><td class="line">1</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source">/*!</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source"> * Stylus - Token</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source"> * Copyright(c) 2010 LearnBoost &lt;dev@learnboost.com&gt;</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> * MIT Licensed</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source"> * Module dependencies.</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">12</td><td class="hits">1</td><td class="source">var inspect = require('util').inspect;</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">14</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">15</td><td class="hits"></td><td class="source"> * Initialize a new `Token` with the given `type` and `val`.</td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">17</td><td class="hits"></td><td class="source"> * @param {String} type</td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source"> * @param {Mixed} val</td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">21</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">22</td><td class="hits">1</td><td class="source">var Token = exports = module.exports = function Token(type, val) {</td></tr><tr class="hit"><td class="line">23</td><td class="hits">221151</td><td class="source">  this.type = type;</td></tr><tr class="hit"><td class="line">24</td><td class="hits">221151</td><td class="source">  this.val = val;</td></tr><tr><td class="line">25</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">26</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">27</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">28</td><td class="hits"></td><td class="source"> * Custom inspect.</td></tr><tr><td class="line">29</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">30</td><td class="hits"></td><td class="source"> * @return {String}</td></tr><tr><td class="line">31</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">32</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">33</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">34</td><td class="hits">1</td><td class="source">Token.prototype.inspect = function(){</td></tr><tr class="miss"><td class="line">35</td><td class="hits">0</td><td class="source">  var val = ' ' + inspect(this.val);</td></tr><tr class="miss"><td class="line">36</td><td class="hits">0</td><td class="source">  return '[Token:' + this.lineno + ' '</td></tr><tr><td class="line">37</td><td class="hits"></td><td class="source">    + '\x1b[32m' + this.type + '\x1b[0m'</td></tr><tr><td class="line">38</td><td class="hits"></td><td class="source">    + '\x1b[33m' + (this.val ? val : '') + '\x1b[0m'</td></tr><tr><td class="line">39</td><td class="hits"></td><td class="source">    + ']';</td></tr><tr><td class="line">40</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">41</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">42</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">43</td><td class="hits"></td><td class="source"> * Return type or val.</td></tr><tr><td class="line">44</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">45</td><td class="hits"></td><td class="source"> * @return {String}</td></tr><tr><td class="line">46</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">47</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">48</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">49</td><td class="hits">1</td><td class="source">Token.prototype.toString = function(){</td></tr><tr class="hit"><td class="line">50</td><td class="hits">4476</td><td class="source">  return (undefined === this.val</td></tr><tr><td class="line">51</td><td class="hits"></td><td class="source">    ? this.type</td></tr><tr><td class="line">52</td><td class="hits"></td><td class="source">    : this.val).toString();</td></tr><tr><td class="line">53</td><td class="hits"></td><td class="source">};</td></tr></tbody></table></div><div class="file"><h2 id="nodes/index.js">nodes/index.js</h2><div id="stats" class="high"><div class="percentage">100%</div><div class="sloc">37</div><div class="hits">37</div><div class="misses">0</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr><td class="line">1</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source">/*!</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source"> * Stylus - nodes</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source"> * Copyright(c) 2010 LearnBoost &lt;dev@learnboost.com&gt;</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> * MIT Licensed</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source"> * Constructors</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">12</td><td class="hits">1</td><td class="source">exports.Node = require('./node');</td></tr><tr class="hit"><td class="line">13</td><td class="hits">1</td><td class="source">exports.Root = require('./root');</td></tr><tr class="hit"><td class="line">14</td><td class="hits">1</td><td class="source">exports.Null = require('./null');</td></tr><tr class="hit"><td class="line">15</td><td class="hits">1</td><td class="source">exports.Each = require('./each');</td></tr><tr class="hit"><td class="line">16</td><td class="hits">1</td><td class="source">exports.If = require('./if');</td></tr><tr class="hit"><td class="line">17</td><td class="hits">1</td><td class="source">exports.Call = require('./call');</td></tr><tr class="hit"><td class="line">18</td><td class="hits">1</td><td class="source">exports.Page = require('./page');</td></tr><tr class="hit"><td class="line">19</td><td class="hits">1</td><td class="source">exports.FontFace = require('./fontface');</td></tr><tr class="hit"><td class="line">20</td><td class="hits">1</td><td class="source">exports.UnaryOp = require('./unaryop');</td></tr><tr class="hit"><td class="line">21</td><td class="hits">1</td><td class="source">exports.BinOp = require('./binop');</td></tr><tr class="hit"><td class="line">22</td><td class="hits">1</td><td class="source">exports.Ternary = require('./ternary');</td></tr><tr class="hit"><td class="line">23</td><td class="hits">1</td><td class="source">exports.Block = require('./block');</td></tr><tr class="hit"><td class="line">24</td><td class="hits">1</td><td class="source">exports.Unit = require('./unit');</td></tr><tr class="hit"><td class="line">25</td><td class="hits">1</td><td class="source">exports.String = require('./string');</td></tr><tr class="hit"><td class="line">26</td><td class="hits">1</td><td class="source">exports.HSLA = require('./hsla');</td></tr><tr class="hit"><td class="line">27</td><td class="hits">1</td><td class="source">exports.RGBA = require('./rgba');</td></tr><tr class="hit"><td class="line">28</td><td class="hits">1</td><td class="source">exports.Ident = require('./ident');</td></tr><tr class="hit"><td class="line">29</td><td class="hits">1</td><td class="source">exports.Group = require('./group');</td></tr><tr class="hit"><td class="line">30</td><td class="hits">1</td><td class="source">exports.Literal = require('./literal');</td></tr><tr class="hit"><td class="line">31</td><td class="hits">1</td><td class="source">exports.JSLiteral = require('./jsliteral');</td></tr><tr class="hit"><td class="line">32</td><td class="hits">1</td><td class="source">exports.Boolean = require('./boolean');</td></tr><tr class="hit"><td class="line">33</td><td class="hits">1</td><td class="source">exports.Return = require('./return');</td></tr><tr class="hit"><td class="line">34</td><td class="hits">1</td><td class="source">exports.Media = require('./media');</td></tr><tr class="hit"><td class="line">35</td><td class="hits">1</td><td class="source">exports.Params = require('./params');</td></tr><tr class="hit"><td class="line">36</td><td class="hits">1</td><td class="source">exports.Comment = require('./comment');</td></tr><tr class="hit"><td class="line">37</td><td class="hits">1</td><td class="source">exports.Keyframes = require('./keyframes');</td></tr><tr class="hit"><td class="line">38</td><td class="hits">1</td><td class="source">exports.Charset = require('./charset');</td></tr><tr class="hit"><td class="line">39</td><td class="hits">1</td><td class="source">exports.Import = require('./import');</td></tr><tr class="hit"><td class="line">40</td><td class="hits">1</td><td class="source">exports.Extend = require('./extend');</td></tr><tr class="hit"><td class="line">41</td><td class="hits">1</td><td class="source">exports.Function = require('./function');</td></tr><tr class="hit"><td class="line">42</td><td class="hits">1</td><td class="source">exports.Property = require('./property');</td></tr><tr class="hit"><td class="line">43</td><td class="hits">1</td><td class="source">exports.Selector = require('./selector');</td></tr><tr class="hit"><td class="line">44</td><td class="hits">1</td><td class="source">exports.Expression = require('./expression');</td></tr><tr class="hit"><td class="line">45</td><td class="hits">1</td><td class="source">exports.Arguments = require('./arguments');</td></tr><tr><td class="line">46</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">47</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">48</td><td class="hits"></td><td class="source"> * Singletons.</td></tr><tr><td class="line">49</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">50</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">51</td><td class="hits">1</td><td class="source">exports.true = new exports.Boolean(true);</td></tr><tr class="hit"><td class="line">52</td><td class="hits">1</td><td class="source">exports.false = new exports.Boolean(false);</td></tr><tr class="hit"><td class="line">53</td><td class="hits">1</td><td class="source">exports.null = new exports.Null;</td></tr></tbody></table></div><div class="file"><h2 id="nodes/node.js">nodes/node.js</h2><div id="stats" class="high"><div class="percentage">89%</div><div class="sloc">57</div><div class="hits">51</div><div class="misses">6</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr><td class="line">1</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source">/*!</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source"> * Stylus - Node</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source"> * Copyright(c) 2010 LearnBoost &lt;dev@learnboost.com&gt;</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> * MIT Licensed</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source"> * Module dependencies.</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">12</td><td class="hits">1</td><td class="source">var Evaluator = require('../visitor/evaluator')</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source">  , utils = require('../utils')</td></tr><tr><td class="line">14</td><td class="hits"></td><td class="source">  , nodes = require('./');</td></tr><tr><td class="line">15</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">17</td><td class="hits"></td><td class="source"> * Node constructor.</td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">21</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">22</td><td class="hits">1</td><td class="source">var Node = module.exports = function Node(){</td></tr><tr class="hit"><td class="line">23</td><td class="hits">337881</td><td class="source">  this.lineno = nodes.lineno;</td></tr><tr class="hit"><td class="line">24</td><td class="hits">337881</td><td class="source">  Object.defineProperty(this, 'filename', { writable: true, value: nodes.filename });</td></tr><tr><td class="line">25</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">26</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">27</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">28</td><td class="hits"></td><td class="source"> * Return this node.</td></tr><tr><td class="line">29</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">30</td><td class="hits"></td><td class="source"> * @return {Node}</td></tr><tr><td class="line">31</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">32</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">33</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">34</td><td class="hits">1</td><td class="source">Node.prototype.__defineGetter__('first', function(){</td></tr><tr class="hit"><td class="line">35</td><td class="hits">7890</td><td class="source">  return this;</td></tr><tr><td class="line">36</td><td class="hits"></td><td class="source">});</td></tr><tr><td class="line">37</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">38</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">39</td><td class="hits"></td><td class="source"> * Return hash.</td></tr><tr><td class="line">40</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">41</td><td class="hits"></td><td class="source"> * @return {String}</td></tr><tr><td class="line">42</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">43</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">44</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">45</td><td class="hits">1</td><td class="source">Node.prototype.__defineGetter__('hash', function(){</td></tr><tr class="hit"><td class="line">46</td><td class="hits">653</td><td class="source">  return this.val;</td></tr><tr><td class="line">47</td><td class="hits"></td><td class="source">});</td></tr><tr><td class="line">48</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">49</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">50</td><td class="hits"></td><td class="source"> * Return node name.</td></tr><tr><td class="line">51</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">52</td><td class="hits"></td><td class="source"> * @return {String}</td></tr><tr><td class="line">53</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">54</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">55</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">56</td><td class="hits">1</td><td class="source">Node.prototype.__defineGetter__('nodeName', function(){</td></tr><tr class="hit"><td class="line">57</td><td class="hits">57190</td><td class="source">  return this.constructor.name.toLowerCase();</td></tr><tr><td class="line">58</td><td class="hits"></td><td class="source">});</td></tr><tr><td class="line">59</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">60</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">61</td><td class="hits"></td><td class="source"> * Return this node.</td></tr><tr><td class="line">62</td><td class="hits"></td><td class="source"> * </td></tr><tr><td class="line">63</td><td class="hits"></td><td class="source"> * @return {Node}</td></tr><tr><td class="line">64</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">65</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">66</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">67</td><td class="hits">1</td><td class="source">Node.prototype.clone = function(){</td></tr><tr class="hit"><td class="line">68</td><td class="hits">5003</td><td class="source">  return this;</td></tr><tr><td class="line">69</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">70</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">71</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">72</td><td class="hits"></td><td class="source"> * Nodes by default evaluate to themselves.</td></tr><tr><td class="line">73</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">74</td><td class="hits"></td><td class="source"> * @return {Node}</td></tr><tr><td class="line">75</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">76</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">77</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">78</td><td class="hits">1</td><td class="source">Node.prototype.eval = function(){</td></tr><tr class="miss"><td class="line">79</td><td class="hits">0</td><td class="source">  return new Evaluator(this).evaluate();</td></tr><tr><td class="line">80</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">81</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">82</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">83</td><td class="hits"></td><td class="source"> * Return true.</td></tr><tr><td class="line">84</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">85</td><td class="hits"></td><td class="source"> * @return {Boolean}</td></tr><tr><td class="line">86</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">87</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">88</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">89</td><td class="hits">1</td><td class="source">Node.prototype.toBoolean = function(){</td></tr><tr class="hit"><td class="line">90</td><td class="hits">2</td><td class="source">  return nodes.true;</td></tr><tr><td class="line">91</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">92</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">93</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">94</td><td class="hits"></td><td class="source"> * Return the expression, or wrap this node in an expression.</td></tr><tr><td class="line">95</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">96</td><td class="hits"></td><td class="source"> * @return {Expression}</td></tr><tr><td class="line">97</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">98</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">99</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">100</td><td class="hits">1</td><td class="source">Node.prototype.toExpression = function(){</td></tr><tr class="hit"><td class="line">101</td><td class="hits">126</td><td class="source">  if ('expression' == this.nodeName) return this;</td></tr><tr class="hit"><td class="line">102</td><td class="hits">56</td><td class="source">  var expr = new nodes.Expression;</td></tr><tr class="hit"><td class="line">103</td><td class="hits">56</td><td class="source">  expr.push(this);</td></tr><tr class="hit"><td class="line">104</td><td class="hits">56</td><td class="source">  return expr;</td></tr><tr><td class="line">105</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">106</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">107</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">108</td><td class="hits"></td><td class="source"> * Return false if `op` is generally not coerced.</td></tr><tr><td class="line">109</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">110</td><td class="hits"></td><td class="source"> * @param {String} op</td></tr><tr><td class="line">111</td><td class="hits"></td><td class="source"> * @return {Boolean}</td></tr><tr><td class="line">112</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">113</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">114</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">115</td><td class="hits">1</td><td class="source">Node.prototype.shouldCoerce = function(op){</td></tr><tr class="hit"><td class="line">116</td><td class="hits">523</td><td class="source">  switch (op) {</td></tr><tr><td class="line">117</td><td class="hits"></td><td class="source">    case 'is a':</td></tr><tr><td class="line">118</td><td class="hits"></td><td class="source">    case 'in':</td></tr><tr><td class="line">119</td><td class="hits"></td><td class="source">    case '||':</td></tr><tr><td class="line">120</td><td class="hits"></td><td class="source">    case '&amp;&amp;':</td></tr><tr class="hit"><td class="line">121</td><td class="hits">90</td><td class="source">      return false;</td></tr><tr><td class="line">122</td><td class="hits"></td><td class="source">    default:</td></tr><tr class="hit"><td class="line">123</td><td class="hits">433</td><td class="source">      return true;</td></tr><tr><td class="line">124</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">125</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">126</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">127</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">128</td><td class="hits"></td><td class="source"> * Operate on `right` with the given `op`.</td></tr><tr><td class="line">129</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">130</td><td class="hits"></td><td class="source"> * @param {String} op</td></tr><tr><td class="line">131</td><td class="hits"></td><td class="source"> * @param {Node} right</td></tr><tr><td class="line">132</td><td class="hits"></td><td class="source"> * @return {Node}</td></tr><tr><td class="line">133</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">134</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">135</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">136</td><td class="hits">1</td><td class="source">Node.prototype.operate = function(op, right){</td></tr><tr class="hit"><td class="line">137</td><td class="hits">592</td><td class="source">  switch (op) {</td></tr><tr><td class="line">138</td><td class="hits"></td><td class="source">    case 'is a':</td></tr><tr class="hit"><td class="line">139</td><td class="hits">163</td><td class="source">      if ('string' == right.nodeName) {</td></tr><tr class="hit"><td class="line">140</td><td class="hits">163</td><td class="source">        return nodes.Boolean(this.nodeName == right.val);</td></tr><tr><td class="line">141</td><td class="hits"></td><td class="source">      } else {</td></tr><tr class="miss"><td class="line">142</td><td class="hits">0</td><td class="source">        throw new Error('&quot;is a&quot; expects a string, got ' + right.toString());</td></tr><tr><td class="line">143</td><td class="hits"></td><td class="source">      }</td></tr><tr><td class="line">144</td><td class="hits"></td><td class="source">    case '==':</td></tr><tr class="hit"><td class="line">145</td><td class="hits">227</td><td class="source">      return nodes.Boolean(this.hash == right.hash);</td></tr><tr><td class="line">146</td><td class="hits"></td><td class="source">    case '!=':</td></tr><tr class="hit"><td class="line">147</td><td class="hits">1</td><td class="source">      return nodes.Boolean(this.hash != right.hash);</td></tr><tr><td class="line">148</td><td class="hits"></td><td class="source">    case '&gt;=':</td></tr><tr class="hit"><td class="line">149</td><td class="hits">6</td><td class="source">      return nodes.Boolean(this.hash &gt;= right.hash);</td></tr><tr><td class="line">150</td><td class="hits"></td><td class="source">    case '&lt;=':</td></tr><tr class="hit"><td class="line">151</td><td class="hits">1</td><td class="source">      return nodes.Boolean(this.hash &lt;= right.hash);</td></tr><tr><td class="line">152</td><td class="hits"></td><td class="source">    case '&gt;':</td></tr><tr class="hit"><td class="line">153</td><td class="hits">37</td><td class="source">      return nodes.Boolean(this.hash &gt; right.hash);</td></tr><tr><td class="line">154</td><td class="hits"></td><td class="source">    case '&lt;':</td></tr><tr class="hit"><td class="line">155</td><td class="hits">20</td><td class="source">      return nodes.Boolean(this.hash &lt; right.hash);</td></tr><tr><td class="line">156</td><td class="hits"></td><td class="source">    case '||':</td></tr><tr class="hit"><td class="line">157</td><td class="hits">72</td><td class="source">      return this.toBoolean().isTrue</td></tr><tr><td class="line">158</td><td class="hits"></td><td class="source">        ? this</td></tr><tr><td class="line">159</td><td class="hits"></td><td class="source">        : right;</td></tr><tr><td class="line">160</td><td class="hits"></td><td class="source">    case 'in':</td></tr><tr class="hit"><td class="line">161</td><td class="hits">32</td><td class="source">      var vals = utils.unwrap(right).nodes</td></tr><tr><td class="line">162</td><td class="hits"></td><td class="source">        , hash = this.hash;</td></tr><tr class="hit"><td class="line">163</td><td class="hits">32</td><td class="source">      if (!vals) throw new Error('&quot;in&quot; given invalid right-hand operand, expecting an expression');</td></tr><tr class="hit"><td class="line">164</td><td class="hits">32</td><td class="source">      for (var i = 0, len = vals.length; i &lt; len; ++i) {</td></tr><tr class="hit"><td class="line">165</td><td class="hits">232</td><td class="source">        if (hash == vals[i].hash) {</td></tr><tr class="hit"><td class="line">166</td><td class="hits">22</td><td class="source">          return nodes.true;</td></tr><tr><td class="line">167</td><td class="hits"></td><td class="source">        }</td></tr><tr><td class="line">168</td><td class="hits"></td><td class="source">      }</td></tr><tr class="hit"><td class="line">169</td><td class="hits">10</td><td class="source">      return nodes.false;</td></tr><tr><td class="line">170</td><td class="hits"></td><td class="source">    case '&amp;&amp;':</td></tr><tr class="hit"><td class="line">171</td><td class="hits">33</td><td class="source">      var a = this.toBoolean()</td></tr><tr><td class="line">172</td><td class="hits"></td><td class="source">        , b = right.toBoolean();</td></tr><tr class="hit"><td class="line">173</td><td class="hits">33</td><td class="source">      return a.isTrue &amp;&amp; b.isTrue</td></tr><tr><td class="line">174</td><td class="hits"></td><td class="source">        ? right</td></tr><tr><td class="line">175</td><td class="hits"></td><td class="source">        : a.isFalse</td></tr><tr><td class="line">176</td><td class="hits"></td><td class="source">          ? this</td></tr><tr><td class="line">177</td><td class="hits"></td><td class="source">          : right;</td></tr><tr><td class="line">178</td><td class="hits"></td><td class="source">    default:</td></tr><tr class="miss"><td class="line">179</td><td class="hits">0</td><td class="source">      if ('[]' == op) {</td></tr><tr class="miss"><td class="line">180</td><td class="hits">0</td><td class="source">        var msg = 'cannot perform '</td></tr><tr><td class="line">181</td><td class="hits"></td><td class="source">          + this</td></tr><tr><td class="line">182</td><td class="hits"></td><td class="source">          + '[' + right + ']';</td></tr><tr><td class="line">183</td><td class="hits"></td><td class="source">      } else {</td></tr><tr class="miss"><td class="line">184</td><td class="hits">0</td><td class="source">        var msg = 'cannot perform'</td></tr><tr><td class="line">185</td><td class="hits"></td><td class="source">          + ' ' + this</td></tr><tr><td class="line">186</td><td class="hits"></td><td class="source">          + ' ' + op</td></tr><tr><td class="line">187</td><td class="hits"></td><td class="source">          + ' ' + right;</td></tr><tr><td class="line">188</td><td class="hits"></td><td class="source">      }</td></tr><tr class="miss"><td class="line">189</td><td class="hits">0</td><td class="source">      throw new Error(msg);</td></tr><tr><td class="line">190</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">191</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">192</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">193</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">194</td><td class="hits"></td><td class="source"> * Initialize a new `CoercionError` with the given `msg`.</td></tr><tr><td class="line">195</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">196</td><td class="hits"></td><td class="source"> * @param {String} msg</td></tr><tr><td class="line">197</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">198</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">199</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">200</td><td class="hits">1</td><td class="source">function CoercionError(msg) {</td></tr><tr class="hit"><td class="line">201</td><td class="hits">7</td><td class="source">  this.name = 'CoercionError'</td></tr><tr class="hit"><td class="line">202</td><td class="hits">7</td><td class="source">  this.message = msg</td></tr><tr class="hit"><td class="line">203</td><td class="hits">7</td><td class="source">  Error.captureStackTrace(this, CoercionError);</td></tr><tr><td class="line">204</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">205</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">206</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">207</td><td class="hits"></td><td class="source"> * Inherit from `Error.prototype`.</td></tr><tr><td class="line">208</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">209</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">210</td><td class="hits">1</td><td class="source">CoercionError.prototype.__proto__ = Error.prototype;</td></tr><tr><td class="line">211</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">212</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">213</td><td class="hits"></td><td class="source"> * Default coercion throws.</td></tr><tr><td class="line">214</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">215</td><td class="hits"></td><td class="source"> * @param {Node} other</td></tr><tr><td class="line">216</td><td class="hits"></td><td class="source"> * @return {Node}</td></tr><tr><td class="line">217</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">218</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">219</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">220</td><td class="hits">1</td><td class="source">Node.prototype.coerce = function(other){</td></tr><tr class="hit"><td class="line">221</td><td class="hits">7</td><td class="source">  if (other.nodeName == this.nodeName) return other;</td></tr><tr class="hit"><td class="line">222</td><td class="hits">7</td><td class="source">  throw new CoercionError('cannot coerce ' + other + ' to ' + this.nodeName);</td></tr><tr><td class="line">223</td><td class="hits"></td><td class="source">};</td></tr></tbody></table></div><div class="file"><h2 id="visitor/evaluator.js">visitor/evaluator.js</h2><div id="stats" class="high"><div class="percentage">96%</div><div class="sloc">446</div><div class="hits">431</div><div class="misses">15</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr><td class="line">1</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source">/*!</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source"> * Stylus - Evaluator</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source"> * Copyright(c) 2010 LearnBoost &lt;dev@learnboost.com&gt;</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> * MIT Licensed</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source"> * Module dependencies.</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">12</td><td class="hits">1</td><td class="source">var Visitor = require('./')</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source">  , units = require('../units')</td></tr><tr><td class="line">14</td><td class="hits"></td><td class="source">  , nodes = require('../nodes')</td></tr><tr><td class="line">15</td><td class="hits"></td><td class="source">  , Stack = require('../stack')</td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source">  , Frame = require('../stack/frame')</td></tr><tr><td class="line">17</td><td class="hits"></td><td class="source">  , Scope = require('../stack/scope')</td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source">  , utils = require('../utils')</td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source">  , bifs = require('../functions')</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source">  , dirname = require('path').dirname</td></tr><tr><td class="line">21</td><td class="hits"></td><td class="source">  , join = require('path').join</td></tr><tr><td class="line">22</td><td class="hits"></td><td class="source">  , colors = require('../colors')</td></tr><tr><td class="line">23</td><td class="hits"></td><td class="source">  , debug = require('debug')('stylus:evaluator')</td></tr><tr><td class="line">24</td><td class="hits"></td><td class="source">  , fs = require('fs');</td></tr><tr><td class="line">25</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">26</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">27</td><td class="hits"></td><td class="source"> * Initialize a new `Evaluator` with the given `root` Node</td></tr><tr><td class="line">28</td><td class="hits"></td><td class="source"> * and the following `options`.</td></tr><tr><td class="line">29</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">30</td><td class="hits"></td><td class="source"> * Options:</td></tr><tr><td class="line">31</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">32</td><td class="hits"></td><td class="source"> *   - `compress`  Compress the css output, defaults to false</td></tr><tr><td class="line">33</td><td class="hits"></td><td class="source"> *   - `warn`  Warn the user of duplicate function definitions etc</td></tr><tr><td class="line">34</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">35</td><td class="hits"></td><td class="source"> * @param {Node} root</td></tr><tr><td class="line">36</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">37</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">38</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">39</td><td class="hits">1</td><td class="source">var Evaluator = module.exports = function Evaluator(root, options) {</td></tr><tr class="hit"><td class="line">40</td><td class="hits">208</td><td class="source">  options = options || {};</td></tr><tr class="hit"><td class="line">41</td><td class="hits">208</td><td class="source">  Visitor.call(this, root);</td></tr><tr class="hit"><td class="line">42</td><td class="hits">208</td><td class="source">  this.stack = new Stack;</td></tr><tr class="hit"><td class="line">43</td><td class="hits">208</td><td class="source">  this.imports = options.imports || [];</td></tr><tr class="hit"><td class="line">44</td><td class="hits">208</td><td class="source">  this.functions = options.functions || {};</td></tr><tr class="hit"><td class="line">45</td><td class="hits">208</td><td class="source">  this.globals = options.globals || {};</td></tr><tr class="hit"><td class="line">46</td><td class="hits">208</td><td class="source">  this.paths = options.paths || [];</td></tr><tr class="hit"><td class="line">47</td><td class="hits">208</td><td class="source">  this.filename = options.filename;</td></tr><tr class="hit"><td class="line">48</td><td class="hits">208</td><td class="source">  this.includeCSS = options['include css'];</td></tr><tr class="hit"><td class="line">49</td><td class="hits">208</td><td class="source">  this.paths.push(dirname(options.filename || '.'));</td></tr><tr class="hit"><td class="line">50</td><td class="hits">208</td><td class="source">  this.stack.push(this.global = new Frame(root));</td></tr><tr class="hit"><td class="line">51</td><td class="hits">208</td><td class="source">  this.warnings = options.warn;</td></tr><tr class="hit"><td class="line">52</td><td class="hits">208</td><td class="source">  this.options = options;</td></tr><tr class="hit"><td class="line">53</td><td class="hits">208</td><td class="source">  this.calling = []; // TODO: remove, use stack</td></tr><tr class="hit"><td class="line">54</td><td class="hits">208</td><td class="source">  this.importStack = [];</td></tr><tr class="hit"><td class="line">55</td><td class="hits">208</td><td class="source">  this.return = 0;</td></tr><tr><td class="line">56</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">57</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">58</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">59</td><td class="hits"></td><td class="source"> * Inherit from `Visitor.prototype`.</td></tr><tr><td class="line">60</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">61</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">62</td><td class="hits">1</td><td class="source">Evaluator.prototype.__proto__ = Visitor.prototype;</td></tr><tr><td class="line">63</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">64</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">65</td><td class="hits"></td><td class="source"> * Proxy visit to expose node line numbers.</td></tr><tr><td class="line">66</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">67</td><td class="hits"></td><td class="source"> * @param {Node} node</td></tr><tr><td class="line">68</td><td class="hits"></td><td class="source"> * @return {Node}</td></tr><tr><td class="line">69</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">70</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">71</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">72</td><td class="hits">1</td><td class="source">var visit = Visitor.prototype.visit;</td></tr><tr class="hit"><td class="line">73</td><td class="hits">1</td><td class="source">Evaluator.prototype.visit = function(node){</td></tr><tr class="hit"><td class="line">74</td><td class="hits">54320</td><td class="source">  try {</td></tr><tr class="hit"><td class="line">75</td><td class="hits">54320</td><td class="source">    return visit.call(this, node);</td></tr><tr><td class="line">76</td><td class="hits"></td><td class="source">  } catch (err) {</td></tr><tr class="hit"><td class="line">77</td><td class="hits">56</td><td class="source">    if (err.filename) throw err;</td></tr><tr class="hit"><td class="line">78</td><td class="hits">42</td><td class="source">    err.lineno = node.lineno;</td></tr><tr class="hit"><td class="line">79</td><td class="hits">42</td><td class="source">    err.filename = node.filename;</td></tr><tr class="hit"><td class="line">80</td><td class="hits">42</td><td class="source">    err.stylusStack = this.stack.toString();</td></tr><tr class="hit"><td class="line">81</td><td class="hits">42</td><td class="source">    try {</td></tr><tr class="hit"><td class="line">82</td><td class="hits">42</td><td class="source">      err.input = fs.readFileSync(err.filename, 'utf8');</td></tr><tr><td class="line">83</td><td class="hits"></td><td class="source">    } catch (err) {</td></tr><tr><td class="line">84</td><td class="hits"></td><td class="source">      // ignore</td></tr><tr><td class="line">85</td><td class="hits"></td><td class="source">    }</td></tr><tr class="hit"><td class="line">86</td><td class="hits">42</td><td class="source">    throw err;</td></tr><tr><td class="line">87</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">88</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">89</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">90</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">91</td><td class="hits"></td><td class="source"> * Perform evaluation setup:</td></tr><tr><td class="line">92</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">93</td><td class="hits"></td><td class="source"> *   - populate global scope</td></tr><tr><td class="line">94</td><td class="hits"></td><td class="source"> *   - iterate imports</td></tr><tr><td class="line">95</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">96</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">97</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">98</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">99</td><td class="hits">1</td><td class="source">Evaluator.prototype.setup = function(){</td></tr><tr class="hit"><td class="line">100</td><td class="hits">208</td><td class="source">  this.populateGlobalScope();</td></tr><tr class="hit"><td class="line">101</td><td class="hits">208</td><td class="source">  this.imports.forEach(function(file){</td></tr><tr class="hit"><td class="line">102</td><td class="hits">208</td><td class="source">    var expr = new nodes.Expression;</td></tr><tr class="hit"><td class="line">103</td><td class="hits">208</td><td class="source">    expr.push(new nodes.String(file));</td></tr><tr class="hit"><td class="line">104</td><td class="hits">208</td><td class="source">    this.visit(new nodes.Import(expr));</td></tr><tr><td class="line">105</td><td class="hits"></td><td class="source">  }, this);</td></tr><tr><td class="line">106</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">107</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">108</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">109</td><td class="hits"></td><td class="source"> * Populate the global scope with:</td></tr><tr><td class="line">110</td><td class="hits"></td><td class="source"> * </td></tr><tr><td class="line">111</td><td class="hits"></td><td class="source"> *   - css colors</td></tr><tr><td class="line">112</td><td class="hits"></td><td class="source"> *   - user-defined globals</td></tr><tr><td class="line">113</td><td class="hits"></td><td class="source"> * </td></tr><tr><td class="line">114</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">115</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">116</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">117</td><td class="hits">1</td><td class="source">Evaluator.prototype.populateGlobalScope = function(){</td></tr><tr class="hit"><td class="line">118</td><td class="hits">208</td><td class="source">  var scope = this.global.scope;</td></tr><tr><td class="line">119</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">120</td><td class="hits"></td><td class="source">  // colors</td></tr><tr class="hit"><td class="line">121</td><td class="hits">208</td><td class="source">  Object.keys(colors).forEach(function(name){</td></tr><tr class="hit"><td class="line">122</td><td class="hits">30576</td><td class="source">    var rgb = colors[name]</td></tr><tr><td class="line">123</td><td class="hits"></td><td class="source">      , rgba = new nodes.RGBA(rgb[0], rgb[1], rgb[2], 1)</td></tr><tr><td class="line">124</td><td class="hits"></td><td class="source">      , node = new nodes.Ident(name, rgba);</td></tr><tr class="hit"><td class="line">125</td><td class="hits">30576</td><td class="source">    scope.add(node);</td></tr><tr><td class="line">126</td><td class="hits"></td><td class="source">  });</td></tr><tr><td class="line">127</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">128</td><td class="hits"></td><td class="source">  // user-defined globals</td></tr><tr class="hit"><td class="line">129</td><td class="hits">208</td><td class="source">  var globals = this.globals;</td></tr><tr class="hit"><td class="line">130</td><td class="hits">208</td><td class="source">  Object.keys(globals).forEach(function(name){</td></tr><tr class="miss"><td class="line">131</td><td class="hits">0</td><td class="source">    scope.add(new nodes.Ident(name, globals[name]));</td></tr><tr><td class="line">132</td><td class="hits"></td><td class="source">  });</td></tr><tr><td class="line">133</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">134</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">135</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">136</td><td class="hits"></td><td class="source"> * Evaluate the tree.</td></tr><tr><td class="line">137</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">138</td><td class="hits"></td><td class="source"> * @return {Node}</td></tr><tr><td class="line">139</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">140</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">141</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">142</td><td class="hits">1</td><td class="source">Evaluator.prototype.evaluate = function(){</td></tr><tr class="hit"><td class="line">143</td><td class="hits">208</td><td class="source">  debug('eval %s', this.filename);</td></tr><tr class="hit"><td class="line">144</td><td class="hits">208</td><td class="source">  this.setup();</td></tr><tr class="hit"><td class="line">145</td><td class="hits">208</td><td class="source">  return this.visit(this.root);</td></tr><tr><td class="line">146</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">147</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">148</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">149</td><td class="hits"></td><td class="source"> * Visit Group.</td></tr><tr><td class="line">150</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">151</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">152</td><td class="hits">1</td><td class="source">Evaluator.prototype.visitGroup = function(group){</td></tr><tr class="hit"><td class="line">153</td><td class="hits">1133</td><td class="source">  group.nodes = group.nodes.map(function(selector){</td></tr><tr class="hit"><td class="line">154</td><td class="hits">1756</td><td class="source">    selector.val = this.interpolate(selector);</td></tr><tr class="hit"><td class="line">155</td><td class="hits">1756</td><td class="source">    debug('ruleset %s', selector.val);</td></tr><tr class="hit"><td class="line">156</td><td class="hits">1756</td><td class="source">    return selector;</td></tr><tr><td class="line">157</td><td class="hits"></td><td class="source">  }, this);</td></tr><tr><td class="line">158</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">159</td><td class="hits">1133</td><td class="source">  group.block = this.visit(group.block);</td></tr><tr class="hit"><td class="line">160</td><td class="hits">1133</td><td class="source">  return group;</td></tr><tr><td class="line">161</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">162</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">163</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">164</td><td class="hits"></td><td class="source"> * Visit Charset.</td></tr><tr><td class="line">165</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">166</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">167</td><td class="hits">1</td><td class="source">Evaluator.prototype.visitCharset = function(charset){</td></tr><tr class="hit"><td class="line">168</td><td class="hits">1</td><td class="source">  return charset;</td></tr><tr><td class="line">169</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">170</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">171</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">172</td><td class="hits"></td><td class="source"> * Visit Return.</td></tr><tr><td class="line">173</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">174</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">175</td><td class="hits">1</td><td class="source">Evaluator.prototype.visitReturn = function(ret){</td></tr><tr class="hit"><td class="line">176</td><td class="hits">27</td><td class="source">  ret.expr = this.visit(ret.expr);</td></tr><tr class="hit"><td class="line">177</td><td class="hits">27</td><td class="source">  throw ret;</td></tr><tr><td class="line">178</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">179</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">180</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">181</td><td class="hits"></td><td class="source"> * Visit Media.</td></tr><tr><td class="line">182</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">183</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">184</td><td class="hits">1</td><td class="source">Evaluator.prototype.visitMedia = function(media){</td></tr><tr class="hit"><td class="line">185</td><td class="hits">22</td><td class="source">  media.block = this.visit(media.block);</td></tr><tr class="hit"><td class="line">186</td><td class="hits">22</td><td class="source">  return media;</td></tr><tr><td class="line">187</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">188</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">189</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">190</td><td class="hits"></td><td class="source"> * Visit FontFace.</td></tr><tr><td class="line">191</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">192</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">193</td><td class="hits">1</td><td class="source">Evaluator.prototype.visitFontFace = function(face){</td></tr><tr class="hit"><td class="line">194</td><td class="hits">2</td><td class="source">  face.block = this.visit(face.block);</td></tr><tr class="hit"><td class="line">195</td><td class="hits">2</td><td class="source">  return face;</td></tr><tr><td class="line">196</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">197</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">198</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">199</td><td class="hits"></td><td class="source"> * Visit FontFace.</td></tr><tr><td class="line">200</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">201</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">202</td><td class="hits">1</td><td class="source">Evaluator.prototype.visitPage = function(page){</td></tr><tr class="hit"><td class="line">203</td><td class="hits">8</td><td class="source">  page.block = this.visit(page.block);</td></tr><tr class="hit"><td class="line">204</td><td class="hits">8</td><td class="source">  return page;</td></tr><tr><td class="line">205</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">206</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">207</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">208</td><td class="hits"></td><td class="source"> * Visit Keyframes.</td></tr><tr><td class="line">209</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">210</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">211</td><td class="hits">1</td><td class="source">Evaluator.prototype.visitKeyframes = function(keyframes){</td></tr><tr class="hit"><td class="line">212</td><td class="hits">74</td><td class="source">  if (keyframes.fabricated) return keyframes;</td></tr><tr class="hit"><td class="line">213</td><td class="hits">14</td><td class="source">  keyframes.name = this.visit(keyframes.name).first.name;</td></tr><tr><td class="line">214</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">215</td><td class="hits">14</td><td class="source">  keyframes.frames = keyframes.frames.map(function(frame){</td></tr><tr class="hit"><td class="line">216</td><td class="hits">34</td><td class="source">    frame.block = this.visit(frame.block);</td></tr><tr class="hit"><td class="line">217</td><td class="hits">34</td><td class="source">    return frame;</td></tr><tr><td class="line">218</td><td class="hits"></td><td class="source">  }, this);</td></tr><tr><td class="line">219</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">220</td><td class="hits">16</td><td class="source">  if ('official' != keyframes.prefix) return keyframes;</td></tr><tr><td class="line">221</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">222</td><td class="hits">12</td><td class="source">  this.vendors.forEach(function(prefix){</td></tr><tr class="hit"><td class="line">223</td><td class="hits">29</td><td class="source">    var node = keyframes.clone();</td></tr><tr class="hit"><td class="line">224</td><td class="hits">29</td><td class="source">    node.prefix = prefix;</td></tr><tr class="hit"><td class="line">225</td><td class="hits">29</td><td class="source">    node.fabricated = true;</td></tr><tr class="hit"><td class="line">226</td><td class="hits">29</td><td class="source">    this.currentBlock.push(node);</td></tr><tr><td class="line">227</td><td class="hits"></td><td class="source">  }, this);</td></tr><tr><td class="line">228</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">229</td><td class="hits">12</td><td class="source">  return nodes.null;</td></tr><tr><td class="line">230</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">231</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">232</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">233</td><td class="hits"></td><td class="source"> * Visit Function.</td></tr><tr><td class="line">234</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">235</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">236</td><td class="hits">1</td><td class="source">Evaluator.prototype.visitFunction = function(fn){</td></tr><tr><td class="line">237</td><td class="hits"></td><td class="source">  // check local</td></tr><tr class="hit"><td class="line">238</td><td class="hits">7967</td><td class="source">  var local = this.stack.currentFrame.scope.lookup(fn.name);</td></tr><tr class="hit"><td class="line">239</td><td class="hits">8016</td><td class="source">  if (local) this.warn('local ' + local.nodeName + ' &quot;' + fn.name + '&quot; previously defined in this scope');</td></tr><tr><td class="line">240</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">241</td><td class="hits"></td><td class="source">  // user-defined</td></tr><tr class="hit"><td class="line">242</td><td class="hits">7967</td><td class="source">  var user = this.functions[fn.name];</td></tr><tr class="hit"><td class="line">243</td><td class="hits">7967</td><td class="source">  if (user) this.warn('user-defined function &quot;' + fn.name + '&quot; is already defined');</td></tr><tr><td class="line">244</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">245</td><td class="hits"></td><td class="source">  // BIF</td></tr><tr class="hit"><td class="line">246</td><td class="hits">7967</td><td class="source">  var bif = bifs[fn.name];</td></tr><tr class="hit"><td class="line">247</td><td class="hits">7987</td><td class="source">  if (bif) this.warn('built-in function &quot;' + fn.name + '&quot; is already defined');</td></tr><tr><td class="line">248</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">249</td><td class="hits">7967</td><td class="source">  return fn;</td></tr><tr><td class="line">250</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">251</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">252</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">253</td><td class="hits"></td><td class="source"> * Visit Each.</td></tr><tr><td class="line">254</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">255</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">256</td><td class="hits">1</td><td class="source">Evaluator.prototype.visitEach = function(each){</td></tr><tr class="hit"><td class="line">257</td><td class="hits">98</td><td class="source">  this.return++;</td></tr><tr class="hit"><td class="line">258</td><td class="hits">98</td><td class="source">  var expr = utils.unwrap(this.visit(utils.unwrap(each.expr)))</td></tr><tr><td class="line">259</td><td class="hits"></td><td class="source">    , len = expr.nodes.length</td></tr><tr><td class="line">260</td><td class="hits"></td><td class="source">    , val = new nodes.Ident(each.val)</td></tr><tr><td class="line">261</td><td class="hits"></td><td class="source">    , key = new nodes.Ident(each.key || '__index__')</td></tr><tr><td class="line">262</td><td class="hits"></td><td class="source">    , scope = this.currentScope</td></tr><tr><td class="line">263</td><td class="hits"></td><td class="source">    , block = this.currentBlock</td></tr><tr><td class="line">264</td><td class="hits"></td><td class="source">    , vals = []</td></tr><tr><td class="line">265</td><td class="hits"></td><td class="source">    , body;</td></tr><tr class="hit"><td class="line">266</td><td class="hits">98</td><td class="source">  this.return--;</td></tr><tr><td class="line">267</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">268</td><td class="hits">98</td><td class="source">  each.block.scope = false;</td></tr><tr class="hit"><td class="line">269</td><td class="hits">98</td><td class="source">  for (var i = 0; i &lt; len; ++i) {</td></tr><tr class="hit"><td class="line">270</td><td class="hits">296</td><td class="source">    val.val = expr.nodes[i];</td></tr><tr class="hit"><td class="line">271</td><td class="hits">296</td><td class="source">    key.val = new nodes.Unit(i);</td></tr><tr class="hit"><td class="line">272</td><td class="hits">296</td><td class="source">    scope.add(val);</td></tr><tr class="hit"><td class="line">273</td><td class="hits">296</td><td class="source">    scope.add(key);</td></tr><tr class="hit"><td class="line">274</td><td class="hits">296</td><td class="source">    body = this.visit(each.block.clone());</td></tr><tr class="hit"><td class="line">275</td><td class="hits">295</td><td class="source">    vals = vals.concat(body.nodes);</td></tr><tr><td class="line">276</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">277</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">278</td><td class="hits">97</td><td class="source">  this.mixin(vals, block);</td></tr><tr class="hit"><td class="line">279</td><td class="hits">97</td><td class="source">  return vals[vals.length - 1] || nodes.null;</td></tr><tr><td class="line">280</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">281</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">282</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">283</td><td class="hits"></td><td class="source"> * Visit Call.</td></tr><tr><td class="line">284</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">285</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">286</td><td class="hits">1</td><td class="source">Evaluator.prototype.visitCall = function(call){</td></tr><tr class="hit"><td class="line">287</td><td class="hits">1334</td><td class="source">  debug('call %s', call);</td></tr><tr class="hit"><td class="line">288</td><td class="hits">1334</td><td class="source">  var fn = this.lookup(call.name)</td></tr><tr><td class="line">289</td><td class="hits"></td><td class="source">    , ret;</td></tr><tr><td class="line">290</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">291</td><td class="hits"></td><td class="source">  // url()</td></tr><tr class="hit"><td class="line">292</td><td class="hits">1334</td><td class="source">  this.ignoreColors = 'url' == call.name;</td></tr><tr><td class="line">293</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">294</td><td class="hits"></td><td class="source">  // Variable function</td></tr><tr class="hit"><td class="line">295</td><td class="hits">1334</td><td class="source">  if (fn &amp;&amp; 'expression' == fn.nodeName) {</td></tr><tr class="hit"><td class="line">296</td><td class="hits">7</td><td class="source">    fn = fn.nodes[0];</td></tr><tr><td class="line">297</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">298</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">299</td><td class="hits"></td><td class="source">  // Not a function? try user-defined or built-ins</td></tr><tr class="hit"><td class="line">300</td><td class="hits">1334</td><td class="source">  if (fn &amp;&amp; 'function' != fn.nodeName) {</td></tr><tr class="hit"><td class="line">301</td><td class="hits">28</td><td class="source">    fn = this.lookupFunction(call.name);</td></tr><tr><td class="line">302</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">303</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">304</td><td class="hits"></td><td class="source">  // Undefined function, render literal css</td></tr><tr class="hit"><td class="line">305</td><td class="hits">1334</td><td class="source">  if (!fn || fn.nodeName != 'function') {</td></tr><tr class="hit"><td class="line">306</td><td class="hits">24</td><td class="source">    debug('%s is undefined', call);</td></tr><tr class="hit"><td class="line">307</td><td class="hits">24</td><td class="source">    var ret = this.literalCall(call);</td></tr><tr class="hit"><td class="line">308</td><td class="hits">24</td><td class="source">    this.ignoreColors = false;</td></tr><tr class="hit"><td class="line">309</td><td class="hits">24</td><td class="source">    return ret;</td></tr><tr><td class="line">310</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">311</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">312</td><td class="hits">1310</td><td class="source">  this.calling.push(call.name);</td></tr><tr><td class="line">313</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">314</td><td class="hits"></td><td class="source">  // Massive stack</td></tr><tr class="hit"><td class="line">315</td><td class="hits">1310</td><td class="source">  if (this.calling.length &gt; 200) {</td></tr><tr class="miss"><td class="line">316</td><td class="hits">0</td><td class="source">    throw new RangeError('Maximum stylus call stack size exceeded');</td></tr><tr><td class="line">317</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">318</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">319</td><td class="hits"></td><td class="source">  // First node in expression</td></tr><tr class="hit"><td class="line">320</td><td class="hits">1310</td><td class="source">  if ('expression' == fn.nodeName) fn = fn.first;</td></tr><tr><td class="line">321</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">322</td><td class="hits"></td><td class="source">  // Evaluate arguments</td></tr><tr class="hit"><td class="line">323</td><td class="hits">1310</td><td class="source">  this.return++;</td></tr><tr class="hit"><td class="line">324</td><td class="hits">1310</td><td class="source">  var args = this.visit(call.args);</td></tr><tr class="hit"><td class="line">325</td><td class="hits">1310</td><td class="source">  for (var key in call.args.map) {</td></tr><tr class="hit"><td class="line">326</td><td class="hits">43</td><td class="source">    call.args.map[key] = this.visit(call.args.map[key]);</td></tr><tr><td class="line">327</td><td class="hits"></td><td class="source">  }</td></tr><tr class="hit"><td class="line">328</td><td class="hits">1310</td><td class="source">  this.return--;</td></tr><tr><td class="line">329</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">330</td><td class="hits"></td><td class="source">  // Built-in</td></tr><tr class="hit"><td class="line">331</td><td class="hits">1310</td><td class="source">  if (fn.fn) {</td></tr><tr class="hit"><td class="line">332</td><td class="hits">666</td><td class="source">    debug('%s is built-in', call);</td></tr><tr class="hit"><td class="line">333</td><td class="hits">666</td><td class="source">    ret = this.invokeBuiltin(fn.fn, args);</td></tr><tr><td class="line">334</td><td class="hits"></td><td class="source">  // User-defined</td></tr><tr class="hit"><td class="line">335</td><td class="hits">644</td><td class="source">  } else if ('function' == fn.nodeName) {</td></tr><tr class="hit"><td class="line">336</td><td class="hits">644</td><td class="source">    debug('%s is user-defined', call);</td></tr><tr class="hit"><td class="line">337</td><td class="hits">644</td><td class="source">    ret = this.invokeFunction(fn, args);</td></tr><tr><td class="line">338</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">339</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">340</td><td class="hits">1310</td><td class="source">  this.calling.pop();</td></tr><tr class="hit"><td class="line">341</td><td class="hits">1310</td><td class="source">  this.ignoreColors = false;</td></tr><tr class="hit"><td class="line">342</td><td class="hits">1310</td><td class="source">  return ret;</td></tr><tr><td class="line">343</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">344</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">345</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">346</td><td class="hits"></td><td class="source"> * Visit Ident.</td></tr><tr><td class="line">347</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">348</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">349</td><td class="hits">1</td><td class="source">Evaluator.prototype.visitIdent = function(ident){</td></tr><tr class="hit"><td class="line">350</td><td class="hits">13935</td><td class="source">  var prop;</td></tr><tr><td class="line">351</td><td class="hits"></td><td class="source">  // Property lookup</td></tr><tr class="hit"><td class="line">352</td><td class="hits">13935</td><td class="source">  if (ident.property) {</td></tr><tr class="hit"><td class="line">353</td><td class="hits">29</td><td class="source">    if (prop = this.lookupProperty(ident.name)) {</td></tr><tr class="hit"><td class="line">354</td><td class="hits">23</td><td class="source">      return this.visit(prop.expr.clone());</td></tr><tr><td class="line">355</td><td class="hits"></td><td class="source">    }</td></tr><tr class="hit"><td class="line">356</td><td class="hits">6</td><td class="source">    return nodes.null;</td></tr><tr><td class="line">357</td><td class="hits"></td><td class="source">  // Lookup</td></tr><tr class="hit"><td class="line">358</td><td class="hits">13906</td><td class="source">  } else if (ident.val.isNull) {</td></tr><tr class="hit"><td class="line">359</td><td class="hits">5121</td><td class="source">    var val = this.lookup(ident.name);</td></tr><tr class="hit"><td class="line">360</td><td class="hits">5121</td><td class="source">    return val ? this.visit(val) : ident;</td></tr><tr><td class="line">361</td><td class="hits"></td><td class="source">  // Assign  </td></tr><tr><td class="line">362</td><td class="hits"></td><td class="source">  } else {</td></tr><tr class="hit"><td class="line">363</td><td class="hits">8785</td><td class="source">    this.return++;</td></tr><tr class="hit"><td class="line">364</td><td class="hits">8785</td><td class="source">    ident.val = this.visit(ident.val);</td></tr><tr class="hit"><td class="line">365</td><td class="hits">8785</td><td class="source">    this.return--;</td></tr><tr class="hit"><td class="line">366</td><td class="hits">8785</td><td class="source">    this.currentScope.add(ident);</td></tr><tr class="hit"><td class="line">367</td><td class="hits">8785</td><td class="source">    return ident.val;</td></tr><tr><td class="line">368</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">369</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">370</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">371</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">372</td><td class="hits"></td><td class="source"> * Visit BinOp.</td></tr><tr><td class="line">373</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">374</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">375</td><td class="hits">1</td><td class="source">Evaluator.prototype.visitBinOp = function(binop){</td></tr><tr><td class="line">376</td><td class="hits"></td><td class="source">  // Special-case &quot;is defined&quot; pseudo binop</td></tr><tr class="hit"><td class="line">377</td><td class="hits">1431</td><td class="source">  if ('is defined' == binop.op) return this.isDefined(binop.left);</td></tr><tr><td class="line">378</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">379</td><td class="hits">1373</td><td class="source">  this.return++;</td></tr><tr><td class="line">380</td><td class="hits"></td><td class="source">  // Visit operands</td></tr><tr class="hit"><td class="line">381</td><td class="hits">1373</td><td class="source">  var op = binop.op</td></tr><tr><td class="line">382</td><td class="hits"></td><td class="source">    , left = this.visit(binop.left)</td></tr><tr><td class="line">383</td><td class="hits"></td><td class="source">    , right = this.visit(binop.right);</td></tr><tr class="hit"><td class="line">384</td><td class="hits">1373</td><td class="source">  this.return--;</td></tr><tr><td class="line">385</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">386</td><td class="hits"></td><td class="source">  // HACK: ternary</td></tr><tr class="hit"><td class="line">387</td><td class="hits">1373</td><td class="source">  var val = binop.val</td></tr><tr><td class="line">388</td><td class="hits"></td><td class="source">    ? this.visit(binop.val)</td></tr><tr><td class="line">389</td><td class="hits"></td><td class="source">    : null;</td></tr><tr><td class="line">390</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">391</td><td class="hits"></td><td class="source">  // Operate</td></tr><tr class="hit"><td class="line">392</td><td class="hits">1373</td><td class="source">  try {</td></tr><tr class="hit"><td class="line">393</td><td class="hits">1373</td><td class="source">    return this.visit(left.operate(op, right, val));</td></tr><tr><td class="line">394</td><td class="hits"></td><td class="source">  } catch (err) {</td></tr><tr><td class="line">395</td><td class="hits"></td><td class="source">    // disregard coercion issues in equality</td></tr><tr><td class="line">396</td><td class="hits"></td><td class="source">    // checks, and simply return false</td></tr><tr class="hit"><td class="line">397</td><td class="hits">7</td><td class="source">    if ('CoercionError' == err.name) {</td></tr><tr class="hit"><td class="line">398</td><td class="hits">7</td><td class="source">      switch (op) {</td></tr><tr><td class="line">399</td><td class="hits"></td><td class="source">        case '==':</td></tr><tr class="hit"><td class="line">400</td><td class="hits">6</td><td class="source">          return nodes.false;</td></tr><tr><td class="line">401</td><td class="hits"></td><td class="source">        case '!=':</td></tr><tr class="hit"><td class="line">402</td><td class="hits">1</td><td class="source">          return nodes.true;</td></tr><tr><td class="line">403</td><td class="hits"></td><td class="source">      }</td></tr><tr><td class="line">404</td><td class="hits"></td><td class="source">    }</td></tr><tr class="miss"><td class="line">405</td><td class="hits">0</td><td class="source">    throw err;</td></tr><tr><td class="line">406</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">407</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">408</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">409</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">410</td><td class="hits"></td><td class="source"> * Visit UnaryOp.</td></tr><tr><td class="line">411</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">412</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">413</td><td class="hits">1</td><td class="source">Evaluator.prototype.visitUnaryOp = function(unary){</td></tr><tr class="hit"><td class="line">414</td><td class="hits">143</td><td class="source">  var op = unary.op</td></tr><tr><td class="line">415</td><td class="hits"></td><td class="source">    , node = this.visit(unary.expr);</td></tr><tr><td class="line">416</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">417</td><td class="hits">143</td><td class="source">  if ('!' != op) {</td></tr><tr class="hit"><td class="line">418</td><td class="hits">36</td><td class="source">    node = node.first.clone();</td></tr><tr class="hit"><td class="line">419</td><td class="hits">36</td><td class="source">    utils.assertType(node, 'unit');</td></tr><tr><td class="line">420</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">421</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">422</td><td class="hits">143</td><td class="source">  switch (op) {</td></tr><tr><td class="line">423</td><td class="hits"></td><td class="source">    case '-':</td></tr><tr class="hit"><td class="line">424</td><td class="hits">35</td><td class="source">      node.val = -node.val;</td></tr><tr class="hit"><td class="line">425</td><td class="hits">35</td><td class="source">      break;</td></tr><tr><td class="line">426</td><td class="hits"></td><td class="source">    case '+':</td></tr><tr class="miss"><td class="line">427</td><td class="hits">0</td><td class="source">      node.val = +node.val;</td></tr><tr class="miss"><td class="line">428</td><td class="hits">0</td><td class="source">      break;</td></tr><tr><td class="line">429</td><td class="hits"></td><td class="source">    case '~':</td></tr><tr class="hit"><td class="line">430</td><td class="hits">1</td><td class="source">      node.val = ~node.val;</td></tr><tr class="hit"><td class="line">431</td><td class="hits">1</td><td class="source">      break;</td></tr><tr><td class="line">432</td><td class="hits"></td><td class="source">    case '!':</td></tr><tr class="hit"><td class="line">433</td><td class="hits">107</td><td class="source">      return node.toBoolean().negate();</td></tr><tr><td class="line">434</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">435</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">436</td><td class="hits">36</td><td class="source">  return node;</td></tr><tr><td class="line">437</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">438</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">439</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">440</td><td class="hits"></td><td class="source"> * Visit TernaryOp.</td></tr><tr><td class="line">441</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">442</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">443</td><td class="hits">1</td><td class="source">Evaluator.prototype.visitTernary = function(ternary){</td></tr><tr class="hit"><td class="line">444</td><td class="hits">123</td><td class="source">  var ok = this.visit(ternary.cond).toBoolean();</td></tr><tr class="hit"><td class="line">445</td><td class="hits">123</td><td class="source">  return ok.isTrue</td></tr><tr><td class="line">446</td><td class="hits"></td><td class="source">    ? this.visit(ternary.trueExpr)</td></tr><tr><td class="line">447</td><td class="hits"></td><td class="source">    : this.visit(ternary.falseExpr);</td></tr><tr><td class="line">448</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">449</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">450</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">451</td><td class="hits"></td><td class="source"> * Visit Expression.</td></tr><tr><td class="line">452</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">453</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">454</td><td class="hits">1</td><td class="source">Evaluator.prototype.visitExpression = function(expr){</td></tr><tr class="hit"><td class="line">455</td><td class="hits">12657</td><td class="source">  for (var i = 0, len = expr.nodes.length; i &lt; len; ++i) {</td></tr><tr class="hit"><td class="line">456</td><td class="hits">16795</td><td class="source">    expr.nodes[i] = this.visit(expr.nodes[i]);</td></tr><tr><td class="line">457</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">458</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">459</td><td class="hits"></td><td class="source">  // support (n * 5)px etc</td></tr><tr class="hit"><td class="line">460</td><td class="hits">12666</td><td class="source">  if (this.castable(expr)) expr = this.cast(expr);</td></tr><tr><td class="line">461</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">462</td><td class="hits">12657</td><td class="source">  return expr;</td></tr><tr><td class="line">463</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">464</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">465</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">466</td><td class="hits"></td><td class="source"> * Visit Arguments.</td></tr><tr><td class="line">467</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">468</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">469</td><td class="hits">1</td><td class="source">Evaluator.prototype.visitArguments = Evaluator.prototype.visitExpression;</td></tr><tr><td class="line">470</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">471</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">472</td><td class="hits"></td><td class="source"> * Visit Property.</td></tr><tr><td class="line">473</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">474</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">475</td><td class="hits">1</td><td class="source">Evaluator.prototype.visitProperty = function(prop){</td></tr><tr class="hit"><td class="line">476</td><td class="hits">2484</td><td class="source">  var name = this.interpolate(prop)</td></tr><tr><td class="line">477</td><td class="hits"></td><td class="source">    , fn = this.lookup(name)</td></tr><tr><td class="line">478</td><td class="hits"></td><td class="source">    , call = fn &amp;&amp; 'function' == fn.nodeName</td></tr><tr><td class="line">479</td><td class="hits"></td><td class="source">    , literal = ~this.calling.indexOf(name);</td></tr><tr><td class="line">480</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">481</td><td class="hits"></td><td class="source">  // Function of the same name</td></tr><tr class="hit"><td class="line">482</td><td class="hits">2484</td><td class="source">  if (call &amp;&amp; !literal &amp;&amp; !prop.literal) {</td></tr><tr class="hit"><td class="line">483</td><td class="hits">42</td><td class="source">    this.calling.push(name);</td></tr><tr class="hit"><td class="line">484</td><td class="hits">42</td><td class="source">    var args = nodes.Arguments.fromExpression(utils.unwrap(prop.expr));</td></tr><tr class="hit"><td class="line">485</td><td class="hits">42</td><td class="source">    var ret = this.visit(new nodes.Call(name, args));</td></tr><tr class="hit"><td class="line">486</td><td class="hits">42</td><td class="source">    this.calling.pop();</td></tr><tr class="hit"><td class="line">487</td><td class="hits">42</td><td class="source">    return ret;</td></tr><tr><td class="line">488</td><td class="hits"></td><td class="source">  // Regular property</td></tr><tr><td class="line">489</td><td class="hits"></td><td class="source">  } else {</td></tr><tr class="hit"><td class="line">490</td><td class="hits">2442</td><td class="source">    this.return++;</td></tr><tr class="hit"><td class="line">491</td><td class="hits">2442</td><td class="source">    prop.name = name;</td></tr><tr class="hit"><td class="line">492</td><td class="hits">2442</td><td class="source">    prop.literal = true;</td></tr><tr class="hit"><td class="line">493</td><td class="hits">2442</td><td class="source">    this.property = prop;</td></tr><tr class="hit"><td class="line">494</td><td class="hits">2442</td><td class="source">    prop.expr = this.visit(prop.expr);</td></tr><tr class="hit"><td class="line">495</td><td class="hits">2442</td><td class="source">    delete this.property;</td></tr><tr class="hit"><td class="line">496</td><td class="hits">2442</td><td class="source">    this.return--;</td></tr><tr class="hit"><td class="line">497</td><td class="hits">2442</td><td class="source">    return prop;</td></tr><tr><td class="line">498</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">499</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">500</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">501</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">502</td><td class="hits"></td><td class="source"> * Visit Root.</td></tr><tr><td class="line">503</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">504</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">505</td><td class="hits">1</td><td class="source">Evaluator.prototype.visitRoot = function(block){</td></tr><tr class="hit"><td class="line">506</td><td class="hits">208</td><td class="source">  for (var i = 0; i &lt; block.nodes.length; ++i) {</td></tr><tr class="hit"><td class="line">507</td><td class="hits">1363</td><td class="source">    block.index = this.rootIndex = i;</td></tr><tr class="hit"><td class="line">508</td><td class="hits">1363</td><td class="source">    block.nodes[i] = this.visit(block.nodes[i]);</td></tr><tr><td class="line">509</td><td class="hits"></td><td class="source">  }</td></tr><tr class="hit"><td class="line">510</td><td class="hits">208</td><td class="source">  return block;</td></tr><tr><td class="line">511</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">512</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">513</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">514</td><td class="hits"></td><td class="source"> * Visit Block.</td></tr><tr><td class="line">515</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">516</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">517</td><td class="hits">1</td><td class="source">Evaluator.prototype.visitBlock = function(block){</td></tr><tr class="hit"><td class="line">518</td><td class="hits">2029</td><td class="source">  this.stack.push(new Frame(block));</td></tr><tr class="hit"><td class="line">519</td><td class="hits">2029</td><td class="source">  for (block.index = 0; block.index &lt; block.nodes.length; ++block.index) {</td></tr><tr class="hit"><td class="line">520</td><td class="hits">11518</td><td class="source">    try {</td></tr><tr class="hit"><td class="line">521</td><td class="hits">11518</td><td class="source">      block.nodes[block.index] = this.visit(block.nodes[block.index]);</td></tr><tr><td class="line">522</td><td class="hits"></td><td class="source">    } catch (err) {</td></tr><tr class="hit"><td class="line">523</td><td class="hits">7</td><td class="source">      if ('return' == err.nodeName) {</td></tr><tr class="hit"><td class="line">524</td><td class="hits">7</td><td class="source">        if (this.return) {</td></tr><tr class="hit"><td class="line">525</td><td class="hits">5</td><td class="source">          this.stack.pop();</td></tr><tr class="hit"><td class="line">526</td><td class="hits">5</td><td class="source">          throw err;</td></tr><tr><td class="line">527</td><td class="hits"></td><td class="source">        } else {</td></tr><tr class="hit"><td class="line">528</td><td class="hits">2</td><td class="source">          block.nodes[block.index] = err;</td></tr><tr class="hit"><td class="line">529</td><td class="hits">2</td><td class="source">          break;</td></tr><tr><td class="line">530</td><td class="hits"></td><td class="source">        }</td></tr><tr><td class="line">531</td><td class="hits"></td><td class="source">      } else {</td></tr><tr class="miss"><td class="line">532</td><td class="hits">0</td><td class="source">        throw err;</td></tr><tr><td class="line">533</td><td class="hits"></td><td class="source">      }</td></tr><tr><td class="line">534</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">535</td><td class="hits"></td><td class="source">  }</td></tr><tr class="hit"><td class="line">536</td><td class="hits">2024</td><td class="source">  this.stack.pop();</td></tr><tr class="hit"><td class="line">537</td><td class="hits">2024</td><td class="source">  return block;</td></tr><tr><td class="line">538</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">539</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">540</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">541</td><td class="hits"></td><td class="source"> * Visit If.</td></tr><tr><td class="line">542</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">543</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">544</td><td class="hits">1</td><td class="source">Evaluator.prototype.visitIf = function(node){</td></tr><tr class="hit"><td class="line">545</td><td class="hits">381</td><td class="source">  var ret</td></tr><tr><td class="line">546</td><td class="hits"></td><td class="source">    , block = this.currentBlock</td></tr><tr><td class="line">547</td><td class="hits"></td><td class="source">    , negate = node.negate;</td></tr><tr><td class="line">548</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">549</td><td class="hits">381</td><td class="source">  this.return++;</td></tr><tr class="hit"><td class="line">550</td><td class="hits">381</td><td class="source">  var ok = this.visit(node.cond).first.toBoolean();</td></tr><tr class="hit"><td class="line">551</td><td class="hits">381</td><td class="source">  this.return--;</td></tr><tr><td class="line">552</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">553</td><td class="hits"></td><td class="source">  // Evaluate body</td></tr><tr class="hit"><td class="line">554</td><td class="hits">381</td><td class="source">  if (negate) {</td></tr><tr><td class="line">555</td><td class="hits"></td><td class="source">    // unless</td></tr><tr class="hit"><td class="line">556</td><td class="hits">154</td><td class="source">    if (ok.isFalse) {</td></tr><tr class="hit"><td class="line">557</td><td class="hits">15</td><td class="source">      ret = this.visit(node.block);</td></tr><tr><td class="line">558</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">559</td><td class="hits"></td><td class="source">  } else {</td></tr><tr><td class="line">560</td><td class="hits"></td><td class="source">    // if</td></tr><tr class="hit"><td class="line">561</td><td class="hits">227</td><td class="source">    if (ok.isTrue) {</td></tr><tr class="hit"><td class="line">562</td><td class="hits">124</td><td class="source">      ret = this.visit(node.block);</td></tr><tr><td class="line">563</td><td class="hits"></td><td class="source">    // else</td></tr><tr class="hit"><td class="line">564</td><td class="hits">103</td><td class="source">    } else if (node.elses.length) {</td></tr><tr class="hit"><td class="line">565</td><td class="hits">39</td><td class="source">      var elses = node.elses</td></tr><tr><td class="line">566</td><td class="hits"></td><td class="source">        , len = elses.length;</td></tr><tr class="hit"><td class="line">567</td><td class="hits">39</td><td class="source">      for (var i = 0; i &lt; len; ++i) {</td></tr><tr><td class="line">568</td><td class="hits"></td><td class="source">        // else if</td></tr><tr class="hit"><td class="line">569</td><td class="hits">46</td><td class="source">        if (elses[i].cond) {</td></tr><tr class="hit"><td class="line">570</td><td class="hits">18</td><td class="source">          if (this.visit(elses[i].cond).first.toBoolean().isTrue) {</td></tr><tr class="hit"><td class="line">571</td><td class="hits">8</td><td class="source">            ret = this.visit(elses[i].block);</td></tr><tr class="hit"><td class="line">572</td><td class="hits">8</td><td class="source">            break;</td></tr><tr><td class="line">573</td><td class="hits"></td><td class="source">          }</td></tr><tr><td class="line">574</td><td class="hits"></td><td class="source">        // else </td></tr><tr><td class="line">575</td><td class="hits"></td><td class="source">        } else {</td></tr><tr class="hit"><td class="line">576</td><td class="hits">28</td><td class="source">          ret = this.visit(elses[i]);</td></tr><tr><td class="line">577</td><td class="hits"></td><td class="source">        }</td></tr><tr><td class="line">578</td><td class="hits"></td><td class="source">      }</td></tr><tr><td class="line">579</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">580</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">581</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">582</td><td class="hits"></td><td class="source">  // mixin conditional statements within a selector group</td></tr><tr class="hit"><td class="line">583</td><td class="hits">365</td><td class="source">  if (ret &amp;&amp; !node.postfix &amp;&amp; block.node &amp;&amp; 'group' == block.node.nodeName) {</td></tr><tr class="hit"><td class="line">584</td><td class="hits">10</td><td class="source">    this.mixin(ret.nodes, block);</td></tr><tr class="hit"><td class="line">585</td><td class="hits">10</td><td class="source">    return nodes.null;</td></tr><tr><td class="line">586</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">587</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">588</td><td class="hits">355</td><td class="source">  return ret || nodes.null;</td></tr><tr><td class="line">589</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">590</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">591</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">592</td><td class="hits"></td><td class="source"> * Visit Extend.</td></tr><tr><td class="line">593</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">594</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">595</td><td class="hits">1</td><td class="source">Evaluator.prototype.visitExtend = function(extend){</td></tr><tr class="hit"><td class="line">596</td><td class="hits">13</td><td class="source">  var selector = extend.selector;</td></tr><tr class="hit"><td class="line">597</td><td class="hits">13</td><td class="source">  this.currentBlock.node.extends.push(selector);</td></tr><tr class="hit"><td class="line">598</td><td class="hits">13</td><td class="source">  return nodes.null; </td></tr><tr><td class="line">599</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">600</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">601</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">602</td><td class="hits"></td><td class="source"> * Visit Import.</td></tr><tr><td class="line">603</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">604</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">605</td><td class="hits">1</td><td class="source">Evaluator.prototype.visitImport = function(imported){</td></tr><tr class="hit"><td class="line">606</td><td class="hits">229</td><td class="source">  this.return++;</td></tr><tr><td class="line">607</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">608</td><td class="hits">229</td><td class="source">  var root = this.root</td></tr><tr><td class="line">609</td><td class="hits"></td><td class="source">    , Parser = require('../parser')</td></tr><tr><td class="line">610</td><td class="hits"></td><td class="source">    , path = this.visit(imported.path).first</td></tr><tr><td class="line">611</td><td class="hits"></td><td class="source">    , includeCSS = this.includeCSS</td></tr><tr><td class="line">612</td><td class="hits"></td><td class="source">    , found</td></tr><tr><td class="line">613</td><td class="hits"></td><td class="source">    , literal;</td></tr><tr><td class="line">614</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">615</td><td class="hits">229</td><td class="source">  this.return--;</td></tr><tr class="hit"><td class="line">616</td><td class="hits">229</td><td class="source">  debug('import %s', path);</td></tr><tr><td class="line">617</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">618</td><td class="hits"></td><td class="source">  // url() passed</td></tr><tr class="hit"><td class="line">619</td><td class="hits">229</td><td class="source">  if ('url' == path.name) return imported;</td></tr><tr><td class="line">620</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">621</td><td class="hits"></td><td class="source">  // Enusre string</td></tr><tr class="hit"><td class="line">622</td><td class="hits">229</td><td class="source">  if (!path.string) throw new Error('@import string expected');</td></tr><tr class="hit"><td class="line">623</td><td class="hits">229</td><td class="source">  var name = path = path.string;</td></tr><tr><td class="line">624</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">625</td><td class="hits"></td><td class="source">  // Literal</td></tr><tr class="hit"><td class="line">626</td><td class="hits">229</td><td class="source">  if (~path.indexOf('.css')) {</td></tr><tr class="hit"><td class="line">627</td><td class="hits">7</td><td class="source">    literal = true;</td></tr><tr class="hit"><td class="line">628</td><td class="hits">14</td><td class="source">    if (!includeCSS) return imported;</td></tr><tr><td class="line">629</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">630</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">631</td><td class="hits"></td><td class="source">  // support optional .styl</td></tr><tr class="hit"><td class="line">632</td><td class="hits">444</td><td class="source">  if (!literal &amp;&amp; !~path.indexOf('.styl')) path += '.styl';</td></tr><tr><td class="line">633</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">634</td><td class="hits"></td><td class="source">  // Lookup</td></tr><tr class="hit"><td class="line">635</td><td class="hits">222</td><td class="source">  found = utils.lookup(path, this.paths, this.filename);</td></tr><tr class="hit"><td class="line">636</td><td class="hits">222</td><td class="source">  found = found || utils.lookup(join(name, 'index.styl'), this.paths, this.filename);</td></tr><tr><td class="line">637</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">638</td><td class="hits"></td><td class="source">  // Expose imports</td></tr><tr class="hit"><td class="line">639</td><td class="hits">222</td><td class="source">  imported.path = found;</td></tr><tr class="hit"><td class="line">640</td><td class="hits">222</td><td class="source">  imported.dirname = dirname(found);</td></tr><tr class="hit"><td class="line">641</td><td class="hits">222</td><td class="source">  this.paths.push(imported.dirname);</td></tr><tr class="hit"><td class="line">642</td><td class="hits">222</td><td class="source">  if (this.options._imports) this.options._imports.push(imported);</td></tr><tr><td class="line">643</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">644</td><td class="hits"></td><td class="source">  // Throw if import failed</td></tr><tr class="hit"><td class="line">645</td><td class="hits">222</td><td class="source">  if (!found) throw new Error('failed to locate @import file ' + path);</td></tr><tr><td class="line">646</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">647</td><td class="hits"></td><td class="source">  // Parse the file</td></tr><tr class="hit"><td class="line">648</td><td class="hits">222</td><td class="source">  this.importStack.push(found);</td></tr><tr class="hit"><td class="line">649</td><td class="hits">222</td><td class="source">  nodes.filename = found;</td></tr><tr><td class="line">650</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">651</td><td class="hits">222</td><td class="source">  var str = fs.readFileSync(found, 'utf8');</td></tr><tr class="hit"><td class="line">652</td><td class="hits">222</td><td class="source">  if (literal) return new nodes.Literal(str);</td></tr><tr><td class="line">653</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">654</td><td class="hits"></td><td class="source">  // parse</td></tr><tr class="hit"><td class="line">655</td><td class="hits">222</td><td class="source">  var block = new nodes.Block</td></tr><tr><td class="line">656</td><td class="hits"></td><td class="source">    , parser = new Parser(str, utils.merge({ root: block }, this.options));</td></tr><tr><td class="line">657</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">658</td><td class="hits">222</td><td class="source">  try {</td></tr><tr class="hit"><td class="line">659</td><td class="hits">222</td><td class="source">    block = parser.parse();</td></tr><tr><td class="line">660</td><td class="hits"></td><td class="source">  } catch (err) {</td></tr><tr class="miss"><td class="line">661</td><td class="hits">0</td><td class="source">    err.filename = found;</td></tr><tr class="miss"><td class="line">662</td><td class="hits">0</td><td class="source">    err.lineno = parser.lexer.lineno;</td></tr><tr class="miss"><td class="line">663</td><td class="hits">0</td><td class="source">    err.input = str;</td></tr><tr class="miss"><td class="line">664</td><td class="hits">0</td><td class="source">    throw err;</td></tr><tr><td class="line">665</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">666</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">667</td><td class="hits"></td><td class="source">  // Store the modified time</td></tr><tr class="hit"><td class="line">668</td><td class="hits">222</td><td class="source">  fs.stat(found, function(err, stat){</td></tr><tr class="hit"><td class="line">669</td><td class="hits">222</td><td class="source">    if (err) return;</td></tr><tr class="hit"><td class="line">670</td><td class="hits">222</td><td class="source">    imported.mtime = stat.mtime;</td></tr><tr><td class="line">671</td><td class="hits"></td><td class="source">  });</td></tr><tr><td class="line">672</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">673</td><td class="hits"></td><td class="source">  // Evaluate imported &quot;root&quot;</td></tr><tr class="hit"><td class="line">674</td><td class="hits">222</td><td class="source">  block.parent = root;</td></tr><tr class="hit"><td class="line">675</td><td class="hits">222</td><td class="source">  block.scope = false;</td></tr><tr class="hit"><td class="line">676</td><td class="hits">222</td><td class="source">  var ret = this.visit(block);</td></tr><tr class="hit"><td class="line">677</td><td class="hits">222</td><td class="source">  this.paths.pop();</td></tr><tr class="hit"><td class="line">678</td><td class="hits">222</td><td class="source">  this.importStack.pop();</td></tr><tr><td class="line">679</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">680</td><td class="hits">222</td><td class="source">  return ret;</td></tr><tr><td class="line">681</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">682</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">683</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">684</td><td class="hits"></td><td class="source"> * Invoke `fn` with `args`.</td></tr><tr><td class="line">685</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">686</td><td class="hits"></td><td class="source"> * @param {Function} fn</td></tr><tr><td class="line">687</td><td class="hits"></td><td class="source"> * @param {Array} args</td></tr><tr><td class="line">688</td><td class="hits"></td><td class="source"> * @return {Node}</td></tr><tr><td class="line">689</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">690</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">691</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">692</td><td class="hits">1</td><td class="source">Evaluator.prototype.invokeFunction = function(fn, args){</td></tr><tr class="hit"><td class="line">693</td><td class="hits">644</td><td class="source">  var block = new nodes.Block(fn.block.parent);</td></tr><tr class="hit"><td class="line">694</td><td class="hits">644</td><td class="source">  fn.block.parent = block;</td></tr><tr><td class="line">695</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">696</td><td class="hits"></td><td class="source">  // Clone the function body</td></tr><tr><td class="line">697</td><td class="hits"></td><td class="source">  // to prevent mutation of subsequent calls</td></tr><tr class="hit"><td class="line">698</td><td class="hits">644</td><td class="source">  var body = fn.block.clone();</td></tr><tr><td class="line">699</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">700</td><td class="hits"></td><td class="source">  // mixin block</td></tr><tr class="hit"><td class="line">701</td><td class="hits">644</td><td class="source">  var mixinBlock = this.stack.currentFrame.block;</td></tr><tr><td class="line">702</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">703</td><td class="hits"></td><td class="source">  // new block scope</td></tr><tr class="hit"><td class="line">704</td><td class="hits">644</td><td class="source">  this.stack.push(new Frame(block));</td></tr><tr class="hit"><td class="line">705</td><td class="hits">644</td><td class="source">  var scope = this.currentScope;</td></tr><tr><td class="line">706</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">707</td><td class="hits"></td><td class="source">  // arguments local</td></tr><tr class="hit"><td class="line">708</td><td class="hits">644</td><td class="source">  scope.add(new nodes.Ident('arguments', args));</td></tr><tr><td class="line">709</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">710</td><td class="hits"></td><td class="source">  // mixin scope introspection</td></tr><tr class="hit"><td class="line">711</td><td class="hits">644</td><td class="source">  scope.add(new nodes.Ident('mixin', this.return</td></tr><tr><td class="line">712</td><td class="hits"></td><td class="source">    ? nodes.false</td></tr><tr><td class="line">713</td><td class="hits"></td><td class="source">    : new nodes.String(mixinBlock.nodeName)));</td></tr><tr><td class="line">714</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">715</td><td class="hits"></td><td class="source">  // current property</td></tr><tr class="hit"><td class="line">716</td><td class="hits">644</td><td class="source">  if (this.property) {</td></tr><tr class="hit"><td class="line">717</td><td class="hits">438</td><td class="source">    var prop = this.propertyExpression(this.property, fn.name);</td></tr><tr class="hit"><td class="line">718</td><td class="hits">438</td><td class="source">    scope.add(new nodes.Ident('current-property', prop));</td></tr><tr><td class="line">719</td><td class="hits"></td><td class="source">  } else {</td></tr><tr class="hit"><td class="line">720</td><td class="hits">206</td><td class="source">    scope.add(new nodes.Ident('current-property', nodes.null));</td></tr><tr><td class="line">721</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">722</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">723</td><td class="hits"></td><td class="source">  // inject arguments as locals</td></tr><tr class="hit"><td class="line">724</td><td class="hits">644</td><td class="source">  var i = 0</td></tr><tr><td class="line">725</td><td class="hits"></td><td class="source">    , len = args.nodes.length;</td></tr><tr class="hit"><td class="line">726</td><td class="hits">644</td><td class="source">  fn.params.nodes.forEach(function(node){</td></tr><tr><td class="line">727</td><td class="hits"></td><td class="source">    // rest param support</td></tr><tr class="hit"><td class="line">728</td><td class="hits">804</td><td class="source">    if (node.rest) {</td></tr><tr class="hit"><td class="line">729</td><td class="hits">58</td><td class="source">      node.val = new nodes.Expression;</td></tr><tr class="hit"><td class="line">730</td><td class="hits">193</td><td class="source">      for (; i &lt; len; ++i) node.val.push(args.nodes[i]);</td></tr><tr class="hit"><td class="line">731</td><td class="hits">58</td><td class="source">      node.val.preserve = true;</td></tr><tr><td class="line">732</td><td class="hits"></td><td class="source">    // argument default support</td></tr><tr><td class="line">733</td><td class="hits"></td><td class="source">    } else {</td></tr><tr class="hit"><td class="line">734</td><td class="hits">746</td><td class="source">      var arg = args.map[node.name] || args.nodes[i++];</td></tr><tr class="hit"><td class="line">735</td><td class="hits">746</td><td class="source">      node = node.clone();</td></tr><tr class="hit"><td class="line">736</td><td class="hits">746</td><td class="source">      if (arg) {</td></tr><tr class="hit"><td class="line">737</td><td class="hits">1438</td><td class="source">        if (!arg.isEmpty) node.val = arg;</td></tr><tr><td class="line">738</td><td class="hits"></td><td class="source">      } else {</td></tr><tr class="hit"><td class="line">739</td><td class="hits">19</td><td class="source">        args.push(node.val);</td></tr><tr><td class="line">740</td><td class="hits"></td><td class="source">      }</td></tr><tr><td class="line">741</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">742</td><td class="hits"></td><td class="source">      // required argument not satisfied</td></tr><tr class="hit"><td class="line">743</td><td class="hits">746</td><td class="source">      if (node.val.isNull) {</td></tr><tr class="miss"><td class="line">744</td><td class="hits">0</td><td class="source">        throw new Error('argument &quot;' + node + '&quot; required for ' + fn);</td></tr><tr><td class="line">745</td><td class="hits"></td><td class="source">      }</td></tr><tr><td class="line">746</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">747</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">748</td><td class="hits">804</td><td class="source">    scope.add(node);</td></tr><tr><td class="line">749</td><td class="hits"></td><td class="source">  });</td></tr><tr><td class="line">750</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">751</td><td class="hits"></td><td class="source">  // invoke</td></tr><tr class="hit"><td class="line">752</td><td class="hits">644</td><td class="source">  return this.invoke(body, true);</td></tr><tr><td class="line">753</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">754</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">755</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">756</td><td class="hits"></td><td class="source"> * Invoke built-in `fn` with `args`.</td></tr><tr><td class="line">757</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">758</td><td class="hits"></td><td class="source"> * @param {Function} fn</td></tr><tr><td class="line">759</td><td class="hits"></td><td class="source"> * @param {Array} args</td></tr><tr><td class="line">760</td><td class="hits"></td><td class="source"> * @return {Node}</td></tr><tr><td class="line">761</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">762</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">763</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">764</td><td class="hits">1</td><td class="source">Evaluator.prototype.invokeBuiltin = function(fn, args){</td></tr><tr><td class="line">765</td><td class="hits"></td><td class="source">  // Map arguments to first node</td></tr><tr><td class="line">766</td><td class="hits"></td><td class="source">  // providing a nicer js api for</td></tr><tr><td class="line">767</td><td class="hits"></td><td class="source">  // BIFs. Functions may specify that</td></tr><tr><td class="line">768</td><td class="hits"></td><td class="source">  // they wish to accept full expressions</td></tr><tr><td class="line">769</td><td class="hits"></td><td class="source">  // via .raw</td></tr><tr class="hit"><td class="line">770</td><td class="hits">666</td><td class="source">  if (fn.raw) {</td></tr><tr class="hit"><td class="line">771</td><td class="hits">159</td><td class="source">    args = args.nodes;</td></tr><tr><td class="line">772</td><td class="hits"></td><td class="source">  } else {</td></tr><tr class="hit"><td class="line">773</td><td class="hits">507</td><td class="source">    args = utils.params(fn).reduce(function(ret, param){</td></tr><tr class="hit"><td class="line">774</td><td class="hits">942</td><td class="source">      var arg = args.map[param] || args.nodes.shift();</td></tr><tr class="hit"><td class="line">775</td><td class="hits">1789</td><td class="source">      if (arg) ret.push(arg.first);</td></tr><tr class="hit"><td class="line">776</td><td class="hits">942</td><td class="source">      return ret;</td></tr><tr><td class="line">777</td><td class="hits"></td><td class="source">    }, []);</td></tr><tr><td class="line">778</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">779</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">780</td><td class="hits"></td><td class="source">  // Invoke the BIF</td></tr><tr class="hit"><td class="line">781</td><td class="hits">666</td><td class="source">  var body = utils.coerce(fn.apply(this, args));</td></tr><tr><td class="line">782</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">783</td><td class="hits"></td><td class="source">  // Always wrapping allows js functions</td></tr><tr><td class="line">784</td><td class="hits"></td><td class="source">  // to return several values with a single</td></tr><tr><td class="line">785</td><td class="hits"></td><td class="source">  // Expression node</td></tr><tr class="hit"><td class="line">786</td><td class="hits">666</td><td class="source">  var expr = new nodes.Expression;</td></tr><tr class="hit"><td class="line">787</td><td class="hits">666</td><td class="source">  expr.push(body);</td></tr><tr class="hit"><td class="line">788</td><td class="hits">666</td><td class="source">  body = expr;</td></tr><tr><td class="line">789</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">790</td><td class="hits"></td><td class="source">  // Invoke</td></tr><tr class="hit"><td class="line">791</td><td class="hits">666</td><td class="source">  return this.invoke(body);</td></tr><tr><td class="line">792</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">793</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">794</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">795</td><td class="hits"></td><td class="source"> * Invoke the given function `body`.</td></tr><tr><td class="line">796</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">797</td><td class="hits"></td><td class="source"> * @param {Block} body</td></tr><tr><td class="line">798</td><td class="hits"></td><td class="source"> * @return {Node}</td></tr><tr><td class="line">799</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">800</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">801</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">802</td><td class="hits">1</td><td class="source">Evaluator.prototype.invoke = function(body, stack){</td></tr><tr class="hit"><td class="line">803</td><td class="hits">1310</td><td class="source">  var self = this</td></tr><tr><td class="line">804</td><td class="hits"></td><td class="source">    , ret;</td></tr><tr><td class="line">805</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">806</td><td class="hits"></td><td class="source">  // Return</td></tr><tr class="hit"><td class="line">807</td><td class="hits">1310</td><td class="source">  if (this.return) {</td></tr><tr class="hit"><td class="line">808</td><td class="hits">1118</td><td class="source">    ret = this.eval(body.nodes);</td></tr><tr class="hit"><td class="line">809</td><td class="hits">1575</td><td class="source">    if (stack) this.stack.pop();</td></tr><tr><td class="line">810</td><td class="hits"></td><td class="source">  // Mixin</td></tr><tr><td class="line">811</td><td class="hits"></td><td class="source">  } else {</td></tr><tr class="hit"><td class="line">812</td><td class="hits">192</td><td class="source">    var targetFrame = this.stack[this.stack.length - 2];</td></tr><tr class="hit"><td class="line">813</td><td class="hits">380</td><td class="source">    if (targetFrame) this.targetBlock = targetFrame.block;</td></tr><tr class="hit"><td class="line">814</td><td class="hits">192</td><td class="source">    body = this.visit(body);</td></tr><tr class="hit"><td class="line">815</td><td class="hits">379</td><td class="source">    if (stack) this.stack.pop();</td></tr><tr class="hit"><td class="line">816</td><td class="hits">192</td><td class="source">    this.mixin(body.nodes, this.currentBlock);</td></tr><tr class="hit"><td class="line">817</td><td class="hits">192</td><td class="source">    ret = nodes.null;</td></tr><tr><td class="line">818</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">819</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">820</td><td class="hits">1310</td><td class="source">  return ret;</td></tr><tr><td class="line">821</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">822</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">823</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">824</td><td class="hits"></td><td class="source"> * Mixin the given `nodes` to the given `block`.</td></tr><tr><td class="line">825</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">826</td><td class="hits"></td><td class="source"> * @param {Array} nodes</td></tr><tr><td class="line">827</td><td class="hits"></td><td class="source"> * @param {Block} block</td></tr><tr><td class="line">828</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">829</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">830</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">831</td><td class="hits">1</td><td class="source">Evaluator.prototype.mixin = function(nodes, block){</td></tr><tr class="hit"><td class="line">832</td><td class="hits">299</td><td class="source">  var len = block.nodes.length</td></tr><tr><td class="line">833</td><td class="hits"></td><td class="source">    , head = block.nodes.slice(0, block.index)</td></tr><tr><td class="line">834</td><td class="hits"></td><td class="source">    , tail = block.nodes.slice(block.index + 1, len);</td></tr><tr class="hit"><td class="line">835</td><td class="hits">299</td><td class="source">  this._mixin(nodes, head);</td></tr><tr class="hit"><td class="line">836</td><td class="hits">299</td><td class="source">  block.nodes = head.concat(tail);</td></tr><tr><td class="line">837</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">838</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">839</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">840</td><td class="hits"></td><td class="source"> * Mixin the given `nodes` to the `dest` array.</td></tr><tr><td class="line">841</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">842</td><td class="hits"></td><td class="source"> * @param {Array} nodes</td></tr><tr><td class="line">843</td><td class="hits"></td><td class="source"> * @param {Array} dest</td></tr><tr><td class="line">844</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">845</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">846</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">847</td><td class="hits">1</td><td class="source">Evaluator.prototype._mixin = function(nodes, dest){</td></tr><tr class="hit"><td class="line">848</td><td class="hits">365</td><td class="source">  var node</td></tr><tr><td class="line">849</td><td class="hits"></td><td class="source">    , len = nodes.length;</td></tr><tr class="hit"><td class="line">850</td><td class="hits">365</td><td class="source">  for (var i = 0; i &lt; len; ++i) {</td></tr><tr class="hit"><td class="line">851</td><td class="hits">821</td><td class="source">    switch ((node = nodes[i]).nodeName) {</td></tr><tr><td class="line">852</td><td class="hits"></td><td class="source">      case 'return':</td></tr><tr class="hit"><td class="line">853</td><td class="hits">2</td><td class="source">        return;</td></tr><tr><td class="line">854</td><td class="hits"></td><td class="source">      case 'block':</td></tr><tr class="hit"><td class="line">855</td><td class="hits">66</td><td class="source">        this._mixin(node.nodes, dest);</td></tr><tr class="hit"><td class="line">856</td><td class="hits">66</td><td class="source">        break;</td></tr><tr><td class="line">857</td><td class="hits"></td><td class="source">      default:</td></tr><tr class="hit"><td class="line">858</td><td class="hits">753</td><td class="source">        dest.push(node);</td></tr><tr><td class="line">859</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">860</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">861</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">862</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">863</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">864</td><td class="hits"></td><td class="source"> * Evaluate the given `vals`.</td></tr><tr><td class="line">865</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">866</td><td class="hits"></td><td class="source"> * @param {Array} vals</td></tr><tr><td class="line">867</td><td class="hits"></td><td class="source"> * @return {Node}</td></tr><tr><td class="line">868</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">869</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">870</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">871</td><td class="hits">1</td><td class="source">Evaluator.prototype.eval = function(vals){</td></tr><tr class="hit"><td class="line">872</td><td class="hits">1175</td><td class="source">  if (!vals) return nodes.null;</td></tr><tr class="hit"><td class="line">873</td><td class="hits">1175</td><td class="source">  var len = vals.length</td></tr><tr><td class="line">874</td><td class="hits"></td><td class="source">    , node = nodes.null;</td></tr><tr><td class="line">875</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">876</td><td class="hits">1175</td><td class="source">  try {</td></tr><tr class="hit"><td class="line">877</td><td class="hits">1175</td><td class="source">    for (var i = 0; i &lt; len; ++i) {</td></tr><tr class="hit"><td class="line">878</td><td class="hits">1503</td><td class="source">      node = vals[i];</td></tr><tr class="hit"><td class="line">879</td><td class="hits">1503</td><td class="source">      switch (node.nodeName) {</td></tr><tr><td class="line">880</td><td class="hits"></td><td class="source">        case 'if':</td></tr><tr class="hit"><td class="line">881</td><td class="hits">219</td><td class="source">          if ('block' != node.block.nodeName) {</td></tr><tr class="hit"><td class="line">882</td><td class="hits">61</td><td class="source">            node = this.visit(node);</td></tr><tr class="hit"><td class="line">883</td><td class="hits">50</td><td class="source">            break;</td></tr><tr><td class="line">884</td><td class="hits"></td><td class="source">          }</td></tr><tr><td class="line">885</td><td class="hits"></td><td class="source">        case 'each':</td></tr><tr><td class="line">886</td><td class="hits"></td><td class="source">        case 'block':</td></tr><tr class="hit"><td class="line">887</td><td class="hits">223</td><td class="source">          node = this.visit(node);</td></tr><tr class="hit"><td class="line">888</td><td class="hits">276</td><td class="source">          if (node.nodes) node = this.eval(node.nodes);</td></tr><tr class="hit"><td class="line">889</td><td class="hits">219</td><td class="source">          break;</td></tr><tr><td class="line">890</td><td class="hits"></td><td class="source">        default:</td></tr><tr class="hit"><td class="line">891</td><td class="hits">1219</td><td class="source">          node = this.visit(node);</td></tr><tr><td class="line">892</td><td class="hits"></td><td class="source">      }</td></tr><tr><td class="line">893</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">894</td><td class="hits"></td><td class="source">  } catch (err) {</td></tr><tr class="hit"><td class="line">895</td><td class="hits">25</td><td class="source">    if ('return' == err.nodeName) {</td></tr><tr class="hit"><td class="line">896</td><td class="hits">25</td><td class="source">      return err.expr;</td></tr><tr><td class="line">897</td><td class="hits"></td><td class="source">    } else {</td></tr><tr class="miss"><td class="line">898</td><td class="hits">0</td><td class="source">      throw err;</td></tr><tr><td class="line">899</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">900</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">901</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">902</td><td class="hits">1150</td><td class="source">  return node;</td></tr><tr><td class="line">903</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">904</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">905</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">906</td><td class="hits"></td><td class="source"> * Literal function `call`.</td></tr><tr><td class="line">907</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">908</td><td class="hits"></td><td class="source"> * @param {Call} call</td></tr><tr><td class="line">909</td><td class="hits"></td><td class="source"> * @return {call}</td></tr><tr><td class="line">910</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">911</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">912</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">913</td><td class="hits">1</td><td class="source">Evaluator.prototype.literalCall = function(call){</td></tr><tr class="hit"><td class="line">914</td><td class="hits">24</td><td class="source">  call.args = this.visit(call.args);</td></tr><tr class="hit"><td class="line">915</td><td class="hits">24</td><td class="source">  return call;</td></tr><tr><td class="line">916</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">917</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">918</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">919</td><td class="hits"></td><td class="source"> * Lookup property `name`.</td></tr><tr><td class="line">920</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">921</td><td class="hits"></td><td class="source"> * @param {String} name</td></tr><tr><td class="line">922</td><td class="hits"></td><td class="source"> * @return {Property}</td></tr><tr><td class="line">923</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">924</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">925</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">926</td><td class="hits">1</td><td class="source">Evaluator.prototype.lookupProperty = function(name){</td></tr><tr class="hit"><td class="line">927</td><td class="hits">29</td><td class="source">  var i = this.stack.length</td></tr><tr><td class="line">928</td><td class="hits"></td><td class="source">    , prop = this.property</td></tr><tr><td class="line">929</td><td class="hits"></td><td class="source">    , curr = prop &amp;&amp; prop.name</td></tr><tr><td class="line">930</td><td class="hits"></td><td class="source">    , index = this.currentBlock.index</td></tr><tr><td class="line">931</td><td class="hits"></td><td class="source">    , top = i</td></tr><tr><td class="line">932</td><td class="hits"></td><td class="source">    , nodes</td></tr><tr><td class="line">933</td><td class="hits"></td><td class="source">    , block</td></tr><tr><td class="line">934</td><td class="hits"></td><td class="source">    , other;</td></tr><tr><td class="line">935</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">936</td><td class="hits">29</td><td class="source">  while (i--) {</td></tr><tr class="hit"><td class="line">937</td><td class="hits">62</td><td class="source">    block = this.stack[i].block;</td></tr><tr class="hit"><td class="line">938</td><td class="hits">77</td><td class="source">    if (!block.node) continue;</td></tr><tr class="hit"><td class="line">939</td><td class="hits">47</td><td class="source">    switch (block.node.nodeName) {</td></tr><tr><td class="line">940</td><td class="hits"></td><td class="source">      case 'group':</td></tr><tr><td class="line">941</td><td class="hits"></td><td class="source">      case 'function':</td></tr><tr class="hit"><td class="line">942</td><td class="hits">44</td><td class="source">        nodes = block.nodes;</td></tr><tr><td class="line">943</td><td class="hits"></td><td class="source">        // scan siblings from the property index up</td></tr><tr class="hit"><td class="line">944</td><td class="hits">44</td><td class="source">        if (i + 1 == top) {</td></tr><tr class="hit"><td class="line">945</td><td class="hits">26</td><td class="source">          while (index--) {</td></tr><tr class="hit"><td class="line">946</td><td class="hits">23</td><td class="source">            other = this.interpolate(nodes[index]);</td></tr><tr class="hit"><td class="line">947</td><td class="hits">33</td><td class="source">            if (name == other) return nodes[index].clone();</td></tr><tr><td class="line">948</td><td class="hits"></td><td class="source">          }</td></tr><tr><td class="line">949</td><td class="hits"></td><td class="source">        // sequential lookup for non-siblings (for now)</td></tr><tr><td class="line">950</td><td class="hits"></td><td class="source">        } else {</td></tr><tr class="hit"><td class="line">951</td><td class="hits">18</td><td class="source">          for (var j = 0, len = nodes.length; j &lt; len; ++j) {</td></tr><tr class="hit"><td class="line">952</td><td class="hits">24</td><td class="source">            if ('property' != nodes[j].nodeName) continue;</td></tr><tr class="hit"><td class="line">953</td><td class="hits">16</td><td class="source">            other = this.interpolate(nodes[j]);</td></tr><tr class="hit"><td class="line">954</td><td class="hits">29</td><td class="source">            if (name == other) return nodes[j].clone();</td></tr><tr><td class="line">955</td><td class="hits"></td><td class="source">          }</td></tr><tr><td class="line">956</td><td class="hits"></td><td class="source">        }</td></tr><tr class="hit"><td class="line">957</td><td class="hits">21</td><td class="source">        break;</td></tr><tr><td class="line">958</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">959</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">960</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">961</td><td class="hits">6</td><td class="source">  return nodes.null;</td></tr><tr><td class="line">962</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">963</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">964</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">965</td><td class="hits"></td><td class="source"> * Return the closest mixin-able `Block`.</td></tr><tr><td class="line">966</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">967</td><td class="hits"></td><td class="source"> * @return {Block}</td></tr><tr><td class="line">968</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">969</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">970</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">971</td><td class="hits">1</td><td class="source">Evaluator.prototype.__defineGetter__('closestBlock', function(){</td></tr><tr class="hit"><td class="line">972</td><td class="hits">10</td><td class="source">  var i = this.stack.length</td></tr><tr><td class="line">973</td><td class="hits"></td><td class="source">    , block;</td></tr><tr class="hit"><td class="line">974</td><td class="hits">10</td><td class="source">  while (i--) {</td></tr><tr class="hit"><td class="line">975</td><td class="hits">26</td><td class="source">    block = this.stack[i].block;</td></tr><tr class="hit"><td class="line">976</td><td class="hits">26</td><td class="source">    if (block.node) {</td></tr><tr class="hit"><td class="line">977</td><td class="hits">16</td><td class="source">      switch (block.node.nodeName) {</td></tr><tr><td class="line">978</td><td class="hits"></td><td class="source">        case 'group':</td></tr><tr><td class="line">979</td><td class="hits"></td><td class="source">        case 'function':</td></tr><tr class="hit"><td class="line">980</td><td class="hits">10</td><td class="source">          return block;</td></tr><tr><td class="line">981</td><td class="hits"></td><td class="source">      }</td></tr><tr><td class="line">982</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">983</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">984</td><td class="hits"></td><td class="source">});</td></tr><tr><td class="line">985</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">986</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">987</td><td class="hits"></td><td class="source"> * Lookup `name`, with support for JavaScript</td></tr><tr><td class="line">988</td><td class="hits"></td><td class="source"> * functions, and BIFs.</td></tr><tr><td class="line">989</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">990</td><td class="hits"></td><td class="source"> * @param {String} name</td></tr><tr><td class="line">991</td><td class="hits"></td><td class="source"> * @return {Node}</td></tr><tr><td class="line">992</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">993</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">994</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">995</td><td class="hits">1</td><td class="source">Evaluator.prototype.lookup = function(name){</td></tr><tr class="hit"><td class="line">996</td><td class="hits">8981</td><td class="source">  var val;</td></tr><tr class="hit"><td class="line">997</td><td class="hits">8984</td><td class="source">  if (this.ignoreColors &amp;&amp; name in colors) return;</td></tr><tr class="hit"><td class="line">998</td><td class="hits">8978</td><td class="source">  if (val = this.stack.lookup(name)) {</td></tr><tr class="hit"><td class="line">999</td><td class="hits">3345</td><td class="source">    return utils.unwrap(val);</td></tr><tr><td class="line">1000</td><td class="hits"></td><td class="source">  } else {</td></tr><tr class="hit"><td class="line">1001</td><td class="hits">5633</td><td class="source">    return this.lookupFunction(name);</td></tr><tr><td class="line">1002</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">1003</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">1004</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">1005</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">1006</td><td class="hits"></td><td class="source"> * Map segments in `node` returning a string.</td></tr><tr><td class="line">1007</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">1008</td><td class="hits"></td><td class="source"> * @param {Node} node</td></tr><tr><td class="line">1009</td><td class="hits"></td><td class="source"> * @return {String}</td></tr><tr><td class="line">1010</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">1011</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">1012</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">1013</td><td class="hits">1</td><td class="source">Evaluator.prototype.interpolate = function(node){</td></tr><tr class="hit"><td class="line">1014</td><td class="hits">4279</td><td class="source">  var self = this;</td></tr><tr class="hit"><td class="line">1015</td><td class="hits">4279</td><td class="source">  return node.segments.map(function(node){</td></tr><tr class="hit"><td class="line">1016</td><td class="hits">5653</td><td class="source">    function toString(node) {</td></tr><tr class="hit"><td class="line">1017</td><td class="hits">5826</td><td class="source">      switch (node.nodeName) {</td></tr><tr><td class="line">1018</td><td class="hits"></td><td class="source">        case 'function':</td></tr><tr><td class="line">1019</td><td class="hits"></td><td class="source">        case 'ident':</td></tr><tr class="hit"><td class="line">1020</td><td class="hits">2532</td><td class="source">          return node.name;</td></tr><tr><td class="line">1021</td><td class="hits"></td><td class="source">        case 'literal':</td></tr><tr><td class="line">1022</td><td class="hits"></td><td class="source">        case 'string':</td></tr><tr><td class="line">1023</td><td class="hits"></td><td class="source">        case 'unit':</td></tr><tr class="hit"><td class="line">1024</td><td class="hits">3120</td><td class="source">          return node.val;</td></tr><tr><td class="line">1025</td><td class="hits"></td><td class="source">        case 'expression':</td></tr><tr class="hit"><td class="line">1026</td><td class="hits">173</td><td class="source">          self.return++;</td></tr><tr class="hit"><td class="line">1027</td><td class="hits">173</td><td class="source">          var ret = toString(self.visit(node).first); </td></tr><tr class="hit"><td class="line">1028</td><td class="hits">173</td><td class="source">          self.return--;</td></tr><tr class="hit"><td class="line">1029</td><td class="hits">173</td><td class="source">          return ret;</td></tr><tr><td class="line">1030</td><td class="hits"></td><td class="source">      }</td></tr><tr><td class="line">1031</td><td class="hits"></td><td class="source">    }</td></tr><tr class="hit"><td class="line">1032</td><td class="hits">5653</td><td class="source">    return toString(node);</td></tr><tr><td class="line">1033</td><td class="hits"></td><td class="source">  }).join('');</td></tr><tr><td class="line">1034</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">1035</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">1036</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">1037</td><td class="hits"></td><td class="source"> * Lookup JavaScript user-defined or built-in function.</td></tr><tr><td class="line">1038</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">1039</td><td class="hits"></td><td class="source"> * @param {String} name</td></tr><tr><td class="line">1040</td><td class="hits"></td><td class="source"> * @return {Function}</td></tr><tr><td class="line">1041</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">1042</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">1043</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">1044</td><td class="hits">1</td><td class="source">Evaluator.prototype.lookupFunction = function(name){</td></tr><tr class="hit"><td class="line">1045</td><td class="hits">5661</td><td class="source">  var fn = this.functions[name] || bifs[name];</td></tr><tr class="hit"><td class="line">1046</td><td class="hits">6334</td><td class="source">  if (fn) return new nodes.Function(name, fn);</td></tr><tr><td class="line">1047</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">1048</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">1049</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">1050</td><td class="hits"></td><td class="source"> * Check if the given `node` is an ident, and if it is defined.</td></tr><tr><td class="line">1051</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">1052</td><td class="hits"></td><td class="source"> * @param {Node} node</td></tr><tr><td class="line">1053</td><td class="hits"></td><td class="source"> * @return {Boolean}</td></tr><tr><td class="line">1054</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">1055</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">1056</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">1057</td><td class="hits">1</td><td class="source">Evaluator.prototype.isDefined = function(node){</td></tr><tr class="hit"><td class="line">1058</td><td class="hits">29</td><td class="source">  if ('ident' == node.nodeName) {</td></tr><tr class="hit"><td class="line">1059</td><td class="hits">29</td><td class="source">    return nodes.Boolean(this.lookup(node.name));</td></tr><tr><td class="line">1060</td><td class="hits"></td><td class="source">  } else {</td></tr><tr class="miss"><td class="line">1061</td><td class="hits">0</td><td class="source">    throw new Error('invalid &quot;is defined&quot; check on non-variable ' + node);</td></tr><tr><td class="line">1062</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">1063</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">1064</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">1065</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">1066</td><td class="hits"></td><td class="source"> * Return `Expression` based on the given `prop`,</td></tr><tr><td class="line">1067</td><td class="hits"></td><td class="source"> * replacing cyclic calls to the given function `name`</td></tr><tr><td class="line">1068</td><td class="hits"></td><td class="source"> * with &quot;__CALL__&quot;.</td></tr><tr><td class="line">1069</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">1070</td><td class="hits"></td><td class="source"> * @param {Property} prop</td></tr><tr><td class="line">1071</td><td class="hits"></td><td class="source"> * @param {String} name</td></tr><tr><td class="line">1072</td><td class="hits"></td><td class="source"> * @return {Expression}</td></tr><tr><td class="line">1073</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">1074</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">1075</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">1076</td><td class="hits">1</td><td class="source">Evaluator.prototype.propertyExpression = function(prop, name){</td></tr><tr class="hit"><td class="line">1077</td><td class="hits">438</td><td class="source">  var expr = new nodes.Expression</td></tr><tr><td class="line">1078</td><td class="hits"></td><td class="source">    , val = prop.expr.clone();</td></tr><tr><td class="line">1079</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">1080</td><td class="hits"></td><td class="source">  // name</td></tr><tr class="hit"><td class="line">1081</td><td class="hits">438</td><td class="source">  expr.push(new nodes.String(prop.name));</td></tr><tr><td class="line">1082</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">1083</td><td class="hits"></td><td class="source">  // replace cyclic call with __CALL__</td></tr><tr class="hit"><td class="line">1084</td><td class="hits">438</td><td class="source">  function replace(node) {</td></tr><tr class="hit"><td class="line">1085</td><td class="hits">927</td><td class="source">    if ('call' == node.nodeName &amp;&amp; name == node.name) {</td></tr><tr class="hit"><td class="line">1086</td><td class="hits">186</td><td class="source">      return new nodes.Literal('__CALL__');</td></tr><tr><td class="line">1087</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">1088</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">1089</td><td class="hits">1188</td><td class="source">    if (node.nodes) node.nodes = node.nodes.map(replace);</td></tr><tr class="hit"><td class="line">1090</td><td class="hits">741</td><td class="source">    return node;</td></tr><tr><td class="line">1091</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">1092</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">1093</td><td class="hits">438</td><td class="source">  replace(val);</td></tr><tr class="hit"><td class="line">1094</td><td class="hits">438</td><td class="source">  expr.push(val);</td></tr><tr class="hit"><td class="line">1095</td><td class="hits">438</td><td class="source">  return expr;</td></tr><tr><td class="line">1096</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">1097</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">1098</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">1099</td><td class="hits"></td><td class="source"> * Cast `expr` to the trailing ident.</td></tr><tr><td class="line">1100</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">1101</td><td class="hits"></td><td class="source"> * @param {Expression} expr</td></tr><tr><td class="line">1102</td><td class="hits"></td><td class="source"> * @return {Unit}</td></tr><tr><td class="line">1103</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">1104</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">1105</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">1106</td><td class="hits">1</td><td class="source">Evaluator.prototype.cast = function(expr){</td></tr><tr class="hit"><td class="line">1107</td><td class="hits">9</td><td class="source">  return new nodes.Unit(expr.first.val, expr.nodes[1].name);</td></tr><tr><td class="line">1108</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">1109</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">1110</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">1111</td><td class="hits"></td><td class="source"> * Check if `expr` is castable.</td></tr><tr><td class="line">1112</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">1113</td><td class="hits"></td><td class="source"> * @param {Expression} expr</td></tr><tr><td class="line">1114</td><td class="hits"></td><td class="source"> * @return {Boolean}</td></tr><tr><td class="line">1115</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">1116</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">1117</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">1118</td><td class="hits">1</td><td class="source">Evaluator.prototype.castable = function(expr){</td></tr><tr class="hit"><td class="line">1119</td><td class="hits">12657</td><td class="source">  return 2 == expr.nodes.length</td></tr><tr><td class="line">1120</td><td class="hits"></td><td class="source">    &amp;&amp; 'unit' == expr.first.nodeName</td></tr><tr><td class="line">1121</td><td class="hits"></td><td class="source">    &amp;&amp; ~units.indexOf(expr.nodes[1].name);</td></tr><tr><td class="line">1122</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">1123</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">1124</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">1125</td><td class="hits"></td><td class="source"> * Warn with the given `msg`.</td></tr><tr><td class="line">1126</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">1127</td><td class="hits"></td><td class="source"> * @param {String} msg</td></tr><tr><td class="line">1128</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">1129</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">1130</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">1131</td><td class="hits">1</td><td class="source">Evaluator.prototype.warn = function(msg){</td></tr><tr class="hit"><td class="line">1132</td><td class="hits">138</td><td class="source">  if (!this.warnings) return;</td></tr><tr class="miss"><td class="line">1133</td><td class="hits">0</td><td class="source">  console.warn('\033[33mWarning:\033[0m ' + msg);</td></tr><tr><td class="line">1134</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">1135</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">1136</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">1137</td><td class="hits"></td><td class="source"> * Return the current `Block`.</td></tr><tr><td class="line">1138</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">1139</td><td class="hits"></td><td class="source"> * @return {Block}</td></tr><tr><td class="line">1140</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">1141</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">1142</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">1143</td><td class="hits">1</td><td class="source">Evaluator.prototype.__defineGetter__('currentBlock', function(){</td></tr><tr class="hit"><td class="line">1144</td><td class="hits">742</td><td class="source">  return this.stack.currentFrame.block;</td></tr><tr><td class="line">1145</td><td class="hits"></td><td class="source">});</td></tr><tr><td class="line">1146</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">1147</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">1148</td><td class="hits"></td><td class="source"> * Return an array of vendor names.</td></tr><tr><td class="line">1149</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">1150</td><td class="hits"></td><td class="source"> * @return {Array}</td></tr><tr><td class="line">1151</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">1152</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">1153</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">1154</td><td class="hits">1</td><td class="source">Evaluator.prototype.__defineGetter__('vendors', function(){</td></tr><tr class="hit"><td class="line">1155</td><td class="hits">12</td><td class="source">  return this.lookup('vendors').nodes.map(function(node){</td></tr><tr class="hit"><td class="line">1156</td><td class="hits">29</td><td class="source">    return node.string;</td></tr><tr><td class="line">1157</td><td class="hits"></td><td class="source">  });</td></tr><tr><td class="line">1158</td><td class="hits"></td><td class="source">});</td></tr><tr><td class="line">1159</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">1160</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">1161</td><td class="hits"></td><td class="source"> * Return the current frame `Scope`.</td></tr><tr><td class="line">1162</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">1163</td><td class="hits"></td><td class="source"> * @return {Scope}</td></tr><tr><td class="line">1164</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">1165</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">1166</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">1167</td><td class="hits">1</td><td class="source">Evaluator.prototype.__defineGetter__('currentScope', function(){</td></tr><tr class="hit"><td class="line">1168</td><td class="hits">9527</td><td class="source">  return this.stack.currentFrame.scope;</td></tr><tr><td class="line">1169</td><td class="hits"></td><td class="source">});</td></tr><tr><td class="line">1170</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">1171</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">1172</td><td class="hits"></td><td class="source"> * Return the current `Frame`.</td></tr><tr><td class="line">1173</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">1174</td><td class="hits"></td><td class="source"> * @return {Frame}</td></tr><tr><td class="line">1175</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">1176</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">1177</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">1178</td><td class="hits">1</td><td class="source">Evaluator.prototype.__defineGetter__('currentFrame', function(){</td></tr><tr class="miss"><td class="line">1179</td><td class="hits">0</td><td class="source">  return this.stack.currentFrame;</td></tr><tr><td class="line">1180</td><td class="hits"></td><td class="source">});</td></tr></tbody></table></div><div class="file"><h2 id="visitor/index.js">visitor/index.js</h2><div id="stats" class="high"><div class="percentage">100%</div><div class="sloc">6</div><div class="hits">6</div><div class="misses">0</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr><td class="line">1</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source">/*!</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source"> * Stylus - Visitor</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source"> * Copyright(c) 2010 LearnBoost &lt;dev@learnboost.com&gt;</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> * MIT Licensed</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source"> * Initialize a new `Visitor` with the given `root` Node.</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source"> * @param {Node} root</td></tr><tr><td class="line">12</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">14</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">15</td><td class="hits">1</td><td class="source">var Visitor = module.exports = function Visitor(root) {</td></tr><tr class="hit"><td class="line">16</td><td class="hits">682</td><td class="source">  this.root = root;</td></tr><tr><td class="line">17</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source"> * Visit the given `node`.</td></tr><tr><td class="line">21</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">22</td><td class="hits"></td><td class="source"> * @param {Node|Array} node</td></tr><tr><td class="line">23</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">24</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">25</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">26</td><td class="hits">1</td><td class="source">Visitor.prototype.visit = function(node, fn){</td></tr><tr class="hit"><td class="line">27</td><td class="hits">71916</td><td class="source">  var method = 'visit' + node.constructor.name;</td></tr><tr class="hit"><td class="line">28</td><td class="hits">129495</td><td class="source">  if (this[method]) return this[method](node);</td></tr><tr class="hit"><td class="line">29</td><td class="hits">14337</td><td class="source">  return node;</td></tr><tr><td class="line">30</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">31</td><td class="hits"></td><td class="source"> </td></tr></tbody></table></div><div class="file"><h2 id="units.js">units.js</h2><div id="stats" class="high"><div class="percentage">100%</div><div class="sloc">1</div><div class="hits">1</div><div class="misses">0</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr><td class="line">1</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source">/*!</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source"> * Stylus - units</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source"> * Copyright(c) 2010 LearnBoost &lt;dev@learnboost.com&gt;</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> * MIT Licensed</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">8</td><td class="hits">1</td><td class="source">module.exports = [</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source">    'em'</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source">  , 'ex'</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source">  , 'px'</td></tr><tr><td class="line">12</td><td class="hits"></td><td class="source">  , 'mm'</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source">  , 'cm'</td></tr><tr><td class="line">14</td><td class="hits"></td><td class="source">  , 'in'</td></tr><tr><td class="line">15</td><td class="hits"></td><td class="source">  , 'pt'</td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source">  , 'pc'</td></tr><tr><td class="line">17</td><td class="hits"></td><td class="source">  , 'deg'</td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source">  , 'rad'</td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source">  , 'grad'</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source">  , 'ms'</td></tr><tr><td class="line">21</td><td class="hits"></td><td class="source">  , 's'</td></tr><tr><td class="line">22</td><td class="hits"></td><td class="source">  , 'Hz'</td></tr><tr><td class="line">23</td><td class="hits"></td><td class="source">  , 'kHz'</td></tr><tr><td class="line">24</td><td class="hits"></td><td class="source">  , 'rem'</td></tr><tr><td class="line">25</td><td class="hits"></td><td class="source">  , '%'</td></tr><tr><td class="line">26</td><td class="hits"></td><td class="source">];</td></tr></tbody></table></div><div class="file"><h2 id="stack/index.js">stack/index.js</h2><div id="stats" class="high"><div class="percentage">94%</div><div class="sloc">37</div><div class="hits">35</div><div class="misses">2</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr><td class="line">1</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source">/*!</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source"> * Stylus - Stack</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source"> * Copyright(c) 2010 LearnBoost &lt;dev@learnboost.com&gt;</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> * MIT Licensed</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source"> * Module dependencies.</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">12</td><td class="hits">1</td><td class="source">var Frame = require('./frame');</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">14</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">15</td><td class="hits"></td><td class="source"> * Initialize a new `Stack`.</td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">17</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">20</td><td class="hits">1</td><td class="source">var Stack = module.exports = function Stack() {</td></tr><tr class="hit"><td class="line">21</td><td class="hits">208</td><td class="source">  Array.apply(this, arguments);</td></tr><tr><td class="line">22</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">23</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">24</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">25</td><td class="hits"></td><td class="source"> * Inherit from `Array.prototype`.</td></tr><tr><td class="line">26</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">27</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">28</td><td class="hits">1</td><td class="source">Stack.prototype.__proto__ = Array.prototype;</td></tr><tr><td class="line">29</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">30</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">31</td><td class="hits"></td><td class="source"> * Push the given `frame`.</td></tr><tr><td class="line">32</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">33</td><td class="hits"></td><td class="source"> * @param {Frame} frame</td></tr><tr><td class="line">34</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">35</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">36</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">37</td><td class="hits">1</td><td class="source">Stack.prototype.push = function(frame){</td></tr><tr class="hit"><td class="line">38</td><td class="hits">2881</td><td class="source">  frame.stack = this;</td></tr><tr class="hit"><td class="line">39</td><td class="hits">2881</td><td class="source">  frame.parent = this.currentFrame;</td></tr><tr class="hit"><td class="line">40</td><td class="hits">2881</td><td class="source">  return [].push.apply(this, arguments);</td></tr><tr><td class="line">41</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">42</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">43</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">44</td><td class="hits"></td><td class="source"> * Return the current stack `Frame`.</td></tr><tr><td class="line">45</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">46</td><td class="hits"></td><td class="source"> * @return {Frame}</td></tr><tr><td class="line">47</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">48</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">49</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">50</td><td class="hits">1</td><td class="source">Stack.prototype.__defineGetter__('currentFrame', function(){</td></tr><tr class="hit"><td class="line">51</td><td class="hits">31058</td><td class="source">  return this[this.length - 1];</td></tr><tr><td class="line">52</td><td class="hits"></td><td class="source">});</td></tr><tr><td class="line">53</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">54</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">55</td><td class="hits"></td><td class="source"> * Lookup stack frame for the given `block`.</td></tr><tr><td class="line">56</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">57</td><td class="hits"></td><td class="source"> * @param {Block} block</td></tr><tr><td class="line">58</td><td class="hits"></td><td class="source"> * @return {Frame}</td></tr><tr><td class="line">59</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">60</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">61</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">62</td><td class="hits">1</td><td class="source">Stack.prototype.getBlockFrame = function(block){</td></tr><tr class="hit"><td class="line">63</td><td class="hits">21828</td><td class="source">  for (var i = 0; i &lt; this.length; ++i) {</td></tr><tr class="hit"><td class="line">64</td><td class="hits">56482</td><td class="source">    if (block == this[i].block) {</td></tr><tr class="hit"><td class="line">65</td><td class="hits">18566</td><td class="source">      return this[i];</td></tr><tr><td class="line">66</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">67</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">68</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">69</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">70</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">71</td><td class="hits"></td><td class="source"> * Lookup the given local variable `name`, relative</td></tr><tr><td class="line">72</td><td class="hits"></td><td class="source"> * to the lexical scope of the current frame's `Block`.</td></tr><tr><td class="line">73</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">74</td><td class="hits"></td><td class="source"> * When the result of a lookup is an identifier</td></tr><tr><td class="line">75</td><td class="hits"></td><td class="source"> * a recursive lookup is performed, defaulting to</td></tr><tr><td class="line">76</td><td class="hits"></td><td class="source"> * returning the identifier itself.</td></tr><tr><td class="line">77</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">78</td><td class="hits"></td><td class="source"> * @param {String} name</td></tr><tr><td class="line">79</td><td class="hits"></td><td class="source"> * @return {Node}</td></tr><tr><td class="line">80</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">81</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">82</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">83</td><td class="hits">1</td><td class="source">Stack.prototype.lookup = function(name){</td></tr><tr class="hit"><td class="line">84</td><td class="hits">9297</td><td class="source">  var block = this.currentFrame.block</td></tr><tr><td class="line">85</td><td class="hits"></td><td class="source">    , val</td></tr><tr><td class="line">86</td><td class="hits"></td><td class="source">    , ret;</td></tr><tr><td class="line">87</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">88</td><td class="hits">9297</td><td class="source">  do {</td></tr><tr class="hit"><td class="line">89</td><td class="hits">21828</td><td class="source">    var frame = this.getBlockFrame(block);</td></tr><tr class="hit"><td class="line">90</td><td class="hits">21828</td><td class="source">    if (frame &amp;&amp; (val = frame.lookup(name))) {</td></tr><tr class="hit"><td class="line">91</td><td class="hits">3354</td><td class="source">      switch (val.first.nodeName) {</td></tr><tr><td class="line">92</td><td class="hits"></td><td class="source">        case 'ident':</td></tr><tr class="hit"><td class="line">93</td><td class="hits">319</td><td class="source">          return this.lookup(val.first.name) || val;</td></tr><tr><td class="line">94</td><td class="hits"></td><td class="source">        default:</td></tr><tr class="hit"><td class="line">95</td><td class="hits">3035</td><td class="source">          return val;</td></tr><tr><td class="line">96</td><td class="hits"></td><td class="source">      }</td></tr><tr><td class="line">97</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">98</td><td class="hits"></td><td class="source">  } while (block = block.parent);</td></tr><tr><td class="line">99</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">100</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">101</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">102</td><td class="hits"></td><td class="source"> * Custom inspect.</td></tr><tr><td class="line">103</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">104</td><td class="hits"></td><td class="source"> * @return {String}</td></tr><tr><td class="line">105</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">106</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">107</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">108</td><td class="hits">1</td><td class="source">Stack.prototype.inspect = function(){</td></tr><tr class="miss"><td class="line">109</td><td class="hits">0</td><td class="source">  return this.reverse().map(function(frame){</td></tr><tr class="miss"><td class="line">110</td><td class="hits">0</td><td class="source">    return frame.inspect();</td></tr><tr><td class="line">111</td><td class="hits"></td><td class="source">  }).join('\n');</td></tr><tr><td class="line">112</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">113</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">114</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">115</td><td class="hits"></td><td class="source"> * Return stack string formatted as:</td></tr><tr><td class="line">116</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">117</td><td class="hits"></td><td class="source"> *   at &lt;context&gt; (&lt;filename&gt;:&lt;lineno&gt;)</td></tr><tr><td class="line">118</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">119</td><td class="hits"></td><td class="source"> * @return {String}</td></tr><tr><td class="line">120</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">121</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">122</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">123</td><td class="hits">1</td><td class="source">Stack.prototype.toString = function(){</td></tr><tr class="hit"><td class="line">124</td><td class="hits">42</td><td class="source">  var block</td></tr><tr><td class="line">125</td><td class="hits"></td><td class="source">    , node</td></tr><tr><td class="line">126</td><td class="hits"></td><td class="source">    , buf = []</td></tr><tr><td class="line">127</td><td class="hits"></td><td class="source">    , location</td></tr><tr><td class="line">128</td><td class="hits"></td><td class="source">    , len = this.length;</td></tr><tr><td class="line">129</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">130</td><td class="hits">42</td><td class="source">  while (len--) {</td></tr><tr class="hit"><td class="line">131</td><td class="hits">151</td><td class="source">    block = this[len].block;</td></tr><tr class="hit"><td class="line">132</td><td class="hits">151</td><td class="source">    if (node = block.node) {</td></tr><tr class="hit"><td class="line">133</td><td class="hits">57</td><td class="source">      location = '(' + node.filename + ':' + (node.lineno + 1) + ')';</td></tr><tr class="hit"><td class="line">134</td><td class="hits">57</td><td class="source">      switch (node.nodeName) {</td></tr><tr><td class="line">135</td><td class="hits"></td><td class="source">        case 'function':</td></tr><tr class="hit"><td class="line">136</td><td class="hits">2</td><td class="source">          buf.push('    at ' + node.name + '() ' + location);</td></tr><tr class="hit"><td class="line">137</td><td class="hits">2</td><td class="source">          break;</td></tr><tr><td class="line">138</td><td class="hits"></td><td class="source">        case 'group':</td></tr><tr class="hit"><td class="line">139</td><td class="hits">42</td><td class="source">          buf.push('    at &quot;' + node.nodes[0].val + '&quot; ' + location);</td></tr><tr class="hit"><td class="line">140</td><td class="hits">42</td><td class="source">          break;</td></tr><tr><td class="line">141</td><td class="hits"></td><td class="source">      }</td></tr><tr><td class="line">142</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">143</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">144</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">145</td><td class="hits">42</td><td class="source">  return buf.join('\n');</td></tr><tr><td class="line">146</td><td class="hits"></td><td class="source">};</td></tr></tbody></table></div><div class="file"><h2 id="stack/frame.js">stack/frame.js</h2><div id="stats" class="high"><div class="percentage">90%</div><div class="sloc">10</div><div class="hits">9</div><div class="misses">1</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr><td class="line">1</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source">/*!</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source"> * Stylus - stack - Frame</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source"> * Copyright(c) 2010 LearnBoost &lt;dev@learnboost.com&gt;</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> * MIT Licensed</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source"> * Module dependencies.</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">12</td><td class="hits">1</td><td class="source">var Scope = require('./scope')</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source">  , blocks = require('../nodes');</td></tr><tr><td class="line">14</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">15</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source"> * Initialize a new `Frame` with the given `block`.</td></tr><tr><td class="line">17</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source"> * @param {Block} block</td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">21</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">22</td><td class="hits">1</td><td class="source">var Frame = module.exports = function Frame(block) {</td></tr><tr class="hit"><td class="line">23</td><td class="hits">2881</td><td class="source">  this._scope = false === block.scope</td></tr><tr><td class="line">24</td><td class="hits"></td><td class="source">    ? null</td></tr><tr><td class="line">25</td><td class="hits"></td><td class="source">    : new Scope;</td></tr><tr class="hit"><td class="line">26</td><td class="hits">2881</td><td class="source">  this.block = block;</td></tr><tr><td class="line">27</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">28</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">29</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">30</td><td class="hits"></td><td class="source"> * Return this frame's scope or the parent scope</td></tr><tr><td class="line">31</td><td class="hits"></td><td class="source"> * for scope-less blocks.</td></tr><tr><td class="line">32</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">33</td><td class="hits"></td><td class="source"> * @return {Scope}</td></tr><tr><td class="line">34</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">35</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">36</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">37</td><td class="hits">1</td><td class="source">Frame.prototype.__defineGetter__('scope', function(){</td></tr><tr class="hit"><td class="line">38</td><td class="hits">55571</td><td class="source">  return this._scope || this.parent.scope;</td></tr><tr><td class="line">39</td><td class="hits"></td><td class="source">});</td></tr><tr><td class="line">40</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">41</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">42</td><td class="hits"></td><td class="source"> * Lookup the given local variable `name`.</td></tr><tr><td class="line">43</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">44</td><td class="hits"></td><td class="source"> * @param {String} name</td></tr><tr><td class="line">45</td><td class="hits"></td><td class="source"> * @return {Node}</td></tr><tr><td class="line">46</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">47</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">48</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">49</td><td class="hits">1</td><td class="source">Frame.prototype.lookup = function(name){</td></tr><tr class="hit"><td class="line">50</td><td class="hits">18566</td><td class="source">  return this.scope.lookup(name)</td></tr><tr><td class="line">51</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">52</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">53</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">54</td><td class="hits"></td><td class="source"> * Custom inspect.</td></tr><tr><td class="line">55</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">56</td><td class="hits"></td><td class="source"> * @return {String}</td></tr><tr><td class="line">57</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">58</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">59</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">60</td><td class="hits">1</td><td class="source">Frame.prototype.inspect = function(){</td></tr><tr class="miss"><td class="line">61</td><td class="hits">0</td><td class="source">  return '[Frame '</td></tr><tr><td class="line">62</td><td class="hits"></td><td class="source">    + (false === this.block.scope</td></tr><tr><td class="line">63</td><td class="hits"></td><td class="source">        ? 'scope-less'</td></tr><tr><td class="line">64</td><td class="hits"></td><td class="source">        : this.scope.inspect())</td></tr><tr><td class="line">65</td><td class="hits"></td><td class="source">    + ']';</td></tr><tr><td class="line">66</td><td class="hits"></td><td class="source">};</td></tr></tbody></table></div><div class="file"><h2 id="stack/scope.js">stack/scope.js</h2><div id="stats" class="high"><div class="percentage">77%</div><div class="sloc">9</div><div class="hits">7</div><div class="misses">2</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr><td class="line">1</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source">/*!</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source"> * Stylus - stack - Scope</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source"> * Copyright(c) 2010 LearnBoost &lt;dev@learnboost.com&gt;</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> * MIT Licensed</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source"> * Initialize a new `Scope`.</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">12</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">14</td><td class="hits">1</td><td class="source">var Scope = module.exports = function Scope() {</td></tr><tr class="hit"><td class="line">15</td><td class="hits">2238</td><td class="source">  this.locals = {};</td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">17</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source"> * Add `ident` node to the current scope.</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">21</td><td class="hits"></td><td class="source"> * @param {Ident} ident</td></tr><tr><td class="line">22</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">23</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">24</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">25</td><td class="hits">1</td><td class="source">Scope.prototype.add = function(ident){</td></tr><tr class="hit"><td class="line">26</td><td class="hits">42689</td><td class="source">  this.locals[ident.name] = ident.val;</td></tr><tr><td class="line">27</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">28</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">29</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">30</td><td class="hits"></td><td class="source"> * Lookup the given local variable `name`.</td></tr><tr><td class="line">31</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">32</td><td class="hits"></td><td class="source"> * @param {String} name</td></tr><tr><td class="line">33</td><td class="hits"></td><td class="source"> * @return {Node}</td></tr><tr><td class="line">34</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">35</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">36</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">37</td><td class="hits">1</td><td class="source">Scope.prototype.lookup = function(name){</td></tr><tr class="hit"><td class="line">38</td><td class="hits">26533</td><td class="source">  return this.locals[name];</td></tr><tr><td class="line">39</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">40</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">41</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">42</td><td class="hits"></td><td class="source"> * Custom inspect.</td></tr><tr><td class="line">43</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">44</td><td class="hits"></td><td class="source"> * @return {String}</td></tr><tr><td class="line">45</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">46</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">47</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">48</td><td class="hits">1</td><td class="source">Scope.prototype.inspect = function(){</td></tr><tr class="miss"><td class="line">49</td><td class="hits">0</td><td class="source">  var keys = Object.keys(this.locals).map(function(key){ return '@' + key; });</td></tr><tr class="miss"><td class="line">50</td><td class="hits">0</td><td class="source">  return '[Scope'</td></tr><tr><td class="line">51</td><td class="hits"></td><td class="source">    + (keys.length ? ' ' + keys.join(', ') : '')</td></tr><tr><td class="line">52</td><td class="hits"></td><td class="source">    + ']';</td></tr><tr><td class="line">53</td><td class="hits"></td><td class="source">};</td></tr></tbody></table></div><div class="file"><h2 id="utils.js">utils.js</h2><div id="stats" class="medium"><div class="percentage">71%</div><div class="sloc">76</div><div class="hits">54</div><div class="misses">22</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr><td class="line">1</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source">/*!</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source"> * Stylus - utils</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source"> * Copyright(c) 2010 LearnBoost &lt;dev@learnboost.com&gt;</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> * MIT Licensed</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source"> * Module dependencies.</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">12</td><td class="hits">1</td><td class="source">var nodes = require('./nodes')</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source">  , join = require('path').join</td></tr><tr><td class="line">14</td><td class="hits"></td><td class="source">  , fs = require('fs');</td></tr><tr><td class="line">15</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">17</td><td class="hits"></td><td class="source"> * Check if `path` looks absolute.</td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source"> * @param {String} path</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source"> * @return {Boolean}</td></tr><tr><td class="line">21</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">22</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">23</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">24</td><td class="hits">1</td><td class="source">exports.absolute = function(path){</td></tr><tr class="hit"><td class="line">25</td><td class="hits">450</td><td class="source">  return /^([a-z]:\\)|\//i.test(path);</td></tr><tr><td class="line">26</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">27</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">28</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">29</td><td class="hits"></td><td class="source"> * Attempt to lookup `path` within `paths` from tail to head.</td></tr><tr><td class="line">30</td><td class="hits"></td><td class="source"> * Optionally a path to `ignore` may be passed.</td></tr><tr><td class="line">31</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">32</td><td class="hits"></td><td class="source"> * @param {String} path</td></tr><tr><td class="line">33</td><td class="hits"></td><td class="source"> * @param {String} paths</td></tr><tr><td class="line">34</td><td class="hits"></td><td class="source"> * @param {String} ignore</td></tr><tr><td class="line">35</td><td class="hits"></td><td class="source"> * @return {String}</td></tr><tr><td class="line">36</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">37</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">38</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">39</td><td class="hits">1</td><td class="source">exports.lookup = function(path, paths, ignore){</td></tr><tr class="hit"><td class="line">40</td><td class="hits">450</td><td class="source">  var lookup</td></tr><tr><td class="line">41</td><td class="hits"></td><td class="source">    , i = paths.length;</td></tr><tr><td class="line">42</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">43</td><td class="hits"></td><td class="source">  // Absolute</td></tr><tr class="hit"><td class="line">44</td><td class="hits">450</td><td class="source">  if (exports.absolute(path)) {</td></tr><tr class="hit"><td class="line">45</td><td class="hits">437</td><td class="source">    try {</td></tr><tr class="hit"><td class="line">46</td><td class="hits">437</td><td class="source">      fs.statSync(path);</td></tr><tr class="hit"><td class="line">47</td><td class="hits">208</td><td class="source">      return path;</td></tr><tr><td class="line">48</td><td class="hits"></td><td class="source">    } catch (err) {</td></tr><tr><td class="line">49</td><td class="hits"></td><td class="source">      // Ignore, continue on</td></tr><tr><td class="line">50</td><td class="hits"></td><td class="source">      // to trying relative lookup.</td></tr><tr><td class="line">51</td><td class="hits"></td><td class="source">      // Needed for url(/images/foo.png)</td></tr><tr><td class="line">52</td><td class="hits"></td><td class="source">      // for example</td></tr><tr><td class="line">53</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">54</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">55</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">56</td><td class="hits"></td><td class="source">  // Relative</td></tr><tr class="hit"><td class="line">57</td><td class="hits">242</td><td class="source">  while (i--) {</td></tr><tr class="hit"><td class="line">58</td><td class="hits">700</td><td class="source">    try {</td></tr><tr class="hit"><td class="line">59</td><td class="hits">700</td><td class="source">      lookup = join(paths[i], path);</td></tr><tr class="hit"><td class="line">60</td><td class="hits">700</td><td class="source">      if (ignore == lookup) continue;</td></tr><tr class="hit"><td class="line">61</td><td class="hits">700</td><td class="source">      fs.statSync(lookup);</td></tr><tr class="hit"><td class="line">62</td><td class="hits">21</td><td class="source">      return lookup;</td></tr><tr><td class="line">63</td><td class="hits"></td><td class="source">    } catch (err) {</td></tr><tr><td class="line">64</td><td class="hits"></td><td class="source">      // Ignore</td></tr><tr><td class="line">65</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">66</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">67</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">68</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">69</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">70</td><td class="hits"></td><td class="source"> * Format the given `err` with the given `options`.</td></tr><tr><td class="line">71</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">72</td><td class="hits"></td><td class="source"> * Options:</td></tr><tr><td class="line">73</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">74</td><td class="hits"></td><td class="source"> *   - `filename`   context filename</td></tr><tr><td class="line">75</td><td class="hits"></td><td class="source"> *   - `context`    context line count [8]</td></tr><tr><td class="line">76</td><td class="hits"></td><td class="source"> *   - `lineno`     context line number</td></tr><tr><td class="line">77</td><td class="hits"></td><td class="source"> *   - `input`        input string</td></tr><tr><td class="line">78</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">79</td><td class="hits"></td><td class="source"> * @param {Error} err</td></tr><tr><td class="line">80</td><td class="hits"></td><td class="source"> * @param {Object} options</td></tr><tr><td class="line">81</td><td class="hits"></td><td class="source"> * @return {Error}</td></tr><tr><td class="line">82</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">83</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">84</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">85</td><td class="hits">1</td><td class="source">exports.formatException = function(err, options){</td></tr><tr class="miss"><td class="line">86</td><td class="hits">0</td><td class="source">  var lineno = options.lineno</td></tr><tr><td class="line">87</td><td class="hits"></td><td class="source">    , filename = options.filename</td></tr><tr><td class="line">88</td><td class="hits"></td><td class="source">    , str = options.input</td></tr><tr><td class="line">89</td><td class="hits"></td><td class="source">    , context = options.context || 8</td></tr><tr><td class="line">90</td><td class="hits"></td><td class="source">    , context = context / 2</td></tr><tr><td class="line">91</td><td class="hits"></td><td class="source">    , lines = ('\n' + str).split('\n')</td></tr><tr><td class="line">92</td><td class="hits"></td><td class="source">    , start = Math.max(lineno - context, 1)</td></tr><tr><td class="line">93</td><td class="hits"></td><td class="source">    , end = Math.min(lines.length, lineno + context)</td></tr><tr><td class="line">94</td><td class="hits"></td><td class="source">    , pad = end.toString().length;</td></tr><tr><td class="line">95</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">96</td><td class="hits">0</td><td class="source">  var context = lines.slice(start, end).map(function(line, i){</td></tr><tr class="miss"><td class="line">97</td><td class="hits">0</td><td class="source">    var curr = i + start;</td></tr><tr class="miss"><td class="line">98</td><td class="hits">0</td><td class="source">    return (curr == lineno ? ' &gt; ' : '   ')</td></tr><tr><td class="line">99</td><td class="hits"></td><td class="source">      + Array(pad - curr.toString().length + 1).join(' ')</td></tr><tr><td class="line">100</td><td class="hits"></td><td class="source">      + curr</td></tr><tr><td class="line">101</td><td class="hits"></td><td class="source">      + '| '</td></tr><tr><td class="line">102</td><td class="hits"></td><td class="source">      + line;</td></tr><tr><td class="line">103</td><td class="hits"></td><td class="source">  }).join('\n');</td></tr><tr><td class="line">104</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">105</td><td class="hits">0</td><td class="source">  err.message = filename</td></tr><tr><td class="line">106</td><td class="hits"></td><td class="source">    + ':' + lineno</td></tr><tr><td class="line">107</td><td class="hits"></td><td class="source">    + '\n' + context</td></tr><tr><td class="line">108</td><td class="hits"></td><td class="source">    + '\n\n' + err.message + '\n'</td></tr><tr><td class="line">109</td><td class="hits"></td><td class="source">    + (err.stylusStack ? err.stylusStack + '\n' : '');</td></tr><tr><td class="line">110</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">111</td><td class="hits">0</td><td class="source">  return err;</td></tr><tr><td class="line">112</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">113</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">114</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">115</td><td class="hits"></td><td class="source"> * Assert that `node` is of the given `type`, or throw.</td></tr><tr><td class="line">116</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">117</td><td class="hits"></td><td class="source"> * @param {Node} node</td></tr><tr><td class="line">118</td><td class="hits"></td><td class="source"> * @param {Function} type</td></tr><tr><td class="line">119</td><td class="hits"></td><td class="source"> * @param {String} param</td></tr><tr><td class="line">120</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">121</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">122</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">123</td><td class="hits">1</td><td class="source">exports.assertType = function(node, type, param){</td></tr><tr class="hit"><td class="line">124</td><td class="hits">394</td><td class="source">  exports.assertPresent(node, param);</td></tr><tr class="hit"><td class="line">125</td><td class="hits">788</td><td class="source">  if (node.nodeName == type) return;</td></tr><tr class="miss"><td class="line">126</td><td class="hits">0</td><td class="source">  var actual = node.nodeName</td></tr><tr><td class="line">127</td><td class="hits"></td><td class="source">    , msg = 'expected &quot;'</td></tr><tr><td class="line">128</td><td class="hits"></td><td class="source">      + param + '&quot; to be a '</td></tr><tr><td class="line">129</td><td class="hits"></td><td class="source">      + type + ', but got '</td></tr><tr><td class="line">130</td><td class="hits"></td><td class="source">      + actual + ':' + node;</td></tr><tr class="miss"><td class="line">131</td><td class="hits">0</td><td class="source">  throw new Error('TypeError: ' + msg);</td></tr><tr><td class="line">132</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">133</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">134</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">135</td><td class="hits"></td><td class="source"> * Assert that `node` is a `String` or `Ident`.</td></tr><tr><td class="line">136</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">137</td><td class="hits"></td><td class="source"> * @param {Node} node</td></tr><tr><td class="line">138</td><td class="hits"></td><td class="source"> * @param {String} param</td></tr><tr><td class="line">139</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">140</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">141</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">142</td><td class="hits">1</td><td class="source">exports.assertString = function(node, param){</td></tr><tr class="hit"><td class="line">143</td><td class="hits">152</td><td class="source">  exports.assertPresent(node, param);</td></tr><tr class="hit"><td class="line">144</td><td class="hits">152</td><td class="source">  switch (node.nodeName) {</td></tr><tr><td class="line">145</td><td class="hits"></td><td class="source">    case 'string':</td></tr><tr><td class="line">146</td><td class="hits"></td><td class="source">    case 'ident':</td></tr><tr><td class="line">147</td><td class="hits"></td><td class="source">    case 'literal':</td></tr><tr class="hit"><td class="line">148</td><td class="hits">152</td><td class="source">      return;</td></tr><tr><td class="line">149</td><td class="hits"></td><td class="source">    default:</td></tr><tr class="miss"><td class="line">150</td><td class="hits">0</td><td class="source">      var actual = node.nodeName</td></tr><tr><td class="line">151</td><td class="hits"></td><td class="source">        , msg = 'expected string, ident or literal, but got ' + actual + ':' + node;</td></tr><tr class="miss"><td class="line">152</td><td class="hits">0</td><td class="source">      throw new Error('TypeError: ' + msg);</td></tr><tr><td class="line">153</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">154</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">155</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">156</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">157</td><td class="hits"></td><td class="source"> * Assert that `node` is a `RGBA` or `HSLA`.</td></tr><tr><td class="line">158</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">159</td><td class="hits"></td><td class="source"> * @param {Node} node</td></tr><tr><td class="line">160</td><td class="hits"></td><td class="source"> * @param {String} param</td></tr><tr><td class="line">161</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">162</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">163</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">164</td><td class="hits">1</td><td class="source">exports.assertColor = function(node, param){</td></tr><tr class="hit"><td class="line">165</td><td class="hits">105</td><td class="source">  exports.assertPresent(node, param);</td></tr><tr class="hit"><td class="line">166</td><td class="hits">105</td><td class="source">  switch (node.nodeName) {</td></tr><tr><td class="line">167</td><td class="hits"></td><td class="source">    case 'rgba':</td></tr><tr><td class="line">168</td><td class="hits"></td><td class="source">    case 'hsla':</td></tr><tr class="hit"><td class="line">169</td><td class="hits">105</td><td class="source">      return;</td></tr><tr><td class="line">170</td><td class="hits"></td><td class="source">    default:</td></tr><tr class="miss"><td class="line">171</td><td class="hits">0</td><td class="source">      var actual = node.nodeName</td></tr><tr><td class="line">172</td><td class="hits"></td><td class="source">        , msg = 'expected rgba or hsla, but got ' + actual + ':' + node;</td></tr><tr class="miss"><td class="line">173</td><td class="hits">0</td><td class="source">      throw new Error('TypeError: ' + msg);</td></tr><tr><td class="line">174</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">175</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">176</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">177</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">178</td><td class="hits"></td><td class="source"> * Assert that param `name` is given, aka the `node` is passed.</td></tr><tr><td class="line">179</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">180</td><td class="hits"></td><td class="source"> * @param {Node} node</td></tr><tr><td class="line">181</td><td class="hits"></td><td class="source"> * @param {String} name</td></tr><tr><td class="line">182</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">183</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">184</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">185</td><td class="hits">1</td><td class="source">exports.assertPresent = function(node, name){</td></tr><tr class="hit"><td class="line">186</td><td class="hits">1394</td><td class="source">  if (node) return;</td></tr><tr class="miss"><td class="line">187</td><td class="hits">0</td><td class="source">  if (name) throw new Error('&quot;' + name + '&quot; argument required');</td></tr><tr class="miss"><td class="line">188</td><td class="hits">0</td><td class="source">  throw new Error('argument missing');</td></tr><tr><td class="line">189</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">190</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">191</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">192</td><td class="hits"></td><td class="source"> * Unwrap `expr`.</td></tr><tr><td class="line">193</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">194</td><td class="hits"></td><td class="source"> * Takes an expressions with length of 1</td></tr><tr><td class="line">195</td><td class="hits"></td><td class="source"> * such as `((1 2 3))` and unwraps it to `(1 2 3)`.</td></tr><tr><td class="line">196</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">197</td><td class="hits"></td><td class="source"> * @param {Expression} expr</td></tr><tr><td class="line">198</td><td class="hits"></td><td class="source"> * @return {Node}</td></tr><tr><td class="line">199</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">200</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">201</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">202</td><td class="hits">1</td><td class="source">exports.unwrap = function(expr){</td></tr><tr><td class="line">203</td><td class="hits"></td><td class="source">  // explicitly preserve the expression</td></tr><tr class="hit"><td class="line">204</td><td class="hits">5586</td><td class="source">  if (expr.preserve) return expr;</td></tr><tr class="hit"><td class="line">205</td><td class="hits">6595</td><td class="source">  if ('arguments' != expr.nodeName &amp;&amp; 'expression' != expr.nodeName) return expr;</td></tr><tr class="hit"><td class="line">206</td><td class="hits">4702</td><td class="source">  if (1 != expr.nodes.length) return expr;</td></tr><tr class="hit"><td class="line">207</td><td class="hits">5213</td><td class="source">  if ('arguments' != expr.nodes[0].nodeName &amp;&amp; 'expression' != expr.nodes[0].nodeName) return expr;</td></tr><tr class="hit"><td class="line">208</td><td class="hits">955</td><td class="source">  return exports.unwrap(expr.nodes[0]);</td></tr><tr><td class="line">209</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">210</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">211</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">212</td><td class="hits"></td><td class="source"> * Coerce JavaScript values to their Stylus equivalents.</td></tr><tr><td class="line">213</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">214</td><td class="hits"></td><td class="source"> * @param {Mixed} val</td></tr><tr><td class="line">215</td><td class="hits"></td><td class="source"> * @return {Node}</td></tr><tr><td class="line">216</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">217</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">218</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">219</td><td class="hits">1</td><td class="source">exports.coerce = function(val){</td></tr><tr class="hit"><td class="line">220</td><td class="hits">899</td><td class="source">  switch (typeof val) {</td></tr><tr><td class="line">221</td><td class="hits"></td><td class="source">    case 'function':</td></tr><tr class="hit"><td class="line">222</td><td class="hits">208</td><td class="source">      return val;</td></tr><tr><td class="line">223</td><td class="hits"></td><td class="source">    case 'string':</td></tr><tr class="hit"><td class="line">224</td><td class="hits">21</td><td class="source">      return new nodes.String(val);</td></tr><tr><td class="line">225</td><td class="hits"></td><td class="source">    case 'boolean':</td></tr><tr class="miss"><td class="line">226</td><td class="hits">0</td><td class="source">      return new nodes.Boolean(val);</td></tr><tr><td class="line">227</td><td class="hits"></td><td class="source">    case 'number':</td></tr><tr class="hit"><td class="line">228</td><td class="hits">98</td><td class="source">      return new nodes.Unit(val);</td></tr><tr><td class="line">229</td><td class="hits"></td><td class="source">    default:</td></tr><tr class="hit"><td class="line">230</td><td class="hits">572</td><td class="source">      if (null == val) return nodes.null;</td></tr><tr class="hit"><td class="line">231</td><td class="hits">588</td><td class="source">      if (Array.isArray(val)) return exports.coerceArray(val);</td></tr><tr class="hit"><td class="line">232</td><td class="hits">1112</td><td class="source">      if (val.nodeName) return val;</td></tr><tr class="miss"><td class="line">233</td><td class="hits">0</td><td class="source">      return exports.coerceObject(val);</td></tr><tr><td class="line">234</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">235</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">236</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">237</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">238</td><td class="hits"></td><td class="source"> * Coerce a javascript `Array` to a Stylus `Expression`.</td></tr><tr><td class="line">239</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">240</td><td class="hits"></td><td class="source"> * @param {Array} val</td></tr><tr><td class="line">241</td><td class="hits"></td><td class="source"> * @return {Expression}</td></tr><tr><td class="line">242</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">243</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">244</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">245</td><td class="hits">1</td><td class="source">exports.coerceArray = function(val){</td></tr><tr class="hit"><td class="line">246</td><td class="hits">16</td><td class="source">  var expr = new nodes.Expression;</td></tr><tr class="hit"><td class="line">247</td><td class="hits">16</td><td class="source">  val.forEach(function(val){</td></tr><tr class="hit"><td class="line">248</td><td class="hits">25</td><td class="source">    expr.push(exports.coerce(val));</td></tr><tr><td class="line">249</td><td class="hits"></td><td class="source">  });</td></tr><tr class="hit"><td class="line">250</td><td class="hits">16</td><td class="source">  return expr;</td></tr><tr><td class="line">251</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">252</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">253</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">254</td><td class="hits"></td><td class="source"> * Coerce a javascript object to a Stylus `Expression`.</td></tr><tr><td class="line">255</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">256</td><td class="hits"></td><td class="source"> * For example `{ foo: 'bar', bar: 'baz' }` would become</td></tr><tr><td class="line">257</td><td class="hits"></td><td class="source"> * the expression `(foo 'bar') (bar 'baz')`.</td></tr><tr><td class="line">258</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">259</td><td class="hits"></td><td class="source"> * @param {Object} obj</td></tr><tr><td class="line">260</td><td class="hits"></td><td class="source"> * @return {Expression}</td></tr><tr><td class="line">261</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">262</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">263</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">264</td><td class="hits">1</td><td class="source">exports.coerceObject = function(obj){</td></tr><tr class="miss"><td class="line">265</td><td class="hits">0</td><td class="source">  var expr = new nodes.Expression</td></tr><tr><td class="line">266</td><td class="hits"></td><td class="source">    , val;</td></tr><tr><td class="line">267</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">268</td><td class="hits">0</td><td class="source">  for (var key in obj) {</td></tr><tr class="miss"><td class="line">269</td><td class="hits">0</td><td class="source">    val = exports.coerce(obj[key]);</td></tr><tr class="miss"><td class="line">270</td><td class="hits">0</td><td class="source">    key = new nodes.Ident(key);</td></tr><tr class="miss"><td class="line">271</td><td class="hits">0</td><td class="source">    expr.push(exports.coerceArray([key, val]));</td></tr><tr><td class="line">272</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">273</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">274</td><td class="hits">0</td><td class="source">  return expr;</td></tr><tr><td class="line">275</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">276</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">277</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">278</td><td class="hits"></td><td class="source"> * Return param names for `fn`.</td></tr><tr><td class="line">279</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">280</td><td class="hits"></td><td class="source"> * @param {Function} fn</td></tr><tr><td class="line">281</td><td class="hits"></td><td class="source"> * @return {Array}</td></tr><tr><td class="line">282</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">283</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">284</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">285</td><td class="hits">1</td><td class="source">exports.params = function(fn){</td></tr><tr class="hit"><td class="line">286</td><td class="hits">507</td><td class="source">  return fn</td></tr><tr><td class="line">287</td><td class="hits"></td><td class="source">    .toString()</td></tr><tr><td class="line">288</td><td class="hits"></td><td class="source">    .match(/\(([^)]*)\)/)[1].split(/ *, */);</td></tr><tr><td class="line">289</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">290</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">291</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">292</td><td class="hits"></td><td class="source"> * Merge object `b` with `a`.</td></tr><tr><td class="line">293</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">294</td><td class="hits"></td><td class="source"> * @param {Object} a</td></tr><tr><td class="line">295</td><td class="hits"></td><td class="source"> * @param {Object} b</td></tr><tr><td class="line">296</td><td class="hits"></td><td class="source"> * @return {Object} a</td></tr><tr><td class="line">297</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">298</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">299</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">300</td><td class="hits">1</td><td class="source">exports.merge = function(a, b){</td></tr><tr class="hit"><td class="line">301</td><td class="hits">1335</td><td class="source">  for (var k in b) a[k] = b[k];</td></tr><tr class="hit"><td class="line">302</td><td class="hits">222</td><td class="source">  return a;</td></tr><tr><td class="line">303</td><td class="hits"></td><td class="source">}</td></tr></tbody></table></div><div class="file"><h2 id="functions/index.js">functions/index.js</h2><div id="stats" class="high"><div class="percentage">83%</div><div class="sloc">177</div><div class="hits">148</div><div class="misses">29</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr><td class="line">1</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source">/*!</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source"> * Stylus - Evaluator - built-in functions</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source"> * Copyright(c) 2010 LearnBoost &lt;dev@learnboost.com&gt;</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> * MIT Licensed</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source"> * Module dependencies.</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">12</td><td class="hits">1</td><td class="source">var Compiler = require('../visitor/compiler')</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source">  , nodes = require('../nodes')</td></tr><tr><td class="line">14</td><td class="hits"></td><td class="source">  , utils = require('../utils')</td></tr><tr><td class="line">15</td><td class="hits"></td><td class="source">  , Image = require('./image');</td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">17</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source"> * Color component name map.</td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">21</td><td class="hits">1</td><td class="source">var componentMap = {</td></tr><tr><td class="line">22</td><td class="hits"></td><td class="source">    red: 'r'</td></tr><tr><td class="line">23</td><td class="hits"></td><td class="source">  , green: 'g'</td></tr><tr><td class="line">24</td><td class="hits"></td><td class="source">  , blue: 'b'</td></tr><tr><td class="line">25</td><td class="hits"></td><td class="source">  , alpha: 'a'</td></tr><tr><td class="line">26</td><td class="hits"></td><td class="source">  , hue: 'h'</td></tr><tr><td class="line">27</td><td class="hits"></td><td class="source">  , saturation: 's'</td></tr><tr><td class="line">28</td><td class="hits"></td><td class="source">  , lightness: 'l'</td></tr><tr><td class="line">29</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">30</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">31</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">32</td><td class="hits"></td><td class="source"> * Color component unit type map.</td></tr><tr><td class="line">33</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">34</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">35</td><td class="hits">1</td><td class="source">var unitMap = {</td></tr><tr><td class="line">36</td><td class="hits"></td><td class="source">    hue: 'deg'</td></tr><tr><td class="line">37</td><td class="hits"></td><td class="source">  , saturation: '%'</td></tr><tr><td class="line">38</td><td class="hits"></td><td class="source">  , lightness: '%'</td></tr><tr><td class="line">39</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">40</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">41</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">42</td><td class="hits"></td><td class="source"> * Color type map.</td></tr><tr><td class="line">43</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">44</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">45</td><td class="hits">1</td><td class="source">var typeMap = {</td></tr><tr><td class="line">46</td><td class="hits"></td><td class="source">    red: 'rgba'</td></tr><tr><td class="line">47</td><td class="hits"></td><td class="source">  , blue: 'rgba'</td></tr><tr><td class="line">48</td><td class="hits"></td><td class="source">  , green: 'rgba'</td></tr><tr><td class="line">49</td><td class="hits"></td><td class="source">  , alpha: 'rgba'</td></tr><tr><td class="line">50</td><td class="hits"></td><td class="source">  , hue: 'hsla'</td></tr><tr><td class="line">51</td><td class="hits"></td><td class="source">  , saturation: 'hsla'</td></tr><tr><td class="line">52</td><td class="hits"></td><td class="source">  , lightness: 'hsla'</td></tr><tr><td class="line">53</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">54</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">55</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">56</td><td class="hits"></td><td class="source"> * Convert the given `color` to an `HSLA` node,</td></tr><tr><td class="line">57</td><td class="hits"></td><td class="source"> * or h,s,l,a component values.</td></tr><tr><td class="line">58</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">59</td><td class="hits"></td><td class="source"> * Examples:</td></tr><tr><td class="line">60</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">61</td><td class="hits"></td><td class="source"> *    hsla(10deg, 50%, 30%, 0.5)</td></tr><tr><td class="line">62</td><td class="hits"></td><td class="source"> *    // =&gt; HSLA</td></tr><tr><td class="line">63</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">64</td><td class="hits"></td><td class="source"> *    hsla(#ffcc00)</td></tr><tr><td class="line">65</td><td class="hits"></td><td class="source"> *    // =&gt; HSLA</td></tr><tr><td class="line">66</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">67</td><td class="hits"></td><td class="source"> * @param {RGBA|HSLA|Unit} hue</td></tr><tr><td class="line">68</td><td class="hits"></td><td class="source"> * @param {Unit} saturation</td></tr><tr><td class="line">69</td><td class="hits"></td><td class="source"> * @param {Unit} lightness</td></tr><tr><td class="line">70</td><td class="hits"></td><td class="source"> * @param {Unit} alpha</td></tr><tr><td class="line">71</td><td class="hits"></td><td class="source"> * @return {HSLA}</td></tr><tr><td class="line">72</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">73</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">74</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">75</td><td class="hits">1</td><td class="source">exports.hsla = function hsla(hue, saturation, lightness, alpha){</td></tr><tr class="hit"><td class="line">76</td><td class="hits">34</td><td class="source">  if (alpha &amp;&amp; '%' == alpha.type) alpha.val /= 100;</td></tr><tr class="hit"><td class="line">77</td><td class="hits">33</td><td class="source">  switch (arguments.length) {</td></tr><tr><td class="line">78</td><td class="hits"></td><td class="source">    case 1:</td></tr><tr class="miss"><td class="line">79</td><td class="hits">0</td><td class="source">      utils.assertColor(hue);</td></tr><tr class="miss"><td class="line">80</td><td class="hits">0</td><td class="source">      return hue.hsla;</td></tr><tr><td class="line">81</td><td class="hits"></td><td class="source">    default:</td></tr><tr class="hit"><td class="line">82</td><td class="hits">33</td><td class="source">      utils.assertType(hue, 'unit', 'hue');</td></tr><tr class="hit"><td class="line">83</td><td class="hits">33</td><td class="source">      utils.assertType(saturation, 'unit', 'saturation');</td></tr><tr class="hit"><td class="line">84</td><td class="hits">33</td><td class="source">      utils.assertType(lightness, 'unit', 'lightness');</td></tr><tr class="hit"><td class="line">85</td><td class="hits">33</td><td class="source">      utils.assertType(alpha, 'unit', 'alpha');</td></tr><tr class="hit"><td class="line">86</td><td class="hits">33</td><td class="source">      return new nodes.HSLA(</td></tr><tr><td class="line">87</td><td class="hits"></td><td class="source">          hue.val</td></tr><tr><td class="line">88</td><td class="hits"></td><td class="source">        , saturation.val</td></tr><tr><td class="line">89</td><td class="hits"></td><td class="source">        , lightness.val</td></tr><tr><td class="line">90</td><td class="hits"></td><td class="source">        , alpha.val);</td></tr><tr><td class="line">91</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">92</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">93</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">94</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">95</td><td class="hits"></td><td class="source"> * Convert the given `color` to an `HSLA` node,</td></tr><tr><td class="line">96</td><td class="hits"></td><td class="source"> * or h,s,l component values.</td></tr><tr><td class="line">97</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">98</td><td class="hits"></td><td class="source"> * Examples:</td></tr><tr><td class="line">99</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">100</td><td class="hits"></td><td class="source"> *    hsl(10, 50, 30)</td></tr><tr><td class="line">101</td><td class="hits"></td><td class="source"> *    // =&gt; HSLA</td></tr><tr><td class="line">102</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">103</td><td class="hits"></td><td class="source"> *    hsl(#ffcc00)</td></tr><tr><td class="line">104</td><td class="hits"></td><td class="source"> *    // =&gt; HSLA</td></tr><tr><td class="line">105</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">106</td><td class="hits"></td><td class="source"> * @param {Unit|HSLA|RGBA} hue</td></tr><tr><td class="line">107</td><td class="hits"></td><td class="source"> * @param {Unit} saturation</td></tr><tr><td class="line">108</td><td class="hits"></td><td class="source"> * @param {Unit} lightness</td></tr><tr><td class="line">109</td><td class="hits"></td><td class="source"> * @return {HSLA}</td></tr><tr><td class="line">110</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">111</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">112</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">113</td><td class="hits">1</td><td class="source">exports.hsl = function hsl(hue, saturation, lightness){</td></tr><tr class="hit"><td class="line">114</td><td class="hits">55</td><td class="source">  if (1 == arguments.length) {</td></tr><tr class="hit"><td class="line">115</td><td class="hits">32</td><td class="source">    utils.assertColor(hue, 'color');</td></tr><tr class="hit"><td class="line">116</td><td class="hits">32</td><td class="source">    return hue.hsla;</td></tr><tr><td class="line">117</td><td class="hits"></td><td class="source">  } else {</td></tr><tr class="hit"><td class="line">118</td><td class="hits">23</td><td class="source">    return exports.hsla(</td></tr><tr><td class="line">119</td><td class="hits"></td><td class="source">        hue</td></tr><tr><td class="line">120</td><td class="hits"></td><td class="source">      , saturation</td></tr><tr><td class="line">121</td><td class="hits"></td><td class="source">      , lightness</td></tr><tr><td class="line">122</td><td class="hits"></td><td class="source">      , new nodes.Unit(1));</td></tr><tr><td class="line">123</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">124</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">125</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">126</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">127</td><td class="hits"></td><td class="source"> * Return type of `node`.</td></tr><tr><td class="line">128</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">129</td><td class="hits"></td><td class="source"> * Examples:</td></tr><tr><td class="line">130</td><td class="hits"></td><td class="source"> * </td></tr><tr><td class="line">131</td><td class="hits"></td><td class="source"> *    type(12)</td></tr><tr><td class="line">132</td><td class="hits"></td><td class="source"> *    // =&gt; 'unit'</td></tr><tr><td class="line">133</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">134</td><td class="hits"></td><td class="source"> *    type(#fff)</td></tr><tr><td class="line">135</td><td class="hits"></td><td class="source"> *    // =&gt; 'color'</td></tr><tr><td class="line">136</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">137</td><td class="hits"></td><td class="source"> *    type(type)</td></tr><tr><td class="line">138</td><td class="hits"></td><td class="source"> *    // =&gt; 'function'</td></tr><tr><td class="line">139</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">140</td><td class="hits"></td><td class="source"> *    type(unbound)</td></tr><tr><td class="line">141</td><td class="hits"></td><td class="source"> *    typeof(unbound)</td></tr><tr><td class="line">142</td><td class="hits"></td><td class="source"> *    type-of(unbound)</td></tr><tr><td class="line">143</td><td class="hits"></td><td class="source"> *    // =&gt; 'ident'</td></tr><tr><td class="line">144</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">145</td><td class="hits"></td><td class="source"> * @param {Node} node</td></tr><tr><td class="line">146</td><td class="hits"></td><td class="source"> * @return {String}</td></tr><tr><td class="line">147</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">148</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">149</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">150</td><td class="hits">1</td><td class="source">exports.type =</td></tr><tr><td class="line">151</td><td class="hits"></td><td class="source">exports.typeof =</td></tr><tr><td class="line">152</td><td class="hits"></td><td class="source">exports['type-of'] = function type(node){</td></tr><tr class="hit"><td class="line">153</td><td class="hits">20</td><td class="source">  utils.assertPresent(node, 'expression');</td></tr><tr class="hit"><td class="line">154</td><td class="hits">20</td><td class="source">  return node.nodeName;</td></tr><tr><td class="line">155</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">156</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">157</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">158</td><td class="hits"></td><td class="source"> * Return component `name` for the given `color`.</td></tr><tr><td class="line">159</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">160</td><td class="hits"></td><td class="source"> * @param {RGBA|HSLA} color</td></tr><tr><td class="line">161</td><td class="hits"></td><td class="source"> * @param {String} na,e</td></tr><tr><td class="line">162</td><td class="hits"></td><td class="source"> * @return {Unit}</td></tr><tr><td class="line">163</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">164</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">165</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">166</td><td class="hits">1</td><td class="source">exports.component = function component(color, name) {</td></tr><tr class="hit"><td class="line">167</td><td class="hits">58</td><td class="source">  utils.assertColor(color, 'color');</td></tr><tr class="hit"><td class="line">168</td><td class="hits">58</td><td class="source">  utils.assertString(name, 'name');</td></tr><tr class="hit"><td class="line">169</td><td class="hits">58</td><td class="source">  var name = name.string</td></tr><tr><td class="line">170</td><td class="hits"></td><td class="source">    , unit = unitMap[name]</td></tr><tr><td class="line">171</td><td class="hits"></td><td class="source">    , type = typeMap[name]</td></tr><tr><td class="line">172</td><td class="hits"></td><td class="source">    , name = componentMap[name];</td></tr><tr class="hit"><td class="line">173</td><td class="hits">58</td><td class="source">  if (!name) throw new Error('invalid color component &quot;' + name + '&quot;');</td></tr><tr class="hit"><td class="line">174</td><td class="hits">58</td><td class="source">  return new nodes.Unit(color[type][name], unit);</td></tr><tr><td class="line">175</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">176</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">177</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">178</td><td class="hits"></td><td class="source"> * Return the red component of the given `color`.</td></tr><tr><td class="line">179</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">180</td><td class="hits"></td><td class="source"> * Examples:</td></tr><tr><td class="line">181</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">182</td><td class="hits"></td><td class="source"> *    red(#c00)</td></tr><tr><td class="line">183</td><td class="hits"></td><td class="source"> *    // =&gt; 204</td></tr><tr><td class="line">184</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">185</td><td class="hits"></td><td class="source"> * @param {RGBA|HSLA} color</td></tr><tr><td class="line">186</td><td class="hits"></td><td class="source"> * @return {Unit}</td></tr><tr><td class="line">187</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">188</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">189</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">190</td><td class="hits">1</td><td class="source">exports.red = function red(color){</td></tr><tr class="hit"><td class="line">191</td><td class="hits">9</td><td class="source">  return exports.component(color, new nodes.String('red'));</td></tr><tr><td class="line">192</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">193</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">194</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">195</td><td class="hits"></td><td class="source"> * Return the green component of the given `color`.</td></tr><tr><td class="line">196</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">197</td><td class="hits"></td><td class="source"> * Examples:</td></tr><tr><td class="line">198</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">199</td><td class="hits"></td><td class="source"> *    green(#0c0)</td></tr><tr><td class="line">200</td><td class="hits"></td><td class="source"> *    // =&gt; 204</td></tr><tr><td class="line">201</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">202</td><td class="hits"></td><td class="source"> * @param {RGBA|HSLA} color</td></tr><tr><td class="line">203</td><td class="hits"></td><td class="source"> * @return {Unit}</td></tr><tr><td class="line">204</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">205</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">206</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">207</td><td class="hits">1</td><td class="source">exports.green = function green(color){</td></tr><tr class="hit"><td class="line">208</td><td class="hits">9</td><td class="source">  return exports.component(color, new nodes.String('green'));</td></tr><tr><td class="line">209</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">210</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">211</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">212</td><td class="hits"></td><td class="source"> * Return the blue component of the given `color`.</td></tr><tr><td class="line">213</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">214</td><td class="hits"></td><td class="source"> * Examples:</td></tr><tr><td class="line">215</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">216</td><td class="hits"></td><td class="source"> *    blue(#00c)</td></tr><tr><td class="line">217</td><td class="hits"></td><td class="source"> *    // =&gt; 204</td></tr><tr><td class="line">218</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">219</td><td class="hits"></td><td class="source"> * @param {RGBA|HSLA} color</td></tr><tr><td class="line">220</td><td class="hits"></td><td class="source"> * @return {Unit}</td></tr><tr><td class="line">221</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">222</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">223</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">224</td><td class="hits">1</td><td class="source">exports.blue = function blue(color){</td></tr><tr class="hit"><td class="line">225</td><td class="hits">10</td><td class="source">  return exports.component(color, new nodes.String('blue'));</td></tr><tr><td class="line">226</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">227</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">228</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">229</td><td class="hits"></td><td class="source"> * Return a `RGBA` from the r,g,b,a channels.</td></tr><tr><td class="line">230</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">231</td><td class="hits"></td><td class="source"> * Examples:</td></tr><tr><td class="line">232</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">233</td><td class="hits"></td><td class="source"> *    rgba(255,0,0,0.5)</td></tr><tr><td class="line">234</td><td class="hits"></td><td class="source"> *    // =&gt; rgba(255,0,0,0.5)</td></tr><tr><td class="line">235</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">236</td><td class="hits"></td><td class="source"> *    rgba(255,0,0,1)</td></tr><tr><td class="line">237</td><td class="hits"></td><td class="source"> *    // =&gt; #ff0000</td></tr><tr><td class="line">238</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">239</td><td class="hits"></td><td class="source"> *    rgba(#ffcc00, 0.5)</td></tr><tr><td class="line">240</td><td class="hits"></td><td class="source"> *    // rgba(255,204,0,0.5)</td></tr><tr><td class="line">241</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">242</td><td class="hits"></td><td class="source"> * @param {Unit|RGBA|HSLA} red</td></tr><tr><td class="line">243</td><td class="hits"></td><td class="source"> * @param {Unit} green</td></tr><tr><td class="line">244</td><td class="hits"></td><td class="source"> * @param {Unit} blue</td></tr><tr><td class="line">245</td><td class="hits"></td><td class="source"> * @param {Unit} alpha</td></tr><tr><td class="line">246</td><td class="hits"></td><td class="source"> * @return {RGBA}</td></tr><tr><td class="line">247</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">248</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">249</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">250</td><td class="hits">1</td><td class="source">exports.rgba = function rgba(red, green, blue, alpha){</td></tr><tr class="hit"><td class="line">251</td><td class="hits">51</td><td class="source">  if (alpha &amp;&amp; '%' == alpha.type) alpha.val /= 100;</td></tr><tr class="hit"><td class="line">252</td><td class="hits">50</td><td class="source">  switch (arguments.length) {</td></tr><tr><td class="line">253</td><td class="hits"></td><td class="source">    case 1:</td></tr><tr class="miss"><td class="line">254</td><td class="hits">0</td><td class="source">      utils.assertColor(red);</td></tr><tr class="miss"><td class="line">255</td><td class="hits">0</td><td class="source">      var color = red.rgba;</td></tr><tr class="miss"><td class="line">256</td><td class="hits">0</td><td class="source">      return new nodes.RGBA(</td></tr><tr><td class="line">257</td><td class="hits"></td><td class="source">          color.r</td></tr><tr><td class="line">258</td><td class="hits"></td><td class="source">        , color.g</td></tr><tr><td class="line">259</td><td class="hits"></td><td class="source">        , color.b</td></tr><tr><td class="line">260</td><td class="hits"></td><td class="source">        , color.a);</td></tr><tr><td class="line">261</td><td class="hits"></td><td class="source">    case 2:</td></tr><tr class="hit"><td class="line">262</td><td class="hits">15</td><td class="source">      utils.assertColor(red);</td></tr><tr class="hit"><td class="line">263</td><td class="hits">15</td><td class="source">      var color = red.rgba;</td></tr><tr class="hit"><td class="line">264</td><td class="hits">15</td><td class="source">      utils.assertType(green, 'unit', 'alpha');</td></tr><tr class="hit"><td class="line">265</td><td class="hits">15</td><td class="source">      return new nodes.RGBA(</td></tr><tr><td class="line">266</td><td class="hits"></td><td class="source">          color.r</td></tr><tr><td class="line">267</td><td class="hits"></td><td class="source">        , color.g</td></tr><tr><td class="line">268</td><td class="hits"></td><td class="source">        , color.b</td></tr><tr><td class="line">269</td><td class="hits"></td><td class="source">        , green.val);</td></tr><tr><td class="line">270</td><td class="hits"></td><td class="source">    default:</td></tr><tr class="hit"><td class="line">271</td><td class="hits">35</td><td class="source">      utils.assertType(red, 'unit', 'red');</td></tr><tr class="hit"><td class="line">272</td><td class="hits">35</td><td class="source">      utils.assertType(green, 'unit', 'green');</td></tr><tr class="hit"><td class="line">273</td><td class="hits">35</td><td class="source">      utils.assertType(blue, 'unit', 'blue');</td></tr><tr class="hit"><td class="line">274</td><td class="hits">35</td><td class="source">      utils.assertType(alpha, 'unit', 'alpha');</td></tr><tr class="hit"><td class="line">275</td><td class="hits">35</td><td class="source">      var r = '%' == red.type ? Math.round(red.val * 2.55) : red.val;</td></tr><tr class="hit"><td class="line">276</td><td class="hits">35</td><td class="source">      var g = '%' == green.type ? Math.round(green.val * 2.55) : green.val;</td></tr><tr class="hit"><td class="line">277</td><td class="hits">35</td><td class="source">      var b = '%' == blue.type ? Math.round(blue.val * 2.55) : blue.val;</td></tr><tr class="hit"><td class="line">278</td><td class="hits">35</td><td class="source">      return new nodes.RGBA(</td></tr><tr><td class="line">279</td><td class="hits"></td><td class="source">          r</td></tr><tr><td class="line">280</td><td class="hits"></td><td class="source">        , g</td></tr><tr><td class="line">281</td><td class="hits"></td><td class="source">        , b</td></tr><tr><td class="line">282</td><td class="hits"></td><td class="source">        , alpha.val);</td></tr><tr><td class="line">283</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">284</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">285</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">286</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">287</td><td class="hits"></td><td class="source"> * Return a `RGBA` from the r,g,b channels.</td></tr><tr><td class="line">288</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">289</td><td class="hits"></td><td class="source"> * Examples:</td></tr><tr><td class="line">290</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">291</td><td class="hits"></td><td class="source"> *    rgb(255,204,0)</td></tr><tr><td class="line">292</td><td class="hits"></td><td class="source"> *    // =&gt; #ffcc00</td></tr><tr><td class="line">293</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">294</td><td class="hits"></td><td class="source"> *    rgb(#fff)</td></tr><tr><td class="line">295</td><td class="hits"></td><td class="source"> *    // =&gt; #fff</td></tr><tr><td class="line">296</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">297</td><td class="hits"></td><td class="source"> * @param {Unit|RGBA|HSLA} red</td></tr><tr><td class="line">298</td><td class="hits"></td><td class="source"> * @param {Unit} green</td></tr><tr><td class="line">299</td><td class="hits"></td><td class="source"> * @param {Unit} blue</td></tr><tr><td class="line">300</td><td class="hits"></td><td class="source"> * @return {RGBA}</td></tr><tr><td class="line">301</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">302</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">303</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">304</td><td class="hits">1</td><td class="source">exports.rgb = function rgb(red, green, blue){</td></tr><tr class="hit"><td class="line">305</td><td class="hits">6</td><td class="source">  switch (arguments.length) {</td></tr><tr><td class="line">306</td><td class="hits"></td><td class="source">    case 1:</td></tr><tr class="miss"><td class="line">307</td><td class="hits">0</td><td class="source">      utils.assertColor(red);</td></tr><tr class="miss"><td class="line">308</td><td class="hits">0</td><td class="source">      var color = red.rgba;</td></tr><tr class="miss"><td class="line">309</td><td class="hits">0</td><td class="source">      return new nodes.RGBA(</td></tr><tr><td class="line">310</td><td class="hits"></td><td class="source">          color.r</td></tr><tr><td class="line">311</td><td class="hits"></td><td class="source">        , color.g</td></tr><tr><td class="line">312</td><td class="hits"></td><td class="source">        , color.b</td></tr><tr><td class="line">313</td><td class="hits"></td><td class="source">        , 1);</td></tr><tr><td class="line">314</td><td class="hits"></td><td class="source">    default:</td></tr><tr class="hit"><td class="line">315</td><td class="hits">6</td><td class="source">      return exports.rgba(</td></tr><tr><td class="line">316</td><td class="hits"></td><td class="source">          red</td></tr><tr><td class="line">317</td><td class="hits"></td><td class="source">        , green</td></tr><tr><td class="line">318</td><td class="hits"></td><td class="source">        , blue</td></tr><tr><td class="line">319</td><td class="hits"></td><td class="source">        , new nodes.Unit(1));</td></tr><tr><td class="line">320</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">321</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">322</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">323</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">324</td><td class="hits"></td><td class="source"> * Unquote the given `str`.</td></tr><tr><td class="line">325</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">326</td><td class="hits"></td><td class="source"> * Examples:</td></tr><tr><td class="line">327</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">328</td><td class="hits"></td><td class="source"> *    unquote(&quot;sans-serif&quot;)</td></tr><tr><td class="line">329</td><td class="hits"></td><td class="source"> *    // =&gt; sans-serif</td></tr><tr><td class="line">330</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">331</td><td class="hits"></td><td class="source"> *    unquote(sans-serif)</td></tr><tr><td class="line">332</td><td class="hits"></td><td class="source"> *    // =&gt; sans-serif</td></tr><tr><td class="line">333</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">334</td><td class="hits"></td><td class="source"> * @param {String|Ident} string</td></tr><tr><td class="line">335</td><td class="hits"></td><td class="source"> * @return {Literal}</td></tr><tr><td class="line">336</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">337</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">338</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">339</td><td class="hits">1</td><td class="source">exports.unquote = function unquote(string){</td></tr><tr class="hit"><td class="line">340</td><td class="hits">15</td><td class="source">  utils.assertString(string, 'string');</td></tr><tr class="hit"><td class="line">341</td><td class="hits">15</td><td class="source">  return new nodes.Literal(string.string);</td></tr><tr><td class="line">342</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">343</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">344</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">345</td><td class="hits"></td><td class="source"> * Assign `type` to the given `unit` or return `unit`'s type.</td></tr><tr><td class="line">346</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">347</td><td class="hits"></td><td class="source"> * @param {Unit} unit</td></tr><tr><td class="line">348</td><td class="hits"></td><td class="source"> * @param {String|Ident} type</td></tr><tr><td class="line">349</td><td class="hits"></td><td class="source"> * @return {Unit}</td></tr><tr><td class="line">350</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">351</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">352</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">353</td><td class="hits">1</td><td class="source">exports.unit = function unit(unit, type){</td></tr><tr class="hit"><td class="line">354</td><td class="hits">31</td><td class="source">  utils.assertType(unit, 'unit', 'unit');</td></tr><tr><td class="line">355</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">356</td><td class="hits"></td><td class="source">  // Assign</td></tr><tr class="hit"><td class="line">357</td><td class="hits">31</td><td class="source">  if (type) {</td></tr><tr class="hit"><td class="line">358</td><td class="hits">30</td><td class="source">    utils.assertString(type, 'type');</td></tr><tr class="hit"><td class="line">359</td><td class="hits">30</td><td class="source">    return new nodes.Unit(unit.val, type.string);</td></tr><tr><td class="line">360</td><td class="hits"></td><td class="source">  } else {</td></tr><tr class="hit"><td class="line">361</td><td class="hits">1</td><td class="source">    return unit.type || '';</td></tr><tr><td class="line">362</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">363</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">364</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">365</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">366</td><td class="hits"></td><td class="source"> * Lookup variable `name` or return Null.</td></tr><tr><td class="line">367</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">368</td><td class="hits"></td><td class="source"> * @param {String} name</td></tr><tr><td class="line">369</td><td class="hits"></td><td class="source"> * @return {Mixed}</td></tr><tr><td class="line">370</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">371</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">372</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">373</td><td class="hits">1</td><td class="source">exports.lookup = function lookup(name){</td></tr><tr class="hit"><td class="line">374</td><td class="hits">1</td><td class="source">  utils.assertType(name, 'string', 'name');</td></tr><tr class="hit"><td class="line">375</td><td class="hits">1</td><td class="source">  var node = this.lookup(name.val);</td></tr><tr class="hit"><td class="line">376</td><td class="hits">1</td><td class="source">  if (!node) return nodes.null;</td></tr><tr class="hit"><td class="line">377</td><td class="hits">1</td><td class="source">  return this.visit(node);</td></tr><tr><td class="line">378</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">379</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">380</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">381</td><td class="hits"></td><td class="source"> * Perform `op` on the `left` and `right` operands.</td></tr><tr><td class="line">382</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">383</td><td class="hits"></td><td class="source"> * @param {String} op</td></tr><tr><td class="line">384</td><td class="hits"></td><td class="source"> * @param {Node} left</td></tr><tr><td class="line">385</td><td class="hits"></td><td class="source"> * @param {Node} right</td></tr><tr><td class="line">386</td><td class="hits"></td><td class="source"> * @return {Node}</td></tr><tr><td class="line">387</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">388</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">389</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">390</td><td class="hits">1</td><td class="source">exports.operate = function operate(op, left, right){</td></tr><tr class="hit"><td class="line">391</td><td class="hits">10</td><td class="source">  utils.assertType(op, 'string', 'op');</td></tr><tr class="hit"><td class="line">392</td><td class="hits">10</td><td class="source">  utils.assertPresent(left, 'left');</td></tr><tr class="hit"><td class="line">393</td><td class="hits">10</td><td class="source">  utils.assertPresent(right, 'right');</td></tr><tr class="hit"><td class="line">394</td><td class="hits">10</td><td class="source">  return left.operate(op.val, right);</td></tr><tr><td class="line">395</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">396</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">397</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">398</td><td class="hits"></td><td class="source"> * Test if `val` matches the given `pattern`.</td></tr><tr><td class="line">399</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">400</td><td class="hits"></td><td class="source"> * Examples:</td></tr><tr><td class="line">401</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">402</td><td class="hits"></td><td class="source"> *     match('^foo(bar)?', foo)</td></tr><tr><td class="line">403</td><td class="hits"></td><td class="source"> *     match('^foo(bar)?', foobar)</td></tr><tr><td class="line">404</td><td class="hits"></td><td class="source"> *     match('^foo(bar)?', 'foo')</td></tr><tr><td class="line">405</td><td class="hits"></td><td class="source"> *     match('^foo(bar)?', 'foobar')</td></tr><tr><td class="line">406</td><td class="hits"></td><td class="source"> *     // =&gt; true</td></tr><tr><td class="line">407</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">408</td><td class="hits"></td><td class="source"> *     match('^foo(bar)?', 'bar')</td></tr><tr><td class="line">409</td><td class="hits"></td><td class="source"> *     // =&gt; false</td></tr><tr><td class="line">410</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">411</td><td class="hits"></td><td class="source"> * @param {String} pattern</td></tr><tr><td class="line">412</td><td class="hits"></td><td class="source"> * @param {String|Ident} val</td></tr><tr><td class="line">413</td><td class="hits"></td><td class="source"> * @return {Boolean}</td></tr><tr><td class="line">414</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">415</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">416</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">417</td><td class="hits">1</td><td class="source">exports.match = function match(pattern, val){</td></tr><tr class="hit"><td class="line">418</td><td class="hits">2</td><td class="source">  utils.assertType(pattern, 'string', 'pattern');</td></tr><tr class="hit"><td class="line">419</td><td class="hits">2</td><td class="source">  utils.assertString(val, 'val');</td></tr><tr class="hit"><td class="line">420</td><td class="hits">2</td><td class="source">  var re = new RegExp(pattern.val);</td></tr><tr class="hit"><td class="line">421</td><td class="hits">2</td><td class="source">  return nodes.Boolean(re.test(val.string));</td></tr><tr><td class="line">422</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">423</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">424</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">425</td><td class="hits"></td><td class="source"> * Return length of the given `expr`.</td></tr><tr><td class="line">426</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">427</td><td class="hits"></td><td class="source"> * @param {Expression} expr</td></tr><tr><td class="line">428</td><td class="hits"></td><td class="source"> * @return {Unit}</td></tr><tr><td class="line">429</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">430</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">431</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">432</td><td class="hits">1</td><td class="source">(exports.length = function length(expr){</td></tr><tr class="hit"><td class="line">433</td><td class="hits">71</td><td class="source">  if (expr) {</td></tr><tr class="hit"><td class="line">434</td><td class="hits">71</td><td class="source">    return expr.nodes</td></tr><tr><td class="line">435</td><td class="hits"></td><td class="source">      ? utils.unwrap(expr).nodes.length</td></tr><tr><td class="line">436</td><td class="hits"></td><td class="source">      : 1;</td></tr><tr><td class="line">437</td><td class="hits"></td><td class="source">  }</td></tr><tr class="miss"><td class="line">438</td><td class="hits">0</td><td class="source">  return 0;</td></tr><tr><td class="line">439</td><td class="hits"></td><td class="source">}).raw = true;</td></tr><tr><td class="line">440</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">441</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">442</td><td class="hits"></td><td class="source"> * Inspect the given `expr`.</td></tr><tr><td class="line">443</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">444</td><td class="hits"></td><td class="source"> * @param {Expression} expr</td></tr><tr><td class="line">445</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">446</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">447</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">448</td><td class="hits">1</td><td class="source">(exports.p = function p(){</td></tr><tr class="miss"><td class="line">449</td><td class="hits">0</td><td class="source">  [].slice.call(arguments).forEach(function(expr){</td></tr><tr class="miss"><td class="line">450</td><td class="hits">0</td><td class="source">    expr = utils.unwrap(expr);</td></tr><tr class="miss"><td class="line">451</td><td class="hits">0</td><td class="source">    if (!expr.nodes.length) return;</td></tr><tr class="miss"><td class="line">452</td><td class="hits">0</td><td class="source">    console.log('\033[90minspect:\033[0m %s', expr.toString().replace(/^\(|\)$/g, ''));</td></tr><tr><td class="line">453</td><td class="hits"></td><td class="source">  })</td></tr><tr class="miss"><td class="line">454</td><td class="hits">0</td><td class="source">  return nodes.null;</td></tr><tr><td class="line">455</td><td class="hits"></td><td class="source">}).raw = true;</td></tr><tr><td class="line">456</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">457</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">458</td><td class="hits"></td><td class="source"> * Throw an error with the given `msg`.</td></tr><tr><td class="line">459</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">460</td><td class="hits"></td><td class="source"> * @param {String} msg</td></tr><tr><td class="line">461</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">462</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">463</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">464</td><td class="hits">1</td><td class="source">exports.error = function error(msg){</td></tr><tr class="miss"><td class="line">465</td><td class="hits">0</td><td class="source">  utils.assertType(msg, 'string', 'msg');</td></tr><tr class="miss"><td class="line">466</td><td class="hits">0</td><td class="source">  throw new Error(msg.val);</td></tr><tr><td class="line">467</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">468</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">469</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">470</td><td class="hits"></td><td class="source"> * Warn with the given `msg` prefixed by &quot;Warning: &quot;.</td></tr><tr><td class="line">471</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">472</td><td class="hits"></td><td class="source"> * @param {String} msg</td></tr><tr><td class="line">473</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">474</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">475</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">476</td><td class="hits">1</td><td class="source">exports.warn = function warn(msg){</td></tr><tr class="miss"><td class="line">477</td><td class="hits">0</td><td class="source">  utils.assertType(msg, 'string', 'msg');</td></tr><tr class="miss"><td class="line">478</td><td class="hits">0</td><td class="source">  console.warn('Warning: %s', msg.val);</td></tr><tr class="miss"><td class="line">479</td><td class="hits">0</td><td class="source">  return nodes.null;</td></tr><tr><td class="line">480</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">481</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">482</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">483</td><td class="hits"></td><td class="source"> * Output stack trace.</td></tr><tr><td class="line">484</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">485</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">486</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">487</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">488</td><td class="hits">1</td><td class="source">exports.trace = function trace(){</td></tr><tr class="miss"><td class="line">489</td><td class="hits">0</td><td class="source">  console.log(this.stack);</td></tr><tr class="miss"><td class="line">490</td><td class="hits">0</td><td class="source">  return nodes.null;</td></tr><tr><td class="line">491</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">492</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">493</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">494</td><td class="hits"></td><td class="source"> * Push the given args to `expr`.</td></tr><tr><td class="line">495</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">496</td><td class="hits"></td><td class="source"> * @param {Expression} expr</td></tr><tr><td class="line">497</td><td class="hits"></td><td class="source"> * @param {Node} ...</td></tr><tr><td class="line">498</td><td class="hits"></td><td class="source"> * @return {Unit}</td></tr><tr><td class="line">499</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">500</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">501</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">502</td><td class="hits">1</td><td class="source">(exports.push = exports.append = function(expr){</td></tr><tr class="hit"><td class="line">503</td><td class="hits">26</td><td class="source">  expr = utils.unwrap(expr);</td></tr><tr class="hit"><td class="line">504</td><td class="hits">26</td><td class="source">  for (var i = 1, len = arguments.length; i &lt; len; ++i) {</td></tr><tr class="hit"><td class="line">505</td><td class="hits">37</td><td class="source">    expr.nodes.push(utils.unwrap(arguments[i]));</td></tr><tr><td class="line">506</td><td class="hits"></td><td class="source">  }</td></tr><tr class="hit"><td class="line">507</td><td class="hits">26</td><td class="source">  return expr.nodes.length;</td></tr><tr><td class="line">508</td><td class="hits"></td><td class="source">}).raw = true;</td></tr><tr><td class="line">509</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">510</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">511</td><td class="hits"></td><td class="source"> * Unshift the given args to `expr`.</td></tr><tr><td class="line">512</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">513</td><td class="hits"></td><td class="source"> * @param {Expression} expr</td></tr><tr><td class="line">514</td><td class="hits"></td><td class="source"> * @param {Node} ...</td></tr><tr><td class="line">515</td><td class="hits"></td><td class="source"> * @return {Unit}</td></tr><tr><td class="line">516</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">517</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">518</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">519</td><td class="hits">1</td><td class="source">(exports.unshift = exports.prepend = function(expr){</td></tr><tr class="hit"><td class="line">520</td><td class="hits">1</td><td class="source">  expr = utils.unwrap(expr);</td></tr><tr class="hit"><td class="line">521</td><td class="hits">1</td><td class="source">  for (var i = 1, len = arguments.length; i &lt; len; ++i) {</td></tr><tr class="hit"><td class="line">522</td><td class="hits">2</td><td class="source">    expr.nodes.unshift(utils.unwrap(arguments[i]));</td></tr><tr><td class="line">523</td><td class="hits"></td><td class="source">  }</td></tr><tr class="hit"><td class="line">524</td><td class="hits">1</td><td class="source">  return expr.nodes.length;</td></tr><tr><td class="line">525</td><td class="hits"></td><td class="source">}).raw = true;</td></tr><tr><td class="line">526</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">527</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">528</td><td class="hits"></td><td class="source"> * Return a `Literal` with the given `fmt`, and</td></tr><tr><td class="line">529</td><td class="hits"></td><td class="source"> * variable number of arguments.</td></tr><tr><td class="line">530</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">531</td><td class="hits"></td><td class="source"> * @param {String} fmt</td></tr><tr><td class="line">532</td><td class="hits"></td><td class="source"> * @param {Node} ...</td></tr><tr><td class="line">533</td><td class="hits"></td><td class="source"> * @return {Literal}</td></tr><tr><td class="line">534</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">535</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">536</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">537</td><td class="hits">1</td><td class="source">(exports.s = function s(fmt){</td></tr><tr class="hit"><td class="line">538</td><td class="hits">26</td><td class="source">  fmt = utils.unwrap(fmt).nodes[0];</td></tr><tr class="hit"><td class="line">539</td><td class="hits">26</td><td class="source">  utils.assertString(fmt);</td></tr><tr class="hit"><td class="line">540</td><td class="hits">26</td><td class="source">  var self = this</td></tr><tr><td class="line">541</td><td class="hits"></td><td class="source">    , str = fmt.string</td></tr><tr><td class="line">542</td><td class="hits"></td><td class="source">    , args = arguments</td></tr><tr><td class="line">543</td><td class="hits"></td><td class="source">    , i = 1;</td></tr><tr><td class="line">544</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">545</td><td class="hits"></td><td class="source">  // format</td></tr><tr class="hit"><td class="line">546</td><td class="hits">26</td><td class="source">  str = str.replace(/%(s|d)/g, function(_, specifier){</td></tr><tr class="hit"><td class="line">547</td><td class="hits">42</td><td class="source">    var arg = args[i++] || nodes.null;</td></tr><tr class="hit"><td class="line">548</td><td class="hits">42</td><td class="source">    switch (specifier) {</td></tr><tr><td class="line">549</td><td class="hits"></td><td class="source">      case 's':</td></tr><tr class="hit"><td class="line">550</td><td class="hits">42</td><td class="source">        return new Compiler(arg, self.options).compile();</td></tr><tr><td class="line">551</td><td class="hits"></td><td class="source">      case 'd':</td></tr><tr class="miss"><td class="line">552</td><td class="hits">0</td><td class="source">        arg = utils.unwrap(arg).first;</td></tr><tr class="miss"><td class="line">553</td><td class="hits">0</td><td class="source">        if ('unit' != arg.nodeName) throw new Error('%d requires a unit');</td></tr><tr class="miss"><td class="line">554</td><td class="hits">0</td><td class="source">        return arg.val;</td></tr><tr><td class="line">555</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">556</td><td class="hits"></td><td class="source">  });</td></tr><tr><td class="line">557</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">558</td><td class="hits">26</td><td class="source">  return new nodes.Literal(str);</td></tr><tr><td class="line">559</td><td class="hits"></td><td class="source">}).raw = true;</td></tr><tr><td class="line">560</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">561</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">562</td><td class="hits"></td><td class="source"> * Return the opposites of the given `positions`.</td></tr><tr><td class="line">563</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">564</td><td class="hits"></td><td class="source"> * Examples:</td></tr><tr><td class="line">565</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">566</td><td class="hits"></td><td class="source"> *    opposite-position(top left)</td></tr><tr><td class="line">567</td><td class="hits"></td><td class="source"> *    // =&gt; bottom right</td></tr><tr><td class="line">568</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">569</td><td class="hits"></td><td class="source"> * @param {Expression} positions</td></tr><tr><td class="line">570</td><td class="hits"></td><td class="source"> * @return {Expression}</td></tr><tr><td class="line">571</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">572</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">573</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">574</td><td class="hits">1</td><td class="source">(exports['opposite-position'] = function oppositePosition(positions){</td></tr><tr class="hit"><td class="line">575</td><td class="hits">9</td><td class="source">  var expr = [];</td></tr><tr class="hit"><td class="line">576</td><td class="hits">9</td><td class="source">  utils.unwrap(positions).nodes.forEach(function(pos, i){</td></tr><tr class="hit"><td class="line">577</td><td class="hits">11</td><td class="source">    utils.assertString(pos, 'position ' + i);</td></tr><tr class="hit"><td class="line">578</td><td class="hits">22</td><td class="source">    pos = (function(){ switch (pos.string) {</td></tr><tr class="hit"><td class="line">579</td><td class="hits">4</td><td class="source">      case 'top': return 'bottom';</td></tr><tr class="miss"><td class="line">580</td><td class="hits">0</td><td class="source">      case 'bottom': return 'top';</td></tr><tr class="hit"><td class="line">581</td><td class="hits">6</td><td class="source">      case 'left': return 'right';</td></tr><tr class="miss"><td class="line">582</td><td class="hits">0</td><td class="source">      case 'right': return 'left';</td></tr><tr class="hit"><td class="line">583</td><td class="hits">1</td><td class="source">      case 'center': return 'center';</td></tr><tr class="miss"><td class="line">584</td><td class="hits">0</td><td class="source">      default: throw new Error('invalid position ' + pos);</td></tr><tr><td class="line">585</td><td class="hits"></td><td class="source">    }})();</td></tr><tr class="hit"><td class="line">586</td><td class="hits">11</td><td class="source">    expr.push(new nodes.Literal(pos));</td></tr><tr><td class="line">587</td><td class="hits"></td><td class="source">  });</td></tr><tr class="hit"><td class="line">588</td><td class="hits">9</td><td class="source">  return expr;</td></tr><tr><td class="line">589</td><td class="hits"></td><td class="source">}).raw = true;</td></tr><tr><td class="line">590</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">591</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">592</td><td class="hits"></td><td class="source"> * Return the width and height of the given `img` path.</td></tr><tr><td class="line">593</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">594</td><td class="hits"></td><td class="source"> * Examples:</td></tr><tr><td class="line">595</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">596</td><td class="hits"></td><td class="source"> *    image-size('foo.png')</td></tr><tr><td class="line">597</td><td class="hits"></td><td class="source"> *    // =&gt; 200px 100px</td></tr><tr><td class="line">598</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">599</td><td class="hits"></td><td class="source"> *    image-size('foo.png')[0]</td></tr><tr><td class="line">600</td><td class="hits"></td><td class="source"> *    // =&gt; 200px</td></tr><tr><td class="line">601</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">602</td><td class="hits"></td><td class="source"> *    image-size('foo.png')[1]</td></tr><tr><td class="line">603</td><td class="hits"></td><td class="source"> *    // =&gt; 100px</td></tr><tr><td class="line">604</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">605</td><td class="hits"></td><td class="source"> * @param {String} img</td></tr><tr><td class="line">606</td><td class="hits"></td><td class="source"> * @return {Expression}</td></tr><tr><td class="line">607</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">608</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">609</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">610</td><td class="hits">1</td><td class="source">exports['image-size'] = function imageSize(img) {</td></tr><tr class="hit"><td class="line">611</td><td class="hits">7</td><td class="source">  utils.assertType(img, 'string', 'img');</td></tr><tr class="hit"><td class="line">612</td><td class="hits">7</td><td class="source">  var img = new Image(this, img.string);</td></tr><tr><td class="line">613</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">614</td><td class="hits"></td><td class="source">  // Read size</td></tr><tr class="hit"><td class="line">615</td><td class="hits">7</td><td class="source">  img.open();</td></tr><tr class="hit"><td class="line">616</td><td class="hits">7</td><td class="source">  var size = img.size();</td></tr><tr class="hit"><td class="line">617</td><td class="hits">7</td><td class="source">  img.close();</td></tr><tr><td class="line">618</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">619</td><td class="hits"></td><td class="source">  // Return (w h)</td></tr><tr class="hit"><td class="line">620</td><td class="hits">7</td><td class="source">  var expr = [];</td></tr><tr class="hit"><td class="line">621</td><td class="hits">7</td><td class="source">  expr.push(new nodes.Unit(size[0], 'px'));</td></tr><tr class="hit"><td class="line">622</td><td class="hits">7</td><td class="source">  expr.push(new nodes.Unit(size[1], 'px'));</td></tr><tr><td class="line">623</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">624</td><td class="hits">7</td><td class="source">  return expr;</td></tr><tr><td class="line">625</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">626</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">627</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">628</td><td class="hits"></td><td class="source"> * Apply Math `fn` to `n`.</td></tr><tr><td class="line">629</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">630</td><td class="hits"></td><td class="source"> * @param {Unit} n</td></tr><tr><td class="line">631</td><td class="hits"></td><td class="source"> * @param {String} fn</td></tr><tr><td class="line">632</td><td class="hits"></td><td class="source"> * @return {Unit}</td></tr><tr><td class="line">633</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">634</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">635</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">636</td><td class="hits">1</td><td class="source">exports['-math'] = function math(n, fn){</td></tr><tr class="hit"><td class="line">637</td><td class="hits">12</td><td class="source">  return new nodes.Unit(Math[fn.string](n.val), n.type);</td></tr><tr><td class="line">638</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">639</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">640</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">641</td><td class="hits"></td><td class="source"> * Get Math `prop`.</td></tr><tr><td class="line">642</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">643</td><td class="hits"></td><td class="source"> * @param {String} prop</td></tr><tr><td class="line">644</td><td class="hits"></td><td class="source"> * @return {Unit}</td></tr><tr><td class="line">645</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">646</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">647</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">648</td><td class="hits">1</td><td class="source">exports['-math-prop'] = function math(prop){</td></tr><tr class="hit"><td class="line">649</td><td class="hits">208</td><td class="source">  return new nodes.Unit(Math[prop.string]);</td></tr><tr><td class="line">650</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">651</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">652</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">653</td><td class="hits"></td><td class="source"> * Buffer the given js `str`.</td></tr><tr><td class="line">654</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">655</td><td class="hits"></td><td class="source"> * @param {String} str</td></tr><tr><td class="line">656</td><td class="hits"></td><td class="source"> * @return {JSLiteral}</td></tr><tr><td class="line">657</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">658</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">659</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">660</td><td class="hits">1</td><td class="source">exports.js = function js(str){</td></tr><tr class="miss"><td class="line">661</td><td class="hits">0</td><td class="source">  utils.assertString(str, 'str');</td></tr><tr class="miss"><td class="line">662</td><td class="hits">0</td><td class="source">  return new nodes.JSLiteral(str.val);</td></tr><tr><td class="line">663</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">664</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">665</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">666</td><td class="hits"></td><td class="source"> * Adjust HSL `color` `prop` by `amount`.</td></tr><tr><td class="line">667</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">668</td><td class="hits"></td><td class="source"> * @param {RGBA|HSLA} color</td></tr><tr><td class="line">669</td><td class="hits"></td><td class="source"> * @param {String} prop</td></tr><tr><td class="line">670</td><td class="hits"></td><td class="source"> * @param {Unit} amount</td></tr><tr><td class="line">671</td><td class="hits"></td><td class="source"> * @return {RGBA}</td></tr><tr><td class="line">672</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">673</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">674</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">675</td><td class="hits">1</td><td class="source">exports['-adjust'] = function adjust(color, prop, amount){</td></tr><tr class="hit"><td class="line">676</td><td class="hits">34</td><td class="source">  var hsl = color.hsla.clone();</td></tr><tr class="hit"><td class="line">677</td><td class="hits">34</td><td class="source">  prop = { hue: 'h', saturation: 's', lightness: 'l' }[prop.string];</td></tr><tr class="hit"><td class="line">678</td><td class="hits">34</td><td class="source">  if (!prop) throw new Error('invalid adjustment property');</td></tr><tr class="hit"><td class="line">679</td><td class="hits">34</td><td class="source">  var val = amount.val;</td></tr><tr class="hit"><td class="line">680</td><td class="hits">34</td><td class="source">  if ('%' == amount.type){</td></tr><tr class="hit"><td class="line">681</td><td class="hits">17</td><td class="source">    val = 'l' == prop &amp;&amp; val &gt; 0</td></tr><tr><td class="line">682</td><td class="hits"></td><td class="source">      ? (100 - hsl[prop]) * val / 100</td></tr><tr><td class="line">683</td><td class="hits"></td><td class="source">      : hsl[prop] * (val / 100);</td></tr><tr><td class="line">684</td><td class="hits"></td><td class="source">  }</td></tr><tr class="hit"><td class="line">685</td><td class="hits">34</td><td class="source">  hsl[prop] += val;</td></tr><tr class="hit"><td class="line">686</td><td class="hits">34</td><td class="source">  return hsl.rgba;</td></tr><tr><td class="line">687</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">688</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">689</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">690</td><td class="hits"></td><td class="source"> * Return a clone of the given `expr`.</td></tr><tr><td class="line">691</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">692</td><td class="hits"></td><td class="source"> * @param {Expression} expr</td></tr><tr><td class="line">693</td><td class="hits"></td><td class="source"> * @return {Node}</td></tr><tr><td class="line">694</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">695</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">696</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">697</td><td class="hits">1</td><td class="source">(exports.clone = function clone(expr){</td></tr><tr class="hit"><td class="line">698</td><td class="hits">6</td><td class="source">  utils.assertPresent(expr, 'expr');</td></tr><tr class="hit"><td class="line">699</td><td class="hits">6</td><td class="source">  return expr.clone();</td></tr><tr><td class="line">700</td><td class="hits"></td><td class="source">}).raw = true;</td></tr><tr><td class="line">701</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">702</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">703</td><td class="hits"></td><td class="source"> * Add property `name` with the given `expr`</td></tr><tr><td class="line">704</td><td class="hits"></td><td class="source"> * to the mixin-able block.</td></tr><tr><td class="line">705</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">706</td><td class="hits"></td><td class="source"> * @param {String|Ident|Literal} name</td></tr><tr><td class="line">707</td><td class="hits"></td><td class="source"> * @param {Expression} expr</td></tr><tr><td class="line">708</td><td class="hits"></td><td class="source"> * @return {Property}</td></tr><tr><td class="line">709</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">710</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">711</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">712</td><td class="hits">1</td><td class="source">(exports['add-property'] = function addProperty(name, expr){</td></tr><tr class="hit"><td class="line">713</td><td class="hits">10</td><td class="source">  utils.assertType(name, 'expression', 'name');</td></tr><tr class="hit"><td class="line">714</td><td class="hits">10</td><td class="source">  name = utils.unwrap(name).first;</td></tr><tr class="hit"><td class="line">715</td><td class="hits">10</td><td class="source">  utils.assertString(name, 'name');</td></tr><tr class="hit"><td class="line">716</td><td class="hits">10</td><td class="source">  utils.assertType(expr, 'expression', 'expr');</td></tr><tr class="hit"><td class="line">717</td><td class="hits">10</td><td class="source">  var prop = new nodes.Property([name], expr);</td></tr><tr class="hit"><td class="line">718</td><td class="hits">10</td><td class="source">  var block = this.closestBlock;</td></tr><tr><td class="line">719</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">720</td><td class="hits">10</td><td class="source">  var len = block.nodes.length</td></tr><tr><td class="line">721</td><td class="hits"></td><td class="source">    , head = block.nodes.slice(0, block.index)</td></tr><tr><td class="line">722</td><td class="hits"></td><td class="source">    , tail = block.nodes.slice(block.index++, len);</td></tr><tr class="hit"><td class="line">723</td><td class="hits">10</td><td class="source">  head.push(prop);</td></tr><tr class="hit"><td class="line">724</td><td class="hits">10</td><td class="source">  block.nodes = head.concat(tail);</td></tr><tr><td class="line">725</td><td class="hits"></td><td class="source">  </td></tr><tr class="hit"><td class="line">726</td><td class="hits">10</td><td class="source">  return prop;</td></tr><tr><td class="line">727</td><td class="hits"></td><td class="source">}).raw = true;</td></tr></tbody></table></div><div class="file"><h2 id="visitor/compiler.js">visitor/compiler.js</h2><div id="stats" class="high"><div class="percentage">93%</div><div class="sloc">166</div><div class="hits">156</div><div class="misses">10</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr><td class="line">1</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source">/*!</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source"> * Stylus - Compiler</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source"> * Copyright(c) 2010 LearnBoost &lt;dev@learnboost.com&gt;</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> * MIT Licensed</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source"> * Module dependencies.</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">12</td><td class="hits">1</td><td class="source">var Visitor = require('./')</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source">  , nodes = require('../nodes')</td></tr><tr><td class="line">14</td><td class="hits"></td><td class="source">  , utils = require('../utils')</td></tr><tr><td class="line">15</td><td class="hits"></td><td class="source">  , fs = require('fs');</td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">17</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source"> * Initialize a new `Compiler` with the given `root` Node</td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source"> * and the following `options`.</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">21</td><td class="hits"></td><td class="source"> * Options:</td></tr><tr><td class="line">22</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">23</td><td class="hits"></td><td class="source"> *   - `compress`  Compress the css output, defaults to false</td></tr><tr><td class="line">24</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">25</td><td class="hits"></td><td class="source"> * @param {Node} root</td></tr><tr><td class="line">26</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">27</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">28</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">29</td><td class="hits">1</td><td class="source">var Compiler = module.exports = function Compiler(root, options) {</td></tr><tr class="hit"><td class="line">30</td><td class="hits">266</td><td class="source">  options = options || {};</td></tr><tr class="hit"><td class="line">31</td><td class="hits">266</td><td class="source">  this.compress = options.compress;</td></tr><tr class="hit"><td class="line">32</td><td class="hits">266</td><td class="source">  this.firebug = options.firebug;</td></tr><tr class="hit"><td class="line">33</td><td class="hits">266</td><td class="source">  this.linenos = options.linenos;</td></tr><tr class="hit"><td class="line">34</td><td class="hits">266</td><td class="source">  this.spaces = options['indent spaces'] || 2;</td></tr><tr class="hit"><td class="line">35</td><td class="hits">266</td><td class="source">  this.indents = 1;</td></tr><tr class="hit"><td class="line">36</td><td class="hits">266</td><td class="source">  Visitor.call(this, root);</td></tr><tr class="hit"><td class="line">37</td><td class="hits">266</td><td class="source">  this.stack = [];</td></tr><tr class="hit"><td class="line">38</td><td class="hits">266</td><td class="source">  this.js = '';</td></tr><tr><td class="line">39</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">40</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">41</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">42</td><td class="hits"></td><td class="source"> * Inherit from `Visitor.prototype`.</td></tr><tr><td class="line">43</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">44</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">45</td><td class="hits">1</td><td class="source">Compiler.prototype.__proto__ = Visitor.prototype;</td></tr><tr><td class="line">46</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">47</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">48</td><td class="hits"></td><td class="source"> * Compile to css, and return a string of CSS.</td></tr><tr><td class="line">49</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">50</td><td class="hits"></td><td class="source"> * @return {String}</td></tr><tr><td class="line">51</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">52</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">53</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">54</td><td class="hits">1</td><td class="source">Compiler.prototype.compile = function(){</td></tr><tr class="hit"><td class="line">55</td><td class="hits">250</td><td class="source">  return this.visit(this.root);</td></tr><tr><td class="line">56</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">57</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">58</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">59</td><td class="hits"></td><td class="source"> * Return indentation string.</td></tr><tr><td class="line">60</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">61</td><td class="hits"></td><td class="source"> * @return {String}</td></tr><tr><td class="line">62</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">63</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">64</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">65</td><td class="hits">1</td><td class="source">Compiler.prototype.__defineGetter__('indent', function(){</td></tr><tr class="hit"><td class="line">66</td><td class="hits">4908</td><td class="source">  if (this.compress) return '';</td></tr><tr class="hit"><td class="line">67</td><td class="hits">4854</td><td class="source">  return new Array(this.indents).join(Array(this.spaces + 1).join(' '));</td></tr><tr><td class="line">68</td><td class="hits"></td><td class="source">});</td></tr><tr><td class="line">69</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">70</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">71</td><td class="hits"></td><td class="source"> * Visit Root.</td></tr><tr><td class="line">72</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">73</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">74</td><td class="hits">1</td><td class="source">Compiler.prototype.visitRoot = function(block){</td></tr><tr class="hit"><td class="line">75</td><td class="hits">208</td><td class="source">  this.buf = '';</td></tr><tr class="hit"><td class="line">76</td><td class="hits">208</td><td class="source">  for (var i = 0, len = block.nodes.length; i &lt; len; ++i) {</td></tr><tr class="hit"><td class="line">77</td><td class="hits">1017</td><td class="source">    var node = block.nodes[i];</td></tr><tr class="hit"><td class="line">78</td><td class="hits">1017</td><td class="source">    if (this.linenos || this.firebug) this.debugInfo(node);</td></tr><tr class="hit"><td class="line">79</td><td class="hits">1017</td><td class="source">    var ret = this.visit(node);</td></tr><tr class="hit"><td class="line">80</td><td class="hits">1068</td><td class="source">    if (ret) this.buf += ret + '\n';</td></tr><tr><td class="line">81</td><td class="hits"></td><td class="source">  }</td></tr><tr class="hit"><td class="line">82</td><td class="hits">208</td><td class="source">  return this.buf;</td></tr><tr><td class="line">83</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">84</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">85</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">86</td><td class="hits"></td><td class="source"> * Visit Block.</td></tr><tr><td class="line">87</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">88</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">89</td><td class="hits">1</td><td class="source">Compiler.prototype.visitBlock = function(block){</td></tr><tr class="hit"><td class="line">90</td><td class="hits">1208</td><td class="source">  var node;</td></tr><tr><td class="line">91</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">92</td><td class="hits">1208</td><td class="source">  if (block.hasProperties) {</td></tr><tr class="hit"><td class="line">93</td><td class="hits">1079</td><td class="source">    var arr = [this.compress ? '{' : ' {'];</td></tr><tr class="hit"><td class="line">94</td><td class="hits">1079</td><td class="source">    ++this.indents;</td></tr><tr class="hit"><td class="line">95</td><td class="hits">1079</td><td class="source">    for (var i = 0, len = block.nodes.length; i &lt; len; ++i) {</td></tr><tr class="hit"><td class="line">96</td><td class="hits">2305</td><td class="source">      this.last = len - 1 == i;</td></tr><tr class="hit"><td class="line">97</td><td class="hits">2305</td><td class="source">      node = block.nodes[i];</td></tr><tr class="hit"><td class="line">98</td><td class="hits">2305</td><td class="source">      switch (node.nodeName) {</td></tr><tr><td class="line">99</td><td class="hits"></td><td class="source">        case 'null':</td></tr><tr><td class="line">100</td><td class="hits"></td><td class="source">        case 'expression':</td></tr><tr><td class="line">101</td><td class="hits"></td><td class="source">        case 'function':</td></tr><tr><td class="line">102</td><td class="hits"></td><td class="source">        case 'jsliteral':</td></tr><tr><td class="line">103</td><td class="hits"></td><td class="source">        case 'group':</td></tr><tr><td class="line">104</td><td class="hits"></td><td class="source">        case 'unit':</td></tr><tr class="hit"><td class="line">105</td><td class="hits">168</td><td class="source">          continue;</td></tr><tr><td class="line">106</td><td class="hits"></td><td class="source">        case 'media':</td></tr><tr><td class="line">107</td><td class="hits"></td><td class="source">          // Prevent double-writing the @media declaration when</td></tr><tr><td class="line">108</td><td class="hits"></td><td class="source">          // nested inside of a function/mixin</td></tr><tr class="hit"><td class="line">109</td><td class="hits">1</td><td class="source">          if (node.block.parent.scope) {</td></tr><tr class="hit"><td class="line">110</td><td class="hits">1</td><td class="source">            continue;</td></tr><tr><td class="line">111</td><td class="hits"></td><td class="source">          }</td></tr><tr><td class="line">112</td><td class="hits"></td><td class="source">        default:</td></tr><tr class="hit"><td class="line">113</td><td class="hits">2136</td><td class="source">          arr.push(this.visit(node));</td></tr><tr><td class="line">114</td><td class="hits"></td><td class="source">      }</td></tr><tr><td class="line">115</td><td class="hits"></td><td class="source">    }</td></tr><tr class="hit"><td class="line">116</td><td class="hits">1079</td><td class="source">    --this.indents;</td></tr><tr class="hit"><td class="line">117</td><td class="hits">1079</td><td class="source">    arr.push(this.indent + '}');</td></tr><tr class="hit"><td class="line">118</td><td class="hits">1079</td><td class="source">    this.buf += arr.join(this.compress ? '' : '\n');</td></tr><tr class="hit"><td class="line">119</td><td class="hits">1079</td><td class="source">    this.buf += '\n';</td></tr><tr><td class="line">120</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">121</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">122</td><td class="hits"></td><td class="source">  // Nesting</td></tr><tr class="hit"><td class="line">123</td><td class="hits">1208</td><td class="source">  for (var i = 0, len = block.nodes.length; i &lt; len; ++i) {</td></tr><tr class="hit"><td class="line">124</td><td class="hits">2480</td><td class="source">    node = block.nodes[i];</td></tr><tr class="hit"><td class="line">125</td><td class="hits">2480</td><td class="source">    switch (node.nodeName) {</td></tr><tr><td class="line">126</td><td class="hits"></td><td class="source">      case 'group':</td></tr><tr><td class="line">127</td><td class="hits"></td><td class="source">      case 'print':</td></tr><tr><td class="line">128</td><td class="hits"></td><td class="source">      case 'page':</td></tr><tr><td class="line">129</td><td class="hits"></td><td class="source">      case 'block':</td></tr><tr><td class="line">130</td><td class="hits"></td><td class="source">      case 'keyframes':</td></tr><tr class="hit"><td class="line">131</td><td class="hits">197</td><td class="source">        if (this.linenos || this.firebug) this.debugInfo(node);</td></tr><tr class="hit"><td class="line">132</td><td class="hits">197</td><td class="source">        this.visit(node);</td></tr><tr class="hit"><td class="line">133</td><td class="hits">197</td><td class="source">        break;</td></tr><tr><td class="line">134</td><td class="hits"></td><td class="source">      case 'media':</td></tr><tr><td class="line">135</td><td class="hits"></td><td class="source">      case 'import':</td></tr><tr><td class="line">136</td><td class="hits"></td><td class="source">      case 'fontface':</td></tr><tr class="hit"><td class="line">137</td><td class="hits">8</td><td class="source">        this.visit(node);</td></tr><tr class="hit"><td class="line">138</td><td class="hits">8</td><td class="source">        break;</td></tr><tr><td class="line">139</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">140</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">141</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">142</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">143</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">144</td><td class="hits"></td><td class="source"> * Visit Keyframes.</td></tr><tr><td class="line">145</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">146</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">147</td><td class="hits">1</td><td class="source">Compiler.prototype.visitKeyframes = function(node){</td></tr><tr class="hit"><td class="line">148</td><td class="hits">31</td><td class="source">  var comma = this.compress ? ',' : ', ';</td></tr><tr><td class="line">149</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">150</td><td class="hits">31</td><td class="source">  var prefix = 'official' == node.prefix</td></tr><tr><td class="line">151</td><td class="hits"></td><td class="source">    ? ''</td></tr><tr><td class="line">152</td><td class="hits"></td><td class="source">    : '-' + node.prefix + '-';</td></tr><tr><td class="line">153</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">154</td><td class="hits">31</td><td class="source">  this.buf += '@' + prefix + 'keyframes '</td></tr><tr><td class="line">155</td><td class="hits"></td><td class="source">    + this.visit(node.name)</td></tr><tr><td class="line">156</td><td class="hits"></td><td class="source">    + (this.compress ? '{' : ' {');</td></tr><tr><td class="line">157</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">158</td><td class="hits">31</td><td class="source">  ++this.indents;</td></tr><tr class="hit"><td class="line">159</td><td class="hits">31</td><td class="source">  node.frames.forEach(function(frame){</td></tr><tr class="hit"><td class="line">160</td><td class="hits">149</td><td class="source">    if (!this.compress) this.buf += '\n  ';</td></tr><tr class="hit"><td class="line">161</td><td class="hits">76</td><td class="source">    this.buf += this.visit(frame.pos.join(comma));</td></tr><tr class="hit"><td class="line">162</td><td class="hits">76</td><td class="source">    this.visit(frame.block);</td></tr><tr><td class="line">163</td><td class="hits"></td><td class="source">  }, this);</td></tr><tr class="hit"><td class="line">164</td><td class="hits">31</td><td class="source">  --this.indents;</td></tr><tr><td class="line">165</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">166</td><td class="hits">31</td><td class="source">  this.buf += '}' + (this.compress ? '' : '\n');</td></tr><tr><td class="line">167</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">168</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">169</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">170</td><td class="hits"></td><td class="source"> * Visit Media.</td></tr><tr><td class="line">171</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">172</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">173</td><td class="hits">1</td><td class="source">Compiler.prototype.visitMedia = function(media){</td></tr><tr class="hit"><td class="line">174</td><td class="hits">21</td><td class="source">  this.buf += '@media ' + media.val;</td></tr><tr class="hit"><td class="line">175</td><td class="hits">21</td><td class="source">  this.buf += this.compress ? '{' : ' {\n';</td></tr><tr class="hit"><td class="line">176</td><td class="hits">21</td><td class="source">  ++this.indents;</td></tr><tr class="hit"><td class="line">177</td><td class="hits">21</td><td class="source">  this.visit(media.block);</td></tr><tr class="hit"><td class="line">178</td><td class="hits">21</td><td class="source">  --this.indents;</td></tr><tr class="hit"><td class="line">179</td><td class="hits">21</td><td class="source">  this.buf += '}' + (this.compress ? '' : '\n');</td></tr><tr><td class="line">180</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">181</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">182</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">183</td><td class="hits"></td><td class="source"> * Visit Page.</td></tr><tr><td class="line">184</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">185</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">186</td><td class="hits">1</td><td class="source">Compiler.prototype.visitPage = function(page){</td></tr><tr class="hit"><td class="line">187</td><td class="hits">8</td><td class="source">  this.buf += this.indent + '@page';</td></tr><tr class="hit"><td class="line">188</td><td class="hits">8</td><td class="source">  this.buf += page.selector ? ' ' + page.selector : '';</td></tr><tr class="hit"><td class="line">189</td><td class="hits">8</td><td class="source">  this.visit(page.block);</td></tr><tr><td class="line">190</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">191</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">192</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">193</td><td class="hits"></td><td class="source"> * Visit Import.</td></tr><tr><td class="line">194</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">195</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">196</td><td class="hits">1</td><td class="source">Compiler.prototype.visitImport = function(imported){</td></tr><tr class="hit"><td class="line">197</td><td class="hits">7</td><td class="source">  this.buf += '@import ' + this.visit(imported.path) + ';\n';</td></tr><tr><td class="line">198</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">199</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">200</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">201</td><td class="hits"></td><td class="source"> * Visit FontFace.</td></tr><tr><td class="line">202</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">203</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">204</td><td class="hits">1</td><td class="source">Compiler.prototype.visitFontFace = function(face){</td></tr><tr class="hit"><td class="line">205</td><td class="hits">2</td><td class="source">  this.buf += this.indent + '@font-face';</td></tr><tr class="hit"><td class="line">206</td><td class="hits">2</td><td class="source">  this.visit(face.block);</td></tr><tr><td class="line">207</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">208</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">209</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">210</td><td class="hits"></td><td class="source"> * Visit JSLiteral.</td></tr><tr><td class="line">211</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">212</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">213</td><td class="hits">1</td><td class="source">Compiler.prototype.visitJSLiteral = function(js){</td></tr><tr class="miss"><td class="line">214</td><td class="hits">0</td><td class="source">  this.js += '\n' + js.val.replace(/@selector/g, '&quot;' + this.selector + '&quot;');</td></tr><tr class="miss"><td class="line">215</td><td class="hits">0</td><td class="source">  return '';</td></tr><tr><td class="line">216</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">217</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">218</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">219</td><td class="hits"></td><td class="source"> * Visit Comment.</td></tr><tr><td class="line">220</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">221</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">222</td><td class="hits">1</td><td class="source">Compiler.prototype.visitComment = function(comment){</td></tr><tr class="hit"><td class="line">223</td><td class="hits">55</td><td class="source">  return this.compress</td></tr><tr><td class="line">224</td><td class="hits"></td><td class="source">    ? comment.suppress</td></tr><tr><td class="line">225</td><td class="hits"></td><td class="source">      ? ''</td></tr><tr><td class="line">226</td><td class="hits"></td><td class="source">      : comment.str</td></tr><tr><td class="line">227</td><td class="hits"></td><td class="source">    : comment.str;</td></tr><tr><td class="line">228</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">229</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">230</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">231</td><td class="hits"></td><td class="source"> * Visit Function.</td></tr><tr><td class="line">232</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">233</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">234</td><td class="hits">1</td><td class="source">Compiler.prototype.visitFunction = function(fn){</td></tr><tr class="hit"><td class="line">235</td><td class="hits">8</td><td class="source">  return fn.name;</td></tr><tr><td class="line">236</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">237</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">238</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">239</td><td class="hits"></td><td class="source"> * Visit Variable.</td></tr><tr><td class="line">240</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">241</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">242</td><td class="hits">1</td><td class="source">Compiler.prototype.visitVariable = function(variable){</td></tr><tr class="miss"><td class="line">243</td><td class="hits">0</td><td class="source">  return '';</td></tr><tr><td class="line">244</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">245</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">246</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">247</td><td class="hits"></td><td class="source"> * Visit Charset.</td></tr><tr><td class="line">248</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">249</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">250</td><td class="hits">1</td><td class="source">Compiler.prototype.visitCharset = function(charset){</td></tr><tr class="hit"><td class="line">251</td><td class="hits">1</td><td class="source">  return '@charset ' + this.visit(charset.val) + ';';</td></tr><tr><td class="line">252</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">253</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">254</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">255</td><td class="hits"></td><td class="source"> * Visit Literal.</td></tr><tr><td class="line">256</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">257</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">258</td><td class="hits">1</td><td class="source">Compiler.prototype.visitLiteral = function(lit){</td></tr><tr class="hit"><td class="line">259</td><td class="hits">107</td><td class="source">  return lit.val.trim().replace(/^  /gm, '');</td></tr><tr><td class="line">260</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">261</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">262</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">263</td><td class="hits"></td><td class="source"> * Visit Boolean.</td></tr><tr><td class="line">264</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">265</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">266</td><td class="hits">1</td><td class="source">Compiler.prototype.visitBoolean = function(bool){</td></tr><tr class="hit"><td class="line">267</td><td class="hits">183</td><td class="source">  return bool.toString();</td></tr><tr><td class="line">268</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">269</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">270</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">271</td><td class="hits"></td><td class="source"> * Visit RGBA.</td></tr><tr><td class="line">272</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">273</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">274</td><td class="hits">1</td><td class="source">Compiler.prototype.visitRGBA = function(rgba){</td></tr><tr class="hit"><td class="line">275</td><td class="hits">356</td><td class="source">  return rgba.toString();</td></tr><tr><td class="line">276</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">277</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">278</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">279</td><td class="hits"></td><td class="source"> * Visit HSLA.</td></tr><tr><td class="line">280</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">281</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">282</td><td class="hits">1</td><td class="source">Compiler.prototype.visitHSLA = function(hsla){</td></tr><tr class="hit"><td class="line">283</td><td class="hits">37</td><td class="source">  return hsla.rgba.toString();</td></tr><tr><td class="line">284</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">285</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">286</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">287</td><td class="hits"></td><td class="source"> * Visit Unit.</td></tr><tr><td class="line">288</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">289</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">290</td><td class="hits">1</td><td class="source">Compiler.prototype.visitUnit = function(unit){</td></tr><tr class="hit"><td class="line">291</td><td class="hits">1571</td><td class="source">  var type = unit.type || ''</td></tr><tr><td class="line">292</td><td class="hits"></td><td class="source">    , n = unit.val</td></tr><tr><td class="line">293</td><td class="hits"></td><td class="source">    , float = n != (n | 0);</td></tr><tr><td class="line">294</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">295</td><td class="hits"></td><td class="source">  // Compress</td></tr><tr class="hit"><td class="line">296</td><td class="hits">1571</td><td class="source">  if (this.compress) {</td></tr><tr><td class="line">297</td><td class="hits"></td><td class="source">    // Zero is always '0', unless when</td></tr><tr><td class="line">298</td><td class="hits"></td><td class="source">    // a percentage, this is required by keyframes</td></tr><tr class="hit"><td class="line">299</td><td class="hits">16</td><td class="source">    if ('%' != type &amp;&amp; 0 == n) return '0';</td></tr><tr><td class="line">300</td><td class="hits"></td><td class="source">    // Omit leading '0' on floats</td></tr><tr class="hit"><td class="line">301</td><td class="hits">12</td><td class="source">    if (float &amp;&amp; n &lt; 1 &amp;&amp; n &gt; -1) {</td></tr><tr class="hit"><td class="line">302</td><td class="hits">4</td><td class="source">      return n.toString().replace('0.', '.') + type;</td></tr><tr><td class="line">303</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">304</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">305</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">306</td><td class="hits">1565</td><td class="source">  return n.toString() + type;</td></tr><tr><td class="line">307</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">308</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">309</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">310</td><td class="hits"></td><td class="source"> * Visit Group.</td></tr><tr><td class="line">311</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">312</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">313</td><td class="hits">1</td><td class="source">Compiler.prototype.visitGroup = function(group){</td></tr><tr class="hit"><td class="line">314</td><td class="hits">1076</td><td class="source">  var stack = this.stack;</td></tr><tr><td class="line">315</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">316</td><td class="hits">1076</td><td class="source">  stack.push(group.nodes);</td></tr><tr><td class="line">317</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">318</td><td class="hits"></td><td class="source">  // selectors</td></tr><tr class="hit"><td class="line">319</td><td class="hits">1076</td><td class="source">  if (group.block.hasProperties) {</td></tr><tr class="hit"><td class="line">320</td><td class="hits">993</td><td class="source">    var selectors = this.compileSelectors(stack);</td></tr><tr class="hit"><td class="line">321</td><td class="hits">993</td><td class="source">    this.buf += (this.selector = selectors.join(this.compress ? ',' : ',\n'));</td></tr><tr><td class="line">322</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">323</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">324</td><td class="hits"></td><td class="source">  // output block</td></tr><tr class="hit"><td class="line">325</td><td class="hits">1076</td><td class="source">  this.visit(group.block);</td></tr><tr class="hit"><td class="line">326</td><td class="hits">1076</td><td class="source">  stack.pop();</td></tr><tr><td class="line">327</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">328</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">329</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">330</td><td class="hits"></td><td class="source"> * Visit Ident.</td></tr><tr><td class="line">331</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">332</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">333</td><td class="hits">1</td><td class="source">Compiler.prototype.visitIdent = function(ident){</td></tr><tr class="hit"><td class="line">334</td><td class="hits">610</td><td class="source">  return ident.name;</td></tr><tr><td class="line">335</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">336</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">337</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">338</td><td class="hits"></td><td class="source"> * Visit String.</td></tr><tr><td class="line">339</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">340</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">341</td><td class="hits">1</td><td class="source">Compiler.prototype.visitString = function(string){</td></tr><tr class="hit"><td class="line">342</td><td class="hits">260</td><td class="source">  return this.isURL</td></tr><tr><td class="line">343</td><td class="hits"></td><td class="source">    ? string.val</td></tr><tr><td class="line">344</td><td class="hits"></td><td class="source">    : string.toString();</td></tr><tr><td class="line">345</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">346</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">347</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">348</td><td class="hits"></td><td class="source"> * Visit Null.</td></tr><tr><td class="line">349</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">350</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">351</td><td class="hits">1</td><td class="source">Compiler.prototype.visitNull = function(node){</td></tr><tr class="hit"><td class="line">352</td><td class="hits">20</td><td class="source">  return '';</td></tr><tr><td class="line">353</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">354</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">355</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">356</td><td class="hits"></td><td class="source"> * Visit Call.</td></tr><tr><td class="line">357</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">358</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">359</td><td class="hits">1</td><td class="source">Compiler.prototype.visitCall = function(call){</td></tr><tr class="hit"><td class="line">360</td><td class="hits">54</td><td class="source">  this.isURL = 'url' == call.name;</td></tr><tr class="hit"><td class="line">361</td><td class="hits">54</td><td class="source">  var args = call.args.nodes.map(function(arg){</td></tr><tr class="hit"><td class="line">362</td><td class="hits">61</td><td class="source">    return this.visit(arg);</td></tr><tr><td class="line">363</td><td class="hits"></td><td class="source">  }, this).join(this.compress ? ',' : ', ');</td></tr><tr class="hit"><td class="line">364</td><td class="hits">54</td><td class="source">  if (this.isURL) args = '&quot;' + args + '&quot;';</td></tr><tr class="hit"><td class="line">365</td><td class="hits">54</td><td class="source">  delete this.isURL;</td></tr><tr class="hit"><td class="line">366</td><td class="hits">54</td><td class="source">  return call.name + '(' + args + ')';</td></tr><tr><td class="line">367</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">368</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">369</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">370</td><td class="hits"></td><td class="source"> * Visit Expression.</td></tr><tr><td class="line">371</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">372</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">373</td><td class="hits">1</td><td class="source">Compiler.prototype.visitExpression = function(expr){</td></tr><tr class="hit"><td class="line">374</td><td class="hits">3062</td><td class="source">  var buf = []</td></tr><tr><td class="line">375</td><td class="hits"></td><td class="source">    , self = this</td></tr><tr><td class="line">376</td><td class="hits"></td><td class="source">    , len = expr.nodes.length</td></tr><tr class="hit"><td class="line">377</td><td class="hits">3859</td><td class="source">    , nodes = expr.nodes.map(function(node){ return self.visit(node); });</td></tr><tr><td class="line">378</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">379</td><td class="hits">3062</td><td class="source">  nodes.forEach(function(node, i){</td></tr><tr class="hit"><td class="line">380</td><td class="hits">3859</td><td class="source">    var last = i == len - 1;</td></tr><tr class="hit"><td class="line">381</td><td class="hits">3859</td><td class="source">    buf.push(node);</td></tr><tr class="hit"><td class="line">382</td><td class="hits">3884</td><td class="source">    if ('/' == nodes[i + 1] || '/' == node) return;</td></tr><tr class="hit"><td class="line">383</td><td class="hits">6892</td><td class="source">    if (last) return;</td></tr><tr class="hit"><td class="line">384</td><td class="hits">776</td><td class="source">    buf.push(expr.isList</td></tr><tr><td class="line">385</td><td class="hits"></td><td class="source">      ? (self.compress ? ',' : ', ')</td></tr><tr><td class="line">386</td><td class="hits"></td><td class="source">      : (self.isURL ? '' : ' '));</td></tr><tr><td class="line">387</td><td class="hits"></td><td class="source">  });</td></tr><tr><td class="line">388</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">389</td><td class="hits">3062</td><td class="source">  return buf.join('');</td></tr><tr><td class="line">390</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">391</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">392</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">393</td><td class="hits"></td><td class="source"> * Visit Arguments.</td></tr><tr><td class="line">394</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">395</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">396</td><td class="hits">1</td><td class="source">Compiler.prototype.visitArguments = Compiler.prototype.visitExpression;</td></tr><tr><td class="line">397</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">398</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">399</td><td class="hits"></td><td class="source"> * Visit Property.</td></tr><tr><td class="line">400</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">401</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">402</td><td class="hits">1</td><td class="source">Compiler.prototype.visitProperty = function(prop){</td></tr><tr class="hit"><td class="line">403</td><td class="hits">2131</td><td class="source">  var self = this</td></tr><tr><td class="line">404</td><td class="hits"></td><td class="source">    , val = this.visit(prop.expr);</td></tr><tr class="hit"><td class="line">405</td><td class="hits">2131</td><td class="source">  return this.indent + (prop.name || prop.segments.join(''))</td></tr><tr><td class="line">406</td><td class="hits"></td><td class="source">    + (this.compress ? ':' + val : ': ' + val)</td></tr><tr><td class="line">407</td><td class="hits"></td><td class="source">    + (this.compress</td></tr><tr><td class="line">408</td><td class="hits"></td><td class="source">        ? (this.last ? '' : ';')</td></tr><tr><td class="line">409</td><td class="hits"></td><td class="source">        : ';');</td></tr><tr><td class="line">410</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">411</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">412</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">413</td><td class="hits"></td><td class="source"> * Compile selector strings in `arr` from the bottom-up</td></tr><tr><td class="line">414</td><td class="hits"></td><td class="source"> * to produce the selector combinations. For example</td></tr><tr><td class="line">415</td><td class="hits"></td><td class="source"> * the following Stylus:</td></tr><tr><td class="line">416</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">417</td><td class="hits"></td><td class="source"> *    ul</td></tr><tr><td class="line">418</td><td class="hits"></td><td class="source"> *      li</td></tr><tr><td class="line">419</td><td class="hits"></td><td class="source"> *      p</td></tr><tr><td class="line">420</td><td class="hits"></td><td class="source"> *        a</td></tr><tr><td class="line">421</td><td class="hits"></td><td class="source"> *          color: red</td></tr><tr><td class="line">422</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">423</td><td class="hits"></td><td class="source"> * Would return:</td></tr><tr><td class="line">424</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">425</td><td class="hits"></td><td class="source"> *      [ 'ul li a', 'ul p a' ]</td></tr><tr><td class="line">426</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">427</td><td class="hits"></td><td class="source"> * @param {Array} arr</td></tr><tr><td class="line">428</td><td class="hits"></td><td class="source"> * @return {Array}</td></tr><tr><td class="line">429</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">430</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">431</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">432</td><td class="hits">1</td><td class="source">Compiler.prototype.compileSelectors = function(arr){</td></tr><tr class="hit"><td class="line">433</td><td class="hits">993</td><td class="source">  var stack = this.stack</td></tr><tr><td class="line">434</td><td class="hits"></td><td class="source">    , self = this</td></tr><tr><td class="line">435</td><td class="hits"></td><td class="source">    , selectors = []</td></tr><tr><td class="line">436</td><td class="hits"></td><td class="source">    , buf = [];</td></tr><tr><td class="line">437</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">438</td><td class="hits">993</td><td class="source">  function compile(arr, i) {</td></tr><tr class="hit"><td class="line">439</td><td class="hits">1211</td><td class="source">    if (i) {</td></tr><tr class="hit"><td class="line">440</td><td class="hits">173</td><td class="source">      arr[i].forEach(function(selector){</td></tr><tr class="hit"><td class="line">441</td><td class="hits">222</td><td class="source">        if (selector.inherits) {</td></tr><tr class="hit"><td class="line">442</td><td class="hits">218</td><td class="source">          buf.unshift(selector.val);</td></tr><tr class="hit"><td class="line">443</td><td class="hits">218</td><td class="source">          compile(arr, i - 1);</td></tr><tr class="hit"><td class="line">444</td><td class="hits">218</td><td class="source">          buf.shift();</td></tr><tr><td class="line">445</td><td class="hits"></td><td class="source">        } else {</td></tr><tr class="hit"><td class="line">446</td><td class="hits">4</td><td class="source">          selectors.push(selector.val);</td></tr><tr><td class="line">447</td><td class="hits"></td><td class="source">        }</td></tr><tr><td class="line">448</td><td class="hits"></td><td class="source">      });</td></tr><tr><td class="line">449</td><td class="hits"></td><td class="source">    } else {</td></tr><tr class="hit"><td class="line">450</td><td class="hits">1038</td><td class="source">      arr[0].forEach(function(selector){</td></tr><tr class="hit"><td class="line">451</td><td class="hits">1661</td><td class="source">        var str = selector.val.trim();</td></tr><tr class="hit"><td class="line">452</td><td class="hits">1661</td><td class="source">        if (buf.length) {</td></tr><tr class="hit"><td class="line">453</td><td class="hits">196</td><td class="source">          for (var i = 0, len = buf.length; i &lt; len; ++i) {</td></tr><tr class="hit"><td class="line">454</td><td class="hits">271</td><td class="source">            if (~buf[i].indexOf('&amp;')) {</td></tr><tr class="hit"><td class="line">455</td><td class="hits">59</td><td class="source">              str = buf[i].replace(/&amp;/g, str).trim();</td></tr><tr><td class="line">456</td><td class="hits"></td><td class="source">            } else {</td></tr><tr class="hit"><td class="line">457</td><td class="hits">212</td><td class="source">              str += ' ' + buf[i].trim();</td></tr><tr><td class="line">458</td><td class="hits"></td><td class="source">            }</td></tr><tr><td class="line">459</td><td class="hits"></td><td class="source">          }</td></tr><tr><td class="line">460</td><td class="hits"></td><td class="source">        }</td></tr><tr class="hit"><td class="line">461</td><td class="hits">1661</td><td class="source">        selectors.push(self.indent + str.trimRight());</td></tr><tr><td class="line">462</td><td class="hits"></td><td class="source">      });</td></tr><tr><td class="line">463</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">464</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">465</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">466</td><td class="hits">993</td><td class="source">  compile(arr, arr.length - 1);</td></tr><tr><td class="line">467</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">468</td><td class="hits">993</td><td class="source">  return selectors;</td></tr><tr><td class="line">469</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">470</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">471</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">472</td><td class="hits"></td><td class="source"> * Debug info.</td></tr><tr><td class="line">473</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">474</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">475</td><td class="hits">1</td><td class="source">Compiler.prototype.debugInfo = function(node){</td></tr><tr><td class="line">476</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">477</td><td class="hits">0</td><td class="source">  var path = fs.realpathSync(node.filename)</td></tr><tr><td class="line">478</td><td class="hits"></td><td class="source">    , line = node.nodes ? node.nodes[0].lineno : node.lineno;</td></tr><tr><td class="line">479</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">480</td><td class="hits">0</td><td class="source">  if (this.linenos){</td></tr><tr class="miss"><td class="line">481</td><td class="hits">0</td><td class="source">    this.buf += '\n/* ' + 'line ' + line + ' : ' + path + ' */\n';</td></tr><tr><td class="line">482</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">483</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">484</td><td class="hits">0</td><td class="source">  if (this.firebug){</td></tr><tr><td class="line">485</td><td class="hits"></td><td class="source">    // debug info for firebug, the crazy formatting is needed</td></tr><tr class="miss"><td class="line">486</td><td class="hits">0</td><td class="source">    path = 'file\\\:\\\/\\\/' + path.replace(/(\/|\.)/g, '\\$1');</td></tr><tr class="miss"><td class="line">487</td><td class="hits">0</td><td class="source">    line = '\\00003' + line;</td></tr><tr class="miss"><td class="line">488</td><td class="hits">0</td><td class="source">    this.buf += '\n@media -stylus-debug-info'</td></tr><tr><td class="line">489</td><td class="hits"></td><td class="source">      + '{filename{font-family:' + path</td></tr><tr><td class="line">490</td><td class="hits"></td><td class="source">      + '}line{font-family:' + line + '}}\n';</td></tr><tr><td class="line">491</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">492</td><td class="hits"></td><td class="source">}</td></tr></tbody></table></div><div class="file"><h2 id="functions/image.js">functions/image.js</h2><div id="stats" class="high"><div class="percentage">91%</div><div class="sloc">36</div><div class="hits">33</div><div class="misses">3</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr><td class="line">1</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source">/*!</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source"> * Stylus - plugin - url</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> * Copyright(c) 2010 LearnBoost &lt;dev@learnboost.com&gt;</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> * MIT Licensed</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source"> * Module dependencies.</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">12</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">13</td><td class="hits">1</td><td class="source">var utils = require('../utils')</td></tr><tr><td class="line">14</td><td class="hits"></td><td class="source">  , nodes = require('../nodes')</td></tr><tr><td class="line">15</td><td class="hits"></td><td class="source">  , fs = require('fs');</td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">17</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source"> * Initialize a new `Image` with the given `ctx` and `path.</td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source"> * @param {Evaluator} ctx</td></tr><tr><td class="line">21</td><td class="hits"></td><td class="source"> * @param {String} path</td></tr><tr><td class="line">22</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">23</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">24</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">25</td><td class="hits">1</td><td class="source">var Image = module.exports = function Image(ctx, path) {</td></tr><tr class="hit"><td class="line">26</td><td class="hits">7</td><td class="source">  this.ctx = ctx;</td></tr><tr class="hit"><td class="line">27</td><td class="hits">7</td><td class="source">  this.path = utils.lookup(path, ctx.paths);</td></tr><tr class="hit"><td class="line">28</td><td class="hits">7</td><td class="source">  if (!this.path) throw new Error('failed to locate file ' + path);</td></tr><tr><td class="line">29</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">30</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">31</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">32</td><td class="hits"></td><td class="source"> * Open the image for reading.</td></tr><tr><td class="line">33</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">34</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">35</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">36</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">37</td><td class="hits">1</td><td class="source">Image.prototype.open = function(){</td></tr><tr class="hit"><td class="line">38</td><td class="hits">7</td><td class="source">  this.fd = fs.openSync(this.path, 'r');</td></tr><tr><td class="line">39</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">40</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">41</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">42</td><td class="hits"></td><td class="source"> * Close the file.</td></tr><tr><td class="line">43</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">44</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">45</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">46</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">47</td><td class="hits">1</td><td class="source">Image.prototype.close = function(){</td></tr><tr class="hit"><td class="line">48</td><td class="hits">14</td><td class="source">  if (this.fd) fs.closeSync(this.fd);</td></tr><tr><td class="line">49</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">50</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">51</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">52</td><td class="hits"></td><td class="source"> * Return the type of image, supports:</td></tr><tr><td class="line">53</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">54</td><td class="hits"></td><td class="source"> *  - gif</td></tr><tr><td class="line">55</td><td class="hits"></td><td class="source"> *  - png</td></tr><tr><td class="line">56</td><td class="hits"></td><td class="source"> *  - jpeg</td></tr><tr><td class="line">57</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">58</td><td class="hits"></td><td class="source"> * @return {String}</td></tr><tr><td class="line">59</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">60</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">61</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">62</td><td class="hits">1</td><td class="source">Image.prototype.type = function(){</td></tr><tr class="hit"><td class="line">63</td><td class="hits">7</td><td class="source">  var type</td></tr><tr><td class="line">64</td><td class="hits"></td><td class="source">    , buf = new Buffer(4);</td></tr><tr><td class="line">65</td><td class="hits"></td><td class="source">  </td></tr><tr class="hit"><td class="line">66</td><td class="hits">7</td><td class="source">  fs.readSync(this.fd, buf, 0, 4, 0);</td></tr><tr><td class="line">67</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">68</td><td class="hits"></td><td class="source">  // GIF</td></tr><tr class="hit"><td class="line">69</td><td class="hits">12</td><td class="source">  if (0x47 == buf[0] &amp;&amp; 0x49 == buf[1] &amp;&amp; 0x46 == buf[2]) type = 'gif';</td></tr><tr><td class="line">70</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">71</td><td class="hits"></td><td class="source">  // PNG</td></tr><tr class="hit"><td class="line">72</td><td class="hits">4</td><td class="source">  else if (0x50 == buf[1] &amp;&amp; 0x4E == buf[2] &amp;&amp; 0x47 == buf[3]) type = 'png';</td></tr><tr><td class="line">73</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">74</td><td class="hits"></td><td class="source">  // JPEG</td></tr><tr class="miss"><td class="line">75</td><td class="hits">0</td><td class="source">  else if (0xff == buf[0] &amp;&amp; 0xd8 == buf[1]) type = 'jpeg';</td></tr><tr><td class="line">76</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">77</td><td class="hits">7</td><td class="source">  return type;</td></tr><tr><td class="line">78</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">79</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">80</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">81</td><td class="hits"></td><td class="source"> * Return image dimensions `[width, height]`.</td></tr><tr><td class="line">82</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">83</td><td class="hits"></td><td class="source"> * @return {Array}</td></tr><tr><td class="line">84</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">85</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">86</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">87</td><td class="hits">1</td><td class="source">Image.prototype.size = function(){</td></tr><tr class="hit"><td class="line">88</td><td class="hits">7</td><td class="source">  var type = this.type()</td></tr><tr><td class="line">89</td><td class="hits"></td><td class="source">    , width</td></tr><tr><td class="line">90</td><td class="hits"></td><td class="source">    , height</td></tr><tr><td class="line">91</td><td class="hits"></td><td class="source">    , buf;</td></tr><tr><td class="line">92</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">93</td><td class="hits">17</td><td class="source">  function uint16(b) { return b[1] &lt;&lt; 8 | b[0]; }</td></tr><tr class="hit"><td class="line">94</td><td class="hits">11</td><td class="source">  function uint32(b) { return b[0] &lt;&lt; 24 | b[1] &lt;&lt; 16 | b[2] &lt;&lt; 8 | b[3]; } </td></tr><tr><td class="line">95</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">96</td><td class="hits"></td><td class="source">  // Determine dimensions</td></tr><tr class="hit"><td class="line">97</td><td class="hits">7</td><td class="source">  switch (type) {</td></tr><tr><td class="line">98</td><td class="hits"></td><td class="source">    case 'jpeg':</td></tr><tr class="miss"><td class="line">99</td><td class="hits">0</td><td class="source">      throw new Error('image-size() jpeg support not yet implemented');</td></tr><tr class="miss"><td class="line">100</td><td class="hits">0</td><td class="source">      break;</td></tr><tr><td class="line">101</td><td class="hits"></td><td class="source">    case 'png':</td></tr><tr class="hit"><td class="line">102</td><td class="hits">2</td><td class="source">      buf = new Buffer(8);</td></tr><tr><td class="line">103</td><td class="hits"></td><td class="source">      // IHDR chunk width / height uint32_t big-endian</td></tr><tr class="hit"><td class="line">104</td><td class="hits">2</td><td class="source">      fs.readSync(this.fd, buf, 0, 8, 16);</td></tr><tr class="hit"><td class="line">105</td><td class="hits">2</td><td class="source">      width = uint32(buf);</td></tr><tr class="hit"><td class="line">106</td><td class="hits">2</td><td class="source">      height = uint32(buf.slice(4, 8));</td></tr><tr class="hit"><td class="line">107</td><td class="hits">2</td><td class="source">      break;</td></tr><tr><td class="line">108</td><td class="hits"></td><td class="source">    case 'gif':</td></tr><tr class="hit"><td class="line">109</td><td class="hits">5</td><td class="source">      buf = new Buffer(4);</td></tr><tr><td class="line">110</td><td class="hits"></td><td class="source">      // width / height uint16_t little-endian</td></tr><tr class="hit"><td class="line">111</td><td class="hits">5</td><td class="source">      fs.readSync(this.fd, buf, 0, 4, 6);</td></tr><tr class="hit"><td class="line">112</td><td class="hits">5</td><td class="source">      width = uint16(buf);</td></tr><tr class="hit"><td class="line">113</td><td class="hits">5</td><td class="source">      height = uint16(buf.slice(2, 4));</td></tr><tr class="hit"><td class="line">114</td><td class="hits">5</td><td class="source">      break;</td></tr><tr><td class="line">115</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">116</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">117</td><td class="hits">7</td><td class="source">  if ('number' != typeof width) throw new Error('failed to find width of &quot;' + this.path + '&quot;');</td></tr><tr class="hit"><td class="line">118</td><td class="hits">7</td><td class="source">  if ('number' != typeof height) throw new Error('failed to find height of &quot;' + this.path + '&quot;');</td></tr><tr><td class="line">119</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">120</td><td class="hits">7</td><td class="source">  return [width, height];</td></tr><tr><td class="line">121</td><td class="hits"></td><td class="source">};</td></tr></tbody></table></div><div class="file"><h2 id="colors.js">colors.js</h2><div id="stats" class="high"><div class="percentage">100%</div><div class="sloc">1</div><div class="hits">1</div><div class="misses">0</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr><td class="line">1</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source">/*!</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source"> * Stylus - colors</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source"> * Copyright(c) 2010 LearnBoost &lt;dev@learnboost.com&gt;</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> * MIT Licensed</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">8</td><td class="hits">1</td><td class="source">module.exports = {</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source">    aliceblue: [240, 248, 255]</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source">  , antiquewhite: [250, 235, 215]</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source">  , aqua: [0, 255, 255]</td></tr><tr><td class="line">12</td><td class="hits"></td><td class="source">  , aquamarine: [127, 255, 212]</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source">  , azure: [240, 255, 255]</td></tr><tr><td class="line">14</td><td class="hits"></td><td class="source">  , beige: [245, 245, 220]</td></tr><tr><td class="line">15</td><td class="hits"></td><td class="source">  , bisque: [255, 228, 196]</td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source">  , black: [0, 0, 0]</td></tr><tr><td class="line">17</td><td class="hits"></td><td class="source">  , blanchedalmond: [255, 235, 205]</td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source">  , blue: [0, 0, 255]</td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source">  , blueviolet: [138, 43, 226]</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source">  , brown: [165, 42, 42]</td></tr><tr><td class="line">21</td><td class="hits"></td><td class="source">  , burlywood: [222, 184, 135]</td></tr><tr><td class="line">22</td><td class="hits"></td><td class="source">  , cadetblue: [95, 158, 160]</td></tr><tr><td class="line">23</td><td class="hits"></td><td class="source">  , chartreuse: [127, 255, 0]</td></tr><tr><td class="line">24</td><td class="hits"></td><td class="source">  , chocolate: [210, 105, 30]</td></tr><tr><td class="line">25</td><td class="hits"></td><td class="source">  , coral: [255, 127, 80]</td></tr><tr><td class="line">26</td><td class="hits"></td><td class="source">  , cornflowerblue: [100, 149, 237]</td></tr><tr><td class="line">27</td><td class="hits"></td><td class="source">  , cornsilk: [255, 248, 220]</td></tr><tr><td class="line">28</td><td class="hits"></td><td class="source">  , crimson: [220, 20, 60]</td></tr><tr><td class="line">29</td><td class="hits"></td><td class="source">  , cyan: [0, 255, 255]</td></tr><tr><td class="line">30</td><td class="hits"></td><td class="source">  , darkblue: [0, 0, 139]</td></tr><tr><td class="line">31</td><td class="hits"></td><td class="source">  , darkcyan: [0, 139, 139]</td></tr><tr><td class="line">32</td><td class="hits"></td><td class="source">  , darkgoldenrod: [184, 132, 11]</td></tr><tr><td class="line">33</td><td class="hits"></td><td class="source">  , darkgray: [169, 169, 169]</td></tr><tr><td class="line">34</td><td class="hits"></td><td class="source">  , darkgreen: [0, 100, 0]</td></tr><tr><td class="line">35</td><td class="hits"></td><td class="source">  , darkgrey: [169, 169, 169]</td></tr><tr><td class="line">36</td><td class="hits"></td><td class="source">  , darkkhaki: [189, 183, 107]</td></tr><tr><td class="line">37</td><td class="hits"></td><td class="source">  , darkmagenta: [139, 0, 139]</td></tr><tr><td class="line">38</td><td class="hits"></td><td class="source">  , darkolivegreen: [85, 107, 47]</td></tr><tr><td class="line">39</td><td class="hits"></td><td class="source">  , darkorange: [255, 140, 0]</td></tr><tr><td class="line">40</td><td class="hits"></td><td class="source">  , darkorchid: [153, 50, 204]</td></tr><tr><td class="line">41</td><td class="hits"></td><td class="source">  , darkred: [139, 0, 0]</td></tr><tr><td class="line">42</td><td class="hits"></td><td class="source">  , darksalmon: [233, 150, 122]</td></tr><tr><td class="line">43</td><td class="hits"></td><td class="source">  , darkseagreen: [143, 188, 143]</td></tr><tr><td class="line">44</td><td class="hits"></td><td class="source">  , darkslateblue: [72, 61, 139]</td></tr><tr><td class="line">45</td><td class="hits"></td><td class="source">  , darkslategray: [47, 79, 79]</td></tr><tr><td class="line">46</td><td class="hits"></td><td class="source">  , darkslategrey: [47, 79, 79]</td></tr><tr><td class="line">47</td><td class="hits"></td><td class="source">  , darkturquoise: [0, 206, 209]</td></tr><tr><td class="line">48</td><td class="hits"></td><td class="source">  , darkviolet: [148, 0, 211]</td></tr><tr><td class="line">49</td><td class="hits"></td><td class="source">  , deeppink: [255, 20, 147]</td></tr><tr><td class="line">50</td><td class="hits"></td><td class="source">  , deepskyblue: [0, 191, 255]</td></tr><tr><td class="line">51</td><td class="hits"></td><td class="source">  , dimgray: [105, 105, 105]</td></tr><tr><td class="line">52</td><td class="hits"></td><td class="source">  , dimgrey: [105, 105, 105]</td></tr><tr><td class="line">53</td><td class="hits"></td><td class="source">  , dodgerblue: [30, 144, 255]</td></tr><tr><td class="line">54</td><td class="hits"></td><td class="source">  , firebrick: [178, 34, 34]</td></tr><tr><td class="line">55</td><td class="hits"></td><td class="source">  , floralwhite: [255, 255, 240]</td></tr><tr><td class="line">56</td><td class="hits"></td><td class="source">  , forestgreen: [34, 139, 34]</td></tr><tr><td class="line">57</td><td class="hits"></td><td class="source">  , fuchsia: [255, 0, 255]</td></tr><tr><td class="line">58</td><td class="hits"></td><td class="source">  , gainsboro: [220, 220, 220]</td></tr><tr><td class="line">59</td><td class="hits"></td><td class="source">  , ghostwhite: [248, 248, 255]</td></tr><tr><td class="line">60</td><td class="hits"></td><td class="source">  , gold: [255, 215, 0]</td></tr><tr><td class="line">61</td><td class="hits"></td><td class="source">  , goldenrod: [218, 165, 32]</td></tr><tr><td class="line">62</td><td class="hits"></td><td class="source">  , gray: [128, 128, 128]</td></tr><tr><td class="line">63</td><td class="hits"></td><td class="source">  , green: [0, 128, 0]</td></tr><tr><td class="line">64</td><td class="hits"></td><td class="source">  , greenyellow: [173, 255, 47]</td></tr><tr><td class="line">65</td><td class="hits"></td><td class="source">  , grey: [128, 128, 128]</td></tr><tr><td class="line">66</td><td class="hits"></td><td class="source">  , honeydew: [240, 255, 240]</td></tr><tr><td class="line">67</td><td class="hits"></td><td class="source">  , hotpink: [255, 105, 180]</td></tr><tr><td class="line">68</td><td class="hits"></td><td class="source">  , indianred: [205, 92, 92]</td></tr><tr><td class="line">69</td><td class="hits"></td><td class="source">  , indigo: [75, 0, 130]</td></tr><tr><td class="line">70</td><td class="hits"></td><td class="source">  , ivory: [255, 255, 240]</td></tr><tr><td class="line">71</td><td class="hits"></td><td class="source">  , khaki: [240, 230, 140]</td></tr><tr><td class="line">72</td><td class="hits"></td><td class="source">  , lavender: [230, 230, 250]</td></tr><tr><td class="line">73</td><td class="hits"></td><td class="source">  , lavenderblush: [255, 240, 245]</td></tr><tr><td class="line">74</td><td class="hits"></td><td class="source">  , lawngreen: [124, 252, 0]</td></tr><tr><td class="line">75</td><td class="hits"></td><td class="source">  , lemonchiffon: [255, 250, 205]</td></tr><tr><td class="line">76</td><td class="hits"></td><td class="source">  , lightblue: [173, 216, 230]</td></tr><tr><td class="line">77</td><td class="hits"></td><td class="source">  , lightcoral: [240, 128, 128]</td></tr><tr><td class="line">78</td><td class="hits"></td><td class="source">  , lightcyan: [224, 255, 255]</td></tr><tr><td class="line">79</td><td class="hits"></td><td class="source">  , lightgoldenrodyellow: [250, 250, 210]</td></tr><tr><td class="line">80</td><td class="hits"></td><td class="source">  , lightgray: [211, 211, 211]</td></tr><tr><td class="line">81</td><td class="hits"></td><td class="source">  , lightgreen: [144, 238, 144]</td></tr><tr><td class="line">82</td><td class="hits"></td><td class="source">  , lightgrey: [211, 211, 211]</td></tr><tr><td class="line">83</td><td class="hits"></td><td class="source">  , lightpink: [255, 182, 193]</td></tr><tr><td class="line">84</td><td class="hits"></td><td class="source">  , lightsalmon: [255, 160, 122]</td></tr><tr><td class="line">85</td><td class="hits"></td><td class="source">  , lightseagreen: [32, 178, 170]</td></tr><tr><td class="line">86</td><td class="hits"></td><td class="source">  , lightskyblue: [135, 206, 250]</td></tr><tr><td class="line">87</td><td class="hits"></td><td class="source">  , lightslategray: [119, 136, 153]</td></tr><tr><td class="line">88</td><td class="hits"></td><td class="source">  , lightslategrey: [119, 136, 153]</td></tr><tr><td class="line">89</td><td class="hits"></td><td class="source">  , lightsteelblue: [176, 196, 222]</td></tr><tr><td class="line">90</td><td class="hits"></td><td class="source">  , lightyellow: [255, 255, 224]</td></tr><tr><td class="line">91</td><td class="hits"></td><td class="source">  , lime: [0, 255, 0]</td></tr><tr><td class="line">92</td><td class="hits"></td><td class="source">  , limegreen: [50, 205, 50]</td></tr><tr><td class="line">93</td><td class="hits"></td><td class="source">  , linen: [250, 240, 230]</td></tr><tr><td class="line">94</td><td class="hits"></td><td class="source">  , magenta: [255, 0, 255]</td></tr><tr><td class="line">95</td><td class="hits"></td><td class="source">  , maroon: [128, 0, 0]</td></tr><tr><td class="line">96</td><td class="hits"></td><td class="source">  , mediumaquamarine: [102, 205, 170]</td></tr><tr><td class="line">97</td><td class="hits"></td><td class="source">  , mediumblue: [0, 0, 205]</td></tr><tr><td class="line">98</td><td class="hits"></td><td class="source">  , mediumorchid: [186, 85, 211]</td></tr><tr><td class="line">99</td><td class="hits"></td><td class="source">  , mediumpurple: [147, 112, 219]</td></tr><tr><td class="line">100</td><td class="hits"></td><td class="source">  , mediumseagreen: [60, 179, 113]</td></tr><tr><td class="line">101</td><td class="hits"></td><td class="source">  , mediumslateblue: [123, 104, 238]</td></tr><tr><td class="line">102</td><td class="hits"></td><td class="source">  , mediumspringgreen: [0, 250, 154]</td></tr><tr><td class="line">103</td><td class="hits"></td><td class="source">  , mediumturquoise: [72, 209, 204]</td></tr><tr><td class="line">104</td><td class="hits"></td><td class="source">  , mediumvioletred: [199, 21, 133]</td></tr><tr><td class="line">105</td><td class="hits"></td><td class="source">  , midnightblue: [25, 25, 112]</td></tr><tr><td class="line">106</td><td class="hits"></td><td class="source">  , mintcream: [245, 255, 250]</td></tr><tr><td class="line">107</td><td class="hits"></td><td class="source">  , mistyrose: [255, 228, 225]</td></tr><tr><td class="line">108</td><td class="hits"></td><td class="source">  , moccasin: [255, 228, 181]</td></tr><tr><td class="line">109</td><td class="hits"></td><td class="source">  , navajowhite: [255, 222, 173]</td></tr><tr><td class="line">110</td><td class="hits"></td><td class="source">  , navy: [0, 0, 128]</td></tr><tr><td class="line">111</td><td class="hits"></td><td class="source">  , oldlace: [253, 245, 230]</td></tr><tr><td class="line">112</td><td class="hits"></td><td class="source">  , olive: [128, 128, 0]</td></tr><tr><td class="line">113</td><td class="hits"></td><td class="source">  , olivedrab: [107, 142, 35]</td></tr><tr><td class="line">114</td><td class="hits"></td><td class="source">  , orange: [255, 165, 0]</td></tr><tr><td class="line">115</td><td class="hits"></td><td class="source">  , orangered: [255, 69, 0]</td></tr><tr><td class="line">116</td><td class="hits"></td><td class="source">  , orchid: [218, 112, 214]</td></tr><tr><td class="line">117</td><td class="hits"></td><td class="source">  , palegoldenrod: [238, 232, 170]</td></tr><tr><td class="line">118</td><td class="hits"></td><td class="source">  , palegreen: [152, 251, 152]</td></tr><tr><td class="line">119</td><td class="hits"></td><td class="source">  , paleturquoise: [175, 238, 238]</td></tr><tr><td class="line">120</td><td class="hits"></td><td class="source">  , palevioletred: [219, 112, 147]</td></tr><tr><td class="line">121</td><td class="hits"></td><td class="source">  , papayawhip: [255, 239, 213]</td></tr><tr><td class="line">122</td><td class="hits"></td><td class="source">  , peachpuff: [255, 218, 185]</td></tr><tr><td class="line">123</td><td class="hits"></td><td class="source">  , peru: [205, 133, 63]</td></tr><tr><td class="line">124</td><td class="hits"></td><td class="source">  , pink: [255, 192, 203]</td></tr><tr><td class="line">125</td><td class="hits"></td><td class="source">  , plum: [221, 160, 203]</td></tr><tr><td class="line">126</td><td class="hits"></td><td class="source">  , powderblue: [176, 224, 230]</td></tr><tr><td class="line">127</td><td class="hits"></td><td class="source">  , purple: [128, 0, 128]</td></tr><tr><td class="line">128</td><td class="hits"></td><td class="source">  , red: [255, 0, 0]</td></tr><tr><td class="line">129</td><td class="hits"></td><td class="source">  , rosybrown: [188, 143, 143]</td></tr><tr><td class="line">130</td><td class="hits"></td><td class="source">  , royalblue: [65, 105, 225]</td></tr><tr><td class="line">131</td><td class="hits"></td><td class="source">  , saddlebrown: [139, 69, 19]</td></tr><tr><td class="line">132</td><td class="hits"></td><td class="source">  , salmon: [250, 128, 114]</td></tr><tr><td class="line">133</td><td class="hits"></td><td class="source">  , sandybrown: [244, 164, 96]</td></tr><tr><td class="line">134</td><td class="hits"></td><td class="source">  , seagreen: [46, 139, 87]</td></tr><tr><td class="line">135</td><td class="hits"></td><td class="source">  , seashell: [255, 245, 238]</td></tr><tr><td class="line">136</td><td class="hits"></td><td class="source">  , sienna: [160, 82, 45]</td></tr><tr><td class="line">137</td><td class="hits"></td><td class="source">  , silver: [192, 192, 192]</td></tr><tr><td class="line">138</td><td class="hits"></td><td class="source">  , skyblue: [135, 206, 235]</td></tr><tr><td class="line">139</td><td class="hits"></td><td class="source">  , slateblue: [106, 90, 205]</td></tr><tr><td class="line">140</td><td class="hits"></td><td class="source">  , slategray: [119, 128, 144]</td></tr><tr><td class="line">141</td><td class="hits"></td><td class="source">  , slategrey: [119, 128, 144]</td></tr><tr><td class="line">142</td><td class="hits"></td><td class="source">  , snow: [255, 255, 250]</td></tr><tr><td class="line">143</td><td class="hits"></td><td class="source">  , springgreen: [0, 255, 127]</td></tr><tr><td class="line">144</td><td class="hits"></td><td class="source">  , steelblue: [70, 130, 180]</td></tr><tr><td class="line">145</td><td class="hits"></td><td class="source">  , tan: [210, 180, 140]</td></tr><tr><td class="line">146</td><td class="hits"></td><td class="source">  , teal: [0, 128, 128]</td></tr><tr><td class="line">147</td><td class="hits"></td><td class="source">  , thistle: [216, 191, 216]</td></tr><tr><td class="line">148</td><td class="hits"></td><td class="source">  , tomato: [255, 99, 71]</td></tr><tr><td class="line">149</td><td class="hits"></td><td class="source">  , turquoise: [64, 224, 208]</td></tr><tr><td class="line">150</td><td class="hits"></td><td class="source">  , violet: [238, 130, 238]</td></tr><tr><td class="line">151</td><td class="hits"></td><td class="source">  , wheat: [245, 222, 179]</td></tr><tr><td class="line">152</td><td class="hits"></td><td class="source">  , white: [255, 255, 255]</td></tr><tr><td class="line">153</td><td class="hits"></td><td class="source">  , whitesmoke: [245, 245, 245]</td></tr><tr><td class="line">154</td><td class="hits"></td><td class="source">  , yellow: [255, 255, 0]</td></tr><tr><td class="line">155</td><td class="hits"></td><td class="source">  , yellowgreen: [154, 205, 5]</td></tr><tr><td class="line">156</td><td class="hits"></td><td class="source">};</td></tr></tbody></table></div><div class="file"><h2 id="nodes/root.js">nodes/root.js</h2><div id="stats" class="high"><div class="percentage">87%</div><div class="sloc">8</div><div class="hits">7</div><div class="misses">1</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr><td class="line">1</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source">/*!</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source"> * Stylus - Root</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source"> * Copyright(c) 2010 LearnBoost &lt;dev@learnboost.com&gt;</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> * MIT Licensed</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source"> * Module dependencies.</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">12</td><td class="hits">1</td><td class="source">var Node = require('./node');</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">14</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">15</td><td class="hits"></td><td class="source"> * Initialize a new `Root` node.</td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">17</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">20</td><td class="hits">1</td><td class="source">var Root = module.exports = function Root(){</td></tr><tr class="hit"><td class="line">21</td><td class="hits">416</td><td class="source">  this.nodes = [];</td></tr><tr><td class="line">22</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">23</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">24</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">25</td><td class="hits"></td><td class="source"> * Inherit from `Node.prototype`.</td></tr><tr><td class="line">26</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">27</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">28</td><td class="hits">1</td><td class="source">Root.prototype.__proto__ = Node.prototype;</td></tr><tr><td class="line">29</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">30</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">31</td><td class="hits"></td><td class="source"> * Push a `node` to this block.</td></tr><tr><td class="line">32</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">33</td><td class="hits"></td><td class="source"> * @param {Node} node</td></tr><tr><td class="line">34</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">35</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">36</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">37</td><td class="hits">1</td><td class="source">Root.prototype.push = function(node){</td></tr><tr class="hit"><td class="line">38</td><td class="hits">2361</td><td class="source">  this.nodes.push(node);</td></tr><tr><td class="line">39</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">40</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">41</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">42</td><td class="hits"></td><td class="source"> * Return &quot;root&quot;.</td></tr><tr><td class="line">43</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">44</td><td class="hits"></td><td class="source"> * @return {String}</td></tr><tr><td class="line">45</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">46</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">47</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">48</td><td class="hits">1</td><td class="source">Root.prototype.toString = function(){</td></tr><tr class="miss"><td class="line">49</td><td class="hits">0</td><td class="source">  return '[Root]';</td></tr><tr><td class="line">50</td><td class="hits"></td><td class="source">};</td></tr></tbody></table></div><div class="file"><h2 id="nodes/null.js">nodes/null.js</h2><div id="stats" class="high"><div class="percentage">100%</div><div class="sloc">11</div><div class="hits">11</div><div class="misses">0</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr><td class="line">1</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source">/*!</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source"> * Stylus - Null</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source"> * Copyright(c) 2010 LearnBoost &lt;dev@learnboost.com&gt;</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> * MIT Licensed</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source"> * Module dependencies.</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">12</td><td class="hits">1</td><td class="source">var Node = require('./node')</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source">  , nodes = require('./');</td></tr><tr><td class="line">14</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">15</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source"> * Initialize a new `Null` node.</td></tr><tr><td class="line">17</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">21</td><td class="hits">1</td><td class="source">var Null = module.exports = function Null(){};</td></tr><tr><td class="line">22</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">23</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">24</td><td class="hits"></td><td class="source"> * Inherit from `Node.prototype`.</td></tr><tr><td class="line">25</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">26</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">27</td><td class="hits">1</td><td class="source">Null.prototype.__proto__ = Node.prototype;</td></tr><tr><td class="line">28</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">29</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">30</td><td class="hits"></td><td class="source"> * Return 'Null'.</td></tr><tr><td class="line">31</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">32</td><td class="hits"></td><td class="source"> * @return {String}</td></tr><tr><td class="line">33</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">34</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">35</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">36</td><td class="hits">1</td><td class="source">Null.prototype.inspect = </td></tr><tr><td class="line">37</td><td class="hits"></td><td class="source">Null.prototype.toString = function(){</td></tr><tr class="hit"><td class="line">38</td><td class="hits">1</td><td class="source">  return 'null';</td></tr><tr><td class="line">39</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">40</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">41</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">42</td><td class="hits"></td><td class="source"> * Return false.</td></tr><tr><td class="line">43</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">44</td><td class="hits"></td><td class="source"> * @return {Boolean}</td></tr><tr><td class="line">45</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">46</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">47</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">48</td><td class="hits">1</td><td class="source">Null.prototype.toBoolean = function(){</td></tr><tr class="hit"><td class="line">49</td><td class="hits">4</td><td class="source">  return nodes.false;</td></tr><tr><td class="line">50</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">51</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">52</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">53</td><td class="hits"></td><td class="source"> * Check if the node is a null node.</td></tr><tr><td class="line">54</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">55</td><td class="hits"></td><td class="source"> * @return {Boolean}</td></tr><tr><td class="line">56</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">57</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">58</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">59</td><td class="hits">1</td><td class="source">Null.prototype.__defineGetter__('isNull', function(){</td></tr><tr class="hit"><td class="line">60</td><td class="hits">5121</td><td class="source">  return true;</td></tr><tr><td class="line">61</td><td class="hits"></td><td class="source">});</td></tr><tr><td class="line">62</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">63</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">64</td><td class="hits"></td><td class="source"> * Return hash.</td></tr><tr><td class="line">65</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">66</td><td class="hits"></td><td class="source"> * @return {String}</td></tr><tr><td class="line">67</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">68</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">69</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">70</td><td class="hits">1</td><td class="source">Null.prototype.__defineGetter__('hash', function(){</td></tr><tr class="hit"><td class="line">71</td><td class="hits">29</td><td class="source">  return null;</td></tr><tr><td class="line">72</td><td class="hits"></td><td class="source">});</td></tr></tbody></table></div><div class="file"><h2 id="nodes/each.js">nodes/each.js</h2><div id="stats" class="high"><div class="percentage">100%</div><div class="sloc">13</div><div class="hits">13</div><div class="misses">0</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr><td class="line">1</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source">/*!</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source"> * Stylus - Each</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source"> * Copyright(c) 2010 LearnBoost &lt;dev@learnboost.com&gt;</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> * MIT Licensed</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source"> * Module dependencies.</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">12</td><td class="hits">1</td><td class="source">var Node = require('./node')</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source">  , nodes = require('./');</td></tr><tr><td class="line">14</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">15</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source"> * Initialize a new `Each` node with the given `val` name,</td></tr><tr><td class="line">17</td><td class="hits"></td><td class="source"> * `key` name, `expr`, and `block`.</td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source"> * @param {String} val</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source"> * @param {String} key</td></tr><tr><td class="line">21</td><td class="hits"></td><td class="source"> * @param {Expression} expr</td></tr><tr><td class="line">22</td><td class="hits"></td><td class="source"> * @param {Block} block</td></tr><tr><td class="line">23</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">24</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">25</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">26</td><td class="hits">1</td><td class="source">var Each = module.exports = function Each(val, key, expr, block){</td></tr><tr class="hit"><td class="line">27</td><td class="hits">1160</td><td class="source">  Node.call(this);</td></tr><tr class="hit"><td class="line">28</td><td class="hits">1160</td><td class="source">  this.val = val;</td></tr><tr class="hit"><td class="line">29</td><td class="hits">1160</td><td class="source">  this.key = key;</td></tr><tr class="hit"><td class="line">30</td><td class="hits">1160</td><td class="source">  this.expr = expr;</td></tr><tr class="hit"><td class="line">31</td><td class="hits">1160</td><td class="source">  this.block = block;</td></tr><tr><td class="line">32</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">33</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">34</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">35</td><td class="hits"></td><td class="source"> * Inherit from `Node.prototype`.</td></tr><tr><td class="line">36</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">37</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">38</td><td class="hits">1</td><td class="source">Each.prototype.__proto__ = Node.prototype;</td></tr><tr><td class="line">39</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">40</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">41</td><td class="hits"></td><td class="source"> * Return a clone of this node.</td></tr><tr><td class="line">42</td><td class="hits"></td><td class="source"> * </td></tr><tr><td class="line">43</td><td class="hits"></td><td class="source"> * @return {Node}</td></tr><tr><td class="line">44</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">45</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">46</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">47</td><td class="hits">1</td><td class="source">Each.prototype.clone = function(){</td></tr><tr class="hit"><td class="line">48</td><td class="hits">75</td><td class="source">  var clone = new Each(</td></tr><tr><td class="line">49</td><td class="hits"></td><td class="source">      this.val</td></tr><tr><td class="line">50</td><td class="hits"></td><td class="source">    , this.key</td></tr><tr><td class="line">51</td><td class="hits"></td><td class="source">    , this.expr.clone()</td></tr><tr><td class="line">52</td><td class="hits"></td><td class="source">    , this.block.clone());</td></tr><tr class="hit"><td class="line">53</td><td class="hits">75</td><td class="source">  clone.lineno = this.lineno;</td></tr><tr class="hit"><td class="line">54</td><td class="hits">75</td><td class="source">  clone.filename = this.filename;</td></tr><tr class="hit"><td class="line">55</td><td class="hits">75</td><td class="source">  return clone;</td></tr><tr><td class="line">56</td><td class="hits"></td><td class="source">};</td></tr></tbody></table></div><div class="file"><h2 id="nodes/if.js">nodes/if.js</h2><div id="stats" class="high"><div class="percentage">100%</div><div class="sloc">18</div><div class="hits">18</div><div class="misses">0</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr><td class="line">1</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source">/*!</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source"> * Stylus - If</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source"> * Copyright(c) 2010 LearnBoost &lt;dev@learnboost.com&gt;</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> * MIT Licensed</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source"> * Module dependencies.</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">12</td><td class="hits">1</td><td class="source">var Node = require('./node');</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">14</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">15</td><td class="hits"></td><td class="source"> * Initialize a new `If` with the given `cond`.</td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">17</td><td class="hits"></td><td class="source"> * @param {Expression} cond</td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source"> * @param {Boolean|Block} negate, block</td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">21</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">22</td><td class="hits">1</td><td class="source">var If = module.exports = function If(cond, negate){</td></tr><tr class="hit"><td class="line">23</td><td class="hits">1993</td><td class="source">  Node.call(this);</td></tr><tr class="hit"><td class="line">24</td><td class="hits">1993</td><td class="source">  this.cond = cond;</td></tr><tr class="hit"><td class="line">25</td><td class="hits">1993</td><td class="source">  this.elses = [];</td></tr><tr class="hit"><td class="line">26</td><td class="hits">1993</td><td class="source">  if (negate &amp;&amp; negate.nodeName) {</td></tr><tr class="hit"><td class="line">27</td><td class="hits">880</td><td class="source">    this.block = negate;</td></tr><tr><td class="line">28</td><td class="hits"></td><td class="source">  } else {</td></tr><tr class="hit"><td class="line">29</td><td class="hits">1113</td><td class="source">    this.negate = negate;</td></tr><tr><td class="line">30</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">31</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">32</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">33</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">34</td><td class="hits"></td><td class="source"> * Inherit from `Node.prototype`.</td></tr><tr><td class="line">35</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">36</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">37</td><td class="hits">1</td><td class="source">If.prototype.__proto__ = Node.prototype;</td></tr><tr><td class="line">38</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">39</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">40</td><td class="hits"></td><td class="source"> * Return a clone of this node.</td></tr><tr><td class="line">41</td><td class="hits"></td><td class="source"> * </td></tr><tr><td class="line">42</td><td class="hits"></td><td class="source"> * @return {Node}</td></tr><tr><td class="line">43</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">44</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">45</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">46</td><td class="hits">1</td><td class="source">If.prototype.clone = function(){</td></tr><tr class="hit"><td class="line">47</td><td class="hits">411</td><td class="source">  var cond = this.cond.clone()</td></tr><tr><td class="line">48</td><td class="hits"></td><td class="source">    , block = this.block.clone();</td></tr><tr class="hit"><td class="line">49</td><td class="hits">411</td><td class="source">  var clone = new If(cond, block);</td></tr><tr class="hit"><td class="line">50</td><td class="hits">518</td><td class="source">  clone.elses = this.elses.map(function(node){ return node.clone(); });</td></tr><tr class="hit"><td class="line">51</td><td class="hits">411</td><td class="source">  clone.negate = this.negate;</td></tr><tr class="hit"><td class="line">52</td><td class="hits">411</td><td class="source">  clone.postfix = this.postfix;</td></tr><tr class="hit"><td class="line">53</td><td class="hits">411</td><td class="source">  clone.lineno = this.lineno;</td></tr><tr class="hit"><td class="line">54</td><td class="hits">411</td><td class="source">  clone.filename = this.filename;</td></tr><tr class="hit"><td class="line">55</td><td class="hits">411</td><td class="source">  return clone;</td></tr><tr><td class="line">56</td><td class="hits"></td><td class="source">};</td></tr></tbody></table></div><div class="file"><h2 id="nodes/call.js">nodes/call.js</h2><div id="stats" class="high"><div class="percentage">92%</div><div class="sloc">13</div><div class="hits">12</div><div class="misses">1</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr><td class="line">1</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source">/*!</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source"> * Stylus - Call</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source"> * Copyright(c) 2010 LearnBoost &lt;dev@learnboost.com&gt;</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> * MIT Licensed</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source"> * Module dependencies.</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">12</td><td class="hits">1</td><td class="source">var Node = require('./node');</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">14</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">15</td><td class="hits"></td><td class="source"> * Initialize a new `Call` with `name` and `args`.</td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">17</td><td class="hits"></td><td class="source"> * @param {String} name</td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source"> * @param {Expression} args</td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">21</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">22</td><td class="hits">1</td><td class="source">var Call = module.exports = function Call(name, args){</td></tr><tr class="hit"><td class="line">23</td><td class="hits">16188</td><td class="source">  Node.call(this);</td></tr><tr class="hit"><td class="line">24</td><td class="hits">16188</td><td class="source">  this.name = name;</td></tr><tr class="hit"><td class="line">25</td><td class="hits">16188</td><td class="source">  this.args = args;</td></tr><tr><td class="line">26</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">27</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">28</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">29</td><td class="hits"></td><td class="source"> * Inherit from `Node.prototype`.</td></tr><tr><td class="line">30</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">31</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">32</td><td class="hits">1</td><td class="source">Call.prototype.__proto__ = Node.prototype;</td></tr><tr><td class="line">33</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">34</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">35</td><td class="hits"></td><td class="source"> * Return a clone of this node.</td></tr><tr><td class="line">36</td><td class="hits"></td><td class="source"> * </td></tr><tr><td class="line">37</td><td class="hits"></td><td class="source"> * @return {Node}</td></tr><tr><td class="line">38</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">39</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">40</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">41</td><td class="hits">1</td><td class="source">Call.prototype.clone = function(){</td></tr><tr class="hit"><td class="line">42</td><td class="hits">1366</td><td class="source">  var clone = new Call(this.name, this.args.clone());</td></tr><tr class="hit"><td class="line">43</td><td class="hits">1366</td><td class="source">  clone.lineno = this.lineno;</td></tr><tr class="hit"><td class="line">44</td><td class="hits">1366</td><td class="source">  clone.filename = this.filename;</td></tr><tr class="hit"><td class="line">45</td><td class="hits">1366</td><td class="source">  return clone;</td></tr><tr><td class="line">46</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">47</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">48</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">49</td><td class="hits"></td><td class="source"> * Return &lt;name&gt;().</td></tr><tr><td class="line">50</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">51</td><td class="hits"></td><td class="source"> * @return {String}</td></tr><tr><td class="line">52</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">53</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">54</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">55</td><td class="hits">1</td><td class="source">Call.prototype.toString = function(){</td></tr><tr class="miss"><td class="line">56</td><td class="hits">0</td><td class="source">  return this.name + '()';</td></tr><tr><td class="line">57</td><td class="hits"></td><td class="source">};</td></tr></tbody></table></div><div class="file"><h2 id="nodes/page.js">nodes/page.js</h2><div id="stats" class="high"><div class="percentage">87%</div><div class="sloc">8</div><div class="hits">7</div><div class="misses">1</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr><td class="line">1</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source">/*!</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source"> * Stylus - Page</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source"> * Copyright(c) 2010 LearnBoost &lt;dev@learnboost.com&gt;</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> * MIT Licensed</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source"> * Module dependencies.</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">12</td><td class="hits">1</td><td class="source">var Node = require('./node');</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">14</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">15</td><td class="hits"></td><td class="source"> * Initialize a new `Page` with the given `selector` and `block`.</td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">17</td><td class="hits"></td><td class="source"> * @param {Selector} selector</td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source"> * @param {Block} block</td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">21</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">22</td><td class="hits">1</td><td class="source">var Page = module.exports = function Page(selector, block){</td></tr><tr class="hit"><td class="line">23</td><td class="hits">8</td><td class="source">  Node.call(this);</td></tr><tr class="hit"><td class="line">24</td><td class="hits">8</td><td class="source">  this.selector = selector;</td></tr><tr class="hit"><td class="line">25</td><td class="hits">8</td><td class="source">  this.block = block;</td></tr><tr><td class="line">26</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">27</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">28</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">29</td><td class="hits"></td><td class="source"> * Inherit from `Node.prototype`.</td></tr><tr><td class="line">30</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">31</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">32</td><td class="hits">1</td><td class="source">Page.prototype.__proto__ = Node.prototype;</td></tr><tr><td class="line">33</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">34</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">35</td><td class="hits"></td><td class="source"> * Return `@page name`.</td></tr><tr><td class="line">36</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">37</td><td class="hits"></td><td class="source"> * @return {String}</td></tr><tr><td class="line">38</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">39</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">40</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">41</td><td class="hits">1</td><td class="source">Page.prototype.toString = function(){</td></tr><tr class="miss"><td class="line">42</td><td class="hits">0</td><td class="source">  return '@page ' + this.selector;</td></tr><tr><td class="line">43</td><td class="hits"></td><td class="source">};</td></tr></tbody></table></div><div class="file"><h2 id="nodes/fontface.js">nodes/fontface.js</h2><div id="stats" class="medium"><div class="percentage">58%</div><div class="sloc">12</div><div class="hits">7</div><div class="misses">5</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr><td class="line">1</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source">/*!</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source"> * Stylus - FontFace</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source"> * Copyright(c) 2010 LearnBoost &lt;dev@learnboost.com&gt;</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> * MIT Licensed</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source"> * Module dependencies.</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">12</td><td class="hits">1</td><td class="source">var Node = require('./node');</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">14</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">15</td><td class="hits"></td><td class="source"> * Initialize a new `FontFace` with the given `block`.</td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">17</td><td class="hits"></td><td class="source"> * @param {Block} block</td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">21</td><td class="hits">1</td><td class="source">var FontFace = module.exports = function FontFace(block){</td></tr><tr class="hit"><td class="line">22</td><td class="hits">2</td><td class="source">  Node.call(this);</td></tr><tr class="hit"><td class="line">23</td><td class="hits">2</td><td class="source">  this.block = block;</td></tr><tr><td class="line">24</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">25</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">26</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">27</td><td class="hits"></td><td class="source"> * Inherit from `Node.prototype`.</td></tr><tr><td class="line">28</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">29</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">30</td><td class="hits">1</td><td class="source">FontFace.prototype.__proto__ = Node.prototype;</td></tr><tr><td class="line">31</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">32</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">33</td><td class="hits"></td><td class="source"> * Return a clone of this node.</td></tr><tr><td class="line">34</td><td class="hits"></td><td class="source"> * </td></tr><tr><td class="line">35</td><td class="hits"></td><td class="source"> * @return {Node}</td></tr><tr><td class="line">36</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">37</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">38</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">39</td><td class="hits">1</td><td class="source">FontFace.prototype.clone = function(){</td></tr><tr class="miss"><td class="line">40</td><td class="hits">0</td><td class="source">  var clone = new FontFace(this.block.clone());</td></tr><tr class="miss"><td class="line">41</td><td class="hits">0</td><td class="source">  clone.lineno = this.lineno;</td></tr><tr class="miss"><td class="line">42</td><td class="hits">0</td><td class="source">  clone.filename = this.filename;</td></tr><tr class="miss"><td class="line">43</td><td class="hits">0</td><td class="source">  return clone;</td></tr><tr><td class="line">44</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">45</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">46</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">47</td><td class="hits"></td><td class="source"> * Return `@oage name`.</td></tr><tr><td class="line">48</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">49</td><td class="hits"></td><td class="source"> * @return {String}</td></tr><tr><td class="line">50</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">51</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">52</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">53</td><td class="hits">1</td><td class="source">FontFace.prototype.toString = function(){</td></tr><tr class="miss"><td class="line">54</td><td class="hits">0</td><td class="source">  return '@font-face';</td></tr><tr><td class="line">55</td><td class="hits"></td><td class="source">};</td></tr></tbody></table></div><div class="file"><h2 id="nodes/unaryop.js">nodes/unaryop.js</h2><div id="stats" class="high"><div class="percentage">100%</div><div class="sloc">11</div><div class="hits">11</div><div class="misses">0</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr><td class="line">1</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source">/*!</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source"> * Stylus - UnaryOp</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source"> * Copyright(c) 2010 LearnBoost &lt;dev@learnboost.com&gt;</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> * MIT Licensed</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source"> * Module dependencies.</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">12</td><td class="hits">1</td><td class="source">var Node = require('./node');</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">14</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">15</td><td class="hits"></td><td class="source"> * Initialize a new `UnaryOp` with `op`, and `expr`.</td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">17</td><td class="hits"></td><td class="source"> * @param {String} op</td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source"> * @param {Node} expr</td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">21</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">22</td><td class="hits">1</td><td class="source">var UnaryOp = module.exports = function UnaryOp(op, expr){</td></tr><tr class="hit"><td class="line">23</td><td class="hits">559</td><td class="source">  Node.call(this);</td></tr><tr class="hit"><td class="line">24</td><td class="hits">559</td><td class="source">  this.op = op;</td></tr><tr class="hit"><td class="line">25</td><td class="hits">559</td><td class="source">  this.expr = expr;</td></tr><tr><td class="line">26</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">27</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">28</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">29</td><td class="hits"></td><td class="source"> * Inherit from `Node.prototype`.</td></tr><tr><td class="line">30</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">31</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">32</td><td class="hits">1</td><td class="source">UnaryOp.prototype.__proto__ = Node.prototype;</td></tr><tr><td class="line">33</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">34</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">35</td><td class="hits"></td><td class="source"> * Return a clone of this node.</td></tr><tr><td class="line">36</td><td class="hits"></td><td class="source"> * </td></tr><tr><td class="line">37</td><td class="hits"></td><td class="source"> * @return {Node}</td></tr><tr><td class="line">38</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">39</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">40</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">41</td><td class="hits">1</td><td class="source">UnaryOp.prototype.clone = function(){</td></tr><tr class="hit"><td class="line">42</td><td class="hits">15</td><td class="source">  var clone = new UnaryOp(this.op, this.expr.clone());</td></tr><tr class="hit"><td class="line">43</td><td class="hits">15</td><td class="source">  clone.lineno = this.lineno;</td></tr><tr class="hit"><td class="line">44</td><td class="hits">15</td><td class="source">  clone.filename = this.filename;</td></tr><tr class="hit"><td class="line">45</td><td class="hits">15</td><td class="source">  return clone;</td></tr><tr><td class="line">46</td><td class="hits"></td><td class="source">};</td></tr></tbody></table></div><div class="file"><h2 id="nodes/binop.js">nodes/binop.js</h2><div id="stats" class="high"><div class="percentage">100%</div><div class="sloc">13</div><div class="hits">13</div><div class="misses">0</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr><td class="line">1</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source">/*!</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source"> * Stylus - BinOp</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source"> * Copyright(c) 2010 LearnBoost &lt;dev@learnboost.com&gt;</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> * MIT Licensed</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source"> * Module dependencies.</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">12</td><td class="hits">1</td><td class="source">var Node = require('./node');</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">14</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">15</td><td class="hits"></td><td class="source"> * Initialize a new `BinOp` with `op`, `left` and `right`.</td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">17</td><td class="hits"></td><td class="source"> * @param {String} op</td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source"> * @param {Node} left</td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source"> * @param {Node} right</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">21</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">22</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">23</td><td class="hits">1</td><td class="source">var BinOp = module.exports = function BinOp(op, left, right){</td></tr><tr class="hit"><td class="line">24</td><td class="hits">16182</td><td class="source">  Node.call(this);</td></tr><tr class="hit"><td class="line">25</td><td class="hits">16182</td><td class="source">  this.op = op;</td></tr><tr class="hit"><td class="line">26</td><td class="hits">16182</td><td class="source">  this.left = left;</td></tr><tr class="hit"><td class="line">27</td><td class="hits">16182</td><td class="source">  this.right = right;</td></tr><tr><td class="line">28</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">29</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">30</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">31</td><td class="hits"></td><td class="source"> * Inherit from `Node.prototype`.</td></tr><tr><td class="line">32</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">33</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">34</td><td class="hits">1</td><td class="source">BinOp.prototype.__proto__ = Node.prototype;</td></tr><tr><td class="line">35</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">36</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">37</td><td class="hits"></td><td class="source"> * Return a clone of this node.</td></tr><tr><td class="line">38</td><td class="hits"></td><td class="source"> * </td></tr><tr><td class="line">39</td><td class="hits"></td><td class="source"> * @return {Node}</td></tr><tr><td class="line">40</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">41</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">42</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">43</td><td class="hits">1</td><td class="source">BinOp.prototype.clone = function(){</td></tr><tr class="hit"><td class="line">44</td><td class="hits">1428</td><td class="source">  var clone = new BinOp(</td></tr><tr><td class="line">45</td><td class="hits"></td><td class="source">      this.op</td></tr><tr><td class="line">46</td><td class="hits"></td><td class="source">    , this.left.clone()</td></tr><tr><td class="line">47</td><td class="hits"></td><td class="source">    , this.right ?</td></tr><tr><td class="line">48</td><td class="hits"></td><td class="source">      this.right.clone()</td></tr><tr><td class="line">49</td><td class="hits"></td><td class="source">      : null);</td></tr><tr class="hit"><td class="line">50</td><td class="hits">1428</td><td class="source">  clone.lineno = this.lineno;</td></tr><tr class="hit"><td class="line">51</td><td class="hits">1428</td><td class="source">  clone.filename = this.filename;</td></tr><tr class="hit"><td class="line">52</td><td class="hits">1482</td><td class="source">  if (this.val) clone.val = this.val.clone();</td></tr><tr class="hit"><td class="line">53</td><td class="hits">1428</td><td class="source">  return clone;</td></tr><tr><td class="line">54</td><td class="hits"></td><td class="source">};</td></tr></tbody></table></div><div class="file"><h2 id="nodes/ternary.js">nodes/ternary.js</h2><div id="stats" class="high"><div class="percentage">100%</div><div class="sloc">12</div><div class="hits">12</div><div class="misses">0</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr><td class="line">1</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source">/*!</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source"> * Stylus - Ternary</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source"> * Copyright(c) 2010 LearnBoost &lt;dev@learnboost.com&gt;</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> * MIT Licensed</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source"> * Module dependencies.</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">12</td><td class="hits">1</td><td class="source">var Node = require('./node');</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">14</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">15</td><td class="hits"></td><td class="source"> * Initialize a new `Ternary` with `cond`, `trueExpr` and `falseExpr`.</td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">17</td><td class="hits"></td><td class="source"> * @param {Expression} cond</td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source"> * @param {Expression} trueExpr</td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source"> * @param {Expression} falseExpr</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">21</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">22</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">23</td><td class="hits">1</td><td class="source">var Ternary = module.exports = function Ternary(cond, trueExpr, falseExpr){</td></tr><tr class="hit"><td class="line">24</td><td class="hits">993</td><td class="source">  Node.call(this);</td></tr><tr class="hit"><td class="line">25</td><td class="hits">993</td><td class="source">  this.cond = cond;</td></tr><tr class="hit"><td class="line">26</td><td class="hits">993</td><td class="source">  this.trueExpr = trueExpr;</td></tr><tr class="hit"><td class="line">27</td><td class="hits">993</td><td class="source">  this.falseExpr = falseExpr;</td></tr><tr><td class="line">28</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">29</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">30</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">31</td><td class="hits"></td><td class="source"> * Inherit from `Node.prototype`.</td></tr><tr><td class="line">32</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">33</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">34</td><td class="hits">1</td><td class="source">Ternary.prototype.__proto__ = Node.prototype;</td></tr><tr><td class="line">35</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">36</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">37</td><td class="hits"></td><td class="source"> * Return a clone of this node.</td></tr><tr><td class="line">38</td><td class="hits"></td><td class="source"> * </td></tr><tr><td class="line">39</td><td class="hits"></td><td class="source"> * @return {Node}</td></tr><tr><td class="line">40</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">41</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">42</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">43</td><td class="hits">1</td><td class="source">Ternary.prototype.clone = function(){</td></tr><tr class="hit"><td class="line">44</td><td class="hits">127</td><td class="source">  var clone = new Ternary(</td></tr><tr><td class="line">45</td><td class="hits"></td><td class="source">      this.cond.clone()</td></tr><tr><td class="line">46</td><td class="hits"></td><td class="source">    , this.trueExpr.clone()</td></tr><tr><td class="line">47</td><td class="hits"></td><td class="source">    , this.falseExpr.clone());</td></tr><tr class="hit"><td class="line">48</td><td class="hits">127</td><td class="source">  clone.lineno = this.lineno;</td></tr><tr class="hit"><td class="line">49</td><td class="hits">127</td><td class="source">  clone.filename = this.filename;</td></tr><tr class="hit"><td class="line">50</td><td class="hits">127</td><td class="source">  return clone;</td></tr><tr><td class="line">51</td><td class="hits"></td><td class="source">};</td></tr></tbody></table></div><div class="file"><h2 id="nodes/block.js">nodes/block.js</h2><div id="stats" class="high"><div class="percentage">96%</div><div class="sloc">30</div><div class="hits">29</div><div class="misses">1</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr><td class="line">1</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source">/*!</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source"> * Stylus - Block</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source"> * Copyright(c) 2010 LearnBoost &lt;dev@learnboost.com&gt;</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> * MIT Licensed</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source"> * Module dependencies.</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">12</td><td class="hits">1</td><td class="source">var Node = require('./node');</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">14</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">15</td><td class="hits"></td><td class="source"> * Initialize a new `Block` node with `parent` Block.</td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">17</td><td class="hits"></td><td class="source"> * @param {Block} parent</td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">21</td><td class="hits">1</td><td class="source">var Block = module.exports = function Block(parent, node){</td></tr><tr class="hit"><td class="line">22</td><td class="hits">14979</td><td class="source">  Node.call(this);</td></tr><tr class="hit"><td class="line">23</td><td class="hits">14979</td><td class="source">  this.nodes = [];</td></tr><tr class="hit"><td class="line">24</td><td class="hits">14979</td><td class="source">  this.parent = parent;</td></tr><tr class="hit"><td class="line">25</td><td class="hits">14979</td><td class="source">  this.node = node;</td></tr><tr class="hit"><td class="line">26</td><td class="hits">14979</td><td class="source">  this.scope = true;</td></tr><tr><td class="line">27</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">28</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">29</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">30</td><td class="hits"></td><td class="source"> * Inherit from `Node.prototype`.</td></tr><tr><td class="line">31</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">32</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">33</td><td class="hits">1</td><td class="source">Block.prototype.__proto__ = Node.prototype;</td></tr><tr><td class="line">34</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">35</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">36</td><td class="hits"></td><td class="source"> * Check if this block has properties..</td></tr><tr><td class="line">37</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">38</td><td class="hits"></td><td class="source"> * @return {Boolean}</td></tr><tr><td class="line">39</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">40</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">41</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">42</td><td class="hits">1</td><td class="source">Block.prototype.__defineGetter__('hasProperties', function(){</td></tr><tr class="hit"><td class="line">43</td><td class="hits">3354</td><td class="source">  for (var i = 0, len = this.nodes.length; i &lt; len; ++i) {</td></tr><tr class="hit"><td class="line">44</td><td class="hits">3677</td><td class="source">    if ('property' == this.nodes[i].nodeName) {</td></tr><tr class="hit"><td class="line">45</td><td class="hits">3034</td><td class="source">      return true;</td></tr><tr><td class="line">46</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">47</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">48</td><td class="hits"></td><td class="source">});</td></tr><tr><td class="line">49</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">50</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">51</td><td class="hits"></td><td class="source"> * Check if this block is empty.</td></tr><tr><td class="line">52</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">53</td><td class="hits"></td><td class="source"> * @return {Boolean}</td></tr><tr><td class="line">54</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">55</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">56</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">57</td><td class="hits">1</td><td class="source">Block.prototype.__defineGetter__('isEmpty', function(){</td></tr><tr class="miss"><td class="line">58</td><td class="hits">0</td><td class="source">  return !this.nodes.length;</td></tr><tr><td class="line">59</td><td class="hits"></td><td class="source">});</td></tr><tr><td class="line">60</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">61</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">62</td><td class="hits"></td><td class="source"> * Return a clone of this node.</td></tr><tr><td class="line">63</td><td class="hits"></td><td class="source"> * </td></tr><tr><td class="line">64</td><td class="hits"></td><td class="source"> * @return {Node}</td></tr><tr><td class="line">65</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">66</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">67</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">68</td><td class="hits">1</td><td class="source">Block.prototype.clone = function(){</td></tr><tr class="hit"><td class="line">69</td><td class="hits">1562</td><td class="source">  var clone = new Block(this.parent, this.node);</td></tr><tr class="hit"><td class="line">70</td><td class="hits">1562</td><td class="source">  clone.lineno = this.lineno;</td></tr><tr class="hit"><td class="line">71</td><td class="hits">1562</td><td class="source">  clone.filename = this.filename;</td></tr><tr class="hit"><td class="line">72</td><td class="hits">1562</td><td class="source">  clone.scope = this.scope;</td></tr><tr class="hit"><td class="line">73</td><td class="hits">1562</td><td class="source">  this.nodes.forEach(function(node){</td></tr><tr class="hit"><td class="line">74</td><td class="hits">2182</td><td class="source">    node = node.clone();</td></tr><tr class="hit"><td class="line">75</td><td class="hits">2182</td><td class="source">    switch (node.nodeName) {</td></tr><tr><td class="line">76</td><td class="hits"></td><td class="source">      case 'each':</td></tr><tr><td class="line">77</td><td class="hits"></td><td class="source">      case 'group':</td></tr><tr class="hit"><td class="line">78</td><td class="hits">160</td><td class="source">        node.block.parent = clone;</td></tr><tr class="hit"><td class="line">79</td><td class="hits">160</td><td class="source">        break;</td></tr><tr><td class="line">80</td><td class="hits"></td><td class="source">      case 'ident':</td></tr><tr class="hit"><td class="line">81</td><td class="hits">452</td><td class="source">        if ('function' == node.val.nodeName) {</td></tr><tr class="hit"><td class="line">82</td><td class="hits">9</td><td class="source">          node.val.block.parent = clone;</td></tr><tr><td class="line">83</td><td class="hits"></td><td class="source">        }</td></tr><tr><td class="line">84</td><td class="hits"></td><td class="source">    }</td></tr><tr class="hit"><td class="line">85</td><td class="hits">2182</td><td class="source">    clone.push(node);</td></tr><tr><td class="line">86</td><td class="hits"></td><td class="source">  });</td></tr><tr class="hit"><td class="line">87</td><td class="hits">1562</td><td class="source">  return clone;</td></tr><tr><td class="line">88</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">89</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">90</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">91</td><td class="hits"></td><td class="source"> * Push a `node` to this block.</td></tr><tr><td class="line">92</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">93</td><td class="hits"></td><td class="source"> * @param {Node} node</td></tr><tr><td class="line">94</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">95</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">96</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">97</td><td class="hits">1</td><td class="source">Block.prototype.push = function(node){</td></tr><tr class="hit"><td class="line">98</td><td class="hits">33986</td><td class="source">  this.nodes.push(node);</td></tr><tr><td class="line">99</td><td class="hits"></td><td class="source">};</td></tr></tbody></table></div><div class="file"><h2 id="nodes/unit.js">nodes/unit.js</h2><div id="stats" class="high"><div class="percentage">78%</div><div class="sloc">64</div><div class="hits">50</div><div class="misses">14</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr><td class="line">1</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source">/*!</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source"> * Stylus - Unit</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source"> * Copyright(c) 2010 LearnBoost &lt;dev@learnboost.com&gt;</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> * MIT Licensed</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source"> * Module dependencies.</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">12</td><td class="hits">1</td><td class="source">var Node = require('./node')</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source">  , nodes = require('./');</td></tr><tr><td class="line">14</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">15</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source"> * Initialize a new `Unit` with the given `val` and unit `type`</td></tr><tr><td class="line">17</td><td class="hits"></td><td class="source"> * such as &quot;px&quot;, &quot;pt&quot;, &quot;in&quot;, etc.</td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source"> * @param {String} val</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source"> * @param {String} type</td></tr><tr><td class="line">21</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">22</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">23</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">24</td><td class="hits">1</td><td class="source">var Unit = module.exports = function Unit(val, type){</td></tr><tr class="hit"><td class="line">25</td><td class="hits">13728</td><td class="source">  Node.call(this);</td></tr><tr class="hit"><td class="line">26</td><td class="hits">13728</td><td class="source">  this.val = val;</td></tr><tr class="hit"><td class="line">27</td><td class="hits">13728</td><td class="source">  this.type = type;</td></tr><tr><td class="line">28</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">29</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">30</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">31</td><td class="hits"></td><td class="source"> * Inherit from `Node.prototype`.</td></tr><tr><td class="line">32</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">33</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">34</td><td class="hits">1</td><td class="source">Unit.prototype.__proto__ = Node.prototype;</td></tr><tr><td class="line">35</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">36</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">37</td><td class="hits"></td><td class="source"> * Return Boolean based on the unit value.</td></tr><tr><td class="line">38</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">39</td><td class="hits"></td><td class="source"> * @return {Boolean}</td></tr><tr><td class="line">40</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">41</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">42</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">43</td><td class="hits">1</td><td class="source">Unit.prototype.toBoolean = function(){</td></tr><tr class="hit"><td class="line">44</td><td class="hits">162</td><td class="source">  return nodes.Boolean(this.type</td></tr><tr><td class="line">45</td><td class="hits"></td><td class="source">      ? true</td></tr><tr><td class="line">46</td><td class="hits"></td><td class="source">      : this.val);</td></tr><tr><td class="line">47</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">48</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">49</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">50</td><td class="hits"></td><td class="source"> * Return unit string.</td></tr><tr><td class="line">51</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">52</td><td class="hits"></td><td class="source"> * @return {String}</td></tr><tr><td class="line">53</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">54</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">55</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">56</td><td class="hits">1</td><td class="source">Unit.prototype.toString = function(){</td></tr><tr class="hit"><td class="line">57</td><td class="hits">217</td><td class="source">  var n = this.val;</td></tr><tr class="hit"><td class="line">58</td><td class="hits">221</td><td class="source">  if ('px' == this.type) n = n.toFixed(0);</td></tr><tr class="hit"><td class="line">59</td><td class="hits">217</td><td class="source">  return n + (this.type || '');</td></tr><tr><td class="line">60</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">61</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">62</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">63</td><td class="hits"></td><td class="source"> * Return a clone of this node.</td></tr><tr><td class="line">64</td><td class="hits"></td><td class="source"> * </td></tr><tr><td class="line">65</td><td class="hits"></td><td class="source"> * @return {Node}</td></tr><tr><td class="line">66</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">67</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">68</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">69</td><td class="hits">1</td><td class="source">Unit.prototype.clone = function(){</td></tr><tr class="hit"><td class="line">70</td><td class="hits">1324</td><td class="source">  var clone = new Unit(this.val, this.type);</td></tr><tr class="hit"><td class="line">71</td><td class="hits">1324</td><td class="source">  clone.lineno = this.lineno;</td></tr><tr class="hit"><td class="line">72</td><td class="hits">1324</td><td class="source">  clone.filename = this.filename;</td></tr><tr class="hit"><td class="line">73</td><td class="hits">1324</td><td class="source">  return clone;</td></tr><tr><td class="line">74</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">75</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">76</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">77</td><td class="hits"></td><td class="source"> * Operate on `right` with the given `op`.</td></tr><tr><td class="line">78</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">79</td><td class="hits"></td><td class="source"> * @param {String} op</td></tr><tr><td class="line">80</td><td class="hits"></td><td class="source"> * @param {Node} right</td></tr><tr><td class="line">81</td><td class="hits"></td><td class="source"> * @return {Node}</td></tr><tr><td class="line">82</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">83</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">84</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">85</td><td class="hits">1</td><td class="source">Unit.prototype.operate = function(op, right){</td></tr><tr class="hit"><td class="line">86</td><td class="hits">523</td><td class="source">  var type = this.type || right.first.type;</td></tr><tr><td class="line">87</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">88</td><td class="hits"></td><td class="source">  // swap color</td></tr><tr class="hit"><td class="line">89</td><td class="hits">523</td><td class="source">  if ('rgba' == right.nodeName || 'hsla' == right.nodeName) {</td></tr><tr class="miss"><td class="line">90</td><td class="hits">0</td><td class="source">    return right.operate(op, this);</td></tr><tr><td class="line">91</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">92</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">93</td><td class="hits"></td><td class="source">  // operate</td></tr><tr class="hit"><td class="line">94</td><td class="hits">523</td><td class="source">  if (this.shouldCoerce(op)) {</td></tr><tr><td class="line">95</td><td class="hits"></td><td class="source">    // percentages</td></tr><tr class="hit"><td class="line">96</td><td class="hits">433</td><td class="source">    if (('-' == op || '+' == op) &amp;&amp; '%' == right.type) {</td></tr><tr class="hit"><td class="line">97</td><td class="hits">3</td><td class="source">      right.val = this.val * (right.val / 100);</td></tr><tr><td class="line">98</td><td class="hits"></td><td class="source">    } else {</td></tr><tr class="hit"><td class="line">99</td><td class="hits">430</td><td class="source">      right = this.coerce(right.first);</td></tr><tr><td class="line">100</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">101</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">102</td><td class="hits">426</td><td class="source">    switch (op) {</td></tr><tr><td class="line">103</td><td class="hits"></td><td class="source">      case '-':</td></tr><tr class="hit"><td class="line">104</td><td class="hits">36</td><td class="source">        return new Unit(this.val - right.val, type);</td></tr><tr><td class="line">105</td><td class="hits"></td><td class="source">      case '+':                               </td></tr><tr class="hit"><td class="line">106</td><td class="hits">80</td><td class="source">        return new Unit(this.val + right.val, type);</td></tr><tr><td class="line">107</td><td class="hits"></td><td class="source">      case '/':                               </td></tr><tr class="hit"><td class="line">108</td><td class="hits">43</td><td class="source">        return new Unit(this.val / right.val, type);</td></tr><tr><td class="line">109</td><td class="hits"></td><td class="source">      case '*':                               </td></tr><tr class="hit"><td class="line">110</td><td class="hits">91</td><td class="source">        return new Unit(this.val * right.val, type);</td></tr><tr><td class="line">111</td><td class="hits"></td><td class="source">      case '%':</td></tr><tr class="hit"><td class="line">112</td><td class="hits">17</td><td class="source">        return new Unit(this.val % right.val, type);</td></tr><tr><td class="line">113</td><td class="hits"></td><td class="source">      case '**':</td></tr><tr class="hit"><td class="line">114</td><td class="hits">1</td><td class="source">        return new Unit(Math.pow(this.val, right.val), type);</td></tr><tr><td class="line">115</td><td class="hits"></td><td class="source">      case '..':</td></tr><tr><td class="line">116</td><td class="hits"></td><td class="source">      case '...':</td></tr><tr class="hit"><td class="line">117</td><td class="hits">19</td><td class="source">        var start = this.val</td></tr><tr><td class="line">118</td><td class="hits"></td><td class="source">          , end = right.val</td></tr><tr><td class="line">119</td><td class="hits"></td><td class="source">          , expr = new nodes.Expression</td></tr><tr><td class="line">120</td><td class="hits"></td><td class="source">          , inclusive = '..' == op;</td></tr><tr class="hit"><td class="line">121</td><td class="hits">19</td><td class="source">        do {</td></tr><tr class="hit"><td class="line">122</td><td class="hits">452</td><td class="source">          expr.push(new nodes.Unit(start));</td></tr><tr><td class="line">123</td><td class="hits"></td><td class="source">        } while (inclusive ? ++start &lt;= end : ++start &lt; end);</td></tr><tr class="hit"><td class="line">124</td><td class="hits">19</td><td class="source">        return expr;</td></tr><tr><td class="line">125</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">126</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">127</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">128</td><td class="hits">229</td><td class="source">  return Node.prototype.operate.call(this, op, right);</td></tr><tr><td class="line">129</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">130</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">131</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">132</td><td class="hits"></td><td class="source"> * Coerce `other` unit to the same type as `this` unit.</td></tr><tr><td class="line">133</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">134</td><td class="hits"></td><td class="source"> * Supports:</td></tr><tr><td class="line">135</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">136</td><td class="hits"></td><td class="source"> *    mm -&gt; cm | in</td></tr><tr><td class="line">137</td><td class="hits"></td><td class="source"> *    cm -&gt; mm | in</td></tr><tr><td class="line">138</td><td class="hits"></td><td class="source"> *    in -&gt; mm | cm</td></tr><tr><td class="line">139</td><td class="hits"></td><td class="source"> *    </td></tr><tr><td class="line">140</td><td class="hits"></td><td class="source"> *    ms -&gt; s</td></tr><tr><td class="line">141</td><td class="hits"></td><td class="source"> *    s  -&gt; ms</td></tr><tr><td class="line">142</td><td class="hits"></td><td class="source"> *    </td></tr><tr><td class="line">143</td><td class="hits"></td><td class="source"> *    Hz  -&gt; kHz</td></tr><tr><td class="line">144</td><td class="hits"></td><td class="source"> *    kHz -&gt; Hz</td></tr><tr><td class="line">145</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">146</td><td class="hits"></td><td class="source"> * @param {Unit} other</td></tr><tr><td class="line">147</td><td class="hits"></td><td class="source"> * @return {Unit}</td></tr><tr><td class="line">148</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">149</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">150</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">151</td><td class="hits">1</td><td class="source">Unit.prototype.coerce = function(other){</td></tr><tr class="hit"><td class="line">152</td><td class="hits">430</td><td class="source">  if ('unit' == other.nodeName) {</td></tr><tr class="hit"><td class="line">153</td><td class="hits">419</td><td class="source">    var a = this</td></tr><tr><td class="line">154</td><td class="hits"></td><td class="source">      , b = other;</td></tr><tr class="hit"><td class="line">155</td><td class="hits">419</td><td class="source">    switch (a.type) {</td></tr><tr><td class="line">156</td><td class="hits"></td><td class="source">      case 'mm':</td></tr><tr class="miss"><td class="line">157</td><td class="hits">0</td><td class="source">        switch (b.type) {</td></tr><tr><td class="line">158</td><td class="hits"></td><td class="source">          case 'cm':</td></tr><tr class="miss"><td class="line">159</td><td class="hits">0</td><td class="source">            return new nodes.Unit(b.val * 2.54, 'mm');</td></tr><tr><td class="line">160</td><td class="hits"></td><td class="source">          case 'in':</td></tr><tr class="miss"><td class="line">161</td><td class="hits">0</td><td class="source">            return new nodes.Unit(b.val * 25.4, 'mm');</td></tr><tr><td class="line">162</td><td class="hits"></td><td class="source">        }</td></tr><tr><td class="line">163</td><td class="hits"></td><td class="source">      case 'cm':</td></tr><tr class="miss"><td class="line">164</td><td class="hits">0</td><td class="source">        switch (b.type) {</td></tr><tr><td class="line">165</td><td class="hits"></td><td class="source">          case 'mm':</td></tr><tr class="miss"><td class="line">166</td><td class="hits">0</td><td class="source">            return new nodes.Unit(b.val / 10, 'cm');</td></tr><tr><td class="line">167</td><td class="hits"></td><td class="source">          case 'in':</td></tr><tr class="miss"><td class="line">168</td><td class="hits">0</td><td class="source">            return new nodes.Unit(b.val * 2.54, 'cm');</td></tr><tr><td class="line">169</td><td class="hits"></td><td class="source">        }</td></tr><tr><td class="line">170</td><td class="hits"></td><td class="source">      case 'in':</td></tr><tr class="miss"><td class="line">171</td><td class="hits">0</td><td class="source">        switch (b.type) {</td></tr><tr><td class="line">172</td><td class="hits"></td><td class="source">          case 'mm':</td></tr><tr class="miss"><td class="line">173</td><td class="hits">0</td><td class="source">            return new nodes.Unit(b.val / 25.4, 'in');</td></tr><tr><td class="line">174</td><td class="hits"></td><td class="source">          case 'cm':</td></tr><tr class="miss"><td class="line">175</td><td class="hits">0</td><td class="source">            return new nodes.Unit(b.val / 2.54, 'in');</td></tr><tr><td class="line">176</td><td class="hits"></td><td class="source">        }</td></tr><tr><td class="line">177</td><td class="hits"></td><td class="source">      case 'ms':</td></tr><tr class="hit"><td class="line">178</td><td class="hits">1</td><td class="source">        switch (b.type) {</td></tr><tr><td class="line">179</td><td class="hits"></td><td class="source">          case 's':</td></tr><tr class="hit"><td class="line">180</td><td class="hits">1</td><td class="source">            return new nodes.Unit(b.val * 1000, 'ms');</td></tr><tr><td class="line">181</td><td class="hits"></td><td class="source">        }</td></tr><tr><td class="line">182</td><td class="hits"></td><td class="source">      case 's':</td></tr><tr class="hit"><td class="line">183</td><td class="hits">2</td><td class="source">        switch (b.type) {</td></tr><tr><td class="line">184</td><td class="hits"></td><td class="source">          case 'ms':</td></tr><tr class="hit"><td class="line">185</td><td class="hits">2</td><td class="source">            return new nodes.Unit(b.val / 1000, 's');</td></tr><tr><td class="line">186</td><td class="hits"></td><td class="source">        }</td></tr><tr><td class="line">187</td><td class="hits"></td><td class="source">      case 'Hz':</td></tr><tr class="miss"><td class="line">188</td><td class="hits">0</td><td class="source">        switch (b.type) {</td></tr><tr><td class="line">189</td><td class="hits"></td><td class="source">          case 'kHz':</td></tr><tr class="miss"><td class="line">190</td><td class="hits">0</td><td class="source">            return new nodes.Unit(b.val * 1000, 'Hz');</td></tr><tr><td class="line">191</td><td class="hits"></td><td class="source">        }</td></tr><tr><td class="line">192</td><td class="hits"></td><td class="source">      case 'kHz':</td></tr><tr class="miss"><td class="line">193</td><td class="hits">0</td><td class="source">        switch (b.type) {</td></tr><tr><td class="line">194</td><td class="hits"></td><td class="source">          case 'Hz':</td></tr><tr class="miss"><td class="line">195</td><td class="hits">0</td><td class="source">            return new nodes.Unit(b.val / 1000, 'kHz');</td></tr><tr><td class="line">196</td><td class="hits"></td><td class="source">        }</td></tr><tr><td class="line">197</td><td class="hits"></td><td class="source">      default:</td></tr><tr class="hit"><td class="line">198</td><td class="hits">416</td><td class="source">        return new nodes.Unit(b.val, a.type);</td></tr><tr><td class="line">199</td><td class="hits"></td><td class="source">    }</td></tr><tr class="hit"><td class="line">200</td><td class="hits">11</td><td class="source">  } else if ('string' == other.nodeName) {</td></tr><tr class="hit"><td class="line">201</td><td class="hits">7</td><td class="source">    var val = parseInt(other.val, 10);</td></tr><tr class="hit"><td class="line">202</td><td class="hits">10</td><td class="source">    if (isNaN(val)) Node.prototype.coerce.call(this, other);</td></tr><tr class="hit"><td class="line">203</td><td class="hits">4</td><td class="source">    return new nodes.Unit(val);</td></tr><tr><td class="line">204</td><td class="hits"></td><td class="source">  } else {</td></tr><tr class="hit"><td class="line">205</td><td class="hits">4</td><td class="source">    return Node.prototype.coerce.call(this, other);</td></tr><tr><td class="line">206</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">207</td><td class="hits"></td><td class="source">};</td></tr></tbody></table></div><div class="file"><h2 id="nodes/string.js">nodes/string.js</h2><div id="stats" class="high"><div class="percentage">100%</div><div class="sloc">30</div><div class="hits">30</div><div class="misses">0</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr><td class="line">1</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source">/*!</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source"> * Stylus - String</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source"> * Copyright(c) 2010 LearnBoost &lt;dev@learnboost.com&gt;</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> * MIT Licensed</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source"> * Module dependencies.</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">12</td><td class="hits">1</td><td class="source">var Node = require('./node')</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source">  , sprintf = require('../functions').s</td></tr><tr><td class="line">14</td><td class="hits"></td><td class="source">  , utils = require('../utils')</td></tr><tr><td class="line">15</td><td class="hits"></td><td class="source">  , nodes = require('./');</td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">17</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source"> * Initialize a new `String` with the given `val`.</td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source"> * @param {String} val</td></tr><tr><td class="line">21</td><td class="hits"></td><td class="source"> * @param {String} quote</td></tr><tr><td class="line">22</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">23</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">24</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">25</td><td class="hits">1</td><td class="source">var String = module.exports = function String(val, quote){</td></tr><tr class="hit"><td class="line">26</td><td class="hits">7896</td><td class="source">  Node.call(this);</td></tr><tr class="hit"><td class="line">27</td><td class="hits">7896</td><td class="source">  this.val = val;</td></tr><tr class="hit"><td class="line">28</td><td class="hits">7896</td><td class="source">  this.string = val;</td></tr><tr class="hit"><td class="line">29</td><td class="hits">7896</td><td class="source">  this.quote = quote || &quot;'&quot;;</td></tr><tr><td class="line">30</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">31</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">32</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">33</td><td class="hits"></td><td class="source"> * Inherit from `Node.prototype`.</td></tr><tr><td class="line">34</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">35</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">36</td><td class="hits">1</td><td class="source">String.prototype.__proto__ = Node.prototype;</td></tr><tr><td class="line">37</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">38</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">39</td><td class="hits"></td><td class="source"> * Return quoted string.</td></tr><tr><td class="line">40</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">41</td><td class="hits"></td><td class="source"> * @return {String}</td></tr><tr><td class="line">42</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">43</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">44</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">45</td><td class="hits">1</td><td class="source">String.prototype.toString = function(){</td></tr><tr class="hit"><td class="line">46</td><td class="hits">153</td><td class="source">  return this.quote + this.val + this.quote;</td></tr><tr><td class="line">47</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">48</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">49</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">50</td><td class="hits"></td><td class="source"> * Return a clone of this node.</td></tr><tr><td class="line">51</td><td class="hits"></td><td class="source"> * </td></tr><tr><td class="line">52</td><td class="hits"></td><td class="source"> * @return {Node}</td></tr><tr><td class="line">53</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">54</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">55</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">56</td><td class="hits">1</td><td class="source">String.prototype.clone = function(){</td></tr><tr class="hit"><td class="line">57</td><td class="hits">608</td><td class="source">  var clone = new String(this.val, this.quote);</td></tr><tr class="hit"><td class="line">58</td><td class="hits">608</td><td class="source">  clone.lineno = this.lineno;</td></tr><tr class="hit"><td class="line">59</td><td class="hits">608</td><td class="source">  clone.filename = this.filename;</td></tr><tr class="hit"><td class="line">60</td><td class="hits">608</td><td class="source">  return clone;</td></tr><tr><td class="line">61</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">62</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">63</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">64</td><td class="hits"></td><td class="source"> * Return Boolean based on the length of this string.</td></tr><tr><td class="line">65</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">66</td><td class="hits"></td><td class="source"> * @return {Boolean}</td></tr><tr><td class="line">67</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">68</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">69</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">70</td><td class="hits">1</td><td class="source">String.prototype.toBoolean = function(){</td></tr><tr class="hit"><td class="line">71</td><td class="hits">11</td><td class="source">  return nodes.Boolean(this.val.length);</td></tr><tr><td class="line">72</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">73</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">74</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">75</td><td class="hits"></td><td class="source"> * Coerce `other` to a string.</td></tr><tr><td class="line">76</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">77</td><td class="hits"></td><td class="source"> * @param {Node} other</td></tr><tr><td class="line">78</td><td class="hits"></td><td class="source"> * @return {String}</td></tr><tr><td class="line">79</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">80</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">81</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">82</td><td class="hits">1</td><td class="source">String.prototype.coerce = function(other){</td></tr><tr class="hit"><td class="line">83</td><td class="hits">559</td><td class="source">  switch (other.nodeName) {</td></tr><tr><td class="line">84</td><td class="hits"></td><td class="source">    case 'string':</td></tr><tr class="hit"><td class="line">85</td><td class="hits">75</td><td class="source">      return other;</td></tr><tr><td class="line">86</td><td class="hits"></td><td class="source">    case 'expression':</td></tr><tr class="hit"><td class="line">87</td><td class="hits">370</td><td class="source">      return new String(other.nodes.map(function(node){</td></tr><tr class="hit"><td class="line">88</td><td class="hits">382</td><td class="source">        return this.coerce(node).val;</td></tr><tr><td class="line">89</td><td class="hits"></td><td class="source">      }, this).join(' '));</td></tr><tr><td class="line">90</td><td class="hits"></td><td class="source">    default:</td></tr><tr class="hit"><td class="line">91</td><td class="hits">114</td><td class="source">      return new String(other.toString());</td></tr><tr><td class="line">92</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">93</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">94</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">95</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">96</td><td class="hits"></td><td class="source"> * Operate on `right` with the given `op`.</td></tr><tr><td class="line">97</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">98</td><td class="hits"></td><td class="source"> * @param {String} op</td></tr><tr><td class="line">99</td><td class="hits"></td><td class="source"> * @param {Node} right</td></tr><tr><td class="line">100</td><td class="hits"></td><td class="source"> * @return {Node}</td></tr><tr><td class="line">101</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">102</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">103</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">104</td><td class="hits">1</td><td class="source">String.prototype.operate = function(op, right){</td></tr><tr class="hit"><td class="line">105</td><td class="hits">321</td><td class="source">  switch (op) {</td></tr><tr><td class="line">106</td><td class="hits"></td><td class="source">    case '%':</td></tr><tr class="hit"><td class="line">107</td><td class="hits">6</td><td class="source">      var expr = new nodes.Expression;</td></tr><tr class="hit"><td class="line">108</td><td class="hits">6</td><td class="source">      expr.push(this);</td></tr><tr><td class="line">109</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">110</td><td class="hits"></td><td class="source">      // constructargs</td></tr><tr class="hit"><td class="line">111</td><td class="hits">6</td><td class="source">      var args = 'expression' == right.nodeName</td></tr><tr><td class="line">112</td><td class="hits"></td><td class="source">        ? utils.unwrap(right).nodes</td></tr><tr><td class="line">113</td><td class="hits"></td><td class="source">        : [right];</td></tr><tr><td class="line">114</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">115</td><td class="hits"></td><td class="source">      // apply</td></tr><tr class="hit"><td class="line">116</td><td class="hits">6</td><td class="source">      return sprintf.apply(null, [expr].concat(args));</td></tr><tr><td class="line">117</td><td class="hits"></td><td class="source">    case '+':</td></tr><tr class="hit"><td class="line">118</td><td class="hits">177</td><td class="source">      return new String(this.val + this.coerce(right).val);</td></tr><tr><td class="line">119</td><td class="hits"></td><td class="source">    default:</td></tr><tr class="hit"><td class="line">120</td><td class="hits">138</td><td class="source">      return Node.prototype.operate.call(this, op, right);</td></tr><tr><td class="line">121</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">122</td><td class="hits"></td><td class="source">};</td></tr></tbody></table></div><div class="file"><h2 id="nodes/hsla.js">nodes/hsla.js</h2><div id="stats" class="high"><div class="percentage">94%</div><div class="sloc">58</div><div class="hits">55</div><div class="misses">3</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr><td class="line">1</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source">/*!</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source"> * Stylus - HSLA</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source"> * Copyright(c) 2010 LearnBoost &lt;dev@learnboost.com&gt;</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> * MIT Licensed</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source"> * Module dependencies.</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">12</td><td class="hits">1</td><td class="source">var Node = require('./node')</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source">  , nodes = require('./');</td></tr><tr><td class="line">14</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">15</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source"> * Initialize a new `HSLA` with the given h,s,l,a component values.</td></tr><tr><td class="line">17</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source"> * @param {Number} h</td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source"> * @param {Number} s</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source"> * @param {Number} l</td></tr><tr><td class="line">21</td><td class="hits"></td><td class="source"> * @param {Number} a</td></tr><tr><td class="line">22</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">23</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">24</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">25</td><td class="hits">1</td><td class="source">var HSLA = exports = module.exports = function HSLA(h,s,l,a){</td></tr><tr class="hit"><td class="line">26</td><td class="hits">153</td><td class="source">  Node.call(this);</td></tr><tr class="hit"><td class="line">27</td><td class="hits">153</td><td class="source">  this.h = clampDegrees(h);</td></tr><tr class="hit"><td class="line">28</td><td class="hits">153</td><td class="source">  this.s = clampPercentage(s);</td></tr><tr class="hit"><td class="line">29</td><td class="hits">153</td><td class="source">  this.l = clampPercentage(l);</td></tr><tr class="hit"><td class="line">30</td><td class="hits">153</td><td class="source">  this.a = clampAlpha(a);</td></tr><tr class="hit"><td class="line">31</td><td class="hits">153</td><td class="source">  this.hsla = this;</td></tr><tr><td class="line">32</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">33</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">34</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">35</td><td class="hits"></td><td class="source"> * Inherit from `Node.prototype`.</td></tr><tr><td class="line">36</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">37</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">38</td><td class="hits">1</td><td class="source">HSLA.prototype.__proto__ = Node.prototype;</td></tr><tr><td class="line">39</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">40</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">41</td><td class="hits"></td><td class="source"> * Return hsla(n,n,n,n).</td></tr><tr><td class="line">42</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">43</td><td class="hits"></td><td class="source"> * @return {String}</td></tr><tr><td class="line">44</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">45</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">46</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">47</td><td class="hits">1</td><td class="source">HSLA.prototype.toString = function(){</td></tr><tr class="miss"><td class="line">48</td><td class="hits">0</td><td class="source">  return 'hsla('</td></tr><tr><td class="line">49</td><td class="hits"></td><td class="source">    + this.h + ','</td></tr><tr><td class="line">50</td><td class="hits"></td><td class="source">    + this.s.toFixed(0) + ','</td></tr><tr><td class="line">51</td><td class="hits"></td><td class="source">    + this.l.toFixed(0) + ','</td></tr><tr><td class="line">52</td><td class="hits"></td><td class="source">    + this.a + ')';</td></tr><tr><td class="line">53</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">54</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">55</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">56</td><td class="hits"></td><td class="source"> * Return a clone of this node.</td></tr><tr><td class="line">57</td><td class="hits"></td><td class="source"> * </td></tr><tr><td class="line">58</td><td class="hits"></td><td class="source"> * @return {Node}</td></tr><tr><td class="line">59</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">60</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">61</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">62</td><td class="hits">1</td><td class="source">HSLA.prototype.clone = function(){</td></tr><tr class="hit"><td class="line">63</td><td class="hits">37</td><td class="source">  var clone = new HSLA(</td></tr><tr><td class="line">64</td><td class="hits"></td><td class="source">      this.h</td></tr><tr><td class="line">65</td><td class="hits"></td><td class="source">    , this.s</td></tr><tr><td class="line">66</td><td class="hits"></td><td class="source">    , this.l</td></tr><tr><td class="line">67</td><td class="hits"></td><td class="source">    , this.a);</td></tr><tr class="hit"><td class="line">68</td><td class="hits">37</td><td class="source">  clone.lineno = this.lineno;</td></tr><tr class="hit"><td class="line">69</td><td class="hits">37</td><td class="source">  clone.filename = this.filename;</td></tr><tr class="hit"><td class="line">70</td><td class="hits">37</td><td class="source">  return clone;</td></tr><tr><td class="line">71</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">72</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">73</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">74</td><td class="hits"></td><td class="source"> * Return rgba `RGBA` representation.</td></tr><tr><td class="line">75</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">76</td><td class="hits"></td><td class="source"> * @return {RGBA}</td></tr><tr><td class="line">77</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">78</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">79</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">80</td><td class="hits">1</td><td class="source">HSLA.prototype.__defineGetter__('rgba', function(){</td></tr><tr class="hit"><td class="line">81</td><td class="hits">119</td><td class="source">  return nodes.RGBA.fromHSLA(this);</td></tr><tr><td class="line">82</td><td class="hits"></td><td class="source">});</td></tr><tr><td class="line">83</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">84</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">85</td><td class="hits"></td><td class="source"> * Return hash.</td></tr><tr><td class="line">86</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">87</td><td class="hits"></td><td class="source"> * @return {String}</td></tr><tr><td class="line">88</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">89</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">90</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">91</td><td class="hits">1</td><td class="source">HSLA.prototype.__defineGetter__('hash', function(){</td></tr><tr class="hit"><td class="line">92</td><td class="hits">9</td><td class="source">  return this.rgba.toString();</td></tr><tr><td class="line">93</td><td class="hits"></td><td class="source">});</td></tr><tr><td class="line">94</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">95</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">96</td><td class="hits"></td><td class="source"> * Add h,s,l to the current component values.</td></tr><tr><td class="line">97</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">98</td><td class="hits"></td><td class="source"> * @param {Number} h</td></tr><tr><td class="line">99</td><td class="hits"></td><td class="source"> * @param {Number} s</td></tr><tr><td class="line">100</td><td class="hits"></td><td class="source"> * @param {Number} l</td></tr><tr><td class="line">101</td><td class="hits"></td><td class="source"> * @return {HSLA} new node</td></tr><tr><td class="line">102</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">103</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">104</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">105</td><td class="hits">1</td><td class="source">HSLA.prototype.add = function(h,s,l){</td></tr><tr class="hit"><td class="line">106</td><td class="hits">4</td><td class="source">  return new HSLA(</td></tr><tr><td class="line">107</td><td class="hits"></td><td class="source">      this.h + h</td></tr><tr><td class="line">108</td><td class="hits"></td><td class="source">    , this.s + s</td></tr><tr><td class="line">109</td><td class="hits"></td><td class="source">    , this.l + l</td></tr><tr><td class="line">110</td><td class="hits"></td><td class="source">    , this.a);</td></tr><tr><td class="line">111</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">112</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">113</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">114</td><td class="hits"></td><td class="source"> * Subtract h,s,l from the current component values.</td></tr><tr><td class="line">115</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">116</td><td class="hits"></td><td class="source"> * @param {Number} h</td></tr><tr><td class="line">117</td><td class="hits"></td><td class="source"> * @param {Number} s</td></tr><tr><td class="line">118</td><td class="hits"></td><td class="source"> * @param {Number} l</td></tr><tr><td class="line">119</td><td class="hits"></td><td class="source"> * @return {HSLA} new node</td></tr><tr><td class="line">120</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">121</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">122</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">123</td><td class="hits">1</td><td class="source">HSLA.prototype.sub = function(h,s,l){</td></tr><tr class="hit"><td class="line">124</td><td class="hits">2</td><td class="source">  return this.add(-h, -s, -l);</td></tr><tr><td class="line">125</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">126</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">127</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">128</td><td class="hits"></td><td class="source"> * Operate on `right` with the given `op`.</td></tr><tr><td class="line">129</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">130</td><td class="hits"></td><td class="source"> * @param {String} op</td></tr><tr><td class="line">131</td><td class="hits"></td><td class="source"> * @param {Node} right</td></tr><tr><td class="line">132</td><td class="hits"></td><td class="source"> * @return {Node}</td></tr><tr><td class="line">133</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">134</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">135</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">136</td><td class="hits">1</td><td class="source">HSLA.prototype.operate = function(op, right){</td></tr><tr class="hit"><td class="line">137</td><td class="hits">18</td><td class="source">  switch (op) {</td></tr><tr><td class="line">138</td><td class="hits"></td><td class="source">    case '==':</td></tr><tr><td class="line">139</td><td class="hits"></td><td class="source">    case '!=':</td></tr><tr><td class="line">140</td><td class="hits"></td><td class="source">    case '&lt;=':</td></tr><tr><td class="line">141</td><td class="hits"></td><td class="source">    case '&gt;=':</td></tr><tr><td class="line">142</td><td class="hits"></td><td class="source">    case '&lt;':</td></tr><tr><td class="line">143</td><td class="hits"></td><td class="source">    case '&gt;':</td></tr><tr><td class="line">144</td><td class="hits"></td><td class="source">    case 'is a':</td></tr><tr><td class="line">145</td><td class="hits"></td><td class="source">    case '||':</td></tr><tr><td class="line">146</td><td class="hits"></td><td class="source">    case '&amp;&amp;':</td></tr><tr class="hit"><td class="line">147</td><td class="hits">8</td><td class="source">      return this.rgba.operate(op, right);</td></tr><tr><td class="line">148</td><td class="hits"></td><td class="source">    default:</td></tr><tr class="hit"><td class="line">149</td><td class="hits">10</td><td class="source">      return this.rgba.operate(op, right).hsla;</td></tr><tr><td class="line">150</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">151</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">152</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">153</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">154</td><td class="hits"></td><td class="source"> * Return `HSLA` representation of the given `color`.</td></tr><tr><td class="line">155</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">156</td><td class="hits"></td><td class="source"> * @param {RGBA} color</td></tr><tr><td class="line">157</td><td class="hits"></td><td class="source"> * @return {HSLA}</td></tr><tr><td class="line">158</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">159</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">160</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">161</td><td class="hits">1</td><td class="source">exports.fromRGBA = function(rgba){</td></tr><tr class="hit"><td class="line">162</td><td class="hits">79</td><td class="source">  var r = rgba.r / 255</td></tr><tr><td class="line">163</td><td class="hits"></td><td class="source">    , g = rgba.g / 255</td></tr><tr><td class="line">164</td><td class="hits"></td><td class="source">    , b = rgba.b / 255</td></tr><tr><td class="line">165</td><td class="hits"></td><td class="source">    , a = rgba.a;</td></tr><tr><td class="line">166</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">167</td><td class="hits">79</td><td class="source">  var min = Math.min(r,g,b)</td></tr><tr><td class="line">168</td><td class="hits"></td><td class="source">    , max = Math.max(r,g,b)</td></tr><tr><td class="line">169</td><td class="hits"></td><td class="source">    , l = (max + min) / 2</td></tr><tr><td class="line">170</td><td class="hits"></td><td class="source">    , d = max - min</td></tr><tr><td class="line">171</td><td class="hits"></td><td class="source">    , h, s;</td></tr><tr><td class="line">172</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">173</td><td class="hits">79</td><td class="source">  switch (max) {</td></tr><tr class="hit"><td class="line">174</td><td class="hits">80</td><td class="source">    case min: h = 0; break;</td></tr><tr class="hit"><td class="line">175</td><td class="hits">66</td><td class="source">    case r: h = 60 * (g-b) / d; break;</td></tr><tr class="hit"><td class="line">176</td><td class="hits">4</td><td class="source">    case g: h = 60 * (b-r) / d + 120; break;</td></tr><tr class="hit"><td class="line">177</td><td class="hits">8</td><td class="source">    case b: h = 60 * (r-g) / d + 240; break;</td></tr><tr><td class="line">178</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">179</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">180</td><td class="hits">79</td><td class="source">  if (max == min) {</td></tr><tr class="hit"><td class="line">181</td><td class="hits">40</td><td class="source">    s = 0;</td></tr><tr class="hit"><td class="line">182</td><td class="hits">39</td><td class="source">  } else if (l &lt; .5) {</td></tr><tr class="hit"><td class="line">183</td><td class="hits">4</td><td class="source">    s = d / (2 * l);</td></tr><tr><td class="line">184</td><td class="hits"></td><td class="source">  } else {</td></tr><tr class="hit"><td class="line">185</td><td class="hits">35</td><td class="source">    s = d / (2 - 2 * l);</td></tr><tr><td class="line">186</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">187</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">188</td><td class="hits">79</td><td class="source">  h %= 360;</td></tr><tr class="hit"><td class="line">189</td><td class="hits">79</td><td class="source">  s *= 100;</td></tr><tr class="hit"><td class="line">190</td><td class="hits">79</td><td class="source">  l *= 100;</td></tr><tr><td class="line">191</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">192</td><td class="hits">79</td><td class="source">  return new HSLA(h,s,l,a);</td></tr><tr><td class="line">193</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">194</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">195</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">196</td><td class="hits"></td><td class="source"> * Adjust lightness by `percent`.</td></tr><tr><td class="line">197</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">198</td><td class="hits"></td><td class="source"> * @param {Number} percent</td></tr><tr><td class="line">199</td><td class="hits"></td><td class="source"> * @return {HSLA} for chaining</td></tr><tr><td class="line">200</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">201</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">202</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">203</td><td class="hits">1</td><td class="source">HSLA.prototype.adjustLightness = function(percent){</td></tr><tr class="miss"><td class="line">204</td><td class="hits">0</td><td class="source">  this.l = clampPercentage(this.l + this.l * (percent / 100));</td></tr><tr class="miss"><td class="line">205</td><td class="hits">0</td><td class="source">  return this;</td></tr><tr><td class="line">206</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">207</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">208</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">209</td><td class="hits"></td><td class="source"> * Adjust hue by `deg`.</td></tr><tr><td class="line">210</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">211</td><td class="hits"></td><td class="source"> * @param {Number} deg</td></tr><tr><td class="line">212</td><td class="hits"></td><td class="source"> * @return {HSLA} for chaining</td></tr><tr><td class="line">213</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">214</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">215</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">216</td><td class="hits">1</td><td class="source">HSLA.prototype.adjustHue = function(deg){</td></tr><tr class="hit"><td class="line">217</td><td class="hits">4</td><td class="source">  this.h = clampDegrees(this.h + deg);</td></tr><tr class="hit"><td class="line">218</td><td class="hits">4</td><td class="source">  return this;</td></tr><tr><td class="line">219</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">220</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">221</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">222</td><td class="hits"></td><td class="source"> * Clamp degree `n` &gt;= 0 and &lt;= 360.</td></tr><tr><td class="line">223</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">224</td><td class="hits"></td><td class="source"> * @param {Number} n</td></tr><tr><td class="line">225</td><td class="hits"></td><td class="source"> * @return {Number}</td></tr><tr><td class="line">226</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">227</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">228</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">229</td><td class="hits">1</td><td class="source">function clampDegrees(n) {</td></tr><tr class="hit"><td class="line">230</td><td class="hits">157</td><td class="source">  n = n % 360;</td></tr><tr class="hit"><td class="line">231</td><td class="hits">157</td><td class="source">  return n &gt;= 0 ? n : 360 + n;</td></tr><tr><td class="line">232</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">233</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">234</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">235</td><td class="hits"></td><td class="source"> * Clamp percentage `n` &gt;= 0 and &lt;= 100.</td></tr><tr><td class="line">236</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">237</td><td class="hits"></td><td class="source"> * @param {Number} n</td></tr><tr><td class="line">238</td><td class="hits"></td><td class="source"> * @return {Number}</td></tr><tr><td class="line">239</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">240</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">241</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">242</td><td class="hits">1</td><td class="source">function clampPercentage(n) {</td></tr><tr class="hit"><td class="line">243</td><td class="hits">306</td><td class="source">  return Math.max(0, Math.min(n, 100));</td></tr><tr><td class="line">244</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">245</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">246</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">247</td><td class="hits"></td><td class="source"> * Clamp alpha `n` &gt;= 0 and &lt;= 1.</td></tr><tr><td class="line">248</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">249</td><td class="hits"></td><td class="source"> * @param {Number} n</td></tr><tr><td class="line">250</td><td class="hits"></td><td class="source"> * @return {Number}</td></tr><tr><td class="line">251</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">252</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">253</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">254</td><td class="hits">1</td><td class="source">function clampAlpha(n) {</td></tr><tr class="hit"><td class="line">255</td><td class="hits">153</td><td class="source">  return Math.max(0, Math.min(n, 1));</td></tr><tr><td class="line">256</td><td class="hits"></td><td class="source">}</td></tr></tbody></table></div><div class="file"><h2 id="nodes/rgba.js">nodes/rgba.js</h2><div id="stats" class="high"><div class="percentage">82%</div><div class="sloc">91</div><div class="hits">75</div><div class="misses">16</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr><td class="line">1</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source">/*!</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source"> * Stylus - RGBA</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source"> * Copyright(c) 2010 LearnBoost &lt;dev@learnboost.com&gt;</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> * MIT Licensed</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source"> * Module dependencies.</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">12</td><td class="hits">1</td><td class="source">var Node = require('./node')</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source">  , HSLA = require('./hsla')</td></tr><tr><td class="line">14</td><td class="hits"></td><td class="source">  , functions = require('../functions')</td></tr><tr><td class="line">15</td><td class="hits"></td><td class="source">  , adjust = functions['-adjust']</td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source">  , nodes = require('./');</td></tr><tr><td class="line">17</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source"> * Initialize a new `RGBA` with the given r,g,b,a component values.</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">21</td><td class="hits"></td><td class="source"> * @param {Number} r</td></tr><tr><td class="line">22</td><td class="hits"></td><td class="source"> * @param {Number} g</td></tr><tr><td class="line">23</td><td class="hits"></td><td class="source"> * @param {Number} b</td></tr><tr><td class="line">24</td><td class="hits"></td><td class="source"> * @param {Number} a</td></tr><tr><td class="line">25</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">26</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">27</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">28</td><td class="hits">1</td><td class="source">var RGBA = exports = module.exports = function RGBA(r,g,b,a){</td></tr><tr class="hit"><td class="line">29</td><td class="hits">31399</td><td class="source">  Node.call(this);</td></tr><tr class="hit"><td class="line">30</td><td class="hits">31399</td><td class="source">  this.r = clamp(r);</td></tr><tr class="hit"><td class="line">31</td><td class="hits">31399</td><td class="source">  this.g = clamp(g);</td></tr><tr class="hit"><td class="line">32</td><td class="hits">31399</td><td class="source">  this.b = clamp(b);</td></tr><tr class="hit"><td class="line">33</td><td class="hits">31399</td><td class="source">  this.a = clampAlpha(a);</td></tr><tr class="hit"><td class="line">34</td><td class="hits">31399</td><td class="source">  this.rgba = this;</td></tr><tr><td class="line">35</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">36</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">37</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">38</td><td class="hits"></td><td class="source"> * Inherit from `Node.prototype`.</td></tr><tr><td class="line">39</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">40</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">41</td><td class="hits">1</td><td class="source">RGBA.prototype.__proto__ = Node.prototype;</td></tr><tr><td class="line">42</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">43</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">44</td><td class="hits"></td><td class="source"> * Return an `RGBA` without clamping values.</td></tr><tr><td class="line">45</td><td class="hits"></td><td class="source"> * </td></tr><tr><td class="line">46</td><td class="hits"></td><td class="source"> * @param {Number} r</td></tr><tr><td class="line">47</td><td class="hits"></td><td class="source"> * @param {Number} g</td></tr><tr><td class="line">48</td><td class="hits"></td><td class="source"> * @param {Number} b</td></tr><tr><td class="line">49</td><td class="hits"></td><td class="source"> * @param {Number} a</td></tr><tr><td class="line">50</td><td class="hits"></td><td class="source"> * @return {RGBA}</td></tr><tr><td class="line">51</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">52</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">53</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">54</td><td class="hits">1</td><td class="source">RGBA.withoutClamping = function(r,g,b,a){</td></tr><tr class="miss"><td class="line">55</td><td class="hits">0</td><td class="source">  var rgba = new RGBA(0,0,0,0);</td></tr><tr class="miss"><td class="line">56</td><td class="hits">0</td><td class="source">  rgba.r = r;</td></tr><tr class="miss"><td class="line">57</td><td class="hits">0</td><td class="source">  rgba.g = g;</td></tr><tr class="miss"><td class="line">58</td><td class="hits">0</td><td class="source">  rgba.b = b;</td></tr><tr class="miss"><td class="line">59</td><td class="hits">0</td><td class="source">  rgba.a = a;</td></tr><tr class="miss"><td class="line">60</td><td class="hits">0</td><td class="source">  return rgba;</td></tr><tr><td class="line">61</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">62</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">63</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">64</td><td class="hits"></td><td class="source"> * Return a clone of this node.</td></tr><tr><td class="line">65</td><td class="hits"></td><td class="source"> * </td></tr><tr><td class="line">66</td><td class="hits"></td><td class="source"> * @return {Node}</td></tr><tr><td class="line">67</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">68</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">69</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">70</td><td class="hits">1</td><td class="source">RGBA.prototype.clone = function(){</td></tr><tr class="hit"><td class="line">71</td><td class="hits">418</td><td class="source">  var clone = new RGBA(</td></tr><tr><td class="line">72</td><td class="hits"></td><td class="source">      this.r</td></tr><tr><td class="line">73</td><td class="hits"></td><td class="source">    , this.g</td></tr><tr><td class="line">74</td><td class="hits"></td><td class="source">    , this.b</td></tr><tr><td class="line">75</td><td class="hits"></td><td class="source">    , this.a);</td></tr><tr class="hit"><td class="line">76</td><td class="hits">418</td><td class="source">  clone.lineno = this.lineno;</td></tr><tr class="hit"><td class="line">77</td><td class="hits">418</td><td class="source">  clone.filename = this.filename;</td></tr><tr class="hit"><td class="line">78</td><td class="hits">418</td><td class="source">  return clone;</td></tr><tr><td class="line">79</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">80</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">81</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">82</td><td class="hits"></td><td class="source"> * Return true.</td></tr><tr><td class="line">83</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">84</td><td class="hits"></td><td class="source"> * @return {Boolean}</td></tr><tr><td class="line">85</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">86</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">87</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">88</td><td class="hits">1</td><td class="source">RGBA.prototype.toBoolean = function(){</td></tr><tr class="hit"><td class="line">89</td><td class="hits">4</td><td class="source">  return nodes.true;</td></tr><tr><td class="line">90</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">91</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">92</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">93</td><td class="hits"></td><td class="source"> * Return `HSLA` representation.</td></tr><tr><td class="line">94</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">95</td><td class="hits"></td><td class="source"> * @return {HSLA}</td></tr><tr><td class="line">96</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">97</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">98</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">99</td><td class="hits">1</td><td class="source">RGBA.prototype.__defineGetter__('hsla', function(){</td></tr><tr class="hit"><td class="line">100</td><td class="hits">79</td><td class="source">  return HSLA.fromRGBA(this);</td></tr><tr><td class="line">101</td><td class="hits"></td><td class="source">});</td></tr><tr><td class="line">102</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">103</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">104</td><td class="hits"></td><td class="source"> * Return hash.</td></tr><tr><td class="line">105</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">106</td><td class="hits"></td><td class="source"> * @return {String}</td></tr><tr><td class="line">107</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">108</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">109</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">110</td><td class="hits">1</td><td class="source">RGBA.prototype.__defineGetter__('hash', function(){</td></tr><tr class="hit"><td class="line">111</td><td class="hits">11</td><td class="source">  return this.toString();</td></tr><tr><td class="line">112</td><td class="hits"></td><td class="source">});</td></tr><tr><td class="line">113</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">114</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">115</td><td class="hits"></td><td class="source"> * Add r,g,b,a to the current component values.</td></tr><tr><td class="line">116</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">117</td><td class="hits"></td><td class="source"> * @param {Number} r</td></tr><tr><td class="line">118</td><td class="hits"></td><td class="source"> * @param {Number} g</td></tr><tr><td class="line">119</td><td class="hits"></td><td class="source"> * @param {Number} b</td></tr><tr><td class="line">120</td><td class="hits"></td><td class="source"> * @param {Number} a</td></tr><tr><td class="line">121</td><td class="hits"></td><td class="source"> * @return {RGBA} new node</td></tr><tr><td class="line">122</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">123</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">124</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">125</td><td class="hits">1</td><td class="source">RGBA.prototype.add = function(r,g,b,a){</td></tr><tr class="hit"><td class="line">126</td><td class="hits">8</td><td class="source">  return new RGBA(</td></tr><tr><td class="line">127</td><td class="hits"></td><td class="source">      this.r + r</td></tr><tr><td class="line">128</td><td class="hits"></td><td class="source">    , this.g + g</td></tr><tr><td class="line">129</td><td class="hits"></td><td class="source">    , this.b + b</td></tr><tr><td class="line">130</td><td class="hits"></td><td class="source">    , this.a + a);</td></tr><tr><td class="line">131</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">132</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">133</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">134</td><td class="hits"></td><td class="source"> * Subtract r,g,b,a from the current component values.</td></tr><tr><td class="line">135</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">136</td><td class="hits"></td><td class="source"> * @param {Number} r</td></tr><tr><td class="line">137</td><td class="hits"></td><td class="source"> * @param {Number} g</td></tr><tr><td class="line">138</td><td class="hits"></td><td class="source"> * @param {Number} b</td></tr><tr><td class="line">139</td><td class="hits"></td><td class="source"> * @param {Number} a</td></tr><tr><td class="line">140</td><td class="hits"></td><td class="source"> * @return {RGBA} new node</td></tr><tr><td class="line">141</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">142</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">143</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">144</td><td class="hits">1</td><td class="source">RGBA.prototype.sub = function(r,g,b,a){</td></tr><tr class="hit"><td class="line">145</td><td class="hits">7</td><td class="source">  return new RGBA(</td></tr><tr><td class="line">146</td><td class="hits"></td><td class="source">      this.r - r</td></tr><tr><td class="line">147</td><td class="hits"></td><td class="source">    , this.g - g</td></tr><tr><td class="line">148</td><td class="hits"></td><td class="source">    , this.b - b</td></tr><tr><td class="line">149</td><td class="hits"></td><td class="source">    , a == 1 ? this.a : this.a - a);</td></tr><tr><td class="line">150</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">151</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">152</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">153</td><td class="hits"></td><td class="source"> * Multiply rgb components by `n`.</td></tr><tr><td class="line">154</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">155</td><td class="hits"></td><td class="source"> * @param {String} n</td></tr><tr><td class="line">156</td><td class="hits"></td><td class="source"> * @return {RGBA} new node</td></tr><tr><td class="line">157</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">158</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">159</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">160</td><td class="hits">1</td><td class="source">RGBA.prototype.multiply = function(n){</td></tr><tr class="miss"><td class="line">161</td><td class="hits">0</td><td class="source">  return new RGBA(</td></tr><tr><td class="line">162</td><td class="hits"></td><td class="source">      this.r * n</td></tr><tr><td class="line">163</td><td class="hits"></td><td class="source">    , this.g * n</td></tr><tr><td class="line">164</td><td class="hits"></td><td class="source">    , this.b * n</td></tr><tr><td class="line">165</td><td class="hits"></td><td class="source">    , this.a); </td></tr><tr><td class="line">166</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">167</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">168</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">169</td><td class="hits"></td><td class="source"> * Divide rgb components by `n`.</td></tr><tr><td class="line">170</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">171</td><td class="hits"></td><td class="source"> * @param {String} n</td></tr><tr><td class="line">172</td><td class="hits"></td><td class="source"> * @return {RGBA} new node</td></tr><tr><td class="line">173</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">174</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">175</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">176</td><td class="hits">1</td><td class="source">RGBA.prototype.divide = function(n){</td></tr><tr class="miss"><td class="line">177</td><td class="hits">0</td><td class="source">  return new RGBA(</td></tr><tr><td class="line">178</td><td class="hits"></td><td class="source">      this.r / n</td></tr><tr><td class="line">179</td><td class="hits"></td><td class="source">    , this.g / n</td></tr><tr><td class="line">180</td><td class="hits"></td><td class="source">    , this.b / n</td></tr><tr><td class="line">181</td><td class="hits"></td><td class="source">    , this.a); </td></tr><tr><td class="line">182</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">183</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">184</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">185</td><td class="hits"></td><td class="source"> * Operate on `right` with the given `op`.</td></tr><tr><td class="line">186</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">187</td><td class="hits"></td><td class="source"> * @param {String} op</td></tr><tr><td class="line">188</td><td class="hits"></td><td class="source"> * @param {Node} right</td></tr><tr><td class="line">189</td><td class="hits"></td><td class="source"> * @return {Node}</td></tr><tr><td class="line">190</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">191</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">192</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">193</td><td class="hits">1</td><td class="source">RGBA.prototype.operate = function(op, right){</td></tr><tr class="hit"><td class="line">194</td><td class="hits">86</td><td class="source">  right = right.first;</td></tr><tr><td class="line">195</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">196</td><td class="hits">86</td><td class="source">  switch (op) {</td></tr><tr><td class="line">197</td><td class="hits"></td><td class="source">    case 'is a':</td></tr><tr class="hit"><td class="line">198</td><td class="hits">46</td><td class="source">      if ('string' == right.nodeName &amp;&amp; 'color' == right.string) {</td></tr><tr class="hit"><td class="line">199</td><td class="hits">43</td><td class="source">        return nodes.true;</td></tr><tr><td class="line">200</td><td class="hits"></td><td class="source">      }</td></tr><tr class="hit"><td class="line">201</td><td class="hits">3</td><td class="source">      break;</td></tr><tr><td class="line">202</td><td class="hits"></td><td class="source">    case '+':</td></tr><tr class="hit"><td class="line">203</td><td class="hits">15</td><td class="source">      switch (right.nodeName) {</td></tr><tr><td class="line">204</td><td class="hits"></td><td class="source">        case 'unit':</td></tr><tr class="hit"><td class="line">205</td><td class="hits">8</td><td class="source">          var n = right.val;</td></tr><tr class="hit"><td class="line">206</td><td class="hits">8</td><td class="source">          switch (right.type) {</td></tr><tr class="hit"><td class="line">207</td><td class="hits">3</td><td class="source">            case '%': return adjust(this, new nodes.String('lightness'), right);</td></tr><tr class="hit"><td class="line">208</td><td class="hits">2</td><td class="source">            case 'deg': return this.hsla.adjustHue(n).rgba;</td></tr><tr class="hit"><td class="line">209</td><td class="hits">3</td><td class="source">            default: return this.add(n,n,n,0);</td></tr><tr><td class="line">210</td><td class="hits"></td><td class="source">          }</td></tr><tr><td class="line">211</td><td class="hits"></td><td class="source">        case 'rgba':</td></tr><tr class="hit"><td class="line">212</td><td class="hits">5</td><td class="source">          return this.add(right.r, right.g, right.b, right.a);</td></tr><tr><td class="line">213</td><td class="hits"></td><td class="source">        case 'hsla':</td></tr><tr class="hit"><td class="line">214</td><td class="hits">2</td><td class="source">          return this.hsla.add(right.h, right.s, right.l);</td></tr><tr><td class="line">215</td><td class="hits"></td><td class="source">      }</td></tr><tr class="miss"><td class="line">216</td><td class="hits">0</td><td class="source">      break;</td></tr><tr><td class="line">217</td><td class="hits"></td><td class="source">    case '-':</td></tr><tr class="hit"><td class="line">218</td><td class="hits">14</td><td class="source">      switch (right.nodeName) {</td></tr><tr><td class="line">219</td><td class="hits"></td><td class="source">        case 'unit':</td></tr><tr class="hit"><td class="line">220</td><td class="hits">7</td><td class="source">          var n = right.val;</td></tr><tr class="hit"><td class="line">221</td><td class="hits">7</td><td class="source">          switch (right.type) {</td></tr><tr class="hit"><td class="line">222</td><td class="hits">3</td><td class="source">            case '%': return adjust(this, new nodes.String('lightness'), new nodes.Unit(-n, '%'));</td></tr><tr class="hit"><td class="line">223</td><td class="hits">2</td><td class="source">            case 'deg': return this.hsla.adjustHue(-n).rgba;</td></tr><tr class="hit"><td class="line">224</td><td class="hits">2</td><td class="source">            default: return this.sub(n,n,n,0);</td></tr><tr><td class="line">225</td><td class="hits"></td><td class="source">          }</td></tr><tr><td class="line">226</td><td class="hits"></td><td class="source">        case 'rgba':</td></tr><tr class="hit"><td class="line">227</td><td class="hits">5</td><td class="source">          return this.sub(right.r, right.g, right.b, right.a);</td></tr><tr><td class="line">228</td><td class="hits"></td><td class="source">        case 'hsla':</td></tr><tr class="hit"><td class="line">229</td><td class="hits">2</td><td class="source">          return this.hsla.sub(right.h, right.s, right.l);</td></tr><tr><td class="line">230</td><td class="hits"></td><td class="source">      }</td></tr><tr class="miss"><td class="line">231</td><td class="hits">0</td><td class="source">      break;</td></tr><tr><td class="line">232</td><td class="hits"></td><td class="source">    case '*':</td></tr><tr class="miss"><td class="line">233</td><td class="hits">0</td><td class="source">      switch (right.nodeName) {</td></tr><tr><td class="line">234</td><td class="hits"></td><td class="source">        case 'unit':</td></tr><tr class="miss"><td class="line">235</td><td class="hits">0</td><td class="source">          return this.multiply(right.val);</td></tr><tr><td class="line">236</td><td class="hits"></td><td class="source">      }</td></tr><tr class="miss"><td class="line">237</td><td class="hits">0</td><td class="source">      break;</td></tr><tr><td class="line">238</td><td class="hits"></td><td class="source">    case '/':</td></tr><tr class="miss"><td class="line">239</td><td class="hits">0</td><td class="source">      switch (right.nodeName) {</td></tr><tr><td class="line">240</td><td class="hits"></td><td class="source">        case 'unit':</td></tr><tr class="miss"><td class="line">241</td><td class="hits">0</td><td class="source">          return this.divide(right.val);</td></tr><tr><td class="line">242</td><td class="hits"></td><td class="source">      }</td></tr><tr class="miss"><td class="line">243</td><td class="hits">0</td><td class="source">      break;</td></tr><tr><td class="line">244</td><td class="hits"></td><td class="source">  }</td></tr><tr class="hit"><td class="line">245</td><td class="hits">14</td><td class="source">  return Node.prototype.operate.call(this, op, right);</td></tr><tr><td class="line">246</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">247</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">248</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">249</td><td class="hits"></td><td class="source"> * Return #nnnnnn, #nnn, or rgba(n,n,n,n) string representation of the color.</td></tr><tr><td class="line">250</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">251</td><td class="hits"></td><td class="source"> * @return {String}</td></tr><tr><td class="line">252</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">253</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">254</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">255</td><td class="hits">1</td><td class="source">RGBA.prototype.toString = function(){</td></tr><tr class="hit"><td class="line">256</td><td class="hits">415</td><td class="source">  function pad(n) {</td></tr><tr class="hit"><td class="line">257</td><td class="hits">1071</td><td class="source">    return n &lt; 16</td></tr><tr><td class="line">258</td><td class="hits"></td><td class="source">      ? '0' + n.toString(16)</td></tr><tr><td class="line">259</td><td class="hits"></td><td class="source">      : n.toString(16);</td></tr><tr><td class="line">260</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">261</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">262</td><td class="hits">415</td><td class="source">  if (1 == this.a) {</td></tr><tr class="hit"><td class="line">263</td><td class="hits">357</td><td class="source">    var r = pad(this.r)</td></tr><tr><td class="line">264</td><td class="hits"></td><td class="source">      , g = pad(this.g)</td></tr><tr><td class="line">265</td><td class="hits"></td><td class="source">      , b = pad(this.b);</td></tr><tr><td class="line">266</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">267</td><td class="hits"></td><td class="source">    // Compress</td></tr><tr class="hit"><td class="line">268</td><td class="hits">357</td><td class="source">    if (r[0] == r[1] &amp;&amp; g[0] == g[1] &amp;&amp; b[0] == b[1]) {</td></tr><tr class="hit"><td class="line">269</td><td class="hits">239</td><td class="source">      return '#' + r[0] + g[0] + b[0];</td></tr><tr><td class="line">270</td><td class="hits"></td><td class="source">    } else {</td></tr><tr class="hit"><td class="line">271</td><td class="hits">118</td><td class="source">      return '#' + r + g + b;</td></tr><tr><td class="line">272</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">273</td><td class="hits"></td><td class="source">  } else {</td></tr><tr class="hit"><td class="line">274</td><td class="hits">58</td><td class="source">    return 'rgba('</td></tr><tr><td class="line">275</td><td class="hits"></td><td class="source">      + this.r + ','</td></tr><tr><td class="line">276</td><td class="hits"></td><td class="source">      + this.g + ','</td></tr><tr><td class="line">277</td><td class="hits"></td><td class="source">      + this.b + ','</td></tr><tr><td class="line">278</td><td class="hits"></td><td class="source">      + this.a.toFixed(2) + ')';</td></tr><tr><td class="line">279</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">280</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">281</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">282</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">283</td><td class="hits"></td><td class="source"> * Return a `RGBA` from the given `hsla`.</td></tr><tr><td class="line">284</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">285</td><td class="hits"></td><td class="source"> * @param {HSLA} hsla</td></tr><tr><td class="line">286</td><td class="hits"></td><td class="source"> * @return {RGBA}</td></tr><tr><td class="line">287</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">288</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">289</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">290</td><td class="hits">1</td><td class="source">exports.fromHSLA = function(hsla){</td></tr><tr class="hit"><td class="line">291</td><td class="hits">119</td><td class="source">  var h = hsla.h / 360</td></tr><tr><td class="line">292</td><td class="hits"></td><td class="source">    , s = hsla.s / 100</td></tr><tr><td class="line">293</td><td class="hits"></td><td class="source">    , l = hsla.l / 100</td></tr><tr><td class="line">294</td><td class="hits"></td><td class="source">    , a = hsla.a;</td></tr><tr><td class="line">295</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">296</td><td class="hits">119</td><td class="source">  var m2 = l &lt;= .5 ? l * (s + 1) : l + s - l * s</td></tr><tr><td class="line">297</td><td class="hits"></td><td class="source">    , m1 = l * 2 - m2;</td></tr><tr><td class="line">298</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">299</td><td class="hits">119</td><td class="source">  var r = hue(h + 1/3) * 0xff</td></tr><tr><td class="line">300</td><td class="hits"></td><td class="source">    , g = hue(h) * 0xff</td></tr><tr><td class="line">301</td><td class="hits"></td><td class="source">    , b = hue(h - 1/3) * 0xff;</td></tr><tr><td class="line">302</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">303</td><td class="hits">119</td><td class="source">  function hue(h) {</td></tr><tr class="hit"><td class="line">304</td><td class="hits">444</td><td class="source">    if (h &lt; 0) ++h;</td></tr><tr class="hit"><td class="line">305</td><td class="hits">363</td><td class="source">    if (h &gt; 1) --h;</td></tr><tr class="hit"><td class="line">306</td><td class="hits">444</td><td class="source">    if (h * 6 &lt; 1) return m1 + (m2 - m1) * h * 6;</td></tr><tr class="hit"><td class="line">307</td><td class="hits">389</td><td class="source">    if (h * 2 &lt; 1) return m2;</td></tr><tr class="hit"><td class="line">308</td><td class="hits">179</td><td class="source">    if (h * 3 &lt; 2) return m1 + (m2 - m1) * (2/3 - h) * 6;</td></tr><tr class="hit"><td class="line">309</td><td class="hits">123</td><td class="source">    return m1;</td></tr><tr><td class="line">310</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">311</td><td class="hits"></td><td class="source">  </td></tr><tr class="hit"><td class="line">312</td><td class="hits">119</td><td class="source">  return new RGBA(r,g,b,a);</td></tr><tr><td class="line">313</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">314</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">315</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">316</td><td class="hits"></td><td class="source"> * Clamp `n` &gt;= 0 and &lt;= 255.</td></tr><tr><td class="line">317</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">318</td><td class="hits"></td><td class="source"> * @param {Number} n</td></tr><tr><td class="line">319</td><td class="hits"></td><td class="source"> * @return {Number}</td></tr><tr><td class="line">320</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">321</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">322</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">323</td><td class="hits">1</td><td class="source">function clamp(n) {</td></tr><tr class="hit"><td class="line">324</td><td class="hits">94197</td><td class="source">  return Math.max(0, Math.min(n.toFixed(0), 255));</td></tr><tr><td class="line">325</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">326</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">327</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">328</td><td class="hits"></td><td class="source"> * Clamp alpha `n` &gt;= 0 and &lt;= 1.</td></tr><tr><td class="line">329</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">330</td><td class="hits"></td><td class="source"> * @param {Number} n</td></tr><tr><td class="line">331</td><td class="hits"></td><td class="source"> * @return {Number}</td></tr><tr><td class="line">332</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">333</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">334</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">335</td><td class="hits">1</td><td class="source">function clampAlpha(n) {</td></tr><tr class="hit"><td class="line">336</td><td class="hits">31399</td><td class="source">  return Math.max(0, Math.min(n, 1));</td></tr><tr><td class="line">337</td><td class="hits"></td><td class="source">}</td></tr></tbody></table></div><div class="file"><h2 id="nodes/ident.js">nodes/ident.js</h2><div id="stats" class="high"><div class="percentage">79%</div><div class="sloc">34</div><div class="hits">27</div><div class="misses">7</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr><td class="line">1</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source">/*!</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source"> * Stylus - Ident</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source"> * Copyright(c) 2010 LearnBoost &lt;dev@learnboost.com&gt;</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> * MIT Licensed</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source"> * Module dependencies.</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">12</td><td class="hits">1</td><td class="source">var Node = require('./node')</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source">  , nodes = require('./');</td></tr><tr><td class="line">14</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">15</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source"> * Initialize a new `Ident` by `name` with the given `val` node.</td></tr><tr><td class="line">17</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source"> * @param {String} name</td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source"> * @param {Node} val</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">21</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">22</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">23</td><td class="hits">1</td><td class="source">var Ident = module.exports = function Ident(name, val){</td></tr><tr class="hit"><td class="line">24</td><td class="hits">125596</td><td class="source">  Node.call(this);</td></tr><tr class="hit"><td class="line">25</td><td class="hits">125596</td><td class="source">  this.name = name;</td></tr><tr class="hit"><td class="line">26</td><td class="hits">125596</td><td class="source">  this.string = name;</td></tr><tr class="hit"><td class="line">27</td><td class="hits">125596</td><td class="source">  this.val = val || nodes.null;</td></tr><tr><td class="line">28</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">29</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">30</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">31</td><td class="hits"></td><td class="source"> * Check if the variable has a value.</td></tr><tr><td class="line">32</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">33</td><td class="hits"></td><td class="source"> * @return {Boolean}</td></tr><tr><td class="line">34</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">35</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">36</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">37</td><td class="hits">1</td><td class="source">Ident.prototype.__defineGetter__('isEmpty', function(){</td></tr><tr class="hit"><td class="line">38</td><td class="hits">2</td><td class="source">  return undefined == this.val;</td></tr><tr><td class="line">39</td><td class="hits"></td><td class="source">});</td></tr><tr><td class="line">40</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">41</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">42</td><td class="hits"></td><td class="source"> * Return hash.</td></tr><tr><td class="line">43</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">44</td><td class="hits"></td><td class="source"> * @return {String}</td></tr><tr><td class="line">45</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">46</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">47</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">48</td><td class="hits">1</td><td class="source">Ident.prototype.__defineGetter__('hash', function(){</td></tr><tr class="hit"><td class="line">49</td><td class="hits">147</td><td class="source">  return this.name;</td></tr><tr><td class="line">50</td><td class="hits"></td><td class="source">});</td></tr><tr><td class="line">51</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">52</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">53</td><td class="hits"></td><td class="source"> * Inherit from `Node.prototype`.</td></tr><tr><td class="line">54</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">55</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">56</td><td class="hits">1</td><td class="source">Ident.prototype.__proto__ = Node.prototype;</td></tr><tr><td class="line">57</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">58</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">59</td><td class="hits"></td><td class="source"> * Return a clone of this node.</td></tr><tr><td class="line">60</td><td class="hits"></td><td class="source"> * </td></tr><tr><td class="line">61</td><td class="hits"></td><td class="source"> * @return {Node}</td></tr><tr><td class="line">62</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">63</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">64</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">65</td><td class="hits">1</td><td class="source">Ident.prototype.clone = function(){</td></tr><tr class="hit"><td class="line">66</td><td class="hits">5033</td><td class="source">  var clone = new Ident(this.name, this.val.clone());</td></tr><tr class="hit"><td class="line">67</td><td class="hits">5033</td><td class="source">  clone.lineno = this.lineno;</td></tr><tr class="hit"><td class="line">68</td><td class="hits">5033</td><td class="source">  clone.filename = this.filename;</td></tr><tr class="hit"><td class="line">69</td><td class="hits">5033</td><td class="source">  clone.property = this.property;</td></tr><tr class="hit"><td class="line">70</td><td class="hits">5033</td><td class="source">  return clone;</td></tr><tr><td class="line">71</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">72</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">73</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">74</td><td class="hits"></td><td class="source"> * Return &lt;name&gt;.</td></tr><tr><td class="line">75</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">76</td><td class="hits"></td><td class="source"> * @return {String}</td></tr><tr><td class="line">77</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">78</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">79</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">80</td><td class="hits">1</td><td class="source">Ident.prototype.toString = function(){</td></tr><tr class="hit"><td class="line">81</td><td class="hits">14</td><td class="source">  return this.name;</td></tr><tr><td class="line">82</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">83</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">84</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">85</td><td class="hits"></td><td class="source"> * Coerce `other` to an ident.</td></tr><tr><td class="line">86</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">87</td><td class="hits"></td><td class="source"> * @param {Node} other</td></tr><tr><td class="line">88</td><td class="hits"></td><td class="source"> * @return {String}</td></tr><tr><td class="line">89</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">90</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">91</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">92</td><td class="hits">1</td><td class="source">Ident.prototype.coerce = function(other){</td></tr><tr class="hit"><td class="line">93</td><td class="hits">3</td><td class="source">  switch (other.nodeName) {</td></tr><tr><td class="line">94</td><td class="hits"></td><td class="source">    case 'ident':</td></tr><tr><td class="line">95</td><td class="hits"></td><td class="source">    case 'string':</td></tr><tr><td class="line">96</td><td class="hits"></td><td class="source">    case 'literal':</td></tr><tr class="hit"><td class="line">97</td><td class="hits">3</td><td class="source">      return new Ident(other.string);</td></tr><tr><td class="line">98</td><td class="hits"></td><td class="source">    default:</td></tr><tr class="miss"><td class="line">99</td><td class="hits">0</td><td class="source">      return Node.prototype.coerce.call(this, other);</td></tr><tr><td class="line">100</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">101</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">102</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">103</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">104</td><td class="hits"></td><td class="source"> * Operate on `right` with the given `op`.</td></tr><tr><td class="line">105</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">106</td><td class="hits"></td><td class="source"> * @param {String} op</td></tr><tr><td class="line">107</td><td class="hits"></td><td class="source"> * @param {Node} right</td></tr><tr><td class="line">108</td><td class="hits"></td><td class="source"> * @return {Node}</td></tr><tr><td class="line">109</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">110</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">111</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">112</td><td class="hits">1</td><td class="source">Ident.prototype.operate = function(op, right){</td></tr><tr class="hit"><td class="line">113</td><td class="hits">58</td><td class="source">  var val = right.first;</td></tr><tr class="hit"><td class="line">114</td><td class="hits">58</td><td class="source">  switch (op) {</td></tr><tr><td class="line">115</td><td class="hits"></td><td class="source">    case '-':</td></tr><tr class="miss"><td class="line">116</td><td class="hits">0</td><td class="source">      if ('unit' == val.nodeName) {</td></tr><tr class="miss"><td class="line">117</td><td class="hits">0</td><td class="source">        var expr = new nodes.Expression;</td></tr><tr class="miss"><td class="line">118</td><td class="hits">0</td><td class="source">        val.val = -val.val;</td></tr><tr class="miss"><td class="line">119</td><td class="hits">0</td><td class="source">        expr.push(this);</td></tr><tr class="miss"><td class="line">120</td><td class="hits">0</td><td class="source">        expr.push(val);</td></tr><tr class="miss"><td class="line">121</td><td class="hits">0</td><td class="source">        return expr;</td></tr><tr><td class="line">122</td><td class="hits"></td><td class="source">      }</td></tr><tr><td class="line">123</td><td class="hits"></td><td class="source">    case '+':</td></tr><tr class="hit"><td class="line">124</td><td class="hits">3</td><td class="source">      return new nodes.Ident(this.string + this.coerce(val).string);</td></tr><tr><td class="line">125</td><td class="hits"></td><td class="source">  }</td></tr><tr class="hit"><td class="line">126</td><td class="hits">55</td><td class="source">  return Node.prototype.operate.call(this, op, right);</td></tr><tr><td class="line">127</td><td class="hits"></td><td class="source">};</td></tr></tbody></table></div><div class="file"><h2 id="nodes/group.js">nodes/group.js</h2><div id="stats" class="high"><div class="percentage">100%</div><div class="sloc">21</div><div class="hits">21</div><div class="misses">0</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr><td class="line">1</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source">/*!</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source"> * Stylus - Group</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source"> * Copyright(c) 2010 LearnBoost &lt;dev@learnboost.com&gt;</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> * MIT Licensed</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source"> * Module dependencies.</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">12</td><td class="hits">1</td><td class="source">var Node = require('./node');</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">14</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">15</td><td class="hits"></td><td class="source"> * Initialize a new `Group`.</td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">17</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">20</td><td class="hits">1</td><td class="source">var Group = module.exports = function Group(){</td></tr><tr class="hit"><td class="line">21</td><td class="hits">1137</td><td class="source">  Node.call(this);</td></tr><tr class="hit"><td class="line">22</td><td class="hits">1137</td><td class="source">  this.nodes = [];</td></tr><tr class="hit"><td class="line">23</td><td class="hits">1137</td><td class="source">  this.extends = [];</td></tr><tr><td class="line">24</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">25</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">26</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">27</td><td class="hits"></td><td class="source"> * Inherit from `Node.prototype`.</td></tr><tr><td class="line">28</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">29</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">30</td><td class="hits">1</td><td class="source">Group.prototype.__proto__ = Node.prototype;</td></tr><tr><td class="line">31</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">32</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">33</td><td class="hits"></td><td class="source"> * Push the given `selector` node.</td></tr><tr><td class="line">34</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">35</td><td class="hits"></td><td class="source"> * @param {Selector} selector</td></tr><tr><td class="line">36</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">37</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">38</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">39</td><td class="hits">1</td><td class="source">Group.prototype.push = function(selector){</td></tr><tr class="hit"><td class="line">40</td><td class="hits">1849</td><td class="source">  this.nodes.push(selector);</td></tr><tr><td class="line">41</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">42</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">43</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">44</td><td class="hits"></td><td class="source"> * Return this set's `Block`.</td></tr><tr><td class="line">45</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">46</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">47</td><td class="hits">1</td><td class="source">Group.prototype.__defineGetter__('block', function(){</td></tr><tr class="hit"><td class="line">48</td><td class="hits">4502</td><td class="source">  return this.nodes[0].block;</td></tr><tr><td class="line">49</td><td class="hits"></td><td class="source">});</td></tr><tr><td class="line">50</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">51</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">52</td><td class="hits"></td><td class="source"> * Assign `block` to each selector in this set.</td></tr><tr><td class="line">53</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">54</td><td class="hits"></td><td class="source"> * @param {Block} block</td></tr><tr><td class="line">55</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">56</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">57</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">58</td><td class="hits">1</td><td class="source">Group.prototype.__defineSetter__('block', function(block){</td></tr><tr class="hit"><td class="line">59</td><td class="hits">3315</td><td class="source">  for (var i = 0, len = this.nodes.length; i &lt; len; ++i) {</td></tr><tr class="hit"><td class="line">60</td><td class="hits">5243</td><td class="source">    this.nodes[i].block = block;</td></tr><tr><td class="line">61</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">62</td><td class="hits"></td><td class="source">});</td></tr><tr><td class="line">63</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">64</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">65</td><td class="hits"></td><td class="source"> * Return a clone of this node.</td></tr><tr><td class="line">66</td><td class="hits"></td><td class="source"> * </td></tr><tr><td class="line">67</td><td class="hits"></td><td class="source"> * @return {Node}</td></tr><tr><td class="line">68</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">69</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">70</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">71</td><td class="hits">1</td><td class="source">Group.prototype.clone = function(){</td></tr><tr class="hit"><td class="line">72</td><td class="hits">86</td><td class="source">  var clone = new Group;</td></tr><tr class="hit"><td class="line">73</td><td class="hits">86</td><td class="source">  clone.lineno = this.lineno;</td></tr><tr class="hit"><td class="line">74</td><td class="hits">86</td><td class="source">  this.nodes.forEach(function(node){</td></tr><tr class="hit"><td class="line">75</td><td class="hits">159</td><td class="source">    clone.push(node.clone());</td></tr><tr><td class="line">76</td><td class="hits"></td><td class="source">  });</td></tr><tr class="hit"><td class="line">77</td><td class="hits">86</td><td class="source">  clone.filename = this.filename;</td></tr><tr class="hit"><td class="line">78</td><td class="hits">86</td><td class="source">  clone.block = this.block.clone();</td></tr><tr class="hit"><td class="line">79</td><td class="hits">86</td><td class="source">  return clone;</td></tr><tr><td class="line">80</td><td class="hits"></td><td class="source">};</td></tr></tbody></table></div><div class="file"><h2 id="nodes/literal.js">nodes/literal.js</h2><div id="stats" class="high"><div class="percentage">78%</div><div class="sloc">19</div><div class="hits">15</div><div class="misses">4</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr><td class="line">1</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source">/*!</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source"> * Stylus - Literal</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source"> * Copyright(c) 2010 LearnBoost &lt;dev@learnboost.com&gt;</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> * MIT Licensed</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source"> * Module dependencies.</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">12</td><td class="hits">1</td><td class="source">var Node = require('./node')</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source">  , nodes = require('./');</td></tr><tr><td class="line">14</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">15</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source"> * Initialize a new `Literal` with the given `str`.</td></tr><tr><td class="line">17</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source"> * @param {String} str</td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">21</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">22</td><td class="hits">1</td><td class="source">var Literal = module.exports = function Literal(str){</td></tr><tr class="hit"><td class="line">23</td><td class="hits">3140</td><td class="source">  Node.call(this);</td></tr><tr class="hit"><td class="line">24</td><td class="hits">3140</td><td class="source">  this.val = str;</td></tr><tr class="hit"><td class="line">25</td><td class="hits">3140</td><td class="source">  this.string = str;</td></tr><tr><td class="line">26</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">27</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">28</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">29</td><td class="hits"></td><td class="source"> * Inherit from `Node.prototype`.</td></tr><tr><td class="line">30</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">31</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">32</td><td class="hits">1</td><td class="source">Literal.prototype.__proto__ = Node.prototype;</td></tr><tr><td class="line">33</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">34</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">35</td><td class="hits"></td><td class="source"> * Return hash.</td></tr><tr><td class="line">36</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">37</td><td class="hits"></td><td class="source"> * @return {String}</td></tr><tr><td class="line">38</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">39</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">40</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">41</td><td class="hits">1</td><td class="source">Literal.prototype.__defineGetter__('hash', function(){</td></tr><tr class="hit"><td class="line">42</td><td class="hits">13</td><td class="source">  return this.val;</td></tr><tr><td class="line">43</td><td class="hits"></td><td class="source">});</td></tr><tr><td class="line">44</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">45</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">46</td><td class="hits"></td><td class="source"> * Return literal value.</td></tr><tr><td class="line">47</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">48</td><td class="hits"></td><td class="source"> * @return {String}</td></tr><tr><td class="line">49</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">50</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">51</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">52</td><td class="hits">1</td><td class="source">Literal.prototype.toString = function(){</td></tr><tr class="hit"><td class="line">53</td><td class="hits">12</td><td class="source">  return this.val;</td></tr><tr><td class="line">54</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">55</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">56</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">57</td><td class="hits"></td><td class="source"> * Coerce `other` to a literal.</td></tr><tr><td class="line">58</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">59</td><td class="hits"></td><td class="source"> * @param {Node} other</td></tr><tr><td class="line">60</td><td class="hits"></td><td class="source"> * @return {String}</td></tr><tr><td class="line">61</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">62</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">63</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">64</td><td class="hits">1</td><td class="source">Literal.prototype.coerce = function(other){</td></tr><tr class="miss"><td class="line">65</td><td class="hits">0</td><td class="source">  switch (other.nodeName) {</td></tr><tr><td class="line">66</td><td class="hits"></td><td class="source">    case 'ident':</td></tr><tr><td class="line">67</td><td class="hits"></td><td class="source">    case 'string':</td></tr><tr><td class="line">68</td><td class="hits"></td><td class="source">    case 'literal':</td></tr><tr class="miss"><td class="line">69</td><td class="hits">0</td><td class="source">      return new Literal(other.string);</td></tr><tr><td class="line">70</td><td class="hits"></td><td class="source">    default:</td></tr><tr class="miss"><td class="line">71</td><td class="hits">0</td><td class="source">      return Node.prototype.coerce.call(this, other);</td></tr><tr><td class="line">72</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">73</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">74</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">75</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">76</td><td class="hits"></td><td class="source"> * Operate on `right` with the given `op`.</td></tr><tr><td class="line">77</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">78</td><td class="hits"></td><td class="source"> * @param {String} op</td></tr><tr><td class="line">79</td><td class="hits"></td><td class="source"> * @param {Node} right</td></tr><tr><td class="line">80</td><td class="hits"></td><td class="source"> * @return {Node}</td></tr><tr><td class="line">81</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">82</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">83</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">84</td><td class="hits">1</td><td class="source">Literal.prototype.operate = function(op, right){</td></tr><tr class="hit"><td class="line">85</td><td class="hits">7</td><td class="source">  var val = right.first;</td></tr><tr class="hit"><td class="line">86</td><td class="hits">7</td><td class="source">  switch (op) {</td></tr><tr><td class="line">87</td><td class="hits"></td><td class="source">    case '+':</td></tr><tr class="miss"><td class="line">88</td><td class="hits">0</td><td class="source">      return new nodes.Literal(this.string + this.coerce(val).string);</td></tr><tr><td class="line">89</td><td class="hits"></td><td class="source">    default:</td></tr><tr class="hit"><td class="line">90</td><td class="hits">7</td><td class="source">      return Node.prototype.operate.call(this, op, right);</td></tr><tr><td class="line">91</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">92</td><td class="hits"></td><td class="source">};</td></tr></tbody></table></div><div class="file"><h2 id="nodes/jsliteral.js">nodes/jsliteral.js</h2><div id="stats" class="medium"><div class="percentage">50%</div><div class="sloc">6</div><div class="hits">3</div><div class="misses">3</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr><td class="line">1</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source">/*!</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source"> * Stylus - JSLiteral</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source"> * Copyright(c) 2010 LearnBoost &lt;dev@learnboost.com&gt;</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> * MIT Licensed</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source"> * Module dependencies.</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">12</td><td class="hits">1</td><td class="source">var Node = require('./node')</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source">  , nodes = require('./');</td></tr><tr><td class="line">14</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">15</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source"> * Initialize a new `JSLiteral` with the given `str`.</td></tr><tr><td class="line">17</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source"> * @param {String} str</td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">21</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">22</td><td class="hits">1</td><td class="source">var JSLiteral = module.exports = function JSLiteral(str){</td></tr><tr class="miss"><td class="line">23</td><td class="hits">0</td><td class="source">  Node.call(this);</td></tr><tr class="miss"><td class="line">24</td><td class="hits">0</td><td class="source">  this.val = str;</td></tr><tr class="miss"><td class="line">25</td><td class="hits">0</td><td class="source">  this.string = str;</td></tr><tr><td class="line">26</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">27</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">28</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">29</td><td class="hits"></td><td class="source"> * Inherit from `Node.prototype`.</td></tr><tr><td class="line">30</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">31</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">32</td><td class="hits">1</td><td class="source">JSLiteral.prototype.__proto__ = Node.prototype;</td></tr></tbody></table></div><div class="file"><h2 id="nodes/boolean.js">nodes/boolean.js</h2><div id="stats" class="high"><div class="percentage">94%</div><div class="sloc">19</div><div class="hits">18</div><div class="misses">1</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr><td class="line">1</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source">/*!</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source"> * Stylus - Boolean</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source"> * Copyright(c) 2010 LearnBoost &lt;dev@learnboost.com&gt;</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> * MIT Licensed</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source"> * Module dependencies.</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">12</td><td class="hits">1</td><td class="source">var Node = require('./node')</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source">  , nodes = require('./');</td></tr><tr><td class="line">14</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">15</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source"> * Initialize a new `Boolean` node with the given `val`.</td></tr><tr><td class="line">17</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source"> * @param {Boolean} val</td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">21</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">22</td><td class="hits">1</td><td class="source">var Boolean = module.exports = function Boolean(val){</td></tr><tr class="hit"><td class="line">23</td><td class="hits">1680</td><td class="source">  Node.call(this);</td></tr><tr class="hit"><td class="line">24</td><td class="hits">1680</td><td class="source">  if (this.nodeName) {</td></tr><tr class="hit"><td class="line">25</td><td class="hits">899</td><td class="source">    this.val = !!val;</td></tr><tr><td class="line">26</td><td class="hits"></td><td class="source">  } else {</td></tr><tr class="hit"><td class="line">27</td><td class="hits">781</td><td class="source">    return new Boolean(val);</td></tr><tr><td class="line">28</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">29</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">30</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">31</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">32</td><td class="hits"></td><td class="source"> * Inherit from `Node.prototype`.</td></tr><tr><td class="line">33</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">34</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">35</td><td class="hits">1</td><td class="source">Boolean.prototype.__proto__ = Node.prototype;</td></tr><tr><td class="line">36</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">37</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">38</td><td class="hits"></td><td class="source"> * Return `this` node.</td></tr><tr><td class="line">39</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">40</td><td class="hits"></td><td class="source"> * @return {Boolean}</td></tr><tr><td class="line">41</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">42</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">43</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">44</td><td class="hits">1</td><td class="source">Boolean.prototype.toBoolean = function(){</td></tr><tr class="hit"><td class="line">45</td><td class="hits">584</td><td class="source">  return this;</td></tr><tr><td class="line">46</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">47</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">48</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">49</td><td class="hits"></td><td class="source"> * Return `true` if this node represents `true`.</td></tr><tr><td class="line">50</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">51</td><td class="hits"></td><td class="source"> * @return {Boolean}</td></tr><tr><td class="line">52</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">53</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">54</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">55</td><td class="hits">1</td><td class="source">Boolean.prototype.__defineGetter__('isTrue', function(){</td></tr><tr class="hit"><td class="line">56</td><td class="hits">612</td><td class="source">  return this.val;</td></tr><tr><td class="line">57</td><td class="hits"></td><td class="source">});</td></tr><tr><td class="line">58</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">59</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">60</td><td class="hits"></td><td class="source"> * Return `true` if this node represents `false`.</td></tr><tr><td class="line">61</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">62</td><td class="hits"></td><td class="source"> * @return {Boolean}</td></tr><tr><td class="line">63</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">64</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">65</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">66</td><td class="hits">1</td><td class="source">Boolean.prototype.__defineGetter__('isFalse', function(){</td></tr><tr class="hit"><td class="line">67</td><td class="hits">158</td><td class="source">  return ! this.val;</td></tr><tr><td class="line">68</td><td class="hits"></td><td class="source">});</td></tr><tr><td class="line">69</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">70</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">71</td><td class="hits"></td><td class="source"> * Negate the value.</td></tr><tr><td class="line">72</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">73</td><td class="hits"></td><td class="source"> * @return {Boolean}</td></tr><tr><td class="line">74</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">75</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">76</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">77</td><td class="hits">1</td><td class="source">Boolean.prototype.negate = function(){</td></tr><tr class="hit"><td class="line">78</td><td class="hits">116</td><td class="source">  return new Boolean(!this.val);</td></tr><tr><td class="line">79</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">80</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">81</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">82</td><td class="hits"></td><td class="source"> * Return 'Boolean'.</td></tr><tr><td class="line">83</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">84</td><td class="hits"></td><td class="source"> * @return {String}</td></tr><tr><td class="line">85</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">86</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">87</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">88</td><td class="hits">1</td><td class="source">Boolean.prototype.inspect = function(){</td></tr><tr class="miss"><td class="line">89</td><td class="hits">0</td><td class="source">  return '[Boolean ' + this.val + ']';</td></tr><tr><td class="line">90</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">91</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">92</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">93</td><td class="hits"></td><td class="source"> * Return 'true' or 'false'.</td></tr><tr><td class="line">94</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">95</td><td class="hits"></td><td class="source"> * @return {String}</td></tr><tr><td class="line">96</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">97</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">98</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">99</td><td class="hits">1</td><td class="source">Boolean.prototype.toString = function(){</td></tr><tr class="hit"><td class="line">100</td><td class="hits">185</td><td class="source">  return this.val</td></tr><tr><td class="line">101</td><td class="hits"></td><td class="source">    ? 'true'</td></tr><tr><td class="line">102</td><td class="hits"></td><td class="source">    : 'false';</td></tr><tr><td class="line">103</td><td class="hits"></td><td class="source">};</td></tr></tbody></table></div><div class="file"><h2 id="nodes/return.js">nodes/return.js</h2><div id="stats" class="high"><div class="percentage">100%</div><div class="sloc">9</div><div class="hits">9</div><div class="misses">0</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr><td class="line">1</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source">/*!</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source"> * Stylus - Return</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source"> * Copyright(c) 2010 LearnBoost &lt;dev@learnboost.com&gt;</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> * MIT Licensed</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source"> * Module dependencies.</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">12</td><td class="hits">1</td><td class="source">var Node = require('./node')</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source">  , nodes = require('./');</td></tr><tr><td class="line">14</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">15</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source"> * Initialize a new `Return` node with the given `expr`.</td></tr><tr><td class="line">17</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source"> * @param {Expression} expr</td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">21</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">22</td><td class="hits">1</td><td class="source">var Return = module.exports = function Return(expr){</td></tr><tr class="hit"><td class="line">23</td><td class="hits">91</td><td class="source">  this.expr = expr || nodes.null;</td></tr><tr><td class="line">24</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">25</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">26</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">27</td><td class="hits"></td><td class="source"> * Inherit from `Node.prototype`.</td></tr><tr><td class="line">28</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">29</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">30</td><td class="hits">1</td><td class="source">Return.prototype.__proto__ = Node.prototype;</td></tr><tr><td class="line">31</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">32</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">33</td><td class="hits"></td><td class="source"> * Return a clone of this node.</td></tr><tr><td class="line">34</td><td class="hits"></td><td class="source"> * </td></tr><tr><td class="line">35</td><td class="hits"></td><td class="source"> * @return {Node}</td></tr><tr><td class="line">36</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">37</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">38</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">39</td><td class="hits">1</td><td class="source">Return.prototype.clone = function(){</td></tr><tr class="hit"><td class="line">40</td><td class="hits">65</td><td class="source">  var clone = new Return(this.expr.clone());</td></tr><tr class="hit"><td class="line">41</td><td class="hits">65</td><td class="source">  clone.lineno = this.lineno;</td></tr><tr class="hit"><td class="line">42</td><td class="hits">65</td><td class="source">  clone.filename = this.filename;</td></tr><tr class="hit"><td class="line">43</td><td class="hits">65</td><td class="source">  return clone;</td></tr><tr><td class="line">44</td><td class="hits"></td><td class="source">};</td></tr></tbody></table></div><div class="file"><h2 id="nodes/media.js">nodes/media.js</h2><div id="stats" class="high"><div class="percentage">85%</div><div class="sloc">7</div><div class="hits">6</div><div class="misses">1</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr><td class="line">1</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source">/*!</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source"> * Stylus - Media</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source"> * Copyright(c) 2010 LearnBoost &lt;dev@learnboost.com&gt;</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> * MIT Licensed</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source"> * Module dependencies.</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">12</td><td class="hits">1</td><td class="source">var Node = require('./node')</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source">  , nodes = require('./');</td></tr><tr><td class="line">14</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">15</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source"> * Initialize a new `Media` with the given `val`</td></tr><tr><td class="line">17</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source"> * @param {String} val</td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">21</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">22</td><td class="hits">1</td><td class="source">var Media = module.exports = function Media(val){</td></tr><tr class="hit"><td class="line">23</td><td class="hits">20</td><td class="source">  Node.call(this);</td></tr><tr class="hit"><td class="line">24</td><td class="hits">20</td><td class="source">  this.val = val;</td></tr><tr><td class="line">25</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">26</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">27</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">28</td><td class="hits"></td><td class="source"> * Inherit from `Node.prototype`.</td></tr><tr><td class="line">29</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">30</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">31</td><td class="hits">1</td><td class="source">Media.prototype.__proto__ = Node.prototype;</td></tr><tr><td class="line">32</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">33</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">34</td><td class="hits"></td><td class="source"> * Return @media &quot;val&quot;.</td></tr><tr><td class="line">35</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">36</td><td class="hits"></td><td class="source"> * @return {String}</td></tr><tr><td class="line">37</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">38</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">39</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">40</td><td class="hits">1</td><td class="source">Media.prototype.toString = function(){</td></tr><tr class="miss"><td class="line">41</td><td class="hits">0</td><td class="source">  return '@media ' + this.val;</td></tr><tr><td class="line">42</td><td class="hits"></td><td class="source">};</td></tr></tbody></table></div><div class="file"><h2 id="nodes/params.js">nodes/params.js</h2><div id="stats" class="high"><div class="percentage">93%</div><div class="sloc">16</div><div class="hits">15</div><div class="misses">1</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr><td class="line">1</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source">/*!</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source"> * Stylus - Params</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source"> * Copyright(c) 2010 LearnBoost &lt;dev@learnboost.com&gt;</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> * MIT Licensed</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source"> * Module dependencies.</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">12</td><td class="hits">1</td><td class="source">var Node = require('./node');</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">14</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">15</td><td class="hits"></td><td class="source"> * Initialize a new `Params` with `name`, `params`, and `body`.</td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">17</td><td class="hits"></td><td class="source"> * @param {String} name</td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source"> * @param {Params} params</td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source"> * @param {Expression} body</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">21</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">22</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">23</td><td class="hits">1</td><td class="source">var Params = module.exports = function Params(){</td></tr><tr class="hit"><td class="line">24</td><td class="hits">7935</td><td class="source">  Node.call(this);</td></tr><tr class="hit"><td class="line">25</td><td class="hits">7935</td><td class="source">  this.nodes = [];</td></tr><tr><td class="line">26</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">27</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">28</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">29</td><td class="hits"></td><td class="source"> * Check function arity.</td></tr><tr><td class="line">30</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">31</td><td class="hits"></td><td class="source"> * @return {Boolean}</td></tr><tr><td class="line">32</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">33</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">34</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">35</td><td class="hits">1</td><td class="source">Params.prototype.__defineGetter__('length', function(){</td></tr><tr class="miss"><td class="line">36</td><td class="hits">0</td><td class="source">  return this.nodes.length;</td></tr><tr><td class="line">37</td><td class="hits"></td><td class="source">});</td></tr><tr><td class="line">38</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">39</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">40</td><td class="hits"></td><td class="source"> * Inherit from `Node.prototype`.</td></tr><tr><td class="line">41</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">42</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">43</td><td class="hits">1</td><td class="source">Params.prototype.__proto__ = Node.prototype;</td></tr><tr><td class="line">44</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">45</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">46</td><td class="hits"></td><td class="source"> * Push the given `node`.</td></tr><tr><td class="line">47</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">48</td><td class="hits"></td><td class="source"> * @param {Node} node</td></tr><tr><td class="line">49</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">50</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">51</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">52</td><td class="hits">1</td><td class="source">Params.prototype.push = function(node){</td></tr><tr class="hit"><td class="line">53</td><td class="hits">11045</td><td class="source">  this.nodes.push(node);</td></tr><tr><td class="line">54</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">55</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">56</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">57</td><td class="hits"></td><td class="source"> * Return a clone of this node.</td></tr><tr><td class="line">58</td><td class="hits"></td><td class="source"> * </td></tr><tr><td class="line">59</td><td class="hits"></td><td class="source"> * @return {Node}</td></tr><tr><td class="line">60</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">61</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">62</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">63</td><td class="hits">1</td><td class="source">Params.prototype.clone = function(){</td></tr><tr class="hit"><td class="line">64</td><td class="hits">9</td><td class="source">  var clone = new Params;</td></tr><tr class="hit"><td class="line">65</td><td class="hits">9</td><td class="source">  clone.lineno = this.lineno;</td></tr><tr class="hit"><td class="line">66</td><td class="hits">9</td><td class="source">  clone.filename = this.filename;</td></tr><tr class="hit"><td class="line">67</td><td class="hits">9</td><td class="source">  this.nodes.forEach(function(node){</td></tr><tr class="hit"><td class="line">68</td><td class="hits">13</td><td class="source">    clone.push(node.clone());</td></tr><tr><td class="line">69</td><td class="hits"></td><td class="source">  });</td></tr><tr class="hit"><td class="line">70</td><td class="hits">9</td><td class="source">  return clone;</td></tr><tr><td class="line">71</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">72</td><td class="hits"></td><td class="source"> </td></tr></tbody></table></div><div class="file"><h2 id="nodes/comment.js">nodes/comment.js</h2><div id="stats" class="high"><div class="percentage">100%</div><div class="sloc">6</div><div class="hits">6</div><div class="misses">0</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr><td class="line">1</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source">/*!</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source"> * Stylus - Comment</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source"> * Copyright(c) 2010 LearnBoost &lt;dev@learnboost.com&gt;</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> * MIT Licensed</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source"> * Module dependencies.</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">12</td><td class="hits">1</td><td class="source">var Node = require('./node');</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">14</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">15</td><td class="hits"></td><td class="source"> * Initialize a new `Comment` with the given `str`.</td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">17</td><td class="hits"></td><td class="source"> * @param {String} str</td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source"> * @param {Boolean} suppress</td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">21</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">22</td><td class="hits">1</td><td class="source">var Comment = module.exports = function Comment(str, suppress){</td></tr><tr class="hit"><td class="line">23</td><td class="hits">63</td><td class="source">  Node.call(this);</td></tr><tr class="hit"><td class="line">24</td><td class="hits">63</td><td class="source">  this.str = str;</td></tr><tr class="hit"><td class="line">25</td><td class="hits">63</td><td class="source">  this.suppress = suppress;</td></tr><tr><td class="line">26</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">27</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">28</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">29</td><td class="hits"></td><td class="source"> * Inherit from `Node.prototype`.</td></tr><tr><td class="line">30</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">31</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">32</td><td class="hits">1</td><td class="source">Comment.prototype.__proto__ = Node.prototype;</td></tr></tbody></table></div><div class="file"><h2 id="nodes/keyframes.js">nodes/keyframes.js</h2><div id="stats" class="high"><div class="percentage">94%</div><div class="sloc">19</div><div class="hits">18</div><div class="misses">1</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr><td class="line">1</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source">/*!</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source"> * Stylus - Keyframes</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source"> * Copyright(c) 2010 LearnBoost &lt;dev@learnboost.com&gt;</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> * MIT Licensed</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source"> * Module dependencies.</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">12</td><td class="hits">1</td><td class="source">var Node = require('./node');</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">14</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">15</td><td class="hits"></td><td class="source"> * Initialize a new `Keyframes` with the given `name`,</td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source"> * and optional vendor `prefix`.</td></tr><tr><td class="line">17</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source"> * @param {String} name</td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source"> * @param {String} prefix</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">21</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">22</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">23</td><td class="hits">1</td><td class="source">var Keyframes = module.exports = function Keyframes(name, prefix){</td></tr><tr class="hit"><td class="line">24</td><td class="hits">44</td><td class="source">  Node.call(this);</td></tr><tr class="hit"><td class="line">25</td><td class="hits">44</td><td class="source">  this.name = name;</td></tr><tr class="hit"><td class="line">26</td><td class="hits">44</td><td class="source">  this.frames = [];</td></tr><tr class="hit"><td class="line">27</td><td class="hits">44</td><td class="source">  this.prefix = prefix || 'official';</td></tr><tr><td class="line">28</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">29</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">30</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">31</td><td class="hits"></td><td class="source"> * Inherit from `Node.prototype`.</td></tr><tr><td class="line">32</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">33</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">34</td><td class="hits">1</td><td class="source">Keyframes.prototype.__proto__ = Node.prototype;</td></tr><tr><td class="line">35</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">36</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">37</td><td class="hits"></td><td class="source"> * Push the given `block` at `pos`.</td></tr><tr><td class="line">38</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">39</td><td class="hits"></td><td class="source"> * @param {Array} pos</td></tr><tr><td class="line">40</td><td class="hits"></td><td class="source"> * @param {Block} block</td></tr><tr><td class="line">41</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">42</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">43</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">44</td><td class="hits">1</td><td class="source">Keyframes.prototype.push = function(pos, block){</td></tr><tr class="hit"><td class="line">45</td><td class="hits">34</td><td class="source">  this.frames.push({</td></tr><tr><td class="line">46</td><td class="hits"></td><td class="source">      pos: pos</td></tr><tr><td class="line">47</td><td class="hits"></td><td class="source">    , block: block</td></tr><tr><td class="line">48</td><td class="hits"></td><td class="source">  });</td></tr><tr><td class="line">49</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">50</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">51</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">52</td><td class="hits"></td><td class="source"> * Return a clone of this node.</td></tr><tr><td class="line">53</td><td class="hits"></td><td class="source"> * </td></tr><tr><td class="line">54</td><td class="hits"></td><td class="source"> * @return {Node}</td></tr><tr><td class="line">55</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">56</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">57</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">58</td><td class="hits">1</td><td class="source">Keyframes.prototype.clone = function(){</td></tr><tr class="hit"><td class="line">59</td><td class="hits">30</td><td class="source">  var clone = new Keyframes(this.name);</td></tr><tr class="hit"><td class="line">60</td><td class="hits">30</td><td class="source">  clone.lineno = this.lineno;</td></tr><tr class="hit"><td class="line">61</td><td class="hits">30</td><td class="source">  clone.prefix = this.prefix;</td></tr><tr class="hit"><td class="line">62</td><td class="hits">30</td><td class="source">  clone.frames = this.frames.map(function(node){</td></tr><tr class="hit"><td class="line">63</td><td class="hits">74</td><td class="source">    node.block = node.block.clone();</td></tr><tr class="hit"><td class="line">64</td><td class="hits">74</td><td class="source">    return node;</td></tr><tr><td class="line">65</td><td class="hits"></td><td class="source">  });</td></tr><tr class="hit"><td class="line">66</td><td class="hits">30</td><td class="source">  return clone;</td></tr><tr><td class="line">67</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">68</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">69</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">70</td><td class="hits"></td><td class="source"> * Return `@keyframes name`.</td></tr><tr><td class="line">71</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">72</td><td class="hits"></td><td class="source"> * @return {String}</td></tr><tr><td class="line">73</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">74</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">75</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">76</td><td class="hits">1</td><td class="source">Keyframes.prototype.toString = function(){</td></tr><tr class="miss"><td class="line">77</td><td class="hits">0</td><td class="source">  return '@keyframes ' + this.name;</td></tr><tr><td class="line">78</td><td class="hits"></td><td class="source">};</td></tr></tbody></table></div><div class="file"><h2 id="nodes/charset.js">nodes/charset.js</h2><div id="stats" class="high"><div class="percentage">85%</div><div class="sloc">7</div><div class="hits">6</div><div class="misses">1</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr><td class="line">1</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source">/*!</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source"> * Stylus - Charset</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source"> * Copyright(c) 2010 LearnBoost &lt;dev@learnboost.com&gt;</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> * MIT Licensed</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source"> * Module dependencies.</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">12</td><td class="hits">1</td><td class="source">var Node = require('./node')</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source">  , nodes = require('./');</td></tr><tr><td class="line">14</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">15</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source"> * Initialize a new `Charset` with the given `val`</td></tr><tr><td class="line">17</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source"> * @param {String} val</td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">21</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">22</td><td class="hits">1</td><td class="source">var Charset = module.exports = function Charset(val){</td></tr><tr class="hit"><td class="line">23</td><td class="hits">2</td><td class="source">  Node.call(this);</td></tr><tr class="hit"><td class="line">24</td><td class="hits">2</td><td class="source">  this.val = val;</td></tr><tr><td class="line">25</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">26</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">27</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">28</td><td class="hits"></td><td class="source"> * Inherit from `Node.prototype`.</td></tr><tr><td class="line">29</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">30</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">31</td><td class="hits">1</td><td class="source">Charset.prototype.__proto__ = Node.prototype;</td></tr><tr><td class="line">32</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">33</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">34</td><td class="hits"></td><td class="source"> * Return @charset &quot;val&quot;.</td></tr><tr><td class="line">35</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">36</td><td class="hits"></td><td class="source"> * @return {String}</td></tr><tr><td class="line">37</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">38</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">39</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">40</td><td class="hits">1</td><td class="source">Charset.prototype.toString = function(){</td></tr><tr class="miss"><td class="line">41</td><td class="hits">0</td><td class="source">  return '@charset ' + this.val;</td></tr><tr><td class="line">42</td><td class="hits"></td><td class="source">};</td></tr></tbody></table></div><div class="file"><h2 id="nodes/import.js">nodes/import.js</h2><div id="stats" class="high"><div class="percentage">100%</div><div class="sloc">5</div><div class="hits">5</div><div class="misses">0</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr><td class="line">1</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source">/*!</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source"> * Stylus - Import</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source"> * Copyright(c) 2010 LearnBoost &lt;dev@learnboost.com&gt;</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> * MIT Licensed</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source"> * Module dependencies.</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">12</td><td class="hits">1</td><td class="source">var Node = require('./node');</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">14</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">15</td><td class="hits"></td><td class="source"> * Initialize a new `Import` with the given `expr`.</td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">17</td><td class="hits"></td><td class="source"> * @param {Expression} expr</td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">21</td><td class="hits">1</td><td class="source">var Import = module.exports = function Import(expr){</td></tr><tr class="hit"><td class="line">22</td><td class="hits">230</td><td class="source">  Node.call(this);</td></tr><tr class="hit"><td class="line">23</td><td class="hits">230</td><td class="source">  this.path = expr;</td></tr><tr><td class="line">24</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">25</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">26</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">27</td><td class="hits"></td><td class="source"> * Inherit from `Node.prototype`.</td></tr><tr><td class="line">28</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">29</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">30</td><td class="hits">1</td><td class="source">Import.prototype.__proto__ = Node.prototype;</td></tr></tbody></table></div><div class="file"><h2 id="nodes/extend.js">nodes/extend.js</h2><div id="stats" class="high"><div class="percentage">77%</div><div class="sloc">9</div><div class="hits">7</div><div class="misses">2</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr><td class="line">1</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source">/*!</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source"> * Stylus - Extend</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source"> * Copyright(c) 2010 LearnBoost &lt;dev@learnboost.com&gt;</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> * MIT Licensed</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source"> * Module dependencies.</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">12</td><td class="hits">1</td><td class="source">var Node = require('./node');</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">14</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">15</td><td class="hits"></td><td class="source"> * Initialize a new `Extend` with the given `selector`.</td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">17</td><td class="hits"></td><td class="source"> * @param {Selector} selector</td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">21</td><td class="hits">1</td><td class="source">var Extend = module.exports = function Extend(selector){</td></tr><tr class="hit"><td class="line">22</td><td class="hits">13</td><td class="source">  Node.call(this);</td></tr><tr class="hit"><td class="line">23</td><td class="hits">13</td><td class="source">  this.selector = selector;</td></tr><tr><td class="line">24</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">25</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">26</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">27</td><td class="hits"></td><td class="source"> * Inherit from `Node.prototype`.</td></tr><tr><td class="line">28</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">29</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">30</td><td class="hits">1</td><td class="source">Extend.prototype.__proto__ = Node.prototype;</td></tr><tr><td class="line">31</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">32</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">33</td><td class="hits"></td><td class="source"> * Return a clone of this node.</td></tr><tr><td class="line">34</td><td class="hits"></td><td class="source"> * </td></tr><tr><td class="line">35</td><td class="hits"></td><td class="source"> * @return {Node}</td></tr><tr><td class="line">36</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">37</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">38</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">39</td><td class="hits">1</td><td class="source">Extend.prototype.clone = function(){</td></tr><tr class="miss"><td class="line">40</td><td class="hits">0</td><td class="source">  return new Extend(this.selector);</td></tr><tr><td class="line">41</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">42</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">43</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">44</td><td class="hits"></td><td class="source"> * Return `@extend selector`.</td></tr><tr><td class="line">45</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">46</td><td class="hits"></td><td class="source"> * @return {String}</td></tr><tr><td class="line">47</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">48</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">49</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">50</td><td class="hits">1</td><td class="source">Extend.prototype.toString = function(){</td></tr><tr class="miss"><td class="line">51</td><td class="hits">0</td><td class="source">  return '@extend ' + this.selector;</td></tr><tr><td class="line">52</td><td class="hits"></td><td class="source">};</td></tr></tbody></table></div><div class="file"><h2 id="nodes/function.js">nodes/function.js</h2><div id="stats" class="medium"><div class="percentage">73%</div><div class="sloc">23</div><div class="hits">17</div><div class="misses">6</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr><td class="line">1</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source">/*!</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source"> * Stylus - Function</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source"> * Copyright(c) 2010 LearnBoost &lt;dev@learnboost.com&gt;</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> * MIT Licensed</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source"> * Module dependencies.</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">12</td><td class="hits">1</td><td class="source">var Node = require('./node');</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">14</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">15</td><td class="hits"></td><td class="source"> * Initialize a new `Function` with `name`, `params`, and `body`.</td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">17</td><td class="hits"></td><td class="source"> * @param {String} name</td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source"> * @param {Params|Function} params</td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source"> * @param {Block} body</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">21</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">22</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">23</td><td class="hits">1</td><td class="source">var Function = module.exports = function Function(name, params, body){</td></tr><tr class="hit"><td class="line">24</td><td class="hits">8608</td><td class="source">  Node.call(this);</td></tr><tr class="hit"><td class="line">25</td><td class="hits">8608</td><td class="source">  this.name = name;</td></tr><tr class="hit"><td class="line">26</td><td class="hits">8608</td><td class="source">  this.params = params;</td></tr><tr class="hit"><td class="line">27</td><td class="hits">8608</td><td class="source">  this.block = body;</td></tr><tr class="hit"><td class="line">28</td><td class="hits">9281</td><td class="source">  if ('function' == typeof params) this.fn = params;</td></tr><tr><td class="line">29</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">30</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">31</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">32</td><td class="hits"></td><td class="source"> * Check function arity.</td></tr><tr><td class="line">33</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">34</td><td class="hits"></td><td class="source"> * @return {Boolean}</td></tr><tr><td class="line">35</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">36</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">37</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">38</td><td class="hits">1</td><td class="source">Function.prototype.__defineGetter__('arity', function(){</td></tr><tr class="miss"><td class="line">39</td><td class="hits">0</td><td class="source">  return this.params.length;</td></tr><tr><td class="line">40</td><td class="hits"></td><td class="source">});</td></tr><tr><td class="line">41</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">42</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">43</td><td class="hits"></td><td class="source"> * Inherit from `Node.prototype`.</td></tr><tr><td class="line">44</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">45</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">46</td><td class="hits">1</td><td class="source">Function.prototype.__proto__ = Node.prototype;</td></tr><tr><td class="line">47</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">48</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">49</td><td class="hits"></td><td class="source"> * Return hash.</td></tr><tr><td class="line">50</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">51</td><td class="hits"></td><td class="source"> * @return {String}</td></tr><tr><td class="line">52</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">53</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">54</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">55</td><td class="hits">1</td><td class="source">Function.prototype.__defineGetter__('hash', function(){</td></tr><tr class="miss"><td class="line">56</td><td class="hits">0</td><td class="source">  return 'function ' + this.name;</td></tr><tr><td class="line">57</td><td class="hits"></td><td class="source">});</td></tr><tr><td class="line">58</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">59</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">60</td><td class="hits"></td><td class="source"> * Return a clone of this node.</td></tr><tr><td class="line">61</td><td class="hits"></td><td class="source"> * </td></tr><tr><td class="line">62</td><td class="hits"></td><td class="source"> * @return {Node}</td></tr><tr><td class="line">63</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">64</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">65</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">66</td><td class="hits">1</td><td class="source">Function.prototype.clone = function(){</td></tr><tr class="hit"><td class="line">67</td><td class="hits">9</td><td class="source">  if (this.fn) {</td></tr><tr class="miss"><td class="line">68</td><td class="hits">0</td><td class="source">    var clone = new Function(</td></tr><tr><td class="line">69</td><td class="hits"></td><td class="source">        this.name</td></tr><tr><td class="line">70</td><td class="hits"></td><td class="source">      , this.fn);</td></tr><tr><td class="line">71</td><td class="hits"></td><td class="source">  } else {</td></tr><tr class="hit"><td class="line">72</td><td class="hits">9</td><td class="source">    var clone = new Function(</td></tr><tr><td class="line">73</td><td class="hits"></td><td class="source">        this.name</td></tr><tr><td class="line">74</td><td class="hits"></td><td class="source">      , this.params.clone()</td></tr><tr><td class="line">75</td><td class="hits"></td><td class="source">      , this.block.clone());</td></tr><tr><td class="line">76</td><td class="hits"></td><td class="source">  }</td></tr><tr class="hit"><td class="line">77</td><td class="hits">9</td><td class="source">  clone.lineno = this.lineno;</td></tr><tr class="hit"><td class="line">78</td><td class="hits">9</td><td class="source">  clone.filename = this.filename;</td></tr><tr class="hit"><td class="line">79</td><td class="hits">9</td><td class="source">  return clone;</td></tr><tr><td class="line">80</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">81</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">82</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">83</td><td class="hits"></td><td class="source"> * Return &lt;name&gt;(param1, param2, ...).</td></tr><tr><td class="line">84</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">85</td><td class="hits"></td><td class="source"> * @return {String}</td></tr><tr><td class="line">86</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">87</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">88</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">89</td><td class="hits">1</td><td class="source">Function.prototype.toString = function(){</td></tr><tr class="miss"><td class="line">90</td><td class="hits">0</td><td class="source">  if (this.fn) {</td></tr><tr class="miss"><td class="line">91</td><td class="hits">0</td><td class="source">    return this.name</td></tr><tr><td class="line">92</td><td class="hits"></td><td class="source">      + '('</td></tr><tr><td class="line">93</td><td class="hits"></td><td class="source">      + this.fn.toString()</td></tr><tr><td class="line">94</td><td class="hits"></td><td class="source">        .match(/^function *\((.*?)\)/)</td></tr><tr><td class="line">95</td><td class="hits"></td><td class="source">        .slice(1)</td></tr><tr><td class="line">96</td><td class="hits"></td><td class="source">        .join(', ')</td></tr><tr><td class="line">97</td><td class="hits"></td><td class="source">      + ')';</td></tr><tr><td class="line">98</td><td class="hits"></td><td class="source">  } else {</td></tr><tr class="miss"><td class="line">99</td><td class="hits">0</td><td class="source">    return this.name</td></tr><tr><td class="line">100</td><td class="hits"></td><td class="source">      + '('</td></tr><tr><td class="line">101</td><td class="hits"></td><td class="source">      + this.params.nodes.join(', ')</td></tr><tr><td class="line">102</td><td class="hits"></td><td class="source">      + ')';</td></tr><tr><td class="line">103</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">104</td><td class="hits"></td><td class="source">};</td></tr></tbody></table></div><div class="file"><h2 id="nodes/property.js">nodes/property.js</h2><div id="stats" class="high"><div class="percentage">88%</div><div class="sloc">18</div><div class="hits">16</div><div class="misses">2</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr><td class="line">1</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source">/*!</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source"> * Stylus - Property</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source"> * Copyright(c) 2010 LearnBoost &lt;dev@learnboost.com&gt;</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> * MIT Licensed</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source"> * Module dependencies.</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">12</td><td class="hits">1</td><td class="source">var Node = require('./node');</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">14</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">15</td><td class="hits"></td><td class="source"> * Initialize a new `Property` with the given `segs` and optional `expr`.</td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">17</td><td class="hits"></td><td class="source"> * @param {Array} segs</td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source"> * @param {Expression} expr</td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">21</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">22</td><td class="hits">1</td><td class="source">var Property = module.exports = function Property(segs, expr){</td></tr><tr class="hit"><td class="line">23</td><td class="hits">3064</td><td class="source">  Node.call(this);</td></tr><tr class="hit"><td class="line">24</td><td class="hits">3064</td><td class="source">  this.segments = segs;</td></tr><tr class="hit"><td class="line">25</td><td class="hits">3064</td><td class="source">  this.expr = expr;</td></tr><tr><td class="line">26</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">27</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">28</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">29</td><td class="hits"></td><td class="source"> * Inherit from `Node.prototype`.</td></tr><tr><td class="line">30</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">31</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">32</td><td class="hits">1</td><td class="source">Property.prototype.__proto__ = Node.prototype;</td></tr><tr><td class="line">33</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">34</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">35</td><td class="hits"></td><td class="source"> * Return a clone of this node.</td></tr><tr><td class="line">36</td><td class="hits"></td><td class="source"> * </td></tr><tr><td class="line">37</td><td class="hits"></td><td class="source"> * @return {Node}</td></tr><tr><td class="line">38</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">39</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">40</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">41</td><td class="hits">1</td><td class="source">Property.prototype.clone = function(){</td></tr><tr class="hit"><td class="line">42</td><td class="hits">614</td><td class="source">  var clone = new Property(this.segments);</td></tr><tr class="hit"><td class="line">43</td><td class="hits">614</td><td class="source">  clone.name = this.name;</td></tr><tr class="hit"><td class="line">44</td><td class="hits">614</td><td class="source">  clone.lineno = this.lineno;</td></tr><tr class="hit"><td class="line">45</td><td class="hits">614</td><td class="source">  clone.filename = this.filename;</td></tr><tr class="hit"><td class="line">46</td><td class="hits">1238</td><td class="source">  clone.segments = this.segments.map(function(node){ return node.clone(); });</td></tr><tr class="hit"><td class="line">47</td><td class="hits">1228</td><td class="source">  if (this.expr) clone.expr = this.expr.clone();</td></tr><tr class="hit"><td class="line">48</td><td class="hits">614</td><td class="source">  return clone;</td></tr><tr><td class="line">49</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">50</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">51</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">52</td><td class="hits"></td><td class="source"> * Return string representation of this node.</td></tr><tr><td class="line">53</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">54</td><td class="hits"></td><td class="source"> * @return {String}</td></tr><tr><td class="line">55</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">56</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">57</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">58</td><td class="hits">1</td><td class="source">Property.prototype.toString = function(){</td></tr><tr class="miss"><td class="line">59</td><td class="hits">0</td><td class="source">  return 'property(' + this.segments.join('') + ', ' + this.expr + ')';</td></tr><tr><td class="line">60</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">61</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">62</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">63</td><td class="hits"></td><td class="source"> * Operate on the property expression.</td></tr><tr><td class="line">64</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">65</td><td class="hits"></td><td class="source"> * @param {String} op</td></tr><tr><td class="line">66</td><td class="hits"></td><td class="source"> * @param {Node} right</td></tr><tr><td class="line">67</td><td class="hits"></td><td class="source"> * @return {Node}</td></tr><tr><td class="line">68</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">69</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">70</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">71</td><td class="hits">1</td><td class="source">Property.prototype.operate = function(op, right, val){</td></tr><tr class="miss"><td class="line">72</td><td class="hits">0</td><td class="source">  return this.expr.operate(op, right, val);</td></tr><tr><td class="line">73</td><td class="hits"></td><td class="source">};</td></tr></tbody></table></div><div class="file"><h2 id="nodes/selector.js">nodes/selector.js</h2><div id="stats" class="high"><div class="percentage">92%</div><div class="sloc">14</div><div class="hits">13</div><div class="misses">1</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr><td class="line">1</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source">/*!</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source"> * Stylus - Selector</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source"> * Copyright(c) 2010 LearnBoost &lt;dev@learnboost.com&gt;</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> * MIT Licensed</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source"> * Module dependencies.</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">12</td><td class="hits">1</td><td class="source">var Block = require('./block')</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source">  , Node = require('./node');</td></tr><tr><td class="line">14</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">15</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source"> * Initialize a new `Selector` with the given `segs`.</td></tr><tr><td class="line">17</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source"> * @param {Array} segs</td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">21</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">22</td><td class="hits">1</td><td class="source">var Selector = module.exports = function Selector(segs){</td></tr><tr class="hit"><td class="line">23</td><td class="hits">1848</td><td class="source">  Node.call(this);</td></tr><tr class="hit"><td class="line">24</td><td class="hits">1848</td><td class="source">  this.inherits = true;</td></tr><tr class="hit"><td class="line">25</td><td class="hits">1848</td><td class="source">  this.segments = segs;</td></tr><tr><td class="line">26</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">27</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">28</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">29</td><td class="hits"></td><td class="source"> * Inherit from `Node.prototype`.</td></tr><tr><td class="line">30</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">31</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">32</td><td class="hits">1</td><td class="source">Selector.prototype.__proto__ = Node.prototype;</td></tr><tr><td class="line">33</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">34</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">35</td><td class="hits"></td><td class="source"> * Return the selector string.</td></tr><tr><td class="line">36</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">37</td><td class="hits"></td><td class="source"> * @return {String}</td></tr><tr><td class="line">38</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">39</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">40</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">41</td><td class="hits">1</td><td class="source">Selector.prototype.toString = function(){</td></tr><tr class="miss"><td class="line">42</td><td class="hits">0</td><td class="source">  return this.segments.join('');</td></tr><tr><td class="line">43</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">44</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">45</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">46</td><td class="hits"></td><td class="source"> * Return a clone of this node.</td></tr><tr><td class="line">47</td><td class="hits"></td><td class="source"> * </td></tr><tr><td class="line">48</td><td class="hits"></td><td class="source"> * @return {Node}</td></tr><tr><td class="line">49</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">50</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">51</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">52</td><td class="hits">1</td><td class="source">Selector.prototype.clone = function(){</td></tr><tr class="hit"><td class="line">53</td><td class="hits">159</td><td class="source">  var clone = new Selector;</td></tr><tr class="hit"><td class="line">54</td><td class="hits">159</td><td class="source">  clone.lineno = this.lineno;</td></tr><tr class="hit"><td class="line">55</td><td class="hits">159</td><td class="source">  clone.filename = this.filename;</td></tr><tr class="hit"><td class="line">56</td><td class="hits">504</td><td class="source">  clone.segments = this.segments.map(function(node){ return node.clone(); });</td></tr><tr class="hit"><td class="line">57</td><td class="hits">159</td><td class="source">  return clone;</td></tr><tr><td class="line">58</td><td class="hits"></td><td class="source">};</td></tr></tbody></table></div><div class="file"><h2 id="nodes/expression.js">nodes/expression.js</h2><div id="stats" class="high"><div class="percentage">94%</div><div class="sloc">58</div><div class="hits">55</div><div class="misses">3</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr><td class="line">1</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source">/*!</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source"> * Stylus - Expression</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source"> * Copyright(c) 2010 LearnBoost &lt;dev@learnboost.com&gt;</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> * MIT Licensed</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source"> * Module dependencies.</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">12</td><td class="hits">1</td><td class="source">var Node = require('./node')</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source">  , nodes = require('../nodes')</td></tr><tr><td class="line">14</td><td class="hits"></td><td class="source">  , utils = require('../utils');</td></tr><tr><td class="line">15</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">17</td><td class="hits"></td><td class="source"> * Initialize a new `Expression`.</td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source"> * @param {Boolean} isList</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">21</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">22</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">23</td><td class="hits">1</td><td class="source">var Expression = module.exports = function Expression(isList){</td></tr><tr class="hit"><td class="line">24</td><td class="hits">79261</td><td class="source">  Node.call(this);</td></tr><tr class="hit"><td class="line">25</td><td class="hits">79261</td><td class="source">  this.nodes = [];</td></tr><tr class="hit"><td class="line">26</td><td class="hits">79261</td><td class="source">  this.isList = isList;</td></tr><tr><td class="line">27</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">28</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">29</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">30</td><td class="hits"></td><td class="source"> * Check if the variable has a value.</td></tr><tr><td class="line">31</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">32</td><td class="hits"></td><td class="source"> * @return {Boolean}</td></tr><tr><td class="line">33</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">34</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">35</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">36</td><td class="hits">1</td><td class="source">Expression.prototype.__defineGetter__('isEmpty', function(){</td></tr><tr class="hit"><td class="line">37</td><td class="hits">9458</td><td class="source">  return !this.nodes.length;</td></tr><tr><td class="line">38</td><td class="hits"></td><td class="source">});</td></tr><tr><td class="line">39</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">40</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">41</td><td class="hits"></td><td class="source"> * Return the first node in this expression.</td></tr><tr><td class="line">42</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">43</td><td class="hits"></td><td class="source"> * @return {Node}</td></tr><tr><td class="line">44</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">45</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">46</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">47</td><td class="hits">1</td><td class="source">Expression.prototype.__defineGetter__('first', function(){</td></tr><tr class="hit"><td class="line">48</td><td class="hits">7893</td><td class="source">  return this.nodes[0]</td></tr><tr><td class="line">49</td><td class="hits"></td><td class="source">    ? this.nodes[0].first</td></tr><tr><td class="line">50</td><td class="hits"></td><td class="source">    : nodes.null;</td></tr><tr><td class="line">51</td><td class="hits"></td><td class="source">});</td></tr><tr><td class="line">52</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">53</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">54</td><td class="hits"></td><td class="source"> * Hash all the nodes in order.</td></tr><tr><td class="line">55</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">56</td><td class="hits"></td><td class="source"> * @return {String}</td></tr><tr><td class="line">57</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">58</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">59</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">60</td><td class="hits">1</td><td class="source">Expression.prototype.__defineGetter__('hash', function(){</td></tr><tr class="hit"><td class="line">61</td><td class="hits">63</td><td class="source">  return this.nodes.map(function(node){</td></tr><tr class="hit"><td class="line">62</td><td class="hits">77</td><td class="source">    return node.hash;</td></tr><tr><td class="line">63</td><td class="hits"></td><td class="source">  }).join('::');</td></tr><tr><td class="line">64</td><td class="hits"></td><td class="source">});</td></tr><tr><td class="line">65</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">66</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">67</td><td class="hits"></td><td class="source"> * Inherit from `Node.prototype`.</td></tr><tr><td class="line">68</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">69</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">70</td><td class="hits">1</td><td class="source">Expression.prototype.__proto__ = Node.prototype;</td></tr><tr><td class="line">71</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">72</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">73</td><td class="hits"></td><td class="source"> * Return a clone of this node.</td></tr><tr><td class="line">74</td><td class="hits"></td><td class="source"> * </td></tr><tr><td class="line">75</td><td class="hits"></td><td class="source"> * @return {Node}</td></tr><tr><td class="line">76</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">77</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">78</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">79</td><td class="hits">1</td><td class="source">Expression.prototype.clone = function(){</td></tr><tr class="hit"><td class="line">80</td><td class="hits">7843</td><td class="source">  var clone = new this.constructor(this.isList);</td></tr><tr class="hit"><td class="line">81</td><td class="hits">7843</td><td class="source">  clone.preserve = this.preserve;</td></tr><tr class="hit"><td class="line">82</td><td class="hits">7843</td><td class="source">  clone.lineno = this.lineno;</td></tr><tr class="hit"><td class="line">83</td><td class="hits">7843</td><td class="source">  clone.filename = this.filename;</td></tr><tr class="hit"><td class="line">84</td><td class="hits">7843</td><td class="source">  for (var i = 0; i &lt; this.nodes.length; ++i) {</td></tr><tr class="hit"><td class="line">85</td><td class="hits">8997</td><td class="source">    clone.push(this.nodes[i].clone());</td></tr><tr><td class="line">86</td><td class="hits"></td><td class="source">  }</td></tr><tr class="hit"><td class="line">87</td><td class="hits">7843</td><td class="source">  return clone;</td></tr><tr><td class="line">88</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">89</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">90</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">91</td><td class="hits"></td><td class="source"> * Push the given `node`.</td></tr><tr><td class="line">92</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">93</td><td class="hits"></td><td class="source"> * @param {Node} node</td></tr><tr><td class="line">94</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">95</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">96</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">97</td><td class="hits">1</td><td class="source">Expression.prototype.push = function(node){</td></tr><tr class="hit"><td class="line">98</td><td class="hits">90582</td><td class="source">  this.nodes.push(node);</td></tr><tr><td class="line">99</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">100</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">101</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">102</td><td class="hits"></td><td class="source"> * Operate on `right` with the given `op`.</td></tr><tr><td class="line">103</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">104</td><td class="hits"></td><td class="source"> * @param {String} op</td></tr><tr><td class="line">105</td><td class="hits"></td><td class="source"> * @param {Node} right</td></tr><tr><td class="line">106</td><td class="hits"></td><td class="source"> * @return {Node}</td></tr><tr><td class="line">107</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">108</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">109</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">110</td><td class="hits">1</td><td class="source">Expression.prototype.operate = function(op, right, val){</td></tr><tr class="hit"><td class="line">111</td><td class="hits">861</td><td class="source">  switch (op) {</td></tr><tr><td class="line">112</td><td class="hits"></td><td class="source">    case '[]=':</td></tr><tr class="hit"><td class="line">113</td><td class="hits">19</td><td class="source">      var self = this</td></tr><tr><td class="line">114</td><td class="hits"></td><td class="source">        , range = utils.unwrap(right).nodes</td></tr><tr><td class="line">115</td><td class="hits"></td><td class="source">        , val = utils.unwrap(val)</td></tr><tr><td class="line">116</td><td class="hits"></td><td class="source">        , len;</td></tr><tr class="hit"><td class="line">117</td><td class="hits">19</td><td class="source">      range.forEach(function(unit){</td></tr><tr class="hit"><td class="line">118</td><td class="hits">22</td><td class="source">        len = self.nodes.length;</td></tr><tr class="hit"><td class="line">119</td><td class="hits">22</td><td class="source">        if ('unit' == unit.nodeName) {</td></tr><tr class="hit"><td class="line">120</td><td class="hits">22</td><td class="source">          var i = unit.val;</td></tr><tr class="hit"><td class="line">121</td><td class="hits">27</td><td class="source">          while (i-- &gt; len) self.nodes[i] = nodes.null;</td></tr><tr class="hit"><td class="line">122</td><td class="hits">22</td><td class="source">          self.nodes[unit.val] = val;</td></tr><tr><td class="line">123</td><td class="hits"></td><td class="source">        }</td></tr><tr><td class="line">124</td><td class="hits"></td><td class="source">      });</td></tr><tr class="hit"><td class="line">125</td><td class="hits">19</td><td class="source">      return val;</td></tr><tr><td class="line">126</td><td class="hits"></td><td class="source">    case '[]':</td></tr><tr class="hit"><td class="line">127</td><td class="hits">211</td><td class="source">      var expr = new nodes.Expression</td></tr><tr><td class="line">128</td><td class="hits"></td><td class="source">        , vals = utils.unwrap(this).nodes</td></tr><tr><td class="line">129</td><td class="hits"></td><td class="source">        , range = utils.unwrap(right).nodes;</td></tr><tr class="hit"><td class="line">130</td><td class="hits">211</td><td class="source">      range.forEach(function(unit){</td></tr><tr class="hit"><td class="line">131</td><td class="hits">224</td><td class="source">        if ('unit' == unit.nodeName) {</td></tr><tr class="hit"><td class="line">132</td><td class="hits">223</td><td class="source">          var node = vals[unit.val];</td></tr><tr class="hit"><td class="line">133</td><td class="hits">435</td><td class="source">          if (node) expr.push(node);</td></tr><tr><td class="line">134</td><td class="hits"></td><td class="source">        }</td></tr><tr><td class="line">135</td><td class="hits"></td><td class="source">      });</td></tr><tr class="hit"><td class="line">136</td><td class="hits">211</td><td class="source">      return expr.isEmpty</td></tr><tr><td class="line">137</td><td class="hits"></td><td class="source">        ? nodes.null</td></tr><tr><td class="line">138</td><td class="hits"></td><td class="source">        : utils.unwrap(expr);</td></tr><tr><td class="line">139</td><td class="hits"></td><td class="source">    case '||':</td></tr><tr class="hit"><td class="line">140</td><td class="hits">13</td><td class="source">      return this.toBoolean().isTrue</td></tr><tr><td class="line">141</td><td class="hits"></td><td class="source">        ? this</td></tr><tr><td class="line">142</td><td class="hits"></td><td class="source">        : right;</td></tr><tr><td class="line">143</td><td class="hits"></td><td class="source">    case 'in':</td></tr><tr class="hit"><td class="line">144</td><td class="hits">11</td><td class="source">      return Node.prototype.operate.call(this, op, right);</td></tr><tr><td class="line">145</td><td class="hits"></td><td class="source">    case '!=':</td></tr><tr class="hit"><td class="line">146</td><td class="hits">9</td><td class="source">      return this.operate('==', right, val).negate();</td></tr><tr><td class="line">147</td><td class="hits"></td><td class="source">    case '==':</td></tr><tr class="hit"><td class="line">148</td><td class="hits">91</td><td class="source">      var len = this.nodes.length</td></tr><tr><td class="line">149</td><td class="hits"></td><td class="source">        , right = right.toExpression()</td></tr><tr><td class="line">150</td><td class="hits"></td><td class="source">        , a</td></tr><tr><td class="line">151</td><td class="hits"></td><td class="source">        , b;</td></tr><tr class="hit"><td class="line">152</td><td class="hits">97</td><td class="source">      if (len != right.nodes.length) return nodes.false;</td></tr><tr class="hit"><td class="line">153</td><td class="hits">85</td><td class="source">      for (var i = 0; i &lt; len; ++i) {</td></tr><tr class="hit"><td class="line">154</td><td class="hits">95</td><td class="source">        a = this.nodes[i];</td></tr><tr class="hit"><td class="line">155</td><td class="hits">95</td><td class="source">        b = right.nodes[i];</td></tr><tr class="hit"><td class="line">156</td><td class="hits">163</td><td class="source">        if (a.operate(op, b).isTrue) continue;</td></tr><tr class="hit"><td class="line">157</td><td class="hits">26</td><td class="source">        return nodes.false;</td></tr><tr><td class="line">158</td><td class="hits"></td><td class="source">      }</td></tr><tr class="hit"><td class="line">159</td><td class="hits">58</td><td class="source">      return nodes.true;</td></tr><tr class="miss"><td class="line">160</td><td class="hits">0</td><td class="source">      break;</td></tr><tr><td class="line">161</td><td class="hits"></td><td class="source">    default:</td></tr><tr class="hit"><td class="line">162</td><td class="hits">507</td><td class="source">      return this.first.operate(op, right, val);</td></tr><tr><td class="line">163</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">164</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">165</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">166</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">167</td><td class="hits"></td><td class="source"> * Expressions with length &gt; 1 are truthy,</td></tr><tr><td class="line">168</td><td class="hits"></td><td class="source"> * otherwise the first value's toBoolean()</td></tr><tr><td class="line">169</td><td class="hits"></td><td class="source"> * method is invoked.</td></tr><tr><td class="line">170</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">171</td><td class="hits"></td><td class="source"> * @return {Boolean}</td></tr><tr><td class="line">172</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">173</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">174</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">175</td><td class="hits">1</td><td class="source">Expression.prototype.toBoolean = function(){</td></tr><tr class="hit"><td class="line">176</td><td class="hits">77</td><td class="source">  if (this.nodes.length &gt; 1) return nodes.true;</td></tr><tr class="hit"><td class="line">177</td><td class="hits">51</td><td class="source">  return this.first.toBoolean();</td></tr><tr><td class="line">178</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">179</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">180</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">181</td><td class="hits"></td><td class="source"> * Return &quot;&lt;a&gt; &lt;b&gt; &lt;c&gt;&quot; or &quot;&lt;a&gt;, &lt;b&gt;, &lt;c&gt;&quot; if</td></tr><tr><td class="line">182</td><td class="hits"></td><td class="source"> * the expression represents a list.</td></tr><tr><td class="line">183</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">184</td><td class="hits"></td><td class="source"> * @return {String}</td></tr><tr><td class="line">185</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">186</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">187</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">188</td><td class="hits">1</td><td class="source">Expression.prototype.toString = function(){</td></tr><tr class="miss"><td class="line">189</td><td class="hits">0</td><td class="source">  return '(' + this.nodes.map(function(node){</td></tr><tr class="miss"><td class="line">190</td><td class="hits">0</td><td class="source">    return node.toString();</td></tr><tr><td class="line">191</td><td class="hits"></td><td class="source">  }).join(this.isList ? ', ' : ' ') + ')';</td></tr><tr><td class="line">192</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">193</td><td class="hits"></td><td class="source"> </td></tr></tbody></table></div><div class="file"><h2 id="nodes/arguments.js">nodes/arguments.js</h2><div id="stats" class="high"><div class="percentage">100%</div><div class="sloc">16</div><div class="hits">16</div><div class="misses">0</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr><td class="line">1</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source">/*!</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source"> * Stylus - Arguments</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source"> * Copyright(c) 2010 LearnBoost &lt;dev@learnboost.com&gt;</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> * MIT Licensed</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source"> * Module dependencies.</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">12</td><td class="hits">1</td><td class="source">var Node = require('./node')</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source">  , nodes = require('../nodes')</td></tr><tr><td class="line">14</td><td class="hits"></td><td class="source">  , utils = require('../utils');</td></tr><tr><td class="line">15</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">17</td><td class="hits"></td><td class="source"> * Initialize a new `Arguments`.</td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">21</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">22</td><td class="hits">1</td><td class="source">var Arguments = module.exports = function Arguments(){</td></tr><tr class="hit"><td class="line">23</td><td class="hits">16188</td><td class="source">  nodes.Expression.call(this);</td></tr><tr class="hit"><td class="line">24</td><td class="hits">16188</td><td class="source">  this.map = {};</td></tr><tr><td class="line">25</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">26</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">27</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">28</td><td class="hits"></td><td class="source"> * Inherit from `nodes.Expression.prototype`.</td></tr><tr><td class="line">29</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">30</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">31</td><td class="hits">1</td><td class="source">Arguments.prototype.__proto__ = nodes.Expression.prototype;</td></tr><tr><td class="line">32</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">33</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">34</td><td class="hits"></td><td class="source"> * Initialize an `Arguments` object with the nodes</td></tr><tr><td class="line">35</td><td class="hits"></td><td class="source"> * from the given `expr`.</td></tr><tr><td class="line">36</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">37</td><td class="hits"></td><td class="source"> * @param {Expression} expr</td></tr><tr><td class="line">38</td><td class="hits"></td><td class="source"> * @return {Arguments}</td></tr><tr><td class="line">39</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">40</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">41</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">42</td><td class="hits">1</td><td class="source">Arguments.fromExpression = function(expr){</td></tr><tr class="hit"><td class="line">43</td><td class="hits">42</td><td class="source">  var args = new Arguments</td></tr><tr><td class="line">44</td><td class="hits"></td><td class="source">    , len = expr.nodes.length;</td></tr><tr class="hit"><td class="line">45</td><td class="hits">42</td><td class="source">  args.lineno = expr.lineno;</td></tr><tr class="hit"><td class="line">46</td><td class="hits">42</td><td class="source">  args.isList = expr.isList;</td></tr><tr class="hit"><td class="line">47</td><td class="hits">42</td><td class="source">  for (var i = 0; i &lt; len; ++i) {</td></tr><tr class="hit"><td class="line">48</td><td class="hits">84</td><td class="source">    args.push(expr.nodes[i]);</td></tr><tr><td class="line">49</td><td class="hits"></td><td class="source">  }</td></tr><tr class="hit"><td class="line">50</td><td class="hits">42</td><td class="source">  return args;</td></tr><tr><td class="line">51</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">52</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">53</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">54</td><td class="hits"></td><td class="source"> * Return a clone of this node.</td></tr><tr><td class="line">55</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">56</td><td class="hits"></td><td class="source"> * @return {Node}</td></tr><tr><td class="line">57</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">58</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">59</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">60</td><td class="hits">1</td><td class="source">Arguments.prototype.clone = function(){</td></tr><tr class="hit"><td class="line">61</td><td class="hits">1366</td><td class="source">  var clone = nodes.Expression.prototype.clone.call(this);</td></tr><tr class="hit"><td class="line">62</td><td class="hits">1366</td><td class="source">  clone.map = this.map;</td></tr><tr class="hit"><td class="line">63</td><td class="hits">1366</td><td class="source">  return clone;</td></tr><tr><td class="line">64</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">65</td><td class="hits"></td><td class="source"> </td></tr></tbody></table></div><div class="file"><h2 id="errors.js">errors.js</h2><div id="stats" class="medium"><div class="percentage">53%</div><div class="sloc">13</div><div class="hits">7</div><div class="misses">6</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr><td class="line">1</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source">/*!</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source"> * Stylus - errors</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source"> * Copyright(c) 2010 LearnBoost &lt;dev@learnboost.com&gt;</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> * MIT Licensed</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source"> * Expose constructors.</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">12</td><td class="hits">1</td><td class="source">exports.ParseError = ParseError;</td></tr><tr class="hit"><td class="line">13</td><td class="hits">1</td><td class="source">exports.SyntaxError = SyntaxError;</td></tr><tr><td class="line">14</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">15</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source"> * Inherit from `Error.prototype`.</td></tr><tr><td class="line">17</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">19</td><td class="hits">1</td><td class="source">SyntaxError.prototype.__proto__ = Error.prototype;</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">21</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">22</td><td class="hits"></td><td class="source"> * Initialize a new `ParseError` with the given `msg`.</td></tr><tr><td class="line">23</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">24</td><td class="hits"></td><td class="source"> * @param {String} msg</td></tr><tr><td class="line">25</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">26</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">27</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">28</td><td class="hits">1</td><td class="source">function ParseError(msg) {</td></tr><tr class="miss"><td class="line">29</td><td class="hits">0</td><td class="source">  this.name = 'ParseError';</td></tr><tr class="miss"><td class="line">30</td><td class="hits">0</td><td class="source">  this.message = msg;</td></tr><tr class="miss"><td class="line">31</td><td class="hits">0</td><td class="source">  Error.captureStackTrace(this, ParseError);</td></tr><tr><td class="line">32</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">33</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">34</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">35</td><td class="hits"></td><td class="source"> * Inherit from `Error.prototype`.</td></tr><tr><td class="line">36</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">37</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">38</td><td class="hits">1</td><td class="source">ParseError.prototype.__proto__ = Error.prototype;</td></tr><tr><td class="line">39</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">40</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">41</td><td class="hits"></td><td class="source"> * Initialize a new `SyntaxError` with the given `msg`.</td></tr><tr><td class="line">42</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">43</td><td class="hits"></td><td class="source"> * @param {String} msg</td></tr><tr><td class="line">44</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">45</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">46</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">47</td><td class="hits">1</td><td class="source">function SyntaxError(msg) {</td></tr><tr class="miss"><td class="line">48</td><td class="hits">0</td><td class="source">  this.name = 'SyntaxError';</td></tr><tr class="miss"><td class="line">49</td><td class="hits">0</td><td class="source">  this.message = msg;</td></tr><tr class="miss"><td class="line">50</td><td class="hits">0</td><td class="source">  Error.captureStackTrace(this, ParseError);</td></tr><tr><td class="line">51</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">52</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">53</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">54</td><td class="hits"></td><td class="source"> * Inherit from `Error.prototype`.</td></tr><tr><td class="line">55</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">56</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">57</td><td class="hits">1</td><td class="source">SyntaxError.prototype.__proto__ = Error.prototype;</td></tr><tr><td class="line">58</td><td class="hits"></td><td class="source"> </td></tr></tbody></table></div><div class="file"><h2 id="visitor/normalizer.js">visitor/normalizer.js</h2><div id="stats" class="high"><div class="percentage">100%</div><div class="sloc">72</div><div class="hits">72</div><div class="misses">0</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr><td class="line">1</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source">/*!</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source"> * Stylus - Normalizer</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source"> * Copyright(c) 2010 LearnBoost &lt;dev@learnboost.com&gt;</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> * MIT Licensed</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source"> * Module dependencies.</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">12</td><td class="hits">1</td><td class="source">var Visitor = require('./')</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source">  , nodes = require('../nodes')</td></tr><tr><td class="line">14</td><td class="hits"></td><td class="source">  , utils = require('../utils')</td></tr><tr><td class="line">15</td><td class="hits"></td><td class="source">  , fs = require('fs');</td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">17</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source"> * Initialize a new `Normalizer` with the given `root` Node.</td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source"> * This visitor implements the first stage of the duel-stage</td></tr><tr><td class="line">21</td><td class="hits"></td><td class="source"> * compiler, tasked with stripping the &quot;garbage&quot; from</td></tr><tr><td class="line">22</td><td class="hits"></td><td class="source"> * the evaluated nodes, ditching null rules, resolving</td></tr><tr><td class="line">23</td><td class="hits"></td><td class="source"> * ruleset selectors etc. This step performs the logic</td></tr><tr><td class="line">24</td><td class="hits"></td><td class="source"> * necessary to facilitate the &quot;@extend&quot; functionality,</td></tr><tr><td class="line">25</td><td class="hits"></td><td class="source"> * as these must be resolved _before_ buffering output.</td></tr><tr><td class="line">26</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">27</td><td class="hits"></td><td class="source"> * @param {Node} root</td></tr><tr><td class="line">28</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">29</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">30</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">31</td><td class="hits">1</td><td class="source">var Normalizer = module.exports = function Normalizer(root, options) {</td></tr><tr class="hit"><td class="line">32</td><td class="hits">208</td><td class="source">  options = options || {};</td></tr><tr class="hit"><td class="line">33</td><td class="hits">208</td><td class="source">  Visitor.call(this, root);</td></tr><tr class="hit"><td class="line">34</td><td class="hits">208</td><td class="source">  this.stack = [];</td></tr><tr class="hit"><td class="line">35</td><td class="hits">208</td><td class="source">  this.extends = {};</td></tr><tr class="hit"><td class="line">36</td><td class="hits">208</td><td class="source">  this.map = {};</td></tr><tr><td class="line">37</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">38</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">39</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">40</td><td class="hits"></td><td class="source"> * Inherit from `Visitor.prototype`.</td></tr><tr><td class="line">41</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">42</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">43</td><td class="hits">1</td><td class="source">Normalizer.prototype.__proto__ = Visitor.prototype;</td></tr><tr><td class="line">44</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">45</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">46</td><td class="hits"></td><td class="source"> * Normalize the node tree.</td></tr><tr><td class="line">47</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">48</td><td class="hits"></td><td class="source"> * @return {Node}</td></tr><tr><td class="line">49</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">50</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">51</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">52</td><td class="hits">1</td><td class="source">Normalizer.prototype.normalize = function(){</td></tr><tr class="hit"><td class="line">53</td><td class="hits">208</td><td class="source">  return this.visit(this.root);</td></tr><tr><td class="line">54</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">55</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">56</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">57</td><td class="hits"></td><td class="source"> * Visit Root.</td></tr><tr><td class="line">58</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">59</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">60</td><td class="hits">1</td><td class="source">Normalizer.prototype.visitRoot = function(block){</td></tr><tr class="hit"><td class="line">61</td><td class="hits">208</td><td class="source">  var ret = new nodes.Root</td></tr><tr><td class="line">62</td><td class="hits"></td><td class="source">    , node;</td></tr><tr><td class="line">63</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">64</td><td class="hits">208</td><td class="source">  for (var i = 0, len = block.nodes.length; i &lt; len; ++i) {</td></tr><tr class="hit"><td class="line">65</td><td class="hits">1363</td><td class="source">    node = block.nodes[i];</td></tr><tr class="hit"><td class="line">66</td><td class="hits">1363</td><td class="source">    switch (node.nodeName) {</td></tr><tr><td class="line">67</td><td class="hits"></td><td class="source">      case 'null':</td></tr><tr><td class="line">68</td><td class="hits"></td><td class="source">      case 'expression':</td></tr><tr><td class="line">69</td><td class="hits"></td><td class="source">      case 'function':</td></tr><tr><td class="line">70</td><td class="hits"></td><td class="source">      case 'jsliteral':</td></tr><tr><td class="line">71</td><td class="hits"></td><td class="source">      case 'unit':</td></tr><tr class="hit"><td class="line">72</td><td class="hits">346</td><td class="source">        continue;</td></tr><tr><td class="line">73</td><td class="hits"></td><td class="source">      default:</td></tr><tr class="hit"><td class="line">74</td><td class="hits">1017</td><td class="source">        ret.push(this.visit(node));</td></tr><tr><td class="line">75</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">76</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">77</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">78</td><td class="hits">208</td><td class="source">  return ret;</td></tr><tr><td class="line">79</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">80</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">81</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">82</td><td class="hits"></td><td class="source"> * Visit Block.</td></tr><tr><td class="line">83</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">84</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">85</td><td class="hits">1</td><td class="source">Normalizer.prototype.visitBlock = function(block){</td></tr><tr class="hit"><td class="line">86</td><td class="hits">1070</td><td class="source">  var ret = new nodes.Block</td></tr><tr><td class="line">87</td><td class="hits"></td><td class="source">    , node;</td></tr><tr><td class="line">88</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">89</td><td class="hits">1070</td><td class="source">  if (block.hasProperties) {</td></tr><tr class="hit"><td class="line">90</td><td class="hits">962</td><td class="source">    for (var i = 0, len = block.nodes.length; i &lt; len; ++i) {</td></tr><tr class="hit"><td class="line">91</td><td class="hits">2171</td><td class="source">      this.last = len - 1 == i;</td></tr><tr class="hit"><td class="line">92</td><td class="hits">2171</td><td class="source">      node = block.nodes[i];</td></tr><tr class="hit"><td class="line">93</td><td class="hits">2171</td><td class="source">      switch (node.nodeName) {</td></tr><tr><td class="line">94</td><td class="hits"></td><td class="source">        case 'null':</td></tr><tr><td class="line">95</td><td class="hits"></td><td class="source">        case 'expression':</td></tr><tr><td class="line">96</td><td class="hits"></td><td class="source">        case 'function':</td></tr><tr><td class="line">97</td><td class="hits"></td><td class="source">        case 'jsliteral':</td></tr><tr><td class="line">98</td><td class="hits"></td><td class="source">        case 'group':</td></tr><tr><td class="line">99</td><td class="hits"></td><td class="source">        case 'unit':</td></tr><tr class="hit"><td class="line">100</td><td class="hits">166</td><td class="source">          continue;</td></tr><tr><td class="line">101</td><td class="hits"></td><td class="source">        default:</td></tr><tr class="hit"><td class="line">102</td><td class="hits">2005</td><td class="source">          ret.push(this.visit(node));</td></tr><tr><td class="line">103</td><td class="hits"></td><td class="source">      } </td></tr><tr><td class="line">104</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">105</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">106</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">107</td><td class="hits"></td><td class="source">  // nesting</td></tr><tr class="hit"><td class="line">108</td><td class="hits">1070</td><td class="source">  for (var i = 0, len = block.nodes.length; i &lt; len; ++i) {</td></tr><tr class="hit"><td class="line">109</td><td class="hits">2305</td><td class="source">    node = block.nodes[i];</td></tr><tr class="hit"><td class="line">110</td><td class="hits">2305</td><td class="source">    ret.push(this.visit(node));</td></tr><tr><td class="line">111</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">112</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">113</td><td class="hits">1070</td><td class="source">  return block;</td></tr><tr><td class="line">114</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">115</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">116</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">117</td><td class="hits"></td><td class="source"> * Visit Group.</td></tr><tr><td class="line">118</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">119</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">120</td><td class="hits">1</td><td class="source">Normalizer.prototype.visitGroup = function(group){</td></tr><tr><td class="line">121</td><td class="hits"></td><td class="source">  // TODO: clean this mess up</td></tr><tr class="hit"><td class="line">122</td><td class="hits">1045</td><td class="source">  var stack = this.stack</td></tr><tr><td class="line">123</td><td class="hits"></td><td class="source">    , map = this.map</td></tr><tr><td class="line">124</td><td class="hits"></td><td class="source">    , self = this;</td></tr><tr><td class="line">125</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">126</td><td class="hits">1045</td><td class="source">  stack.push(group.nodes);</td></tr><tr><td class="line">127</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">128</td><td class="hits">1045</td><td class="source">  var selectors = this.compileSelectors(stack);</td></tr><tr><td class="line">129</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">130</td><td class="hits"></td><td class="source">  // map for extension lookup</td></tr><tr class="hit"><td class="line">131</td><td class="hits">1045</td><td class="source">  selectors.forEach(function(selector){</td></tr><tr class="hit"><td class="line">132</td><td class="hits">1702</td><td class="source">    map[selector] = map[selector] || [];</td></tr><tr class="hit"><td class="line">133</td><td class="hits">1702</td><td class="source">    map[selector].push(group);</td></tr><tr><td class="line">134</td><td class="hits"></td><td class="source">  });</td></tr><tr><td class="line">135</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">136</td><td class="hits"></td><td class="source">  // extensions</td></tr><tr class="hit"><td class="line">137</td><td class="hits">1045</td><td class="source">  this.extend(group, selectors);</td></tr><tr><td class="line">138</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">139</td><td class="hits">1045</td><td class="source">  group.block = this.visit(group.block);</td></tr><tr class="hit"><td class="line">140</td><td class="hits">1045</td><td class="source">  stack.pop();</td></tr><tr class="hit"><td class="line">141</td><td class="hits">1045</td><td class="source">  return group;</td></tr><tr><td class="line">142</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">143</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">144</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">145</td><td class="hits"></td><td class="source"> * Apply `group` extensions.</td></tr><tr><td class="line">146</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">147</td><td class="hits"></td><td class="source"> * @param {Group} group</td></tr><tr><td class="line">148</td><td class="hits"></td><td class="source"> * @param {Array} selectors</td></tr><tr><td class="line">149</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">150</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">151</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">152</td><td class="hits">1</td><td class="source">Normalizer.prototype.extend = function(group, selectors){</td></tr><tr class="hit"><td class="line">153</td><td class="hits">1064</td><td class="source">  var map = this.map</td></tr><tr><td class="line">154</td><td class="hits"></td><td class="source">    , self = this;</td></tr><tr><td class="line">155</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">156</td><td class="hits">1064</td><td class="source">  group.extends.forEach(function(extend){</td></tr><tr class="hit"><td class="line">157</td><td class="hits">16</td><td class="source">    var groups = map[extend];</td></tr><tr class="hit"><td class="line">158</td><td class="hits">16</td><td class="source">    if (!groups) throw new Error('Failed to @extend &quot;' + extend + '&quot;');</td></tr><tr class="hit"><td class="line">159</td><td class="hits">16</td><td class="source">    selectors.forEach(function(selector){</td></tr><tr class="hit"><td class="line">160</td><td class="hits">18</td><td class="source">      var node = new nodes.Selector;</td></tr><tr class="hit"><td class="line">161</td><td class="hits">18</td><td class="source">      node.val = selector;</td></tr><tr class="hit"><td class="line">162</td><td class="hits">18</td><td class="source">      node.inherits = false;</td></tr><tr class="hit"><td class="line">163</td><td class="hits">18</td><td class="source">      groups.forEach(function(group){</td></tr><tr class="hit"><td class="line">164</td><td class="hits">19</td><td class="source">        self.extend(group, selectors);</td></tr><tr class="hit"><td class="line">165</td><td class="hits">19</td><td class="source">        group.push(node);</td></tr><tr><td class="line">166</td><td class="hits"></td><td class="source">      });</td></tr><tr><td class="line">167</td><td class="hits"></td><td class="source">    });</td></tr><tr><td class="line">168</td><td class="hits"></td><td class="source">  });</td></tr><tr><td class="line">169</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">170</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">171</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">172</td><td class="hits"></td><td class="source"> * Compile selector strings in `arr` from the bottom-up</td></tr><tr><td class="line">173</td><td class="hits"></td><td class="source"> * to produce the selector combinations. For example</td></tr><tr><td class="line">174</td><td class="hits"></td><td class="source"> * the following Stylus:</td></tr><tr><td class="line">175</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">176</td><td class="hits"></td><td class="source"> *    ul</td></tr><tr><td class="line">177</td><td class="hits"></td><td class="source"> *      li</td></tr><tr><td class="line">178</td><td class="hits"></td><td class="source"> *      p</td></tr><tr><td class="line">179</td><td class="hits"></td><td class="source"> *        a</td></tr><tr><td class="line">180</td><td class="hits"></td><td class="source"> *          color: red</td></tr><tr><td class="line">181</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">182</td><td class="hits"></td><td class="source"> * Would return:</td></tr><tr><td class="line">183</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">184</td><td class="hits"></td><td class="source"> *      [ 'ul li a', 'ul p a' ]</td></tr><tr><td class="line">185</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">186</td><td class="hits"></td><td class="source"> * @param {Array} arr</td></tr><tr><td class="line">187</td><td class="hits"></td><td class="source"> * @return {Array}</td></tr><tr><td class="line">188</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">189</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">190</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">191</td><td class="hits">1</td><td class="source">Normalizer.prototype.compileSelectors = function(arr){</td></tr><tr><td class="line">192</td><td class="hits"></td><td class="source">  // TODO: remove this duplication</td></tr><tr class="hit"><td class="line">193</td><td class="hits">1045</td><td class="source">  var stack = this.stack</td></tr><tr><td class="line">194</td><td class="hits"></td><td class="source">    , self = this</td></tr><tr><td class="line">195</td><td class="hits"></td><td class="source">    , selectors = []</td></tr><tr><td class="line">196</td><td class="hits"></td><td class="source">    , buf = [];</td></tr><tr><td class="line">197</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">198</td><td class="hits">1045</td><td class="source">  function compile(arr, i) {</td></tr><tr class="hit"><td class="line">199</td><td class="hits">1280</td><td class="source">    if (i) {</td></tr><tr class="hit"><td class="line">200</td><td class="hits">189</td><td class="source">      arr[i].forEach(function(selector){</td></tr><tr class="hit"><td class="line">201</td><td class="hits">235</td><td class="source">        buf.unshift(selector.val);</td></tr><tr class="hit"><td class="line">202</td><td class="hits">235</td><td class="source">        compile(arr, i - 1);</td></tr><tr class="hit"><td class="line">203</td><td class="hits">235</td><td class="source">        buf.shift();</td></tr><tr><td class="line">204</td><td class="hits"></td><td class="source">      });</td></tr><tr><td class="line">205</td><td class="hits"></td><td class="source">    } else {</td></tr><tr class="hit"><td class="line">206</td><td class="hits">1091</td><td class="source">      arr[0].forEach(function(selector){</td></tr><tr class="hit"><td class="line">207</td><td class="hits">1702</td><td class="source">        var str = selector.val.trim();</td></tr><tr class="hit"><td class="line">208</td><td class="hits">1702</td><td class="source">        if (buf.length) {</td></tr><tr class="hit"><td class="line">209</td><td class="hits">215</td><td class="source">          for (var i = 0, len = buf.length; i &lt; len; ++i) {</td></tr><tr class="hit"><td class="line">210</td><td class="hits">290</td><td class="source">            if (~buf[i].indexOf('&amp;')) {</td></tr><tr class="hit"><td class="line">211</td><td class="hits">57</td><td class="source">              str = buf[i].replace(/&amp;/g, str).trim();</td></tr><tr><td class="line">212</td><td class="hits"></td><td class="source">            } else {</td></tr><tr class="hit"><td class="line">213</td><td class="hits">233</td><td class="source">              str += ' ' + buf[i].trim();</td></tr><tr><td class="line">214</td><td class="hits"></td><td class="source">            }</td></tr><tr><td class="line">215</td><td class="hits"></td><td class="source">          }</td></tr><tr><td class="line">216</td><td class="hits"></td><td class="source">        }</td></tr><tr class="hit"><td class="line">217</td><td class="hits">1702</td><td class="source">        selectors.push(str.trimRight());</td></tr><tr><td class="line">218</td><td class="hits"></td><td class="source">      });</td></tr><tr><td class="line">219</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">220</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">221</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">222</td><td class="hits">1045</td><td class="source">  compile(arr, arr.length - 1);</td></tr><tr><td class="line">223</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">224</td><td class="hits">1045</td><td class="source">  return selectors;</td></tr><tr><td class="line">225</td><td class="hits"></td><td class="source">};</td></tr></tbody></table></div><div class="file"><h2 id="middleware.js">middleware.js</h2><div id="stats" class="terrible"><div class="percentage">7%</div><div class="sloc">68</div><div class="hits">5</div><div class="misses">63</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr><td class="line">1</td><td class="hits"></td><td class="source">/*!</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> * Stylus - middleware</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source"> * Copyright(c) 2010 LearnBoost &lt;dev@learnboost.com&gt;</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source"> * MIT Licensed</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source"> * Module dependencies.</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">11</td><td class="hits">1</td><td class="source">var stylus = require('./stylus')</td></tr><tr><td class="line">12</td><td class="hits"></td><td class="source">  , fs = require('fs')</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source">  , url = require('url')</td></tr><tr><td class="line">14</td><td class="hits"></td><td class="source">  , basename = require('path').basename</td></tr><tr><td class="line">15</td><td class="hits"></td><td class="source">  , dirname = require('path').dirname</td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source">  , mkdirp = require('mkdirp')</td></tr><tr><td class="line">17</td><td class="hits"></td><td class="source">  , join = require('path').join;</td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source"> * Import map.</td></tr><tr><td class="line">21</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">22</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">23</td><td class="hits">1</td><td class="source">var imports = {};</td></tr><tr><td class="line">24</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">25</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">26</td><td class="hits"></td><td class="source"> * Return Connect middleware with the given `options`.</td></tr><tr><td class="line">27</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">28</td><td class="hits"></td><td class="source"> * Options:</td></tr><tr><td class="line">29</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">30</td><td class="hits"></td><td class="source"> *    `force`     Always re-compile</td></tr><tr><td class="line">31</td><td class="hits"></td><td class="source"> *    `debug`     Output debugging information</td></tr><tr><td class="line">32</td><td class="hits"></td><td class="source"> *    `src`       Source directory used to find .styl files</td></tr><tr><td class="line">33</td><td class="hits"></td><td class="source"> *    `dest`      Destination directory used to output .css files</td></tr><tr><td class="line">34</td><td class="hits"></td><td class="source"> *                when undefined defaults to `src`.</td></tr><tr><td class="line">35</td><td class="hits"></td><td class="source"> *    `compile`   Custom compile function, accepting the arguments</td></tr><tr><td class="line">36</td><td class="hits"></td><td class="source"> *                `(str, path)`.</td></tr><tr><td class="line">37</td><td class="hits"></td><td class="source"> *    `compress`  Whether the output .css files should be compressed</td></tr><tr><td class="line">38</td><td class="hits"></td><td class="source"> *    `firebug`   Emits debug infos in the generated css that can</td></tr><tr><td class="line">39</td><td class="hits"></td><td class="source"> *                be used by the FireStylus Firebug plugin</td></tr><tr><td class="line">40</td><td class="hits"></td><td class="source"> *    `linenos`   Emits comments in the generated css indicating </td></tr><tr><td class="line">41</td><td class="hits"></td><td class="source"> *                the corresponding stylus line</td></tr><tr><td class="line">42</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">43</td><td class="hits"></td><td class="source"> * Examples:</td></tr><tr><td class="line">44</td><td class="hits"></td><td class="source"> * </td></tr><tr><td class="line">45</td><td class="hits"></td><td class="source"> * Here we set up the custom compile function so that we may</td></tr><tr><td class="line">46</td><td class="hits"></td><td class="source"> * set the `compress` option, or define additional functions.</td></tr><tr><td class="line">47</td><td class="hits"></td><td class="source"> * </td></tr><tr><td class="line">48</td><td class="hits"></td><td class="source"> * By default the compile function simply sets the `filename`</td></tr><tr><td class="line">49</td><td class="hits"></td><td class="source"> * and renders the CSS.</td></tr><tr><td class="line">50</td><td class="hits"></td><td class="source"> * </td></tr><tr><td class="line">51</td><td class="hits"></td><td class="source"> *      function compile(str, path) {</td></tr><tr><td class="line">52</td><td class="hits"></td><td class="source"> *        return stylus(str)</td></tr><tr><td class="line">53</td><td class="hits"></td><td class="source"> *          .set('filename', path)</td></tr><tr><td class="line">54</td><td class="hits"></td><td class="source"> *          .set('compress', true);</td></tr><tr><td class="line">55</td><td class="hits"></td><td class="source"> *      }</td></tr><tr><td class="line">56</td><td class="hits"></td><td class="source"> * </td></tr><tr><td class="line">57</td><td class="hits"></td><td class="source"> * Pass the middleware to Connect, grabbing .styl files from this directory</td></tr><tr><td class="line">58</td><td class="hits"></td><td class="source"> * and saving .css files to _./public_. Also supplying our custom `compile` function.</td></tr><tr><td class="line">59</td><td class="hits"></td><td class="source"> * </td></tr><tr><td class="line">60</td><td class="hits"></td><td class="source"> * Following that we have a `staticProvider` layer setup to serve the .css</td></tr><tr><td class="line">61</td><td class="hits"></td><td class="source"> * files generated by Stylus.</td></tr><tr><td class="line">62</td><td class="hits"></td><td class="source"> * </td></tr><tr><td class="line">63</td><td class="hits"></td><td class="source"> *      var server = connect.createServer(</td></tr><tr><td class="line">64</td><td class="hits"></td><td class="source"> *          stylus.middleware({</td></tr><tr><td class="line">65</td><td class="hits"></td><td class="source"> *              src: __dirname</td></tr><tr><td class="line">66</td><td class="hits"></td><td class="source"> *            , dest: __dirname + '/public'</td></tr><tr><td class="line">67</td><td class="hits"></td><td class="source"> *            , compile: compile</td></tr><tr><td class="line">68</td><td class="hits"></td><td class="source"> *          })</td></tr><tr><td class="line">69</td><td class="hits"></td><td class="source"> *        , connect.static(__dirname + '/public')</td></tr><tr><td class="line">70</td><td class="hits"></td><td class="source"> *      );</td></tr><tr><td class="line">71</td><td class="hits"></td><td class="source"> * </td></tr><tr><td class="line">72</td><td class="hits"></td><td class="source"> * @param {Object} options</td></tr><tr><td class="line">73</td><td class="hits"></td><td class="source"> * @return {Function}</td></tr><tr><td class="line">74</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">75</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">76</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">77</td><td class="hits">1</td><td class="source">module.exports = function(options){</td></tr><tr class="miss"><td class="line">78</td><td class="hits">0</td><td class="source">  options = options || {};</td></tr><tr><td class="line">79</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">80</td><td class="hits"></td><td class="source">  // Accept src/dest dir</td></tr><tr class="miss"><td class="line">81</td><td class="hits">0</td><td class="source">  if ('string' == typeof options) {</td></tr><tr class="miss"><td class="line">82</td><td class="hits">0</td><td class="source">    options = { src: options };</td></tr><tr><td class="line">83</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">84</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">85</td><td class="hits"></td><td class="source">  // Force compilation</td></tr><tr class="miss"><td class="line">86</td><td class="hits">0</td><td class="source">  var force = options.force;</td></tr><tr><td class="line">87</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">88</td><td class="hits"></td><td class="source">  // Debug option</td></tr><tr class="miss"><td class="line">89</td><td class="hits">0</td><td class="source">  var debug = options.debug;</td></tr><tr><td class="line">90</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">91</td><td class="hits"></td><td class="source">  // Source dir required</td></tr><tr class="miss"><td class="line">92</td><td class="hits">0</td><td class="source">  var src = options.src;</td></tr><tr class="miss"><td class="line">93</td><td class="hits">0</td><td class="source">  if (!src) throw new Error('stylus.middleware() requires &quot;src&quot; directory');</td></tr><tr><td class="line">94</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">95</td><td class="hits"></td><td class="source">  // Default dest dir to source</td></tr><tr class="miss"><td class="line">96</td><td class="hits">0</td><td class="source">  var dest = options.dest</td></tr><tr><td class="line">97</td><td class="hits"></td><td class="source">    ? options.dest</td></tr><tr><td class="line">98</td><td class="hits"></td><td class="source">    : src;</td></tr><tr><td class="line">99</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">100</td><td class="hits"></td><td class="source">  // Default compile callback</td></tr><tr class="miss"><td class="line">101</td><td class="hits">0</td><td class="source">  options.compile = options.compile || function(str, path){</td></tr><tr class="miss"><td class="line">102</td><td class="hits">0</td><td class="source">    return stylus(str)</td></tr><tr><td class="line">103</td><td class="hits"></td><td class="source">      .set('filename', path)</td></tr><tr><td class="line">104</td><td class="hits"></td><td class="source">      .set('compress', options.compress)</td></tr><tr><td class="line">105</td><td class="hits"></td><td class="source">      .set('firebug', options.firebug)</td></tr><tr><td class="line">106</td><td class="hits"></td><td class="source">      .set('linenos', options.linenos);</td></tr><tr><td class="line">107</td><td class="hits"></td><td class="source">  };</td></tr><tr><td class="line">108</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">109</td><td class="hits"></td><td class="source">  // Middleware</td></tr><tr class="miss"><td class="line">110</td><td class="hits">0</td><td class="source">  return function stylus(req, res, next){</td></tr><tr class="miss"><td class="line">111</td><td class="hits">0</td><td class="source">    if ('GET' != req.method &amp;&amp; 'HEAD' != req.method) return next();</td></tr><tr class="miss"><td class="line">112</td><td class="hits">0</td><td class="source">    var path = url.parse(req.url).pathname;</td></tr><tr class="miss"><td class="line">113</td><td class="hits">0</td><td class="source">    if (/\.css$/.test(path)) {</td></tr><tr class="miss"><td class="line">114</td><td class="hits">0</td><td class="source">      var cssPath = join(dest, path)</td></tr><tr><td class="line">115</td><td class="hits"></td><td class="source">        , stylusPath = join(src, path.replace('.css', '.styl'));</td></tr><tr><td class="line">116</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">117</td><td class="hits">0</td><td class="source">      if (debug) {</td></tr><tr class="miss"><td class="line">118</td><td class="hits">0</td><td class="source">        log('source', stylusPath);</td></tr><tr class="miss"><td class="line">119</td><td class="hits">0</td><td class="source">        log('dest', cssPath);</td></tr><tr><td class="line">120</td><td class="hits"></td><td class="source">      }</td></tr><tr><td class="line">121</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">122</td><td class="hits"></td><td class="source">      // Ignore ENOENT to fall through as 404</td></tr><tr class="miss"><td class="line">123</td><td class="hits">0</td><td class="source">      function error(err) {</td></tr><tr class="miss"><td class="line">124</td><td class="hits">0</td><td class="source">        next('ENOENT' == err.code</td></tr><tr><td class="line">125</td><td class="hits"></td><td class="source">          ? null</td></tr><tr><td class="line">126</td><td class="hits"></td><td class="source">          : err);</td></tr><tr><td class="line">127</td><td class="hits"></td><td class="source">      }</td></tr><tr><td class="line">128</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">129</td><td class="hits"></td><td class="source">      // Force</td></tr><tr class="miss"><td class="line">130</td><td class="hits">0</td><td class="source">      if (force) return compile();</td></tr><tr><td class="line">131</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">132</td><td class="hits"></td><td class="source">      // Compile to cssPath</td></tr><tr class="miss"><td class="line">133</td><td class="hits">0</td><td class="source">      function compile() {</td></tr><tr class="miss"><td class="line">134</td><td class="hits">0</td><td class="source">        if (debug) log('read', cssPath);</td></tr><tr class="miss"><td class="line">135</td><td class="hits">0</td><td class="source">        fs.readFile(stylusPath, 'utf8', function(err, str){</td></tr><tr class="miss"><td class="line">136</td><td class="hits">0</td><td class="source">          if (err) return error(err);</td></tr><tr class="miss"><td class="line">137</td><td class="hits">0</td><td class="source">          var style = options.compile(str, stylusPath);</td></tr><tr class="miss"><td class="line">138</td><td class="hits">0</td><td class="source">          var paths = style.options._imports = [];</td></tr><tr class="miss"><td class="line">139</td><td class="hits">0</td><td class="source">          delete imports[stylusPath];</td></tr><tr class="miss"><td class="line">140</td><td class="hits">0</td><td class="source">          style.render(function(err, css){</td></tr><tr class="miss"><td class="line">141</td><td class="hits">0</td><td class="source">            if (err) return next(err);</td></tr><tr class="miss"><td class="line">142</td><td class="hits">0</td><td class="source">            if (debug) log('render', stylusPath);</td></tr><tr class="miss"><td class="line">143</td><td class="hits">0</td><td class="source">            imports[stylusPath] = paths;</td></tr><tr class="miss"><td class="line">144</td><td class="hits">0</td><td class="source">            mkdirp(dirname(cssPath), 0700, function(err){</td></tr><tr class="miss"><td class="line">145</td><td class="hits">0</td><td class="source">              if (err) return error(err);</td></tr><tr class="miss"><td class="line">146</td><td class="hits">0</td><td class="source">              fs.writeFile(cssPath, css, 'utf8', next);</td></tr><tr><td class="line">147</td><td class="hits"></td><td class="source">            });</td></tr><tr><td class="line">148</td><td class="hits"></td><td class="source">          });</td></tr><tr><td class="line">149</td><td class="hits"></td><td class="source">        });</td></tr><tr><td class="line">150</td><td class="hits"></td><td class="source">      }</td></tr><tr><td class="line">151</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">152</td><td class="hits"></td><td class="source">      // Re-compile on server restart, disregarding</td></tr><tr><td class="line">153</td><td class="hits"></td><td class="source">      // mtimes since we need to map imports</td></tr><tr class="miss"><td class="line">154</td><td class="hits">0</td><td class="source">      if (!imports[stylusPath]) return compile();</td></tr><tr><td class="line">155</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">156</td><td class="hits"></td><td class="source">      // Compare mtimes</td></tr><tr class="miss"><td class="line">157</td><td class="hits">0</td><td class="source">      fs.stat(stylusPath, function(err, stylusStats){</td></tr><tr class="miss"><td class="line">158</td><td class="hits">0</td><td class="source">        if (err) return error(err);</td></tr><tr class="miss"><td class="line">159</td><td class="hits">0</td><td class="source">        fs.stat(cssPath, function(err, cssStats){</td></tr><tr><td class="line">160</td><td class="hits"></td><td class="source">          // CSS has not been compiled, compile it!</td></tr><tr class="miss"><td class="line">161</td><td class="hits">0</td><td class="source">          if (err) {</td></tr><tr class="miss"><td class="line">162</td><td class="hits">0</td><td class="source">            if ('ENOENT' == err.code) {</td></tr><tr class="miss"><td class="line">163</td><td class="hits">0</td><td class="source">              if (debug) log('not found', cssPath);</td></tr><tr class="miss"><td class="line">164</td><td class="hits">0</td><td class="source">              compile();</td></tr><tr><td class="line">165</td><td class="hits"></td><td class="source">            } else {</td></tr><tr class="miss"><td class="line">166</td><td class="hits">0</td><td class="source">              next(err);</td></tr><tr><td class="line">167</td><td class="hits"></td><td class="source">            }</td></tr><tr><td class="line">168</td><td class="hits"></td><td class="source">          } else {</td></tr><tr><td class="line">169</td><td class="hits"></td><td class="source">            // Source has changed, compile it</td></tr><tr class="miss"><td class="line">170</td><td class="hits">0</td><td class="source">            if (stylusStats.mtime &gt; cssStats.mtime) {</td></tr><tr class="miss"><td class="line">171</td><td class="hits">0</td><td class="source">              if (debug) log('modified', cssPath);</td></tr><tr class="miss"><td class="line">172</td><td class="hits">0</td><td class="source">              compile();</td></tr><tr><td class="line">173</td><td class="hits"></td><td class="source">            // Already compiled, check imports</td></tr><tr><td class="line">174</td><td class="hits"></td><td class="source">            } else {</td></tr><tr class="miss"><td class="line">175</td><td class="hits">0</td><td class="source">              checkImports(stylusPath, function(changed){</td></tr><tr class="miss"><td class="line">176</td><td class="hits">0</td><td class="source">                if (debug &amp;&amp; changed.length) {</td></tr><tr class="miss"><td class="line">177</td><td class="hits">0</td><td class="source">                  changed.forEach(function(path) {</td></tr><tr class="miss"><td class="line">178</td><td class="hits">0</td><td class="source">                    log('modified import %s', path);</td></tr><tr><td class="line">179</td><td class="hits"></td><td class="source">                  });</td></tr><tr><td class="line">180</td><td class="hits"></td><td class="source">                }</td></tr><tr class="miss"><td class="line">181</td><td class="hits">0</td><td class="source">                changed.length ? compile() : next();</td></tr><tr><td class="line">182</td><td class="hits"></td><td class="source">              });</td></tr><tr><td class="line">183</td><td class="hits"></td><td class="source">            }</td></tr><tr><td class="line">184</td><td class="hits"></td><td class="source">          }</td></tr><tr><td class="line">185</td><td class="hits"></td><td class="source">        });</td></tr><tr><td class="line">186</td><td class="hits"></td><td class="source">      });</td></tr><tr><td class="line">187</td><td class="hits"></td><td class="source">    } else {</td></tr><tr class="miss"><td class="line">188</td><td class="hits">0</td><td class="source">      next();</td></tr><tr><td class="line">189</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">190</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">191</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">192</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">193</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">194</td><td class="hits"></td><td class="source"> * Check `path`'s imports to see if they have been altered.</td></tr><tr><td class="line">195</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">196</td><td class="hits"></td><td class="source"> * @param {String} path</td></tr><tr><td class="line">197</td><td class="hits"></td><td class="source"> * @param {Function} fn</td></tr><tr><td class="line">198</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">199</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">200</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">201</td><td class="hits">1</td><td class="source">function checkImports(path, fn) {</td></tr><tr class="miss"><td class="line">202</td><td class="hits">0</td><td class="source">  var nodes = imports[path];</td></tr><tr class="miss"><td class="line">203</td><td class="hits">0</td><td class="source">  if (!nodes) return fn();</td></tr><tr class="miss"><td class="line">204</td><td class="hits">0</td><td class="source">  if (!nodes.length) return fn();</td></tr><tr><td class="line">205</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">206</td><td class="hits">0</td><td class="source">  var pending = nodes.length</td></tr><tr><td class="line">207</td><td class="hits"></td><td class="source">    , changed = [];</td></tr><tr><td class="line">208</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">209</td><td class="hits">0</td><td class="source">  nodes.forEach(function(imported){</td></tr><tr class="miss"><td class="line">210</td><td class="hits">0</td><td class="source">    fs.stat(imported.path, function(err, stat){</td></tr><tr><td class="line">211</td><td class="hits"></td><td class="source">      // error or newer mtime</td></tr><tr class="miss"><td class="line">212</td><td class="hits">0</td><td class="source">      if (err || !imported.mtime || stat.mtime &gt; imported.mtime) {</td></tr><tr class="miss"><td class="line">213</td><td class="hits">0</td><td class="source">        changed.push(imported.path);</td></tr><tr><td class="line">214</td><td class="hits"></td><td class="source">      }</td></tr><tr class="miss"><td class="line">215</td><td class="hits">0</td><td class="source">      --pending || fn(changed);</td></tr><tr><td class="line">216</td><td class="hits"></td><td class="source">    });</td></tr><tr><td class="line">217</td><td class="hits"></td><td class="source">  });</td></tr><tr><td class="line">218</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">219</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">220</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">221</td><td class="hits"></td><td class="source"> * Log a message.</td></tr><tr><td class="line">222</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">223</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">224</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">225</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">226</td><td class="hits">1</td><td class="source">function log(key, val) {</td></tr><tr class="miss"><td class="line">227</td><td class="hits">0</td><td class="source">  console.error('  \033[90m%s :\033[0m \033[36m%s\033[0m', key, val);</td></tr><tr><td class="line">228</td><td class="hits"></td><td class="source">}</td></tr></tbody></table></div><div class="file"><h2 id="convert/css.js">convert/css.js</h2><div id="stats" class="terrible"><div class="percentage">20%</div><div class="sloc">39</div><div class="hits">8</div><div class="misses">31</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr><td class="line">1</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source">/*!</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source"> * Stylus - css to stylus conversion</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source"> * Copyright(c) 2010 LearnBoost &lt;dev@learnboost.com&gt;</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> * MIT Licensed</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source"> * Convert the given `css` to stylus source.</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source"> * @param {String} css</td></tr><tr><td class="line">12</td><td class="hits"></td><td class="source"> * @return {String}</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">14</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">15</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">16</td><td class="hits">1</td><td class="source">module.exports = function(css){</td></tr><tr class="miss"><td class="line">17</td><td class="hits">0</td><td class="source">  return new Converter(css).stylus();</td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">21</td><td class="hits"></td><td class="source"> * Initialize a new `Converter` with the given `css`.</td></tr><tr><td class="line">22</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">23</td><td class="hits"></td><td class="source"> * @param {String} css</td></tr><tr><td class="line">24</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">25</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">26</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">27</td><td class="hits">1</td><td class="source">function Converter(css) {</td></tr><tr class="miss"><td class="line">28</td><td class="hits">0</td><td class="source">  var cssom = require('cssom');</td></tr><tr class="miss"><td class="line">29</td><td class="hits">0</td><td class="source">  this.css = css;</td></tr><tr class="miss"><td class="line">30</td><td class="hits">0</td><td class="source">  this.types = cssom.CSSRule;</td></tr><tr class="miss"><td class="line">31</td><td class="hits">0</td><td class="source">  this.root = cssom.parse(css);</td></tr><tr class="miss"><td class="line">32</td><td class="hits">0</td><td class="source">  this.indents = 0;</td></tr><tr><td class="line">33</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">34</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">35</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">36</td><td class="hits"></td><td class="source"> * Convert to stylus.</td></tr><tr><td class="line">37</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">38</td><td class="hits"></td><td class="source"> * @return {String}</td></tr><tr><td class="line">39</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">40</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">41</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">42</td><td class="hits">1</td><td class="source">Converter.prototype.stylus = function(){</td></tr><tr class="miss"><td class="line">43</td><td class="hits">0</td><td class="source">  return this.visitRules(this.root.cssRules);</td></tr><tr><td class="line">44</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">45</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">46</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">47</td><td class="hits"></td><td class="source"> * Return indent string.</td></tr><tr><td class="line">48</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">49</td><td class="hits"></td><td class="source"> * @return {String}</td></tr><tr><td class="line">50</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">51</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">52</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">53</td><td class="hits">1</td><td class="source">Converter.prototype.__defineGetter__('indent', function(){</td></tr><tr class="miss"><td class="line">54</td><td class="hits">0</td><td class="source">  return Array(this.indents + 1).join('  ');</td></tr><tr><td class="line">55</td><td class="hits"></td><td class="source">});</td></tr><tr><td class="line">56</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">57</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">58</td><td class="hits"></td><td class="source"> * Visit `node`.</td></tr><tr><td class="line">59</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">60</td><td class="hits"></td><td class="source"> * @param {CSSRule} node</td></tr><tr><td class="line">61</td><td class="hits"></td><td class="source"> * @return {String}</td></tr><tr><td class="line">62</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">63</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">64</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">65</td><td class="hits">1</td><td class="source">Converter.prototype.visit = function(node){</td></tr><tr class="miss"><td class="line">66</td><td class="hits">0</td><td class="source">  switch (node.type) {</td></tr><tr><td class="line">67</td><td class="hits"></td><td class="source">    case this.types.STYLE_RULE:</td></tr><tr class="miss"><td class="line">68</td><td class="hits">0</td><td class="source">      return this.visitStyle(node);</td></tr><tr><td class="line">69</td><td class="hits"></td><td class="source">    case this.types.MEDIA_RULE:</td></tr><tr class="miss"><td class="line">70</td><td class="hits">0</td><td class="source">      return this.visitMedia(node);</td></tr><tr><td class="line">71</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">72</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">73</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">74</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">75</td><td class="hits"></td><td class="source"> * Visit the rules on `node`.</td></tr><tr><td class="line">76</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">77</td><td class="hits"></td><td class="source"> * @param {CSSRule} node</td></tr><tr><td class="line">78</td><td class="hits"></td><td class="source"> * @return {String}</td></tr><tr><td class="line">79</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">80</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">81</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">82</td><td class="hits">1</td><td class="source">Converter.prototype.visitRules = function(node){</td></tr><tr class="miss"><td class="line">83</td><td class="hits">0</td><td class="source">  var buf = '';</td></tr><tr class="miss"><td class="line">84</td><td class="hits">0</td><td class="source">  for (var i = 0, len = node.length; i &lt; len; ++i) {</td></tr><tr class="miss"><td class="line">85</td><td class="hits">0</td><td class="source">    buf += this.visit(node[i]);</td></tr><tr><td class="line">86</td><td class="hits"></td><td class="source">  }</td></tr><tr class="miss"><td class="line">87</td><td class="hits">0</td><td class="source">  return buf;</td></tr><tr><td class="line">88</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">89</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">90</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">91</td><td class="hits"></td><td class="source"> * Visit CSSMediaRule `node`.</td></tr><tr><td class="line">92</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">93</td><td class="hits"></td><td class="source"> * @param {CSSMediaRule} node</td></tr><tr><td class="line">94</td><td class="hits"></td><td class="source"> * @return {String}</td></tr><tr><td class="line">95</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">96</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">97</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">98</td><td class="hits">1</td><td class="source">Converter.prototype.visitMedia = function(node){</td></tr><tr class="miss"><td class="line">99</td><td class="hits">0</td><td class="source">  var buf = this.indent + '@media ';</td></tr><tr class="miss"><td class="line">100</td><td class="hits">0</td><td class="source">  for (var i = 0, len = node.media.length; i &lt; len; ++i) {</td></tr><tr class="miss"><td class="line">101</td><td class="hits">0</td><td class="source">    buf += node.media[i];</td></tr><tr><td class="line">102</td><td class="hits"></td><td class="source">  }</td></tr><tr class="miss"><td class="line">103</td><td class="hits">0</td><td class="source">  buf += '\n';</td></tr><tr class="miss"><td class="line">104</td><td class="hits">0</td><td class="source">  ++this.indents;</td></tr><tr class="miss"><td class="line">105</td><td class="hits">0</td><td class="source">  buf += this.visitRules(node.cssRules);</td></tr><tr class="miss"><td class="line">106</td><td class="hits">0</td><td class="source">  --this.indents;</td></tr><tr class="miss"><td class="line">107</td><td class="hits">0</td><td class="source">  return buf;</td></tr><tr><td class="line">108</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">109</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">110</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">111</td><td class="hits"></td><td class="source"> * Visit CSSStyleRule `node`.`</td></tr><tr><td class="line">112</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">113</td><td class="hits"></td><td class="source"> * @param {CSSStyleRule} node</td></tr><tr><td class="line">114</td><td class="hits"></td><td class="source"> * @return {String}</td></tr><tr><td class="line">115</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">116</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">117</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">118</td><td class="hits">1</td><td class="source">Converter.prototype.visitStyle = function(node){</td></tr><tr class="miss"><td class="line">119</td><td class="hits">0</td><td class="source">  var buf = this.indent + node.selectorText + '\n';</td></tr><tr class="miss"><td class="line">120</td><td class="hits">0</td><td class="source">  ++this.indents;</td></tr><tr class="miss"><td class="line">121</td><td class="hits">0</td><td class="source">  for (var i = 0, len = node.style.length; i &lt; len; ++i) {</td></tr><tr class="miss"><td class="line">122</td><td class="hits">0</td><td class="source">    var prop = node.style[i]</td></tr><tr><td class="line">123</td><td class="hits"></td><td class="source">      , val = node.style[prop];</td></tr><tr class="miss"><td class="line">124</td><td class="hits">0</td><td class="source">    if (prop) {</td></tr><tr class="miss"><td class="line">125</td><td class="hits">0</td><td class="source">      buf += this.indent + prop + ': ' + val + '\n';</td></tr><tr><td class="line">126</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">127</td><td class="hits"></td><td class="source">  }</td></tr><tr class="miss"><td class="line">128</td><td class="hits">0</td><td class="source">  --this.indents;</td></tr><tr class="miss"><td class="line">129</td><td class="hits">0</td><td class="source">  return buf + '\n';</td></tr><tr><td class="line">130</td><td class="hits"></td><td class="source">};</td></tr></tbody></table></div><div class="file"><h2 id="functions/url.js">functions/url.js</h2><div id="stats" class="high"><div class="percentage">85%</div><div class="sloc">21</div><div class="hits">18</div><div class="misses">3</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr><td class="line">1</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source">/*!</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source"> * Stylus - plugin - url</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source"> * Copyright(c) 2010 LearnBoost &lt;dev@learnboost.com&gt;</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> * MIT Licensed</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source"> * Module dependencies.</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">12</td><td class="hits">1</td><td class="source">var Compiler = require('../visitor/compiler')</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source">  , nodes = require('../nodes')</td></tr><tr><td class="line">14</td><td class="hits"></td><td class="source">  , parse = require('url').parse</td></tr><tr><td class="line">15</td><td class="hits"></td><td class="source">  , extname = require('path').extname</td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source">  , utils = require('../utils')</td></tr><tr><td class="line">17</td><td class="hits"></td><td class="source">  , fs = require('fs');</td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source"> * Mime table.</td></tr><tr><td class="line">21</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">22</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">23</td><td class="hits">1</td><td class="source">var mimes = {</td></tr><tr><td class="line">24</td><td class="hits"></td><td class="source">    '.gif': 'image/gif'</td></tr><tr><td class="line">25</td><td class="hits"></td><td class="source">  , '.png': 'image/png'</td></tr><tr><td class="line">26</td><td class="hits"></td><td class="source">  , '.jpg': 'image/jpeg'</td></tr><tr><td class="line">27</td><td class="hits"></td><td class="source">  , '.jpeg': 'image/jpeg'</td></tr><tr><td class="line">28</td><td class="hits"></td><td class="source">  , '.svg': 'image/svg+xml'</td></tr><tr><td class="line">29</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">30</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">31</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">32</td><td class="hits"></td><td class="source"> * Return a url() function with the given `options`.</td></tr><tr><td class="line">33</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">34</td><td class="hits"></td><td class="source"> * Options:</td></tr><tr><td class="line">35</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">36</td><td class="hits"></td><td class="source"> *    - `limit` bytesize limit defaulting to 30Kb</td></tr><tr><td class="line">37</td><td class="hits"></td><td class="source"> *    - `paths` image resolution path(s), merged with general lookup paths</td></tr><tr><td class="line">38</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">39</td><td class="hits"></td><td class="source"> * Examples:</td></tr><tr><td class="line">40</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">41</td><td class="hits"></td><td class="source"> *    stylus(str)</td></tr><tr><td class="line">42</td><td class="hits"></td><td class="source"> *      .set('filename', __dirname + '/css/test.styl')</td></tr><tr><td class="line">43</td><td class="hits"></td><td class="source"> *      .define('url', stylus.url({ paths: [__dirname + '/public'] }))</td></tr><tr><td class="line">44</td><td class="hits"></td><td class="source"> *      .render(function(err, css){ ... })</td></tr><tr><td class="line">45</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">46</td><td class="hits"></td><td class="source"> * @param {Object} options</td></tr><tr><td class="line">47</td><td class="hits"></td><td class="source"> * @return {Function}</td></tr><tr><td class="line">48</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">49</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">50</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">51</td><td class="hits">1</td><td class="source">module.exports = function(options) {</td></tr><tr class="hit"><td class="line">52</td><td class="hits">208</td><td class="source">  options = options || {};</td></tr><tr><td class="line">53</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">54</td><td class="hits">208</td><td class="source">  var sizeLimit = options.limit || 30000</td></tr><tr><td class="line">55</td><td class="hits"></td><td class="source">    , _paths = options.paths || [];</td></tr><tr><td class="line">56</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">57</td><td class="hits">208</td><td class="source">  function url(url){</td></tr><tr><td class="line">58</td><td class="hits"></td><td class="source">    // Compile the url</td></tr><tr class="hit"><td class="line">59</td><td class="hits">16</td><td class="source">    var compiler = new Compiler(url);</td></tr><tr class="hit"><td class="line">60</td><td class="hits">16</td><td class="source">    compiler.isURL = true;</td></tr><tr class="hit"><td class="line">61</td><td class="hits">16</td><td class="source">    var url = url.nodes.map(function(node){</td></tr><tr class="hit"><td class="line">62</td><td class="hits">59</td><td class="source">      return compiler.visit(node);</td></tr><tr><td class="line">63</td><td class="hits"></td><td class="source">    }).join('');</td></tr><tr><td class="line">64</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">65</td><td class="hits"></td><td class="source">    // Parse literal </td></tr><tr class="hit"><td class="line">66</td><td class="hits">16</td><td class="source">    var url = parse(url)</td></tr><tr><td class="line">67</td><td class="hits"></td><td class="source">      , ext = extname(url.pathname)</td></tr><tr><td class="line">68</td><td class="hits"></td><td class="source">      , mime = mimes[ext]</td></tr><tr><td class="line">69</td><td class="hits"></td><td class="source">      , literal = new nodes.Literal('url(&quot;' + url.href + '&quot;)')</td></tr><tr><td class="line">70</td><td class="hits"></td><td class="source">      , paths = _paths.concat(this.paths)</td></tr><tr><td class="line">71</td><td class="hits"></td><td class="source">      , founds</td></tr><tr><td class="line">72</td><td class="hits"></td><td class="source">      , buf;</td></tr><tr><td class="line">73</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">74</td><td class="hits"></td><td class="source">    // Not supported</td></tr><tr class="hit"><td class="line">75</td><td class="hits">19</td><td class="source">    if (!mime) return literal;</td></tr><tr><td class="line">76</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">77</td><td class="hits"></td><td class="source">    // Absolute</td></tr><tr class="hit"><td class="line">78</td><td class="hits">14</td><td class="source">    if (url.protocol) return literal;</td></tr><tr><td class="line">79</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">80</td><td class="hits"></td><td class="source">    // Lookup</td></tr><tr class="hit"><td class="line">81</td><td class="hits">12</td><td class="source">    var found = utils.lookup(url.pathname, paths);</td></tr><tr><td class="line">82</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">83</td><td class="hits"></td><td class="source">    // Failed to lookup</td></tr><tr class="hit"><td class="line">84</td><td class="hits">24</td><td class="source">    if (!found) return literal;</td></tr><tr><td class="line">85</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">86</td><td class="hits"></td><td class="source">    // Read data</td></tr><tr class="miss"><td class="line">87</td><td class="hits">0</td><td class="source">    buf = fs.readFileSync(found);</td></tr><tr><td class="line">88</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">89</td><td class="hits"></td><td class="source">    // To large</td></tr><tr class="miss"><td class="line">90</td><td class="hits">0</td><td class="source">    if (buf.length &gt; sizeLimit) return literal;</td></tr><tr><td class="line">91</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">92</td><td class="hits"></td><td class="source">    // Encode</td></tr><tr class="miss"><td class="line">93</td><td class="hits">0</td><td class="source">    return new nodes.Literal('url(&quot;data:' + mime + ';base64,' + buf.toString('base64') + '&quot;)');</td></tr><tr class="hit"><td class="line">94</td><td class="hits">208</td><td class="source">  };</td></tr><tr><td class="line">95</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">96</td><td class="hits">208</td><td class="source">  url.raw = true;</td></tr><tr class="hit"><td class="line">97</td><td class="hits">208</td><td class="source">  return url;</td></tr><tr><td class="line">98</td><td class="hits"></td><td class="source">};</td></tr></tbody></table></div></div></div></body></html>